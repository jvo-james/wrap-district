<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wrap District — Mobile</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet"/>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>
<style>
/* ----------------------------
  APPETIZING COLOR THEME — Food-focused
  Replace the original :root and body background rules with this block.
  ---------------------------- */
:root{
  /* Primary palette — warm & appetizing */
  --accent-1: #FF6A00;        /* vibrant orange - primary CTA */
  --accent-2: #FFD166;        /* warm golden yellow - highlight */
  --accent-3: #78C267;        /* fresh green - freshness / success */
  --accent-4: #D96A2B;        /* secondary orange (for subtle contrast) */

  /* Neutral / text */
  --bg-start: #0b0b0b;        /* deep charcoal for dramatic food photography */
  --bg-end:   #20140d;        /* warm deep brown tint */
  --muted:    #E6E1DC;        /* off-white for readable small text */
  --muted-2:  rgba(230,225,220,0.78);
  --text:     #FFF9F6;        /* main content text */

  /* Glass / cards */
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(255,255,255,0.02);
  --glass-border: rgba(255,255,255,0.04);

  /* Shadows / radii */
  --card-shadow: 0 12px 40px rgba(0,0,0,0.65);
  --accent-shadow: 0 10px 30px rgba(255,106,0,0.12);
  --radius-lg: 14px;
  --radius-sm: 10px;

  --max-width: 420px;
  --safe-top: env(safe-area-inset-top, 12px);
}

/* Page background — warm, slightly textured gradient to make food photos pop */
body {
  background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
  color: var(--text);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  margin: 0;
  -webkit-text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Small tweaks to key UI pieces to match the palette */
.logo-mark{
  background: linear-gradient(135deg, var(--accent-1), var(--accent-4));
  color: #111; /* dark text on bright badge gives premium stamp look */
  font-weight:900;
  padding:6px 10px;
  border-radius:8px;
  font-size:16px;
  letter-spacing:1px;
  box-shadow: 0 8px 26px rgba(217,106,43,0.10), inset 0 -2px 0 rgba(0,0,0,0.06);
}

.logo-name{
  color: var(--accent-2);
  font-weight:700;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:1px;
}

/* CTAs — primary and ghost tuned for better contrast */
.btn.primary{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  box-shadow: var(--accent-shadow);
  border: 0;
}
.btn.ghost{
  background: rgba(255,255,255,0.03);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.04);
}

/* Slide eyebrow & titles tuned */
.eyebrow{ color: var(--accent-2); font-weight: 800; }
.slide-title{ color: var(--text); text-shadow: 0 10px 30px rgba(0,0,0,0.6); }
.slide-sub{ color: var(--muted-2); }

/* Accent icon colors used around slides */
.art-icon{ color: rgba(255,230,200,0.95); }

/* Cart badge uses the same appetizing gradient */
.cart-count, .cart-mini-count {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:800;
  box-shadow: var(--accent-shadow);
}

/* Menu cards: slightly warmer surfaces to read as food cards */
.menu-item{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: var(--radius-lg);
  padding: 10px;
  box-shadow: var(--card-shadow);
  border: 1px solid var(--glass-border);
}

/* Price chips: make them pop without feeling loud */
.menu-item::after{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  padding:6px 10px;
  border-radius:999px;
}

/* Promo badges */
.badge, .promo-badge, .promo-badge-small{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:900;
}

/* Cart lines warm accent for quantities */
.line-qty{ color: var(--accent-2); font-weight:900; }

/* Promo countdown chip tuned */
.promo-countdown-chip{ background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); color:#111; }

/* Modal inner highlight for promo */
.entry-promo .modal-inner{
  background: linear-gradient(90deg, rgba(255,106,0,0.07), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,204,51,0.08);
}

/* Small accessibility improvement: ensure links on dark backgrounds are readable */
a { color: var(--accent-2); text-decoration: none; }



/* ---------- STICKY HEADER ---------- */
.sticky-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: calc(56px + var(--safe-top));
  padding-top: var(--safe-top);
  z-index: 1200;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px) saturate(130%);
  background: linear-gradient(180deg, rgba(10,10,10,0.6), rgba(10,10,10,0.45));
  border-bottom: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 6px 18px rgba(0,0,0,0.45);
}

/* header inner row */
.header-inner{
  width: 100%;
  max-width: var(--max-width);
  display:flex;
  align-items:center;
  gap:12px;
  padding:8px 14px;
  box-sizing: border-box;
}

/* Logo (left) */
.logo{
  display:flex;
  align-items:center;
  gap:8px;
  flex: 1 1 auto;
  cursor: default;
  user-select: none;
}
.logo-mark{
  background: linear-gradient(135deg, var(--accent-1), #ff8c2b);
  color: #111;
  font-weight:900;
  padding:6px 10px;
  border-radius:8px;
  font-size:16px;
  letter-spacing:1px;
  box-shadow: 0 6px 18px rgba(255,106,0,0.12), inset 0 -2px 0 rgba(0,0,0,0.08);
}
.logo-name{
  color: var(--accent-2);
  font-weight:700;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:1px;
}

/* Icon buttons (cart, hamburger) */
.icon-btn{
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size:20px;
  line-height:1;
  padding:8px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  -webkit-tap-highlight-color: transparent;
}
.icon-btn:active{ transform: translateY(1px) scale(.995); }

/* Cart button specifically */
.cart-btn{
  position: relative;
  margin-right: 6px;
  color: var(--accent-2);
  font-size:20px;
  min-width:44px;
  min-height:44px;
  display:inline-grid;
  place-items:center;
}

/* cart count badge */
.cart-count{
  position: absolute;
  top: 6px;
  right: 6px;
  transform: translate(25%, -10%);
  background: linear-gradient(180deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:800;
  font-size:12px;
  padding:4px 6px;
  border-radius:999px;
  box-shadow: 0 6px 16px rgba(255,106,0,0.14);
  border: 2px solid rgba(255,255,255,0.05);
  min-width: 22px;
  text-align:center;
}

/* Hamburger on far right */
.ham-btn{
  color: var(--muted);
  font-size:20px;
  width:44px;
  height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Ensure header elements are keyboard-focusable and visible */
.icon-btn:focus{ outline: 3px solid rgba(255,204,51,0.12); outline-offset: 3px; }

/* ---------- HERO SLIDESHOW (mobile-first, full-bleed) ---------- */
.hero-slideshow{
  margin-top: calc(56px + var(--safe-top)); /* push content under fixed header */
  width: 100%;
  max-width: var(--max-width);
  margin-left: auto;
  margin-right: auto;
  position: relative;
  overflow: visible;
  padding-bottom: 10px;
}

/* Slide wrapper */
.slides{
  position: relative;
  width: 100%;
  height: 66vh; /* large visual on phones */
  max-height: 560px;
  min-height: 360px;
  border-bottom-left-radius: 22px;
  border-bottom-right-radius: 22px;
  overflow: clip;
  box-shadow: var(--card-shadow);
}

/* Each slide - JS toggles display:block/none; keep transitions for overlay */
.slide{
  position: absolute;
  inset: 0;
  display: none; /* JS will set block for active one */
  will-change: opacity, transform;
}

/* full-bleed image */
.slide-img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  -webkit-user-drag: none;
  transform-origin: center center;
  transition: transform 900ms cubic-bezier(.2,.9,.3,1);
  filter: saturate(1.05) contrast(1.02);
  transform: scale(1.02);
}

/* subtle parallax on active slide */
.slide[style*="display: block"] .slide-img {
  transform: scale(1);
}

/* gradient overlay + frosted glass content */
.slide-overlay{
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(10,10,10,0.08) 0%, rgba(0,0,0,0.55) 70%);
  display: flex;
  align-items: flex-end;
  padding: 18px;
  box-sizing: border-box;
}

/* Slide content container (frosted card) */
.slide-content{
  width: 100%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 14px;
  padding: 14px;
  backdrop-filter: blur(6px) saturate(120%);
  border: 1px solid var(--glass-border);
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  display: flex;
  flex-direction: column;
  gap:8px;
  transform: translateY(8px);
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), opacity 420ms ease;
}
/* ===== Header: larger cart icon, smaller badge ===== */
.cart-btn{
  position: relative;
  margin-right: 6px;
  color: var(--accent-2);
  /* made the icon visually larger and a bit more tappable */
  font-size: 26px;        /* was 20px */
  min-width:52px;        /* increased tap area */
  min-height:52px;
  display:inline-grid;
  place-items:center;
  border-radius:12px;
}
/* ---------- HERO IMAGE IMPROVEMENT (replace existing .slide-img block) ---------- */

/* show full image without aggressive cropping; keeps it centered and avoids upscaling */
.slide-img{
  width: 100%;
  height: 100%;
  object-fit: contain;        /* show the whole image (no crop) */
  object-position: center;    /* keeps the subject centered */
  display: block;
  -webkit-user-drag: none;
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), filter 300ms ease;
  filter: saturate(1.03) contrast(1.02);
  transform: scale(1);        /* remove the intentional zoom */
  background-color: #000;     /* hides any tiny gaps with a neutral background */
}

/* keep slide-content animation behavior but no scale-change on active state */
.slide[style*="display: block"] .slide-img {
  transform: scale(1);
}

  .slide-img{
  width:100%;
  height:100%;
  object-fit: cover;   /* still fills container */
  object-position: center;
  transform: scale(0.98);   /* slight zoom-out to reduce aggressive cropping */
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), filter 300ms ease;
  filter: saturate(1.03) contrast(1.02);
}
.slide[style*="display: block"] .slide-img { transform: scale(0.98); }
  
/* cart count badge — smaller, tighter, and repositioned */
.cart-count{
  position: absolute;
  top: 6px;
  right: 6px;
  transform: translate(35%, -35%); /* nudged so it sits nicely on a bigger icon */
  background: linear-gradient(180deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:800;
  font-size:10px;        /* reduced from 12px */
  padding:3px 5px;       /* reduced padding for compactness */
  border-radius:999px;
  box-shadow: 0 6px 16px rgba(255,106,0,0.14);
  border: 2px solid rgba(255,255,255,0.05);
  min-width: 18px;       /* slightly smaller */
  text-align:center;
  line-height:1;
}

/* Keep the badge readable on very small screens */
@media (max-width:360px){
  .cart-btn{ font-size:24px; min-width:48px; min-height:48px; }
  .cart-count{ font-size:9px; padding:2px 5px; min-width:16px; transform: translate(35%, -40%); }
}
/* When slide is active, lift the card a bit */
.slide[style*="display: block"] .slide-content {
  transform: translateY(0);
  opacity: 1;
}

/* Eyebrow small label */
.eyebrow{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-size:12px;
  color: var(--accent-2);
  font-weight:700;
  text-transform:uppercase;
}

/* Headline */
.slide-title{
  font-size:20px;
  line-height:1.05;
  margin:0;
  color: #fff;
  text-shadow: 0 8px 30px rgba(0,0,0,0.6);
  letter-spacing: -0.2px;
  font-weight:800;
}

/* sub text */
.slide-sub{
  font-size:13px;
  color: rgba(255,255,255,0.86);
  margin:0;
}

/* CTA Buttons inside slides */
.slide-ctas{
  display:flex;
  gap:8px;
  margin-top:6px;
  flex-wrap:wrap;
}

/* Buttons style (used across site) */
.btn{
  border: 0;
  padding:10px 12px;
  border-radius: 12px;
  font-weight:700;
  font-size:13px;
  display:inline-flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  min-height:44px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.btn.primary{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  box-shadow: 0 10px 30px rgba(255,106,0,0.12);
}
.btn.ghost{
  background: rgba(255,255,255,0.03);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.04);
}

/* small / tiny */
.btn.small{ padding:8px 10px; font-size:13px; border-radius:10px; min-height:36px; }

/* decorative art icons floating around slide content */
.slide-art{
  position: absolute;
  right: 14px;
  top: 12px;
  display:flex;
  gap:8px;
  z-index: 15;
  pointer-events: none;
}
.art-icon{
  font-size:20px;
  color: rgba(255,255,255,0.9);
  opacity: 0.95;
  transform-origin: center;
  filter: drop-shadow(0 6px 20px rgba(0,0,0,0.4));
  animation: float 6s ease-in-out infinite;
}
.art-icon:nth-child(2){ animation-delay: 1.2s; transform: scale(.92); }

/* slide promo specific look */
.slide-promo .slide-content{
  border: 1px solid rgba(255,204,51,0.12);
  background: linear-gradient(180deg, rgba(255,106,0,0.06), rgba(255,255,255,0.02));
}

/* slideshow controls (bottom center) */
.slideshow-controls{
  position: absolute;
  left: 0;
  right: 0;
  bottom: 8px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index: 30;
  pointer-events: none;
}
.slideshow-controls .icon-btn { pointer-events: auto; background: rgba(0,0,0,0.45); color: #fff; border-radius: 10px; padding:8px; }

/* dots */
.slide-dots{
  display:flex;
  gap:8px;
  align-items:center;
  pointer-events: auto;
}
.dot{
  width:10px;
  height:10px;
  border-radius:999px;
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,0.04);
  padding:0;
}
.dot.is-active{
  width:34px;
  border-radius:999px;
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  box-shadow: 0 8px 20px rgba(255,106,0,0.14);
}

/* ---------- Accessibility / touch improvements ---------- */
.icon-btn, .btn { touch-action: manipulation; -webkit-user-select: none; user-select: none; }
.slide .slide-content a, .slide .slide-content button { -webkit-tap-highlight-color: transparent; }

/* ---------- Animations ---------- */
@keyframes float{
  0% { transform: translateY(0) rotate(-2deg); opacity: .95; }
  50% { transform: translateY(-8px) rotate(2deg); opacity: 1; }
  100% { transform: translateY(0) rotate(-2deg); opacity: .95; }
}

/* ---------- Responsive tweaks for very small phones ---------- */
@media (max-width:360px){
  .slide-title { font-size:18px; }
  .slide-sub { font-size:12px; }
  .slide-content { padding: 12px; border-radius: 12px; }
  .slides { height: 62vh; min-height: 320px; }
}

/* ---------- Desktop (wider) graceful scale (won't be used as primary) ---------- */
@media (min-width: 640px){
  .hero-slideshow{ margin-top: calc(64px + var(--safe-top)); }
  .slides { height: 56vh; }
  .slide-title { font-size: 28px; }
  .slide-sub { font-size: 15px; }
}

/* ---------- Tiny utility classes used in body markup ---------- */
.hidden { display: none !important; }
.container-small { padding: 14px; max-width: var(--max-width); margin: 0 auto; box-sizing: border-box; }

</style>
  <style>
    /* ===== Checkout scroll & sticky order header fixes =====
   Paste after your checkout CSS blocks (near end of <body>)
*/
#checkout-page {
  overflow: auto;                 /* allow page-level scrolling on mobile */
  -webkit-overflow-scrolling: touch;
}

#checkout-inner {
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 48px)); /* keep inner dialog inside viewport */
  box-sizing: border-box;
  display: grid;
  grid-template-columns: 1fr 360px;
  gap: 0;
  margin: calc(56px + var(--safe-top,12px) + 12px) auto 24px;
}

/* ensure the left and right columns scroll independently */
.checkout-left,
.checkout-right {
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 140px)); /* leaves room for header/footers */
}

/* keep "Your order" heading visible and pinned while contents scroll */
.checkout-right > h4 {
  position: sticky;
  top: 0;
  z-index: 6;
  background: transparent;
  padding-top: 6px;
  margin: 0 0 10px 0;
}

/* make the order lines area scrollable */
#cf-order-lines {
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 220px));
}

/* small screens: ensure stacked layout still scrolls well */
@media (max-width: 900px) {
  #checkout-inner { grid-template-columns: 1fr; max-width: 680px; }
  #cf-order-lines { max-height: calc(60vh); }
}
/* =========================
   Wrap District — Cart / Cart Drawer Styling (Mobile-first, gorgeous)
   Complements header & hero styles. Drop into your stylesheet.
   ========================= */

/* Reuse theme variables from earlier; provide fallbacks */
:root{
  --accent-1: #ff6a00;
  --accent-2: #ffcc33;
  --muted: #d7d7d7;
  --bg-card: rgba(17,17,17,0.85);
  --glass-strong: rgba(255,255,255,0.04);
  --glass-soft: rgba(255,255,255,0.02);
  --shadow-xl: 0 22px 50px rgba(0,0,0,0.6);
  --radius-lg: 16px;
  --radius-sm: 10px;
  --cart-header-h: 72px;
  --cart-footer-h: 96px;
  --max-width: 420px;
}

/* ---------- CART DRAWER (off-canvas) ---------- */
.cart-drawer{
  position: fixed;
  top: 0;
  right: 0;
  width: 94%;
  max-width: var(--max-width);
  height: 100vh;
  background: linear-gradient(180deg, rgba(12,12,12,0.96), rgba(8,8,8,0.98));
  box-shadow: -28px 0 60px rgba(0,0,0,0.65);
  z-index: 1400;
  transform: translateX(110%);
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), opacity 300ms ease;
  opacity: 0;
  display: none; /* JS toggles block + aria-hidden */
  border-left: 1px solid rgba(255,255,255,0.03);
  overflow: hidden;
  border-top-left-radius: 18px;
  border-bottom-left-radius: 18px;
}

/* When visible (JS sets aria-hidden="false" and display:block) */
.cart-drawer[aria-hidden="false"]{
  transform: translateX(0);
  opacity: 1;
  display: block;
}

/* ---------- Cart header ---------- */
.cart-header{
  height: var(--cart-header-h);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 14px 14px;
  gap:10px;
  box-sizing: border-box;
  background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-bottom: 1px solid rgba(255,255,255,0.03);
  position: relative;
  backdrop-filter: blur(6px) saturate(120%);
}
.cart-header h3{
  margin:0;
  font-size:16px;
  letter-spacing: .2px;
  color: var(--accent-2);
  font-weight:800;
  display:flex;
  align-items:center;
  gap:10px;
}
.cart-header .cart-mini-count{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color:#111;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  box-shadow: 0 8px 30px rgba(255,106,0,0.12);
  border: 2px solid rgba(255,255,255,0.04);
}

/* close button */
#cart-close{
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size:18px;
  padding:8px;
  border-radius:10px;
}
#cart-close:focus{ outline: 3px solid rgba(255,204,51,0.10); outline-offset:2px; }

/* ---------- Cart body (scrollable) ---------- */
.cart-body{
  padding: 12px;
  height: calc(100vh - var(--cart-header-h) - var(--cart-footer-h));
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

    /* ---------- Cart: thumbnails + sticky footer polish (add after your cart styles) ---------- */

/* thumbnail inside cart line */
.cart-thumb{
  width:64px;
  height:56px;
  object-fit: cover;
  border-radius:8px;
  flex: 0 0 64px;
  margin-right:12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.45);
  border: 1px solid rgba(255,255,255,0.03);
}

/* adjust cart-line left area to align image + text nicely */
.cart-line .line-left{
  display:flex;
  align-items:center;
  gap:12px;
}

/* make footer sticky and slightly elevated */
.cart-footer{
  position: sticky;
  bottom: 0;
  z-index: 60;
  height: var(--cart-footer-h);
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(6,6,6,0.96), rgba(8,8,8,0.98));
  backdrop-filter: blur(6px) saturate(120%);
  box-shadow: 0 -8px 28px rgba(0,0,0,0.6);
  box-sizing: border-box;
}

/* give cart-body bottom padding so content never hides under sticky footer */
.cart-body{
  padding-bottom: calc(var(--cart-footer-h) + 18px);
}

/* small condensed summary inside footer for immediate totals */
.cart-footer .footer-summary{
  display:flex;
  align-items:center;
  gap:12px;
  min-width: 0;
  flex: 1 1 auto;
}
.cart-footer .footer-summary .total-label{ color: rgba(255,255,255,0.85); font-weight:800; font-size:13px; }
.cart-footer .footer-summary .total-value{ font-weight:900; font-size:16px; color: var(--accent-2); }

/* make checkout/clear buttons share space nicely on small screens */
.cart-footer .footer-actions{
  display:flex;
  gap:8px;
  width: 48%;
  min-width: 160px;
  justify-content: flex-end;
}

/* ensure cart-drawer content height calculation still works on larger screens */
@media (min-width: 640px) {
  .cart-body{ height: calc(100vh - var(--cart-header-h) - var(--cart-footer-h)); }
}
    
/* Nice custom scrollbar (WebKit) */
.cart-body::-webkit-scrollbar{ width:8px; }
.cart-body::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border-radius: 999px;
  border: 2px solid rgba(0,0,0,0.3);
}

/* Empty cart message */
.cart-items .empty{
  padding: 28px 12px;
  text-align: center;
  color: rgba(255,255,255,0.75);
  font-weight:700;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius: 12px;
  margin: 6px 0 14px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.45) inset;
}

/* ---------- Cart line items ---------- */
.cart-items{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; }

.cart-line{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 8px 28px rgba(0,0,0,0.45);
}

/* Free promo lines look lighter and friendly */
.cart-line.cart-free{
  background: linear-gradient(180deg, rgba(34,34,34,0.65), rgba(20,20,20,0.6));
  border: 1px dashed rgba(255,204,51,0.09);
  color: var(--accent-2);
}

/* left area - title & meta */
.line-left{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width: 0;
  flex: 1 1 auto;
}
.line-title{
  font-size:14px;
  font-weight:800;
  color: #fff;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.line-meta{
  color: rgba(255,255,255,0.66);
  font-size:13px;
  font-weight:700;
}

/* right area - controls */
.line-controls{
  display:flex;
  align-items:center;
  gap:8px;
  flex: 0 0 auto;
}

/* round quantity controls */
.icon-btn.cart-increase, .icon-btn.cart-decrease, .icon-btn.cart-remove {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  width:40px;
  height:40px;
  display:inline-grid;
  place-items:center;
  border-radius:10px;
  color: var(--muted);
  font-size:16px;
  transition: transform 150ms ease, background 180ms ease, color 180ms ease;
}
.icon-btn.cart-increase:hover, .icon-btn.cart-decrease:hover {
  transform: translateY(-3px);
  color: var(--accent-2);
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
}
.icon-btn.cart-remove{ color: rgba(255,140,100,0.95); border-color: rgba(255,140,100,0.06); }
.icon-btn.cart-remove:hover{ transform: translateY(-3px); color: #ff6a00; }

/* quantity number inside meta (if present) */
.line-qty{ font-weight:900; color: var(--accent-2); }

/* ---------- Promo / discount block ---------- */
.cart-promo{
  margin-top: 12px;
  padding: 12px;
  border-radius: 12px;
  background: linear-gradient(90deg, rgba(255,204,51,0.06), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,204,51,0.08);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.promo-applied{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.promo-label{ font-weight:800; color: #fff; }
.promo-value{ font-weight:900; color: #111; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); padding:6px 10px; border-radius:999px; }

/* helper row */
.promo-cta{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:6px; }
#add-missing{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  padding:8px 10px;
  border-radius:10px;
  border:0;
  font-weight:800;
  min-width:120px;
  box-shadow: 0 10px 30px rgba(255,106,0,0.12);
}
.promo-cta small{ color: rgba(255,255,255,0.78); font-weight:700; }

/* ---------- Cart summary ---------- */
.cart-summary{
  margin-top: 14px;
  padding: 12px;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.03);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.summary-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  color: rgba(255,255,255,0.9);
  font-weight:700;
  font-size:15px;
  padding:6px 0;
}
.summary-row.total{
  font-size:18px;
  color:#fff;
  font-weight:900;
  border-top: 1px dashed rgba(255,255,255,0.04);
  padding-top:10px;
}

/* ---------- Cart footer (checkout actions) ---------- */
.cart-footer{
  height: var(--cart-footer-h);
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,0.03);
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.04));
  box-sizing: border-box;
}
.btn.fullwidth{ width: 100%; padding: 14px; font-size:16px; border-radius:12px; }
.btn.primary.fullwidth{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  font-weight:900;
  box-shadow: 0 12px 36px rgba(255,106,0,0.14);
}
.btn.ghost.fullwidth{
  background: transparent;
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.04);
}

/* small / tiny btn used in promo helper */
.btn.tiny{ padding:8px 10px; border-radius:10px; font-weight:800; }

/* ---------- Utility & focus ---------- */
.cart-drawer :focus { outline: none; }
.cart-drawer button:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset: 3px; border-radius: 10px; }

/* ---------- Micro animations ---------- */
.cart-line { transition: transform 250ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms ease; }
.cart-line:hover { transform: translateY(-3px); box-shadow: 0 30px 60px rgba(0,0,0,0.55); }

/* ---------- Responsive tweaks ---------- */
@media (min-width: 640px){
  .cart-drawer{
    width: 420px;
  }
  .cart-body{ height: calc(100vh - var(--cart-header-h) - var(--cart-footer-h)); }
  .cart-header h3{ font-size:18px; }
  .cart-line{ padding:14px; }
}

/* ---------- Small polish: badges used inside cart if any ---------- */
.badge-inline{
  background: rgba(255,204,51,0.08);
  color: var(--accent-2);
  font-weight:800;
  padding:6px 8px;
  border-radius: 999px;
  font-size:12px;
  border: 1px solid rgba(255,204,51,0.08);
}

/* ---------- End of cart styles ---------- */
</style>

  <style>
/* =========================
   Wrap District — Menu Section Styling (Mobile-first, ultra-appealing & appetizing)
   Use with the existing header / hero / cart styles. Focused on:
   - bold food photography cards
   - clear pricing tiers & CTA
   - tasty color palette, gradients, micro-anim
   ========================= */

/* Fallback theme variables (will reuse if already defined) */
:root{
  --accent-1: #ff6a00;
  --accent-2: #ffcc33;
  --muted: #d7d7d7;
  --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  --glass: rgba(255,255,255,0.03);
  --shadow-lg: 0 18px 40px rgba(0,0,0,0.6);
  --radius-lg: 14px;
  --radius-md: 12px;
  --max-width: 420px;
}

/* Container for menu section */
.menu-section{
  width: 100%;
  max-width: var(--max-width);
  margin: 12px auto 28px;
  padding: 0 14px;
  box-sizing: border-box;
}

/* Section heading */
.section-title{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:18px;
  color: var(--accent-2);
  font-weight:900;
  margin-bottom:8px;
  text-transform: none;
}
.section-sub{
  color: rgba(255,255,255,0.78);
  font-size:13px;
  margin-bottom:12px;
}

/* Menu grid (vertical list on mobile) */
.menu-grid{
  display:flex;
  flex-direction:column;
  gap:14px;
}

    /* ------- Menu container & tabs polish (add after menu styles) ------- */
.menu-container {
  padding: 12px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(6,6,6,0.92), rgba(12,12,12,0.95));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.55);
}

/* tabs */
.menu-tabs {
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding: 8px 4px 12px;
  -webkit-overflow-scrolling: touch;
}
.menu-tabs .tab-btn {
  white-space:nowrap;
  flex:0 0 auto;
  border:0;
  padding:8px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,0.02);
  color: var(--muted);
  font-weight:900;
  font-size:13px;
  cursor:pointer;
  outline: none;
  border: 1px solid rgba(255,255,255,0.02);
}
.menu-tabs .tab-btn.is-active {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  box-shadow: 0 12px 36px rgba(255,106,0,0.10);
}

/* visually distinct card: left accent + stronger contrast */
.menu-item {
  position: relative;
  padding: 12px;
  border-radius: 12px;
  display:block;
  transition: transform 220ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms ease;
  border-left: 6px solid transparent;
  background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
}
.menu-item:focus,
.menu-item:hover {
  transform: translateY(-6px);
  box-shadow: 0 36px 80px rgba(0,0,0,0.6);
  border-left-color: rgba(255,106,0,0.95);
  outline: none;
}

/* larger, rounder thumbnail so items are easier to distinguish */
.item-thumb {
  width:110px;
  height:86px;
  border-radius:12px;
  flex:0 0 110px;
  object-fit: cover;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 8px 28px rgba(0,0,0,0.45);
}

/* stronger title contrast */
.item-title { font-size:16px; color:#fff; }

/* small spacing improvements */
.menu-grid { display:flex; flex-direction:column; gap:14px; }

/* On larger widths show two-column grid */
@media (min-width: 540px) {
  .menu-grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
}

/* increase hit-target for add/remove on mobile */
.action-row .btn { min-width:48px; padding:10px 14px; }

/* small focus ring for keyboard users */
.menu-item:focus { box-shadow: 0 8px 30px rgba(0,0,0,0.55), 0 0 0 3px rgba(255,204,51,0.06); }
    
/* Each menu card */
.menu-item{
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 10px;
  box-shadow: var(--shadow-lg);
  border: 1px solid rgba(255,255,255,0.03);
  overflow: hidden;
  transition: transform 240ms cubic-bezier(.2,.9,.3,1), box-shadow 240ms ease;
}

/* Lift on hover/tap */
.menu-item:active,
.menu-item:hover{
  transform: translateY(-6px);
  box-shadow: 0 36px 80px rgba(0,0,0,0.6);
}

/* Top row: image + meta */
.item-top{
  display:flex;
  gap:12px;
  align-items:flex-start;
}

/* Round-edge image thumb */
.item-thumb{
  width:94px;
  height:84px;
  object-fit:cover;
  border-radius:12px;
  flex: 0 0 94px;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 10px 30px rgba(0,0,0,0.45);
  transform-origin: center;
  transition: transform 420ms cubic-bezier(.2,.9,.3,1);
}

/* Zoom subtle on hover */
.menu-item:hover .item-thumb{ transform: scale(1.03) rotate(-0.5deg); }

/* Title + desc area */
.item-meta{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width: 0;
}
.item-title{
  font-size:16px;
  color: #fff;
  font-weight:900;
  line-height:1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  display:flex;
  align-items:center;
  gap:8px;
}
.item-desc{
  color: rgba(255,255,255,0.78);
  font-size:13px;
  margin-top:2px;
}

/* Badges (promo, small) */
.badge, .promo-badge, .promo-badge-small{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  font-weight:900;
  font-size:11px;
  padding:6px 8px;
  border-radius:999px;
  box-shadow: 0 10px 26px rgba(255,106,0,0.12);
  border: 1px solid rgba(255,255,255,0.04);
  display:inline-flex;
  align-items:center;
  gap:8px;
}

/* Smaller badge variant */
.promo-badge-small{ padding:4px 6px; font-size:11px; font-weight:800; background: rgba(255,255,255,0.03); color: var(--accent-2); border:1px solid rgba(255,255,255,0.03); box-shadow:none; }

/* Item config area (selects, addons) */
.item-config{
  margin-top:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* Labels */
.label{ font-size:12px; color: var(--muted); font-weight:800; text-transform:uppercase; letter-spacing: .8px; }

/* Custom styled select (appearance: none replacement) */
.select{
  appearance: none;
  -webkit-appearance: none;
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border: 1px solid rgba(255,255,255,0.04);
  color: #fff;
  font-weight:800;
  font-size:14px;
  outline: none;
  box-shadow: 0 6px 20px rgba(0,0,0,0.45) inset;
  background-image: linear-gradient(45deg, rgba(255,255,255,0.06) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.06) 75%, transparent 75%, transparent);
  background-size: 12px 12px;
  background-position: right 12px center;
}

/* Add-ons row */
.addons-row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

/* Styled addon checkbox label */
.addon{
  display:flex;
  gap:8px;
  align-items:center;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  padding:8px 10px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.03);
  font-weight:800;
  color: var(--muted);
  font-size:13px;
  cursor: pointer;
  transition: transform 180ms ease, box-shadow 200ms ease;
}

/* Hide native checkbox visually but keep accessible */
.addon input[type="checkbox"]{
  appearance:none;
  -webkit-appearance:none;
  width:18px;
  height:18px;
  border-radius:6px;
  border:2px solid rgba(255,255,255,0.06);
  background: transparent;
  margin:0;
  display:inline-block;
}

/* Checked state */
.addon input[type="checkbox"]:checked{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  border-color: rgba(255,255,255,0.02);
  box-shadow: 0 6px 18px rgba(255,106,0,0.12);
}

/* Text near checkbox */
.addon span{ font-weight:800; color: rgba(255,255,255,0.9); font-size:13px; }

/* Actions row: price + buttons */
.item-actions{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:8px;
}

/* Price display */
.price-row{
  display:flex;
  flex-direction:column;
  gap:4px;
  align-items:flex-start;
}
.price-label{ font-size:12px; color: var(--muted); font-weight:800; }
.item-price{ font-size:16px; font-weight:900; color: var(--accent-2); }

/* Action buttons */
.action-row{ display:flex; gap:8px; align-items:center; }
.add-btn, .remove-btn{
  border:0;
  padding:10px 12px;
  border-radius:12px;
  font-weight:900;
  font-size:13px;
  min-height:44px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  transition: transform 160ms ease, box-shadow 200ms ease;
}
.add-btn{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  box-shadow: 0 10px 30px rgba(255,106,0,0.12);
  border: 1px solid rgba(255,255,255,0.02);
}
.remove-btn{
  background: rgba(255,255,255,0.02);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.03);
}

/* Hidden utility */
.hidden{ display:none !important; }

/* Micro interactions */
.add-btn:active, .remove-btn:active{ transform: translateY(1px) scale(.995); }
.menu-item:hover .add-btn{ transform: translateY(-3px); }

/* Price chip inside card for quick glance (top-right) */
.menu-item::after{
  content: attr(data-price);
  position: absolute;
  right: 18px;
  top: 12px;
  font-size:12px;
  font-weight:900;
  color:#111;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  padding:6px 10px;
  border-radius:999px;
  box-shadow: 0 10px 26px rgba(255,106,0,0.12);
  display:none; /* hidden by default; optional */
}

/* Promo microcopy when tapping eligible item (small note area) */
.menu-item .promo-note{
  margin-top:8px;
  background: rgba(255,255,255,0.02);
  padding:8px 10px;
  border-radius:10px;
  color: rgba(255,255,255,0.86);
  font-size:13px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}

/* "Add missing items" small CTA inside menu (non-blocking) */
.menu-item .promo-cta-small{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  padding:6px 8px;
  border-radius:8px;
  font-weight:900;
  font-size:12px;
}

/* Accessibility & touch improvements */
.select, .add-btn, .remove-btn, .addon, .item-thumb { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }

/* Responsive adjustments */
@media (min-width: 420px){
  .menu-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:16px;
  }
  .item-thumb{ width:120px; height:100px; flex:0 0 120px; border-radius:14px; }
  .item-title{ font-size:17px; }
}

/* Small polish: shimmer on price value when user changes options */
.item-price .price-value {
  display:inline-block;
  transition: transform 220ms cubic-bezier(.2,.9,.3,1);
}
.item-price.updated .price-value { transform: translateY(-4px); }

    /* ==========================
   Preorder Modal Styles
   Matches site variables (uses --accent-1 / --accent-2)
   Mobile-first, accessible, animated, with sticky CTA bar
   ========================== */

.preorder-modal { /* overlay wrapper */
  position: fixed;
  inset: 0;
  display: none; /* JS toggles display / aria-modal */
  align-items: flex-end; /* slide-up from bottom on mobile */
  justify-content: center;
  z-index: 2200;
  background: rgba(6,6,6,0.6);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  padding: 12px;
  box-sizing: border-box;
}

/* show when aria-modal true */
.preorder-modal[aria-modal="true"] {
  display: flex;
  animation: preorder-overlay-in 260ms cubic-bezier(.2,.9,.3,1);
}

/* inner card */
.preorder-modal .modal-inner-preorder {
  width: 100%;
  max-width: 420px;
  border-radius: 14px 14px 8px 8px;
  background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(8,8,8,0.98));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 30px 80px rgba(0,0,0,0.7);
  transform: translateY(18px);
  animation: preorder-card-in 360ms cubic-bezier(.2,.9,.3,1) forwards;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* header row */
.preorder-modal .preorder-header {
  display:flex;
  gap:12px;
  align-items:center;
  padding: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
.preorder-modal .preorder-header .thumb {
  width:72px;
  height:64px;
  border-radius:10px;
  object-fit:cover;
  flex: 0 0 72px;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 8px 30px rgba(0,0,0,0.45);
}
.preorder-modal .preorder-header .meta {
  flex: 1 1 auto;
  min-width:0;
}
.preorder-modal .preorder-header .meta .title {
  font-size:16px;
  font-weight:900;
  color:#fff;
  margin:0 0 4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.preorder-modal .preorder-header .meta .subtitle {
  font-size:13px;
  color: rgba(255,255,255,0.82);
  margin:0;
}

/* countdown / weekday chip */
.preorder-modal .preorder-when {
  display:flex;
  gap:8px;
  align-items:center;
  padding: 12px 14px;
  border-bottom: 1px dashed rgba(255,255,255,0.02);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
.preorder-modal .countdown-chip {
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:8px 10px;
  border-radius:999px;
  font-weight:900;
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color:#111;
  box-shadow: 0 12px 30px rgba(255,106,0,0.12);
  font-size:13px;
}

/* form area */
.preorder-modal .preorder-body {
  padding: 12px 14px 84px; /* bottom padding to allow for sticky CTA bar */
  display:flex;
  flex-direction:column;
  gap:12px;
  max-height: calc(100vh - 220px);
  overflow:auto;
}

/* qty + extras row */
.preorder-modal .row {
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

/* quantity control */
.preorder-modal .qty-control {
  display:flex;
  gap:8px;
  align-items:center;
}
.preorder-modal .qty-control button {
  width:40px;
  height:40px;
  border-radius:10px;
  border:0;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  color:var(--muted);
  font-weight:900;
  font-size:18px;
}
.preorder-modal .qty-control .qty-value {
  min-width:36px;
  text-align:center;
  font-weight:900;
  color: var(--accent-2);
}

/* date/time picker row */
.preorder-modal .datetime {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.preorder-modal .datetime input[type="date"],
.preorder-modal .datetime input[type="time"],
.preorder-modal .datetime select,
.preorder-modal .datetime .prefetch-select {
  padding:10px 12px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color:#fff;
  font-weight:800;
  font-size:14px;
  box-sizing:border-box;
}

/* extras list */
.preorder-modal .extras {
  display:flex;
  flex-direction:column;
  gap:8px;
}
.preorder-modal .extras label {
  display:flex;
  gap:10px;
  align-items:center;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  cursor:pointer;
  font-weight:800;
  color: var(--muted);
}
.preorder-modal .extras input[type="checkbox"] {
  width:18px;
  height:18px;
  border-radius:6px;
  border:2px solid rgba(255,255,255,0.06);
  appearance:none;
  -webkit-appearance:none;
}
.preorder-modal .extras input[type="checkbox"]:checked {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  border-color: rgba(255,255,255,0.02);
}

/* contact inputs */
.preorder-modal .contact-row {
  display:flex;
  gap:8px;
  flex-direction:column;
}
.preorder-modal .contact-row input[type="text"],
.preorder-modal .contact-row input[type="tel"],
.preorder-modal .contact-row input[type="email"] {
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color:#fff;
  font-weight:800;
  font-size:14px;
  box-sizing:border-box;
}

/* small helper text */
.preorder-modal .helper {
  font-size:13px;
  color: rgba(255,255,255,0.75);
  margin-top:2px;
}

/* sticky CTA bar (fixed to modal bottom) */
.preorder-modal .preorder-cta {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 12px;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(8,8,8,0.00), rgba(0,0,0,0.6));
  border-top: 1px solid rgba(255,255,255,0.03);
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
}
.preorder-modal .preorder-cta .price {
  font-weight:900;
  font-size:16px;
  color: var(--accent-2);
  min-width:120px;
  text-align:left;
}
.preorder-modal .preorder-cta .btn {
  min-width: 140px;
  padding:12px 14px;
  border-radius:12px;
  font-weight:900;
}

/* disabled state for submit */
.preorder-modal .btn[disabled] {
  opacity: 0.4;
  transform: none;
  pointer-events: none;
}

/* small close button top-right */
.preorder-modal .preorder-close {
  position:absolute;
  right: 10px;
  top: 8px;
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size:18px;
  padding:8px;
  z-index: 10;
}

/* success state/shimmer for confirmation */
.preorder-modal .success {
  display:none;
  padding:18px;
  text-align:center;
  color: var(--accent-2);
  font-weight:900;
}
.preorder-modal.success-visible .success { display:block; }
.preorder-modal.success-visible .modal-inner-preorder { opacity: 0.2; pointer-events: none; }

/* Animations */
@keyframes preorder-overlay-in {
  from { opacity: 0; } to { opacity: 1; }
}
@keyframes preorder-card-in {
  from { transform: translateY(22px); opacity: 0; } to { transform: translateY(0); opacity: 1; }
}

/* Responsive tweaks for larger screens */
@media (min-width: 640px) {
  .preorder-modal { align-items: center; padding: 30px; }
  .preorder-modal .modal-inner-preorder { width: 560px; border-radius: 12px; }
  .preorder-modal .preorder-body { padding-bottom: 16px; max-height: calc(100vh - 160px); }
  .preorder-modal .preorder-cta { position: relative; background: transparent; border-top: none; }
}
/* End of menu styles */
</style>
  <style>
    /* -------------------------
   INPUT VISIBILITY FIX — paste after your other styles
   Applies to #checkout-page (Complete Order) and menu controls (.select, .addon)
   ------------------------- */

:root{
  /* fallback highlight when needed */
  --input-bg: rgba(255,255,255,0.03);
  --input-border: rgba(255,255,255,0.10);
  --placeholder: rgba(255,255,255,0.72);
  --input-focus: rgba(255,204,51,0.16);
}

/* Generic inputs / textareas used in checkout & preorders */
#checkout-page .input,
#preorder-modal .input,
#checkout-full-modal .input,
.input, input[type="text"], input[type="tel"], input[type="email"], textarea,
.select {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  /* slightly brighter so it sits above the page background */
  border: 1px solid var(--input-border);
  color: #fff !important;
  padding: 10px 12px;
  border-radius: 10px;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.45);
  -webkit-appearance: none;
  appearance: none;
  outline: none;
}

/* Ensure placeholder text is readable */
input::placeholder, textarea::placeholder, .input::placeholder,
.select::placeholder {
  color: var(--placeholder) !important;
  opacity: 1;
}

/* Stronger focus state for accessibility */
#checkout-page .input:focus,
#preorder-modal .input:focus,
.input:focus,
.select:focus,
select:focus {
  box-shadow: 0 6px 24px var(--input-focus), inset 0 2px 6px rgba(0,0,0,0.5);
  border-color: rgba(255,204,51,0.22);
  outline: none;
  transform: translateZ(0);
}

/* Selects: show custom arrow and make the arrow visible on dark background */
.select, select {
  background-image:
    linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24'%3E%3Cpath fill='%23FFFFFF' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 14px;
  padding-right: 38px; /* room for arrow */
  cursor: pointer;
}

/* Make select text bold & clear */
.select, select { font-weight:800; color:#fff; }

/* Checkbox / addon styling — uses markup: <label class="addon"><input type="checkbox"/><span>Label</span></label> */
.addon {
  --box-size: 18px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color: rgba(255,255,255,0.92);
  cursor: pointer;
}

/* Visually hide native checkbox but keep accessible — we style a clear square instead */
.addon input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: var(--box-size);
  height: var(--box-size);
  min-width: var(--box-size);
  display:inline-grid;
  place-items: center;
  border-radius: 6px;
  border: 2px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.02);
  margin: 0;
  transition: background 180ms ease, border-color 180ms ease, box-shadow 180ms ease, transform 120ms ease;
}

/* Unchecked: subtle contrast */
.addon input[type="checkbox"] + span { position: relative; padding-left: 0; }

/* Checked state: gradient + subtle checkmark */
.addon input[type="checkbox"]:checked {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  border-color: rgba(255,255,255,0.02);
  box-shadow: 0 8px 24px rgba(255,106,0,0.12);
  transform: translateY(-1px);
}

/* place a checkmark using adjacent span ::before for crisp vector-free rendering */
.addon input[type="checkbox"]:checked + span::before {
  content: '✔';
  position: absolute;
  left: -26px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 13px;
  color: #111;
  font-weight: 900;
  line-height: 1;
  /* give it a circle-like padding so it sits within the checkbox area visually */
  width: var(--box-size);
  height: var(--box-size);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* ensure the text next to checkbox remains readable */
.addon span { color: rgba(255,255,255,0.95); font-weight:800; }

/* When the checkbox is focused via keyboard, show clear ring */
.addon input[type="checkbox"]:focus {
  outline: 3px solid rgba(255,204,51,0.14);
  outline-offset: 2px;
}

/* Make radio / hidden inputs / small selects visible inside modal / checkout too */
#checkout-page select, #checkout-page .input, #checkout-page textarea { color: #fff !important; }

/* Print/Save as PDF hints:
   - When printing we want input values to be visible (browser may hide backgrounds).
   - This rule brightens inputs when printing.
*/
@media print {
  input, textarea, select { background: #ffffff !important; color: #000 !important; -webkit-print-color-adjust: exact; }
  .addon input[type="checkbox"] { background: #000 !important; color:#fff !important; }
}
  </style>
  <style>

/* =========================
   Wrap District — Remaining UI: Modals, Promo Details, Mobile Nav, Entry Modal,
   Contact/Footer, Global utilities and finishing touches.
   Mobile-first, polished, accessible.
   Drop into your stylesheet after other styles.
   ========================= */

/* Reuse / fallback variables */
:root{
  --accent-1: #ff6a00;
  --accent-2: #ffcc33;
  --muted: #d7d7d7;
  --glass: rgba(255,255,255,0.03);
  --glass-strong: rgba(255,255,255,0.06);
  --bg-dark: #071013;
  --card-shadow: 0 12px 40px rgba(0,0,0,0.6);
  --max-width: 420px;
  --safe-top: env(safe-area-inset-top, 12px);
  --radius-lg: 14px;
}

/* ---------- GLOBAL / UTILITIES ---------- */
.container-small{ max-width:var(--max-width); margin:0 auto; padding:0 14px; box-sizing:border-box; }
.muted{ color: rgba(255,255,255,0.6); }
.small{ font-size:12px; color: rgba(255,255,255,0.7); }
.lead{ color: rgba(255,255,255,0.9); font-weight:700; }

/* subtle glass card */
.glass-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 12px;
  box-shadow: var(--card-shadow);
  padding: 12px;
}

/* Links */
a { color: var(--accent-2); text-decoration: none; }
a:focus, button:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset: 2px; }

/* ---------- MOBILE NAV (OFF-CANVAS) ---------- */
.mobile-nav{
  position: fixed;
  top: calc(56px + var(--safe-top));
  right: 0;
  left: 0;
  bottom: 0;
  background: linear-gradient(180deg, rgba(6,6,6,0.98), rgba(4,4,4,0.98));
  z-index: 1300;
  display: none;
  padding: 20px 14px;
  box-sizing: border-box;
  overflow-y: auto;
}
.mobile-nav[aria-hidden="false"]{ display:block; }
.mobile-nav-inner{ max-width: var(--max-width); margin: 0 auto; }
.mobile-nav .nav-list{ list-style:none; padding:0; margin: 20px 0; display:flex; flex-direction:column; gap:12px; }
.mobile-nav .nav-link{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border: 1px solid rgba(255,255,255,0.03);
  color: #fff;
  font-weight:800;
}
.mobile-nav .nav-link i{ width:20px; text-align:center; color: var(--accent-2); }

/* ---------- MODALS (generic) ---------- */
.modal{
  position: fixed;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1600;
  padding: 20px;
  background: rgba(3,3,3,0.6);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
}
.modal[aria-modal="true"]{ display:flex; }

.modal .modal-inner{
  width: 100%;
  max-width: 420px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(6,6,6,0.98));
  border: 1px solid rgba(255,255,255,0.03);
  padding: 14px;
  box-shadow: 0 30px 80px rgba(0,0,0,0.65);
  transform: translateY(12px);
  transition: transform 260ms cubic-bezier(.2,.9,.3,1), opacity 240ms ease;
}
.modal .modal-inner .modal-body{ padding: 6px 2px; }
.modal .modal-close{ position:absolute; right:14px; top:12px; background:transparent; border:0; color:var(--muted); font-size:18px; }

/* small CTA in modal */
.modal .modal-actions{ display:flex; gap:10px; margin-top:10px; align-items:center; justify-content:flex-start; }

/* ---------- ENTRY PROMO STYLE (slide-in modal variant) ---------- */
.entry-promo.modal .modal-inner{
  background: linear-gradient(90deg, rgba(255,106,0,0.09), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,204,51,0.08);
}
.entry-promo .lead{ font-size:15px; color:#fff; }

/* "Don't show again" label */
.dont-show{ display:flex; gap:8px; align-items:center; font-size:13px; color: rgba(255,255,255,0.8); margin-top:10px; }
.dont-show input{ width:18px; height:18px; }

/* ---------- PROMO DETAILS SECTION (in-page) ---------- */
.promo-detail{
  width: 100%;
  max-width: var(--max-width);
  margin: 6px auto 18px;
  padding: 0 14px;
  box-sizing: border-box;
}
.promo-copy{
  margin-top:8px;
  display:flex;
  gap:12px;
  flex-direction:column;
}
.promo-copy p{ margin: 6px 0; color: rgba(255,255,255,0.9); font-weight:700; }
.promo-help{ margin-top:8px; color: rgba(255,255,255,0.78); font-size:13px; }

/* Promo countdown inline chip used elsewhere */
.promo-countdown-chip{
  display:inline-flex;
  gap:8px;
  align-items:center;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  padding:8px 10px;
  border-radius: 999px;
  font-weight:900;
  box-shadow: 0 12px 30px rgba(255,106,0,0.12);
}

/* ---------- PROMO DETAILS - HELPFUL MICROCOPY ---------- */
.promo-note-inline{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
  background: rgba(255,255,255,0.02);
  padding:10px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.02);
  color: rgba(255,255,255,0.9);
}

/* ---------- CONTACT / FOOTER ---------- */
.site-footer{
  width:100%;
  max-width: var(--max-width);
  margin: 20px auto 40px;
  padding: 12px 14px;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
}
.footer-row{
  display:flex;
  gap:12px;
  justify-content:space-between;
  align-items:flex-start;
  flex-direction:row;
}
.footer-left, .footer-right{ flex:1 1 50%; }
.footer-left h4, .footer-right h4{ margin:0 0 6px; color: var(--accent-2); font-weight:900; }
.footer-left p, .footer-right p{ margin:6px 0; color: rgba(255,255,255,0.8); font-weight:700; }
.footer-bottom{ margin-top:12px; text-align:center; color: rgba(255,255,255,0.6); font-size:12px; }

/* Footer small screen layout */
@media (max-width:520px){
  .footer-row{ flex-direction:column; gap:10px; }
}

/* ---------- TOAST / TEMP FEEDBACK (inline) ---------- */
.toast {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 14px;
  z-index: 1800;
  background: rgba(0,0,0,0.7);
  color: #fff;
  padding: 10px 14px;
  border-radius: 999px;
  font-weight:800;
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  display:none;
}
.toast.show{ display:block; animation: toast-in 320ms cubic-bezier(.2,.9,.3,1); }
@keyframes toast-in { from { opacity:0; transform: translateX(-50%) translateY(8px); } to { opacity:1; transform: translateX(-50%) translateY(0); } }

/* ---------- FORMS / INPUTS (if used in future) ---------- */
.input, input[type="text"], input[type="tel"], textarea {
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color:#fff;
  font-weight:700;
  box-sizing: border-box;
}

/* ---------- SMALL POLISH: focus ring for keyboard users ---------- */
:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset:2px; border-radius:8px; }

/* ---------- PRINT & REDUCTION (if user prints) ---------- */
@media print {
  body * { visibility: hidden; }
  #cart-drawer, #cart-drawer * { visibility: visible; }
}
/* -------------------------
   Premium Mobile-First Footer
   Paste this after existing styles (overrides old .site-footer)
   ------------------------- */
.site-footer {
  width: 100%;
  max-width: 420px;
  margin: 18px auto 34px;
  box-sizing: border-box;
  padding: 14px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(18,18,18,0.98), rgba(8,8,8,0.95));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  color: #fff;
  font-weight: 700;
  -webkit-font-smoothing: antialiased;
}

/* Top callout */
.footer-top {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}
.footer-brand {
  display:flex;
  gap:10px;
  align-items:center;
}
.footer-brand .logo-mark { font-size:14px; padding:6px 10px; border-radius:10px; }
.footer-brand .tagline { font-size:13px; color: rgba(255,255,255,0.88); font-weight:900; }

/* CTA group */
.footer-ctas { display:flex; gap:8px; align-items:center; }
.btn-footer {
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  font-weight:900;
  font-size:14px;
  border:0;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.btn-order {
  background: linear-gradient(90deg, var(--accent-1, #FF6A00), var(--accent-2, #FFD166));
  color:#111;
  box-shadow: 0 12px 36px rgba(255,106,0,0.12);
}
.btn-wa {
  background: rgba(255,255,255,0.03);
  color: var(--accent-2, #FFD166);
  border: 1px solid rgba(255,255,255,0.04);
}

/* Footer content layout */
.footer-grid {
  display:flex;
  gap:12px;
  margin-top:6px;
  align-items:flex-start;
  justify-content:space-between;
  flex-direction:column;
}
.footer-row {
  display:flex;
  gap:10px;
  align-items:flex-start;
  justify-content:space-between;
  width:100%;
}
.footer-left, .footer-right {
  width:100%;
}

/* contact list */
.contact-list { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
.contact-row { display:flex; gap:10px; align-items:center; color: rgba(255,255,255,0.9); font-weight:800; font-size:14px; }
.contact-row i { color: var(--accent-2, #FFD166); min-width:22px; text-align:center; }

/* small meta blocks */
.meta-block { margin-top:12px; display:flex; gap:8px; align-items:center; justify-content:space-between; }
.meta-block .hours { color: rgba(255,255,255,0.85); font-weight:800; }
.meta-block .delivery { color: rgba(255,255,255,0.78); font-weight:700; font-size:14px; }

/* pickup / map small row */
.pickup {
  margin-top:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding:10px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.03);
  display:flex;
  align-items:center;
  gap:10px;
  color: rgba(255,255,255,0.88);
  font-weight:800;
  font-size:13px;
}

/* bottom legal line */
.footer-bottom {
  margin-top:12px;
  font-size:12px;
  color: rgba(255,255,255,0.6);
  text-align:center;
}

/* responsive layout — two columns on wider phones */
@media (min-width: 420px) {
  .footer-grid { flex-direction: row; }
  .footer-left, .footer-right { width: 50%; }
  .footer-top { gap: 18px; }
}

/* small accessibility */
.site-footer a { color: inherit; text-decoration: none; }
.site-footer button:focus, .site-footer a:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset: 3px; border-radius:10px; }
    
/* ---------- END of remaining UI styles ---------- */
</style>
  <style>
    /* ------------------------
  DESKTOP / LARGE SCREENS
  Add after your existing stylesheet (mobile-first)
  Breakpoints: 900px (laptop), 1200px (desktop), 1440px (wide)
  ------------------------ */

/* Global container max width for desktop */
@media (min-width: 900px) {
  :root { --max-width: 1100px; }

  /* Center header contents and increase horizontal padding */
  .header-inner {
    max-width: var(--max-width);
    padding: 12px 20px;
    gap: 18px;
  }
  .sticky-header { height: calc(72px + var(--safe-top)); padding-top: var(--safe-top); }

  /* Make logo slightly larger */
  .logo-mark { font-size: 18px; padding:8px 12px; border-radius:10px; }
  .logo-name { font-size:14px; }

  /* Hide compact hamburger on larger screens (optional) */
  .ham-btn { display: inline-flex; }
  /* If you want to hide hamburger and show inline nav, see .desktop-nav below (optional) */

  /* HERO: two-column layout (image left, content right) */
  .hero-slideshow {
    max-width: var(--max-width);
    margin-top: calc(72px + var(--safe-top));
    padding: 18px;
  }
  .slides {
    height: 56vh;
    display: grid;
    grid-template-columns: 1fr 520px; /* image area + content area */
    gap: 18px;
    align-items: center;
  }
  .slide {
    position: relative;
    display: block;
    grid-column: 1 / -1; /* each slide still covers full grid, but inner layout controlled below */
  }
  /* split slide internals: image left, overlay/content to the right */
  .slide .slide-img {
    grid-column: 1 / 2;
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    box-shadow: 0 30px 70px rgba(0,0,0,0.6);
  }
  .slide .slide-overlay {
    grid-column: 2 / 3;
    position: relative;
    inset: auto;
    align-items: flex-start;
    padding: 28px;
    display:flex;
    justify-content:flex-start;
  }
  .slide-content {
    width: 100%;
    max-width: 520px;
    border-radius: 12px;
    padding: 18px;
    transform: none;
  }

  /* Larger typography */
  .slide-title { font-size: 34px; }
  .slide-sub { font-size: 16px; }

  /* Slideshow controls reposition */
  .slideshow-controls { bottom: 18px; left: 50%; transform: translateX(-50%); }

  /* Menu section — wider grid: 2 columns on laptop */
  .menu-section { max-width: var(--max-width); padding: 0 20px; }
  .menu-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 18px; }

  /* Menu cards enlarge */
  .menu-item { padding: 16px; border-radius: 14px; }
  .item-thumb { width: 140px; height: 110px; flex: 0 0 140px; border-radius: 12px; }
  .item-title { font-size: 18px; }

  /* Cart drawer: become a right-side panel (sticky) on larger screens */
  .cart-drawer {
    width: 420px;
    max-width: 420px;
    right: 28px;
    top: calc(72px + var(--safe-top));
    height: calc(100vh - (72px + var(--safe-top)) - 28px);
    border-radius: 12px;
    transform: translateX(110%); /* still hidden by default */
    box-shadow: -26px 12px 60px rgba(0,0,0,0.65);
  }

  /* When pinned (use JS to add .desktop-pinned), show as visible panel */
  .cart-drawer.desktop-pinned[aria-hidden="false"], .cart-drawer[aria-hidden="false"] {
    transform: translateX(0);
    display: block;
    opacity: 1;
  }

  .cart-body { height: calc(100% - var(--cart-header-h) - var(--cart-footer-h)); }

  /* Product modal: bigger and centered */
  #product-modal .modal-inner { max-width: 720px; display:flex; flex-direction:row; gap:0; border-radius:12px; }
  #product-modal .pm-thumb { width:220px; height:160px; flex:0 0 220px; border-radius:8px; }
  #product-modal .pm-body { max-height:70vh; overflow:auto; padding:18px; }

  /* Checkout page: use two-column layout (already defined, enhance spacing) */
  #checkout-inner {
    max-width: 1100px;
    grid-template-columns: 1fr 420px;
    margin-top: calc(72px + var(--safe-top) + 18px);
    max-height: calc(100vh - (72px + var(--safe-top) + 60px));
  }
  .checkout-left { padding: 22px; }
  .checkout-right { padding: 22px; }

  /* Order confirmation modal bigger */
  .oc-inner { max-width: 980px; padding: 20px; }

  /* Footer: two columns */
  .site-footer { max-width: var(--max-width); padding: 18px 20px; display:flex; gap:20px; align-items:flex-start; }
  .footer-grid { flex-direction:row; gap:24px; }
  .footer-left, .footer-right { width: 50%; }

  /* Promo carousel: enlarge card and show side-by-side controls */
  .promo-carousel { max-width: var(--max-width); padding: 8px 18px; }
  .pc-slides { height: 44vh; min-height: 260px; }
}

/* Bigger desktop */
@media (min-width: 1200px) {
  :root { --max-width: 1280px; }

  /* Header: show more spacing and a slightly larger logo */
  .header-inner { padding: 16px 28px; gap: 22px; max-width: var(--max-width); }
  .logo-mark { font-size:20px; padding:8px 14px; }

  /* Hero: heavier two-column emphasis (image bigger) */
  .slides { grid-template-columns: 1fr 560px; gap: 24px; height: 60vh; }
  .slide-title { font-size: 40px; letter-spacing: -0.6px; }
  .slide-sub { font-size: 17px; }

  /* Menu grid: 3 columns if space allows */
  .menu-grid { grid-template-columns: repeat(3, 1fr); gap: 20px; }

  .item-thumb { width: 160px; height: 120px; flex: 0 0 160px; }
  .menu-item { padding: 18px; }

  /* Cart: slightly wider */
  .cart-drawer { width: 480px; max-width: 480px; }

  /* Product modal: full feature view */
  #product-modal .modal-inner { max-width: 960px; }
  #product-modal .pm-body { padding: 22px; }

  /* Checkout page: increase right summary column width */
  #checkout-inner { grid-template-columns: 1fr 480px; max-width: 1280px; }
  #cf-order-lines { max-height: calc(100vh - (72px + var(--safe-top) + 320px)); }
}

/* Ultra wide screens */
@media (min-width: 1440px) {
  :root { --max-width: 1400px; }

  .header-inner { max-width: var(--max-width); padding: 18px 36px; }
  .hero-slideshow { padding-left: 28px; padding-right: 28px; }
  .slides { gap: 32px; height: 64vh; }
  .slide-title { font-size: 48px; }

  .menu-grid { grid-template-columns: repeat(4, 1fr); gap: 26px; }
  .menu-item { padding: 22px; border-radius: 16px; }

  /* Cart pinned style suggestion: use .desktop-pinned class to keep cart visible */
  .cart-drawer.desktop-pinned {
    position: fixed;
    right: 36px;
    transform: translateX(0);
    top: calc(88px + var(--safe-top));
    height: calc(100vh - (88px + var(--safe-top) + 36px));
  }
}

/* ------------------------
  Desktop navigation helper (optional)
  If you add an inline nav inside the header (class .desktop-nav),
  these styles will show it and hide the hamburger.
  ------------------------ */
@media (min-width: 900px) {
  /* by default keep the hamburger; if you add .desktop-nav show it and hide .ham-btn */
  .desktop-nav { display: none; }
  /* Example: if you add <nav class="desktop-nav"><ul class="nav-list">...</ul></nav> into header */
  .header-inner .desktop-nav[aria-hidden="false"] { display: flex; gap: 18px; align-items:center; margin-left:auto; }
  .header-inner .desktop-nav .nav-list { display:flex; gap: 12px; align-items:center; }
  .header-inner .desktop-nav .nav-link { padding:10px 12px; border-radius: 10px; background: transparent; color: var(--muted); border: 1px solid rgba(255,255,255,0.02); }
  .header-inner .ham-btn { display: inline-flex; } /* keep by default */
}

/* ------------------------
  Accessibility & small polish on large screens
  ------------------------ */
@media (min-width: 900px) {
  .btn { min-height: 48px; padding: 12px 16px; border-radius: 12px; font-size: 15px; }
  .icon-btn { padding: 10px; }
  .slide-ctas .btn { font-size: 15px; }
  .menu-tabs .tab-btn { padding: 10px 14px; font-size: 14px; }
  .cart-header h3 { font-size: 18px; }
  .cart-footer .footer-actions { min-width: 220px; }
  /* focus rings more visible on desktop */
  :focus { outline: 4px solid rgba(255,204,51,0.12); outline-offset: 3px; }
}

/* ------------------------
  Print-friendly adjustments for desktop print
  ------------------------ */
@media print {
  .slides, .menu-grid, .cart-drawer, .mobile-nav, .promo-carousel, .site-footer { display: none !important; }
  #order-confirmation-modal, .oc-inner { display: block !important; position: static !important; visibility: visible !important; }
}

/* END desktop media CSS */
</style>
  <style>
    /* === DESKTOP / LARGE-SCREEN STYLES for Wrap District ===
   Paste after your other styles. Adjust breakpoints if desired.
*/

@media (min-width: 900px) {
  :root {
    --max-width: 1100px;
    --header-h-desktop: 80px;
    --desktop-cart-w: 380px;
  }

  /* Header: center content and show links inline */
  .sticky-header {
    height: calc(var(--header-h-desktop) + var(--safe-top));
    padding-top: var(--safe-top);
    background: linear-gradient(180deg, rgba(6,6,6,0.85), rgba(6,6,6,0.6));
  }
  .header-inner {
    max-width: var(--max-width);
    padding: 12px 20px;
    display: grid;
    grid-template-columns: 220px 1fr auto;
    align-items: center;
    gap: 16px;
  }
  .logo { gap: 12px; }
  /* Desktop nav (moved into header) */
  .desktop-nav {
    display:flex;
    gap:18px;
    align-items:center;
    justify-content:flex-start;
    font-weight:800;
  }
  .desktop-nav a {
    color: var(--muted);
    padding:8px 12px;
    border-radius:8px;
    text-decoration:none;
    transition: background 160ms ease, color 160ms ease;
    font-size:15px;
  }
  .desktop-nav a:hover, .desktop-nav a:focus { background: rgba(255,255,255,0.02); color: var(--accent-2); outline: none; }

  /* Hide mobile hamburger/nav while showing desktop nav */
  .mobile-nav { display:none !important; }
  .ham-btn { display:none !important; }

  /* Hero: two-column layout */
  .hero-slideshow {
    margin-top: calc(var(--header-h-desktop) + var(--safe-top) + 12px);
    max-width: var(--max-width);
    margin-left: auto; margin-right: auto;
    padding: 0 18px 20px;
  }
  .slides {
    height: 62vh;
    min-height: 420px;
    display: block;
    border-radius: 18px;
    overflow: hidden;
  }
  .slide {
    position: relative;
    display: flex !important;
    align-items: stretch;
  }
  .slide-overlay {
    position: relative;
    display:flex;
    width:100%;
    height:100%;
    background: linear-gradient(90deg, rgba(0,0,0,0.18), rgba(0,0,0,0.35));
  }
  /* split: left content, right image */
  .slide-content {
    width: 48%;
    padding: 32px;
    border-radius: 0;
    align-self: center;
    box-shadow: none;
    background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.0));
  }
  .slide-img {
    width: 52%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-left: 1px solid rgba(255,255,255,0.02);
  }
  .slide-title { font-size: 34px; line-height:1.02; }
  .slide-sub { font-size:16px; }

  /* slideshow controls centered but placed outside the slide */
  .slideshow-controls { bottom: 18px; left: 18px; right: 18px; }

  /* Menu: multi-column grid */
  .menu-section { max-width: var(--max-width); margin: 20px auto 36px; padding: 0 18px; }
  .menu-container { padding: 18px; }
  /* 2 columns on medium, 3 on large */
  @media (min-width: 920px) {
    .menu-grid { grid-template-columns: repeat(2, 1fr); gap: 18px; }
  }
  @media (min-width: 1200px) {
    .menu-grid { grid-template-columns: repeat(3, 1fr); gap: 22px; }
  }

  .menu-item { display:flex; gap:14px; align-items:flex-start; padding:14px; }
  .item-top { flex-direction:row; align-items:flex-start; }
  .item-thumb { width:160px; height:120px; flex:0 0 160px; border-radius:12px; }
  .item-meta { flex:1 1 auto; }
  .item-config { display:flex; gap:12px; align-items:center; margin-top:12px; flex-wrap:wrap; }
  .item-config .select { max-width: 160px; }
  .actions-row { display:flex; gap:12px; align-items:center; }

  /* Show price chip on desktop */
  .menu-item::after { display:block; }

  /* Product modal & other modals: larger, centered */
  .modal .modal-inner { max-width: 820px; width: 90%; border-radius: 12px; padding: 0; }
  #product-modal .modal-inner, #preorder-modal .modal-inner, #order-confirmation-modal .oc-inner {
    max-width: 900px;
  }
  #product-modal .pm-body { max-height: 60vh; overflow:auto; }

  /* Cart drawer -> persistent right sidebar on desktop */
  .cart-drawer {
    top: calc(var(--header-h-desktop) + var(--safe-top) + 12px);
    right: 18px;
    width: var(--desktop-cart-w);
    max-width: var(--desktop-cart-w);
    height: calc(100vh - (var(--header-h-desktop) + 40px));
    border-radius: 12px;
    transform: translateX(0) !important;
    opacity: 1 !important;
    display: block !important;
    z-index: 1400;
    box-shadow: 0 30px 80px rgba(0,0,0,0.6);
    border-left: none;
    border-top-left-radius: 12px;
    border-bottom-left-radius: 12px;
    position: fixed;
  }
  /* make main content avoid cart on wide screens */
  main { margin-right: calc(var(--desktop-cart-w) + 28px); }

  /* If you want the cart to be docked even more, allow a .cart-docked helper (set by JS) */
  .cart-docked { position: fixed; right: 18px; }

  /* Checkout / in-page checkout: make inner dialog wider */
  #checkout-inner, .checkout-full-inner {
    max-width: 1200px;
    grid-template-columns: 1fr 420px;
  }
  .checkout-right { min-width: 380px; max-width: 420px; }

  /* Footer: multi-column layout */
  .footer-top { display:flex; gap:24px; align-items:flex-start; max-width:var(--max-width); margin: 18px auto; padding: 0 18px; }
  .footer-grid { display:flex; gap:24px; justify-content:space-between; max-width:var(--max-width); margin: 0 auto; padding: 12px 18px; }
  .footer-left, .footer-right { flex:1 1 0; }

  /* product / promo carousels get side padding */
  .promo-carousel { max-width: var(--max-width); margin: 10px auto 24px; padding: 0 18px; }

  /* fine-tune small text sizes on large screens */
  .small { font-size:13px; }
  .muted { font-size:14px; }
}

/* Extra polish for very large displays */
@media (min-width: 1400px) {
  :root { --max-width: 1400px; --desktop-cart-w: 420px; }
  .header-inner { max-width: calc(var(--max-width) - 120px); }
  .hero-slideshow { max-width: calc(var(--max-width) - 120px); }
  main { margin-right: calc(var(--desktop-cart-w) + 40px); }
}

    </style>
<style>
  /* ===== MOBILE-FRIENDLY CHECKOUT MODAL =====
   Replace .checkout-modal/.modal-content/.modal-body with your real classes if different
   Ensures modal content scrolls on small screens and respects safe-area insets on iOS.
*/

.checkout-modal { /* outer modal container */
  display: block; /* or however your modal is shown */
  padding: 16px;  /* visual gap from top/bottom */
}

/* the scrollable area of the modal (the part that should scroll) */
.checkout-modal .modal-content {
  max-height: calc(100vh - 48px); /* leave a little room above/below */
  height: auto;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  border-radius: 12px;
}

/* the body area that should scroll */
.checkout-modal .modal-body {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* smooth scrolling on iOS */
  flex: 1 1 auto;
  padding-bottom: env(safe-area-inset-bottom); /* avoid home indicator overlap on iPhones */
}

/* ensure order summary/footer remains visible or sticky */
.checkout-modal .order-summary,
.checkout-modal .modal-footer {
  position: sticky;
  bottom: 0;
  z-index: 3;
  background: inherit; /* match modal background so it doesn't show through */
  padding-bottom: env(safe-area-inset-bottom); /* safe area */
  /* add a subtle backdrop so sticky footer doesn't cover exactly the same content */
}

/* if you prefer footer always at bottom but not sticky, use:
.checkout-modal .modal-footer { flex-shrink: 0; }
*/
</style>
<style>
  /* Make modal appear as a bottom sheet on narrow screens */
  #purchase-history-modal {
    align-items: flex-end;                /* bottom sheet feel on mobile */
    padding: 0;                           /* let inner control spacing */
  }
  #purchase-history-modal[aria-hidden="false"] { display:flex; }

  .ph-inner {
    width: 100%;
    max-width: 880px;                     /* desktop cap */
    margin: 0;
    border-radius: 16px 16px 0 0;
    background: linear-gradient(180deg,#0b0b0b,#070707);
    color: #fff;
    box-shadow: 0 -30px 80px rgba(0,0,0,0.6);
    padding: 14px;
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    gap: 10px;
    /* make it feel like a sheet */
    max-height: 92vh;
    overflow: hidden;
    -webkit-overflow-scrolling: touch;
  }

  /* header toolbar (search + close) — sticky so it remains visible while list scrolls */
  .ph-inner > .ph-toolbar {
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    position: sticky;
    top: 0;
    z-index: 20;
    padding-bottom: 8px;
    margin-bottom: 6px;
    backdrop-filter: blur(6px) saturate(120%);
  }

  /* ensure search input is large and easy to tap */
  .ph-search {
    width: 360px;
    max-width: calc(100% - 150px);
    padding: 10px 12px;
    font-size: 15px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.06);
    background: rgba(255,255,255,0.02);
    color: #fff;
    box-sizing: border-box;
    outline: none;
  }
  .ph-search::placeholder { color: rgba(255,255,255,0.5); }

  /* main scrollable list area */
  .ph-list {
    margin-top: 4px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    overflow: auto;
    padding-right: 6px;
    padding-left: 2px;
    max-height: calc(92vh - 180px); /* toolbar + footer room */
    -webkit-overflow-scrolling: touch;
  }

  /* each row: compact, readable, touch friendly */
  .ph-item {
    display: grid;
    grid-template-columns: 1fr 120px;
    gap: 10px;
    align-items: center;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    padding: 12px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.03);
    box-sizing: border-box;
  }
  .ph-meta .ref { font-weight:900; font-size:15px; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .ph-meta .ts  { font-size:12px; color:rgba(255,255,255,0.72); margin-top:4px; }

  .ph-actions {
    display:flex;
    gap:8px;
    align-items:center;
    justify-self:end;
    min-width: 0;
  }
  /* make action buttons big enough to tap */
  .ph-actions .btn { padding: 10px 12px; border-radius:10px; font-weight:900; font-size:13px; min-width: 84px; }

  /* Empty state styling */
  .ph-empty { padding:16px 8px; text-align:center; color:rgba(255,255,255,0.68); }

  .ph-footer {
    display:flex;
    gap:8px;
    justify-content:space-between;
    align-items:center;
    margin-top: 10px;
    padding-top: 8px;
    border-top: 1px solid rgba(255,255,255,0.03);
  }
  .ph-footer .small-muted { color: rgba(255,255,255,0.7); font-size:13px; }

  /* extra small button style */
  .btn.small-xs { padding: 8px 10px; border-radius:10px; font-size:13px; }

  /* Desktop: keep previous layout but centered */
  @media (min-width: 700px) {
    #purchase-history-modal { align-items:center; padding:12px; }
    .ph-inner { border-radius:12px; max-width:820px; max-height:70vh; }
    .ph-list { max-height:60vh; }
  }

  /* Narrow screens: full column layout, stacked actions */
  @media (max-width: 420px) {
    .ph-inner { padding:12px 12px 10px 12px; border-radius:14px 14px 0 0; }
    .ph-toolbar { gap:8px; align-items:center; flex-wrap:wrap; }
    .ph-search { width:100%; max-width:100%; font-size:16px; padding:12px; border-radius:10px; }
    .ph-item { grid-template-columns: 1fr; gap:8px; align-items:flex-start; padding:12px; }
    .ph-actions { flex-direction: column; justify-self: stretch; gap:8px; margin-top:6px; }
    .ph-actions .btn { width:100%; display:block; min-width:0; }
    .ph-footer { flex-direction: column; align-items:stretch; gap:8px; padding-top:12px; }
    .ph-footer .small-muted { order: -1; }
  }

  /* focus ring for accessible keyboard navigation */
  #purchase-history-modal .btn:focus,
  #purchase-history-modal .icon-btn:focus,
  #purchase-history-modal .ph-search:focus {
    outline: 3px solid rgba(255,200,80,0.12);
    outline-offset: 2px;
    border-color: rgba(255,200,80,0.18);
  }

  /* -----------------------
  Purchase-history: mobile bottom-sheet + laptop dialog polish
  Paste after your existing purchase-history CSS block
   ----------------------- */

/* base transitions for the sheet/dialog */
#purchase-history-modal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 9000;
  background: rgba(0,0,0,0.48);
  align-items: center;
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
}

/* animated inner card */
#purchase-history-modal .ph-inner {
  width: 100%;
  max-width: 820px;
  border-radius: 12px;
  background: linear-gradient(180deg,#0b0b0b,#070707);
  color: #fff;
  box-shadow: 0 40px 120px rgba(0,0,0,.7);
  padding: 14px;
  transform: translateY(0);
  opacity: 1;
  transition: transform .28s cubic-bezier(.2,.9,.3,1), opacity .22s ease;
}

/* show state */
#purchase-history-modal[aria-hidden="false"] { display: flex; }

/* Mobile: bottom-sheet style */
@media (max-width: 600px) {
  #purchase-history-modal {
    align-items: flex-end; /* sheet grows from bottom */
    padding: 0;
    background: linear-gradient(rgba(0,0,0,0.36), rgba(0,0,0,0.36));
  }
  #purchase-history-modal .ph-inner {
    width: 100%;
    max-width: 100%;
    border-radius: 12px 12px 0 0;
    padding: 12px;
    margin: 0;
    box-shadow: 0 -20px 60px rgba(0,0,0,0.6);
    transform: translateY(18px);
    opacity: 0;
    /* make it feel like a sheet sliding up */
  }
  #purchase-history-modal[aria-hidden="false"] .ph-inner {
    transform: translateY(0);
    opacity: 1;
  }

  /* header: search & close stacked and full width */
  #purchase-history-modal .ph-inner > div:first-child {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: stretch;
  }
  #ph-search { width: 100%; max-width: 100%; box-sizing: border-box; font-size: 15px; padding: 10px 12px; }
  #ph-close { margin-left: 8px; width:44px; height:44px; border-radius:10px; font-size:16px; }

  /* list height tuned for phones */
  .ph-list { margin-top: 8px; display:flex; flex-direction:column; gap:10px; max-height: calc(85vh - 160px); overflow:auto; padding-right:6px; -webkit-overflow-scrolling: touch; }

  .ph-item { grid-template-columns: 1fr auto; gap: 12px; padding: 12px; border-radius:10px; }
  .ph-meta .ref { font-size:15px; }
  .ph-meta .ts { font-size:13px; }

  /* action buttons larger and easy to tap */
  .ph-actions .btn { padding: 10px 12px; border-radius:10px; font-size:14px; min-width: 86px; }
  .btn.small-xs { padding: 10px 12px; font-size:14px; border-radius:10px; }

  /* sticky footer inside sheet */
  .ph-footer {
    position: sticky;
    bottom: 0;
    left: 0;
    right: 0;
    gap:8px;
    justify-content: space-between;
    background: linear-gradient(180deg, rgba(11,11,11,0.00), rgba(11,11,11,0.02));
    padding: 12px 0 4px 0;
    margin-top: 8px;
    align-items:center;
  }
  .ph-footer .small-muted { font-size:13px; color: rgba(255,255,255,0.72); }

  /* empty state comfortable padding */
  .ph-empty { padding:22px 12px; font-size:15px; }
}

/* Desktop/laptop view: keep centered dialog with larger content area */
@media (min-width: 601px) {
  #purchase-history-modal { align-items: center; }
  #purchase-history-modal .ph-inner {
    max-width: 920px;
    padding: 18px;
  }
  .ph-list { max-height: 60vh; overflow:auto; -webkit-overflow-scrolling: touch; }
  .ph-item { grid-template-columns: 1fr 220px; align-items:center; }
  .ph-actions { justify-self:end; }
  .ph-footer { margin-top: 12px; }
}

/* small polish: ensure buttons & icons have enough hit area everywhere */
#purchase-history-modal .icon-btn, #purchase-history-modal .btn { min-height: 40px; min-width: 44px; }

/* -----------------------
  HERO + MENU: laptop/desktop improvements
  Paste into the same stylesheet (keeps mobile-first behavior)
   ----------------------- */

/* Hero: switch to two-column on laptop screens so image and content are side-by-side */
@media (min-width: 1024px) {
  .hero-slideshow { display: grid; grid-template-columns: 1fr 520px; gap: 28px; align-items: center; max-width: 1200px; margin: 18px auto; padding: 0 18px; box-sizing: border-box; }

  /* the slides container becomes a single slide at a time — we keep carousel JS but present the active slide full height */
  .hero-slideshow .slides { grid-column: 1 / 2; align-self: stretch; height: 420px; overflow: hidden; border-radius: 14px; }
  .hero-slideshow .slide { display: block; height: 100%; position: relative; }
  .hero-slideshow .slide-img { width: 100%; height: 100%; object-fit: cover; display:block; border-radius: 12px; }

  /* content column */
  .hero-slideshow .slide-overlay { grid-column: 2 / 3; position: relative; background: transparent; height: auto; display:flex; align-items:center; justify-content:center; }
  .hero-slideshow .slide-content { padding: 18px 22px; max-width: 520px; background: linear-gradient(180deg, rgba(0,0,0,0.00), rgba(0,0,0,0.00)); }
  .hero-slideshow .slide-title { font-size: 36px; line-height: 1.04; }
  .hero-slideshow .slide-sub { font-size: 16px; }

  /* ensure CTA group stacks nicely */
  .hero-slideshow .slide-ctas { display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; }
  .hero-slideshow .btn.primary, .hero-slideshow .btn.ghost { min-width: 160px; padding: 12px 16px; }
}

/* Menu: multi-column card grid on laptop */
@media (min-width: 1024px) {
  .menu-container { max-width: 1200px; margin: 18px auto; padding: 0 18px; box-sizing: border-box; }
  .menu-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 18px; align-items: start; }

  .menu-item {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 14px;
    border-radius: 12px;
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border: 1px solid rgba(255,255,255,0.03);
    min-height: 260px;
  }

  .menu-item .item-top { display:flex; gap:12px; align-items:flex-start; }
  .menu-item .item-thumb { width:120px; height:92px; object-fit:cover; border-radius:10px; flex:0 0 120px; }
  .menu-item .item-meta { flex:1; min-width:0; }

  .menu-item .item-config { display:block; margin-top:6px; }
  .menu-item .item-actions { margin-top:auto; display:flex; justify-content:space-between; align-items:center; gap:10px; }

  /* price visible and large */
  .menu-item .item-price { font-size:18px; font-weight:900; color: var(--accent-2); }

  /* make selects and inputs larger for laptop */
  .menu-item .select, .menu-item .input { padding:10px 12px; border-radius:10px; }
}

/* small tweaks for mid-sized laptops (between 900px and 1024px) */
@media (min-width: 900px) and (max-width: 1023px) {
  .hero-slideshow { grid-template-columns: 1fr 420px; gap: 18px; }
  .menu-grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
}

/* final accessibility polish */
.menu-item, .slide-ctas .btn, .promo-cta-row .btn { cursor: pointer; }

</style>
  <style> /* ===== Make HERO identical to PROMO styling =====
   Paste after your current hero & promo CSS so it overrides older rules
*/

/* Hero container uses the same glass/panel feel as promo */
    /* ---------- FIX: Checkout modal scrollability & sticky "Your order" ---------- */
#checkout-page {
 /* ensure checkout sits below header and the page can scroll if needed */
  align-items: flex-start !important;
  overflow: auto !important;
 -webkit-overflow-scrolling: touch;
}

#checkout-inner {
  /* keep dialog inside safe area and ensure inner columns can scroll independently */
 margin-top: calc(56px + var(--safe-top,12px) + 12px) !important;
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 48px)) !important;
  box-sizing: border-box;
}

.checkout-right > h4 {
  /* keep the "Your order" header sticky so users always know which column they're viewing */
  position: sticky;
 top: 0;
  z-index: 6;
  background: linear-gradient(180deg,#080808,#050505); /* same background as dialog */
  padding-top: 6px;
  margin-bottom: 8px;
}

#cf-order-lines {
 /* make the order lines scroll, independent of the left form */
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  max-height: calc(60vh); /* adjust if you want more or less space */
}

/* small mobile tweak */
@media (max-width:600px){
  #cf-order-lines { max-height: calc(55vh); }
}
.hero {
  width: 100%;
  box-sizing: border-box;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 28px 18px;
  background: transparent;
}

/* Inner card that mirrors promo card */
.hero .hero-panel {
  width: 100%;
  max-width: 1200px;            /* same width constraint as promo */
  border-radius: 18px;          /* rounded like promo */
  padding: 22px;
  display: grid;
  grid-template-columns: 1fr;   /* mobile-first: stacked */
  gap: 18px;
  background: var(--panel, rgba(255,255,255,0.02)); /* reuse theme panel var */
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 12px 40px rgba(6,6,6,0.55);
  align-items: center;
}

/* content column: copy promo typography & spacing */
.hero .hero-content {
  padding: 8px 2px;
  max-width: 720px;
}

.hero .hero-title {
  font-size: 28px;
  line-height: 1.03;
  font-weight: 800;
  margin: 0 0 8px 0;
  letter-spacing: -0.02em;
}

.hero .hero-sub {
  font-size: 15px;
  line-height: 1.45;
  color: rgba(255,255,255,0.86);
  margin: 0 0 14px 0;
}

/* CTA group uses promo CTA sizing & layout */
.hero .hero-ctas {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
}

/* Primary & ghost CTA styling to match promo CTAs */
.hero .btn {
  border-radius: 12px;
  padding: 10px 14px;
  font-weight: 700;
  min-height: 44px;
  min-width: 140px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
}

/* Primary button: use promo accent colors where available */
.hero .btn.primary {
  background: linear-gradient(180deg, var(--gold-400, #ffd46a), var(--gold-500, #ffbf00));
  color: #111;
  border: none;
}

/* Ghost button style */
.hero .btn.ghost {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.92);
}

/* image/visual column — adopt promo image framing */
.hero .hero-media {
  width: 100%;
  display: block;
  border-radius: 12px;
  overflow: hidden;
  min-height: 160px;
  align-self: center;
}

/* image element */
.hero .hero-media img {
  display:block;
  width:100%;
  height:100%;
  object-fit: cover;
}

/* Desktop / laptop: two-column layout like promo row */
@media (min-width: 1024px) {
  .hero .hero-panel {
    grid-template-columns: 1fr 460px; /* content | media (promo-like split) */
    gap: 26px;
    padding: 28px;
  }
  .hero .hero-title { font-size: 36px; }
  .hero .hero-sub { font-size: 16px; }
  .hero .hero-media { min-height: 320px; border-radius: 14px; }
  .hero .btn { min-width: 160px; padding: 12px 18px; }
}

/* mid-size laptops */
@media (min-width: 900px) and (max-width: 1023px) {
  .hero .hero-panel { grid-template-columns: 1fr 360px; gap: 20px; }
  .hero .hero-title { font-size: 32px; }
}

/* small polish: ensure text wraps and no overflow */
.hero .hero-title, .hero .hero-sub { word-wrap: break-word; hyphens: auto; }

/* Accessibility / focus states match promo */
.hero .btn:focus { outline: 3px solid rgba(255,223,102,0.18); outline-offset: 2px; }
</style>
<style>
/* ====== DESKTOP (Large screens) STYLES for Wrap District ======
   Targets >=1000px screens — full desktop layout, colorful accents on black background
   Applies to the provided HTML structure (header, hero, menu, modals, cart, footer, etc.)
*/

/* ---------- Theme variables (desktop overrides / extra colors) ---------- */
:root{
  --bg: #070707;                 /* page black background */
  --panel: linear-gradient(180deg,#0b0b0b,#0a0a0a);
  --glass: rgba(255,255,255,0.03);
  --muted: rgba(255,255,255,0.72);
  --text: #FFFDFD;
  --accent-red: #FF3B30;
  --accent-blue: #007BFF;
  --accent-green: #28C76F;
  --accent-yellow: #FFD166;
  --accent-purple: #8A2BE2;
  --cta-gradient: linear-gradient(90deg,var(--accent-red),var(--accent-blue));
  --btn-ghost: rgba(255,255,255,0.06);
  --card-radius: 14px;
  --glass-border: rgba(255,255,255,0.04);
  --card-shadow-lg: 0 30px 80px rgba(0,0,0,0.7);
  --card-shadow-sm: 0 8px 28px rgba(0,0,0,0.6);
  --focus-ring: 0 0 0 4px rgba(0,123,255,0.12);
}

/* ---------- Global page layout ---------- */
@media (min-width:1000px){
  html,body { height:100%; }
  body{
    margin:0;
    font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(0,123,255,0.03), transparent),
                radial-gradient(900px 400px at 85% 80%, rgba(40,199,111,0.02), transparent),
                var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    line-height:1.35;
    font-size:16px;
  }

  a { color: inherit; text-decoration:none; }

  .container-small { max-width:1180px; margin:0 auto; padding:28px; box-sizing:border-box; }

/* ---------- Header (desktop) ---------- */
  header.sticky-header {
    position:sticky;
    top:0;
    z-index:2200;
    backdrop-filter: blur(6px) saturate(120%);
    background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.25));
    border-bottom: 1px solid rgba(255,255,255,0.03);
    box-shadow: 0 6px 30px rgba(0,0,0,0.6);
  }
  header .header-inner {
    display:flex;
    align-items:center;
    gap:20px;
    max-width:1400px;
    margin:0 auto;
    padding:18px 26px;
  }

  /* Logo */
  .logo { display:flex; gap:10px; align-items:center; cursor: pointer; }
  .logo-mark{
    font-weight:900;
    letter-spacing:1px;
    padding:10px 14px;
    border-radius:10px;
    background: linear-gradient(135deg,var(--accent-red), var(--accent-yellow));
    color:#0b0b0b;
    font-family: "Montserrat", sans-serif;
    font-size:18px;
  }
  .logo-name {
    font-weight:800;
    font-family:"Montserrat",sans-serif;
    color:var(--accent-blue);
    font-size:18px;
    text-transform:uppercase;
  }

  /* Main nav (desktop) */
  .desktop-nav { margin-left:24px; display:flex; gap:18px; align-items:center; }
  .desktop-nav .nav-link { padding:10px 14px; border-radius:10px; color:var(--muted); font-weight:700; display:inline-flex; gap:8px; align-items:center; }
  .desktop-nav .nav-link:hover { color:var(--text); background: rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); }

  /* header actions (search, cart, profile) */
  .header-actions { margin-left:auto; display:flex; gap:12px; align-items:center; }
  .icon-btn {
    background:transparent;
    border:0;
    color:var(--muted);
    padding:10px;
    border-radius:10px;
    cursor:pointer;
  }
  .icon-btn:hover { color:var(--text); background: rgba(255,255,255,0.02); transform: translateY(-1px); }

  .cart-btn { position:relative; }
  .cart-count, .cart-mini-count { position:absolute; top:-6px; right:-6px; background:var(--accent-red); color:#fff; font-weight:900; font-size:12px; padding:4px 7px; border-radius:999px; box-shadow: 0 6px 20px rgba(255,59,48,0.15); }

/* ---------- Hero (desktop wide layout) ---------- */
  .hero-slideshow {
    max-width:1400px;
    margin:28px auto;
    display:grid;
    grid-template-columns: 1fr 420px;
    gap:24px;
    align-items:stretch;
    padding:0 26px;
  }

  .hero-slideshow .slides {
    position:relative;
    border-radius:16px;
    overflow:hidden;
    box-shadow: var(--card-shadow-lg);
    min-height:420px;
    background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.35));
  }

  .hero-slideshow .slide {
    position:absolute;
    inset:0;
    display:flex;
    align-items:stretch;
    transition: opacity 480ms cubic-bezier(.2,.9,.3,1), transform 480ms;
    opacity:0;
    transform: scale(.996);
    pointer-events:none;
  }
  .hero-slideshow .slide[aria-hidden="false"], .hero-slideshow .slide.is-active { opacity:1; transform:none; pointer-events:auto; }

  .slide-img {
    width:60%;
    height:100%;
    object-fit:cover;
    float:left;
    filter: saturate(1.06) contrast(1.02) brightness(.96);
  }
  .slide-overlay {
    width:40%;
    padding:38px 34px;
    display:flex;
    align-items:center;
    background: linear-gradient(90deg, rgba(0,0,0,0.45) 0%, rgba(0,0,0,0.05) 100%);
  }
  .slide-content { width:100%; color:var(--text); }

  .eyebrow { color:var(--accent-yellow); font-weight:900; letter-spacing:0.6px; font-size:13px; margin:0 0 8px; }
  .slide-title { margin:0 0 12px; font-size:32px; line-height:1.02; font-weight:900; color: linear-gradient(90deg,var(--accent-red),var(--accent-green)); background: -webkit-linear-gradient(var(--accent-red), var(--accent-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .slide-sub { color:var(--muted); margin-bottom:18px; }

  .slide-ctas { display:flex; gap:12px; align-items:center; }
  .btn {
    display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:12px; font-weight:900; cursor:pointer; border:0;
    transition: transform 160ms ease, box-shadow 160ms;
  }
  .btn.primary { background: var(--cta-gradient); color:#0b0b0b; box-shadow: 0 18px 48px rgba(0,123,255,0.12); }
  .btn.ghost { background: var(--btn-ghost); color:var(--text); border:1px solid rgba(255,255,255,0.04); }
  .btn.small { padding:8px 10px; border-radius:10px; font-size:14px; }

  .slide-art .art-icon { color:rgba(255,255,255,0.06); font-size:44px; margin-right:8px; transform:rotate(-12deg); }

/* slideshow controls */
  .slideshow-controls { position:absolute; left:26px; right:26px; bottom:18px; display:flex; justify-content:space-between; align-items:center; pointer-events:none; }
  .slideshow-controls .icon-btn { pointer-events:auto; background: rgba(0,0,0,0.45); color:#fff; border-radius:10px; padding:10px; }

  .slide-dots { display:flex; gap:8px; align-items:center; pointer-events:auto; }
  .dot { width:10px; height:10px; border-radius:999px; background: rgba(255,255,255,0.16); border:1px solid rgba(255,255,255,0.04); }
  .dot.is-active { width:44px; background: linear-gradient(90deg,var(--accent-green),var(--accent-blue)); box-shadow: 0 8px 22px rgba(0,123,255,0.12); border-radius:999px; }

/* Hero right column (promo / quick order / highlights) */
  .promo-detail, .promo-card, .promo-carousel { box-shadow: var(--card-shadow-sm); background:var(--panel); border-radius:14px; padding:18px; }

/* ---------- Menu section (desktop grid) ---------- */
  .menu-section { max-width:1400px; margin:34px auto; padding:0 26px 36px; }
  .menu-section .section-title { display:flex; align-items:center; gap:10px; font-weight:900; color:var(--accent-yellow); font-size:20px; margin-bottom:6px; }
  .menu-section .section-sub { color:var(--muted); margin-bottom:18px; }

  .menu-tabs { display:flex; gap:8px; margin-bottom:18px; flex-wrap:wrap; }
  .tab-btn { padding:10px 14px; border-radius:12px; background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); font-weight:800; cursor:pointer; }
  .tab-btn.is-active { background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); color:var(--text); box-shadow: 0 10px 30px rgba(0,0,0,0.6); border:1px solid rgba(255,255,255,0.06); }

  .menu-container.glass-card {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--card-radius);
    padding:20px;
    border:1px solid var(--glass-border);
    box-shadow: var(--card-shadow-sm);
  }

  /* Desktop grid: 3 columns */
  .menu-grid {
    display:grid;
    grid-template-columns: repeat(3, 1fr);
    gap:18px;
  }

  .menu-item {
    background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
    border-radius:12px;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    border:1px solid rgba(255,255,255,0.03);
    transition: transform 200ms cubic-bezier(.2,.9,.3,1), box-shadow 200ms;
  }
  .menu-item:hover { transform: translateY(-6px); box-shadow: 0 18px 48px rgba(0,0,0,0.6); }

  .item-top { display:flex; gap:12px; align-items:center; }
  .item-thumb { width:110px; height:86px; object-fit:cover; border-radius:10px; flex:0 0 110px; border:1px solid rgba(255,255,255,0.04); }
  .item-meta .item-title { font-weight:900; margin:0; color:var(--text); font-size:16px; display:flex; gap:8px; align-items:center; }
  .promo-badge { background: linear-gradient(90deg,var(--accent-green), var(--accent-yellow)); color:#070707; font-weight:900; padding:6px 8px; border-radius:8px; font-size:12px; }
  .promo-badge-small { background:var(--accent-blue); color:#fff; padding:4px 6px; border-radius:8px; font-size:12px; }

  .item-desc { color:var(--muted); font-size:13px; margin-top:4px; }

  .item-config { display:flex; flex-direction:column; gap:10px; }
  .label { font-size:13px; color:var(--muted); font-weight:800; margin-bottom:4px; }
  .select, .input { padding:10px 12px; border-radius:10px; background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--text); font-weight:800; }
  .addons-row { display:flex; gap:10px; flex-wrap:wrap; }

  .addon { display:flex; gap:8px; align-items:center; background: rgba(255,255,255,0.01); padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); cursor:pointer; }
  .addon input { width:16px; height:16px; accent-color:var(--accent-green); }

  .item-actions { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:6px; }
  .price-row { display:flex; flex-direction:column; gap:4px; text-align:right; }
  .price-label { color:var(--muted); font-size:13px; }
  .item-price { font-size:18px; font-weight:900; color:var(--accent-yellow); }

  .action-row .btn.small { padding:8px 12px; border-radius:10px; }

/* ---------- Product modal (large center-screen) ---------- */
  .modal { display:none; position:fixed; inset:0; z-index:4000; align-items:center; justify-content:center; background: rgba(0,0,0,0.6); }
  .modal[aria-hidden="false"], .modal[style*="display: flex;"] { display:flex; }

  .modal .modal-inner {
    width:100%;
    max-width:920px;
    border-radius:16px;
    overflow:hidden;
    background:var(--panel);
    border: 1px solid rgba(255,255,255,0.04);
    box-shadow: var(--card-shadow-lg);
    padding:0;
  }
  #product-modal .pm-header{ display:flex; gap:18px; padding:18px; align-items:center; border-bottom:1px solid rgba(255,255,255,0.03); }
  #product-modal .pm-thumb { width:160px; height:120px; object-fit:cover; border-radius:12px; border:1px solid rgba(255,255,255,0.04); }
  #product-modal .pm-body{ padding:18px; max-height:62vh; overflow:auto; }
  #product-modal .pm-footer{ padding:16px; display:flex; justify-content:space-between; align-items:center; border-top:1px solid rgba(255,255,255,0.03); }

/* ---------- Cart drawer (desktop pinned right panel) ---------- */
  .cart-drawer {
    display:flex;
    position:fixed;
    right:28px;
    top:100px;
    width:420px;
    height:calc(100vh - 140px);
    border-radius:16px;
    overflow:hidden;
    background: linear-gradient(180deg, rgba(10,10,10,0.98), rgba(6,6,6,0.98));
    border:1px solid rgba(255,255,255,0.04);
    box-shadow: 0 40px 120px rgba(0,0,0,0.6);
    z-index:3500;
    flex-direction:column;
  }
  .cart-drawer[aria-hidden="true"]{ display:none; }
  .cart-header { padding:16px 18px; border-bottom:1px solid rgba(255,255,255,0.03); display:flex; gap:12px; align-items:center; justify-content:space-between; }
  .cart-body { padding:12px 16px; overflow:auto; flex:1 1 auto; }
  .cart-items { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:12px; }
  .cart-items .cart-line { display:flex; justify-content:space-between; align-items:center; gap:10px; }
  .cart-footer { padding:16px; border-top:1px solid rgba(255,255,255,0.03); display:flex; justify-content:space-between; align-items:center; gap:12px; }

/* ---------- Checkout page (center modal) ---------- */
  #checkout-page { display:none; position:fixed; inset:0; z-index:4200; align-items:center; justify-content:center; background: rgba(0,0,0,0.6); }
  #checkout-page[aria-hidden="false"] { display:flex; }
  #checkout-inner { width:1100px; max-width:1100px; background:var(--panel); border-radius:16px; overflow:hidden; display:grid; grid-template-columns: 1fr 420px; box-shadow: var(--card-shadow-lg); border:1px solid rgba(255,255,255,0.04); }
  .checkout-left { padding:22px; }
  .checkout-right { padding:22px; border-left:1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); }

/* ---------- Promo / Carousel (desktop large) ---------- */
  .promo-carousel { max-width:420px; margin:0; }
  .promo-card { padding:16px; border-radius:12px; }

/* ---------- Entry promo modal / preorder modal ---------- */
  .entry-promo.modal, .modal-inner { max-width:720px; border-radius:12px; }

/* ---------- Purchase history modal ---------- */
  #purchase-history-modal .ph-inner { max-width:980px; padding:18px; border-radius:12px; }
  .ph-item { background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.03); padding:12px; border-radius:10px; }

/* ---------- Order confirmation ---------- */
  #order-confirmation-modal .oc-inner { max-width:920px; padding:20px; }

/* ---------- Footer (desktop) ---------- */
  .site-footer { margin-top:36px; padding:28px 26px; background: linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.55)); border-top:1px solid rgba(255,255,255,0.03); color:var(--muted); }
  .footer-top { display:flex; gap:18px; align-items:center; justify-content:space-between; max-width:1200px; margin:0 auto; }
  .footer-grid { display:flex; gap:18px; margin-top:18px; max-width:1200px; margin-left:auto; margin-right:auto; justify-content:space-between; }
  .footer-left, .footer-right { flex:1; }
  .footer-bottom { text-align:center; margin-top:18px; color:rgba(255,255,255,0.6); }

/* ---------- Buttons: accessibility + focus ---------- */
  .btn:focus, .icon-btn:focus, .tab-btn:focus, .dot:focus { outline: none; box-shadow: var(--focus-ring); border-radius:10px; }

/* ---------- Helper utilities ---------- */
  .glass-card { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); border-radius:12px; padding:12px; }
  .muted { color: var(--muted); font-size:13px; }
  .small { font-size:13px; color:var(--muted); }
  .badge { padding:6px 8px; border-radius:8px; background:rgba(255,255,255,0.03); color:var(--text); font-weight:900; }

  /* Colorful micro-accents for visual variety */
  .accent-red { color:var(--accent-red); font-weight:900; }
  .accent-blue { color:var(--accent-blue); font-weight:900; }
  .accent-green { color:var(--accent-green); font-weight:900; }
  .accent-yellow { color:var(--accent-yellow); font-weight:900; }

  /* Fine-tuned responsiveness for very large displays */
  @media (min-width:1500px) {
    .hero-slideshow { grid-template-columns: 1fr 520px; gap:32px; }
    #checkout-inner, #product-modal .modal-inner { max-width:1200px; }
    .menu-grid { grid-template-columns: repeat(4, 1fr); gap:22px; }
  }

  /* small polish: reduce motion if user prefers reduced-motion */
  @media (prefers-reduced-motion: reduce) {
    * { transition: none !important; animation: none !important; }
  }
}
/* ===== end desktop styles ===== */
</style>


</head>
<body>
  <!-- STICKY HEADER (mobile-first: only logo, cart with badge, hamburger) -->
  <header id="site-header" class="sticky-header" role="banner" aria-live="polite">
    <div class="header-inner">
      <!-- Logo (left) -->
      <div class="logo" aria-label="Wrap District logo">
        <span class="logo-mark">WRAP</span>
        <span class="logo-name">District</span>
      </div>

      <!-- Cart (center/right) -->
      <button id="cart-toggle" class="icon-btn cart-btn" aria-haspopup="dialog" aria-controls="cart-drawer" aria-label="Open cart">
        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
        <span id="cart-count" class="cart-count" aria-live="polite">0</span>
      </button>

      <!-- Hamburger -->
      <button id="hamburger" class="icon-btn ham-btn" aria-expanded="false" aria-controls="mobile-nav" aria-label="Open menu">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>
    </div>
  </header>

  <!-- MOBILE NAV (off-canvas) -->
  <nav id="mobile-nav" class="mobile-nav" aria-hidden="true">
    <div class="mobile-nav-inner">
      <button id="nav-close" class="icon-btn" aria-label="Close menu"><i class="fa fa-times"></i></button>
      <ul class="nav-list">
        <li><a href="#hero" class="nav-link"><i class="fa fa-home"></i> Home</a></li>
        <li><a href="#menu" class="nav-link"><i class="fa fa-list"></i> Menu</a></li>
        <li><a href="#promo" class="nav-link"><i class="fa fa-bullhorn"></i> Promo</a></li>
        <li><a href="#contact" class="nav-link"><i class="fa fa-map-marker"></i> Contact</a></li>
      </ul>
    </div>
  </nav>

  <!-- HERO: Mobile-first slideshow with 3 slides -->
  <main id="main">
    <section id="hero" class="hero-slideshow" aria-roledescription="carousel" aria-label="Hero slideshow">
      <div class="slides" id="slides">
        <!-- Slide 1: Business introduction (wraps & brand) -->
        <article class="slide" data-slide-index="0" aria-hidden="false">
          <img class="slide-img" src="promo-shawarma.jpg" alt="Close up shawarma wrap">
          <div class="slide-overlay">
            <div class="slide-content">
              <p class="eyebrow"><i class="fa fa-fire"></i> Fresh & Hot</p>
              <h1 class="slide-title">Shawarma & Wraps — Made to Order</h1>
              <p class="slide-sub">Premium fillings, house sauces, and fast delivery to Tema Community 25.</p>
              <div class="slide-ctas">
                <a href="#menu" class="btn primary"><i class="fa fa-utensils"></i> See Menu</a>
                <button class="btn ghost" data-action="order-now" data-feature="shawarma"><i class="fa fa-phone"></i> Order via WhatsApp</button>
              </div>
              <!-- decorative icons/artwork -->
              <div class="slide-art">
                <i class="fa fa-leaf art-icon"></i>
                <i class="fa fa-star art-icon"></i>
              </div>
            </div>
          </div>
        </article>

        <!-- Slide 2: Business highlight (fries & rice) -->
        <article class="slide" data-slide-index="1" aria-hidden="true">
          <img class="slide-img" src="hero-fries-large.jpg" alt="Loaded fries">
          <div class="slide-overlay">
            <div class="slide-content">
              <p class="eyebrow"><i class="fa fa-thumbs-up"></i> Crowd Favorite</p>
              <h2 class="slide-title">Loaded Fries • Fried Rice • Angwamo</h2>
              <p class="slide-sub">Generous portions, tasty toppings, and affordable tiers.</p>
              <div class="slide-ctas">
                <a href="#menu" class="btn primary"><i class="fa fa-list-alt"></i> Explore Portions</a>
                <a href="#promo" class="btn ghost"><i class="fa fa-gift"></i> Current Deals</a>
              </div>
              <div class="slide-art">
                <i class="fa fa-bolt art-icon"></i>
                <i class="fa fa-heart art-icon"></i>
              </div>
            </div>
          </div>
        </article>

        <!-- Slide 3: Promo -->
        <article class="slide" data-slide-index="2" aria-hidden="true">
          <img class="slide-img" src="hero-shawarma-large.jpg" alt="Promo: buy 2 get 1">
          <div class="slide-overlay slide-promo">
            <div class="slide-content">
              <p class="eyebrow"><i class="fa fa-clock"></i> Limited Time</p>
<h2 class="slide-title">Friday Madness — Buy 2 Shawarmas, Get 1 Free</h2>
              <p class="slide-sub">Loaded Fries come with a free Coke during Friday promo hours.</p>

           <!-- inside your Slide 3 slide-content where promo-cta-row exists -->
<div class="promo-cta-row">
  <button class="btn primary" data-action="apply-promo" data-promo-code="FRIDAY-B2G1">
    <i class="fa fa-tag"></i> Claim Promo
  </button>

  <button class="btn ghost" data-action="learn-more" aria-controls="promo-details">
    <i class="fa fa-info-circle"></i> Details
  </button>

  <!-- NEW: Preorder button for the upcoming promo -->
  <button class="btn primary" data-action="preorder-promo" id="promo-preorder-btn">
    <i class="fa fa-calendar-check"></i> Preorder for next promo
  </button>
</div>

              <div class="promo-urgency">
                <span class="promo-countdown" id="promo-countdown" aria-live="polite">Promo ends in: <strong id="promo-timer">—</strong></span>
               <small class="promo-note">Next promo: Fridays • Add 2 Shawarmas to auto-apply.</small>
              </div>
            </div>
          </div>
        </article>
      </div>

      <!-- slideshow controls -->
      <div class="slideshow-controls">
        <button class="slide-prev icon-btn" aria-label="Previous slide"><i class="fa fa-chevron-left"></i></button>
        <div id="slide-dots" class="slide-dots" role="tablist" aria-label="Slide dots">
          <button class="dot is-active" data-index="0" aria-label="Slide 1"></button>
          <button class="dot" data-index="1" aria-label="Slide 2"></button>
          <button class="dot" data-index="2" aria-label="Slide 3"></button>
        </div>
        <button class="slide-next icon-btn" aria-label="Next slide"><i class="fa fa-chevron-right"></i></button>
      </div>
    </section>

    <!-- MENU: mobile-friendly, card-based, not a long table -->
<!-- MENU: mobile-friendly, card-based, improved -->
<section id="menu" class="menu-section" aria-labelledby="menu-heading">
  <div class="container-small">
    <h2 id="menu-heading" class="section-title"><i class="fa fa-utensils"></i> Menu</h2>
    <p class="section-sub">Tap an item to configure size, protein and add-ons. Use the tabs to filter quickly.</p>

    <!-- Category tabs (mobile horizontal scroll) -->
    <div class="menu-tabs" role="tablist" aria-label="Menu categories">
      <button class="tab-btn is-active" data-cat="all" role="tab" aria-selected="true">All</button>
      <button class="tab-btn" data-cat="wraps" role="tab">Wraps</button>
      <button class="tab-btn" data-cat="fries" role="tab">Fries</button>
      <button class="tab-btn" data-cat="rice" role="tab">Rice</button>
      <button class="tab-btn" data-cat="angwamo" role="tab">Angwamo</button>
      <button class="tab-btn" data-cat="noodles" role="tab">Noodles</button>
    </div>

    <!-- visual container for menu items -->
    <div class="menu-container glass-card">
      <div class="menu-grid" id="menu-grid">
        <!-- Shawarma (structured pricing tiers) -->
        <article class="menu-item" id="item-shawarma" data-item-id="shawarma" data-category="wraps" data-promo="buy2get1" tabindex="0">
          <!-- ...same inner markup as before (keeps selects/addons) ... -->
          <div class="item-top">
            <img class="item-thumb" src="thumb-shawarma.jpg" alt="Shawarma thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Shawarma <span class="badge promo-badge">Buy 2 → 1 Free</span></h3>
              <p class="item-desc">Choose size, then protein. Clear pricing tiers.</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Size</label>
            <select class="select size-select" name="shawarma-size" aria-label="Shawarma size" data-item="shawarma">
              <option value="45" data-size-key="lite">Lite — GHC 45</option>
              <option value="55" data-size-key="classic">Classic — GHC 55</option>
              <option value="70" data-size-key="district-max">District Max — GHC 70</option>
            </select>

            <label class="label">Extra Proteins</label>
            <select class="select protein-select" name="shawarma-protein" aria-label="Shawarma protein" data-item="shawarma">
              <option value="0" data-protein="none">None — +GHC 0</option>
              <option value="8" data-protein="chicken">Extra Chicken — +GHC 8</option>
              <option value="4" data-protein="beef">Extra Sausage — +GHC 4</option>
              <option value="12" data-protein="mixed">Mixed — +GHC 12</option>
            </select>

            <div class="item-addons">
              <label class="label">Extras</label>
              <div class="addons-row">
                <label class="addon">
                  <input type="checkbox" class="addon-checkbox" value="5" data-addon-key="extra-sauce" />
                  <span>Extra Sauce (+GHC 5)</span>
                </label>
                <label class="addon">
                  <input type="checkbox" class="addon-checkbox" value="10" data-addon-key="cheese" />
                  <span>Extra Cheese (+GHC 10)</span>
                </label>
              </div>
            </div>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">45</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="shawarma">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="shawarma">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Loaded Fries -->
        <article class="menu-item" id="item-fries" data-item-id="loaded-fries" data-category="fries" data-promo="freecoke" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="thumb-fries.jpg" alt="Loaded fries thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Loaded Fries <span class="badge promo-badge-small">Free Coke</span></h3>
              <p class="item-desc">Choose portion & add protein/cheese.</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Portion</label>
          <select class="select portion-select" name="fries-portion" aria-label="Fries portion" data-item="loaded-fries">
  <option value="60" selected data-size="regular">Regular — GHC 60</option>
  <option value="70" data-size="large">Large — GHC 75</option>
</select>
      

            
            <label class="label">Toppings</label>
            <div class="addons-row">
              <label class="addon">
                <input type="checkbox" class="addon-checkbox" value="15" data-addon-key="extra-chicken" />
                <span>Extra Chicken (+GHC 15)</span>
              </label>
              <label class="addon">
                <input type="checkbox" class="addon-checkbox" value="10" data-addon-key="extra-cheese" />
                <span>Extra Cheese (+GHC 10)</span>
              </label>
                <label class="addon">
                <input type="checkbox" class="addon-checkbox" value="10" data-addon-key="extra-sauce" />
                <span>Extra Sauce (+GHC 10)</span>
              </label>
            </div>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">55</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="loaded-fries">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="loaded-fries">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Fried Rice -->
        <article class="menu-item" id="item-fried-rice" data-item-id="fried-rice" data-category="rice" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="hero-friedrice-large.jpg" alt="Fried rice thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Fried Rice</h3>
              <p class="item-desc">Classic spiced fried rice — choose protein.</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Choice</label>
            <select class="select protein-select" name="rice-protein" aria-label="Fried rice protein" data-item="fried-rice">
              <option value="60" data-protein="chicken">Classic (+Chicken) — GHC 60</option>
              <option value="60" data-protein="beef">Beef — GHC 60</option>
              <option value="60" data-protein="gizzard">Gizzard  — GHC 60</option>
            </select>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">60</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="fried-rice">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="fried-rice">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

       <!-- Loaded Angwamo -->
        <article class="menu-item" id="item-angwamo" data-item-id="loaded-angwamo" data-category="angwamo" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="hero-angwamo-large.jpg" alt="Angwamo thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Loaded Angwamo</h3>
              <p class="item-desc">Tiered: Basic / Classic / Max</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Tier</label>
            <select class="select tier-select" name="angwamo-tier" aria-label="Angwamo tier" data-item="loaded-angwamo">
              <option value="60" data-tier="basic">Basic — GHC 60</option>
              <option value="70" data-tier="classic">Classic — GHC 70</option>
              <option value="85" data-tier="max">Max (5 proteins) — GHC 85</option>
            </select>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">55</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="loaded-angwamo">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="loaded-angwamo">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

               <!-- Jungle Jumbo — Fully Loaded Jollof -->
        <article class="menu-item" id="item-jollof" data-item-id="jollof" data-category="rice" data-friday-price="75" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="image.png" alt="Jungle Jumbo fully loaded jollof thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Loaded Jollof <span class="badge">New</span></h3>
              <p class="item-desc">Hearty portion of Jungle Jumbo Fully Loaded Jollof ricewith protein & extras. </p>
            </div>
          </div>

          <div class="item-config">
            <!-- No selects for simplicity — it's a fixed-price item. -->
            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Price</span>
                <!-- main price-value used by existing JS to compute totals (default = normal price) -->
                  <span class="friday-price hidden" aria-hidden="true" ><del>GHC 85</del></span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">85</span></strong>
                <!-- strike/alternate price shown/toggled in JS on Fridays -->
               <div class="jollof-prices" style="margin-left:10px;">
                  <span class="normal-price" style="display: none"><del>GHC 85</del></span>
                
                </div>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="jollof">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="jollof">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
         </div>
        </article>
 
        <!-- Noodles -->
        <article class="menu-item" id="item-noodles" data-item-id="noodles" data-category="noodles" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="thumb-noodle.jpg" alt="Noodles thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Noodles</h3>
              <p class="item-desc">Assorted proteins available — GHC 50</p>
            </div>
          </div>

          <div class="item-config">
            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Price</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">50</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="noodles">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="noodles">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

      </div> <!-- .menu-grid -->
    </div> <!-- .menu-container -->
  </div>
</section>

    <!-- PROMO DETAILS (collapsible region referenced by the slide CTA) -->
    <section id="promo" class="promo-detail" aria-labelledby="promo-heading">
      <div class="container-small">
        <h2 id="promo-heading" class="section-title"><i class="fa fa-gift"></i> Promo</h2>
        <div id="promo-details" class="promo-copy">
<p><strong>Buy 2 Shawarmas, Get 1 Free (Fridays)</strong> — Promo applies automatically at checkout. Add two qualifying shawarmas and the third will be discounted to free during the Friday Madness window.</p>
          <p><strong>Loaded Fries</strong> — Get a free Coke when purchasing during promo hours. Free item will appear in cart once qualifying product is added.</p>
         <!-- somewhere inside #promo-details (promo-copy) -->
<div style="margin-top:10px;">
  <button class="btn primary" data-action="preorder-promo">Preorder for next Friday Madness</button>
</div>
          <div class="promo-help">
            <small id="promo-helper" class="muted">Tip: use the "Add missing items" button in cart to reach a promo threshold instantly.</small>
          </div>
        </div>
      </div>
    </section>

    <!-- CART DRAWER (off-canvas, mobile-friendly) -->
    <aside id="cart-drawer" class="cart-drawer" role="dialog" aria-label="Shopping cart" aria-hidden="true">
      <div class="cart-header">
        <h3>Your Cart <span class="cart-mini-count" id="cart-mini-count">0</span></h3>
        <button class="icon-btn" id="cart-close" aria-label="Close cart"><i class="fa fa-times"></i></button>
      </div>

      <div class="cart-body" id="cart-body">
        <!-- line items will be injected here by JS -->
        <ul id="cart-items" class="cart-items" aria-live="polite"></ul>

        <!-- promo helper / discount line -->
        <div id="cart-promo" class="cart-promo hidden" aria-live="polite">
          <div class="promo-applied">
            <span class="promo-label">Promo discount</span>
            <span class="promo-value" id="promo-discount">-GHC 0</span>
          </div>
          <div class="promo-cta">
            <small id="promo-help-text">Add 1 more Shawarma to get one free.</small>
            <button class="btn tiny" id="add-missing">Add missing items</button>
          </div>
        </div>

        <div class="cart-summary">
          <div class="summary-row">
            <span>Subtotal</span>
            <strong id="cart-subtotal">GHC 0</strong>
          </div>
          <div class="summary-row">
            <span>Delivery</span>
            <strong id="cart-delivery">GHC 0</strong>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <strong id="cart-total">GHC 0</strong>
          </div>
        </div>
      </div>

      <div class="cart-footer">
  <div class="footer-summary" style="display: none">
    <div>
      <div class="small">Subtotal</div>
      <div class="total-label">Total</div>
    </div>
    <div style="margin-left:auto; text-align:right;">
      <div id="footer-subtotal" class="small">GHC 0</div>
      <div id="footer-total" class="total-value">GHC 0</div>
    </div>
  </div>

  <div class="footer-actions" style="margin-left:12px;">
    <button id="checkout-btn" class="btn primary" data-action="checkout" style="min-width:120px;">
      <i class="fa fa-credit-card"></i> Pay
    </button>
    <button id="clear-cart" class="btn ghost" data-action="clear" style="min-width:80px;">
      <i class="fa fa-trash"></i>
    </button>
  </div>
</div>
    </aside>

    <!-- ENTRY PROMO MODAL / SLIDE-IN for new visitors -->
<div id="entry-promo" class="entry-promo modal hidden" role="dialog" aria-modal="true" aria-label="Friday Madness">
      <div class="modal-inner">
        <button id="entry-close" class="icon-btn modal-close" aria-label="Close promo"><i class="fa fa-times"></i></button>
        <div class="modal-body">
         <h3><i class="fa fa-gift"></i> Friday Madness</h3>
        <p class="lead">Buy 2 Shawarmas, get one free. Valid Fridays. Tap to claim now.</p>
        <div class="modal-actions">
          <button class="btn primary" id="claim-promo-entry" data-promo="FRIDAY-B2G1"><i class="fa fa-tag"></i> Claim Promo</button>
            <label class="dont-show">
              <input type="checkbox" id="dont-show-again" />
              Don't show again
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTACT / FOOTER -->
<footer id="contact" class="site-footer" role="contentinfo" aria-label="Contact and footer">
  <div class="footer-top">
    <div class="footer-brand" aria-hidden="false">
      <span class="logo-mark">WRAP</span>
      <div style="display:flex;flex-direction:column;">
        <span class="logo-name" style="font-weight:900; color:var(--accent-2)">District</span>
        <small class="tagline">Fresh. Hot. Fast — Delivered to Tema</small>
      </div>
    </div>

    <div class="footer-ctas" role="group" aria-label="Footer actions">
      <!-- Order: scrolls to menu / opens cart -->
      <button id="footer-order" class="btn-footer btn-order" aria-label="Order now">
        <i class="fa fa-utensils" aria-hidden="true"></i> Order
      </button>

      <!-- WhatsApp quick contact -->
      <a id="footer-wa" class="btn-footer btn-wa" href="https://wa.me/233571118856" target="_blank" rel="noopener noreferrer" aria-label="Chat on WhatsApp">
        <i class="fab fa-whatsapp" aria-hidden="true"></i> WhatsApp
      </a>
    </div>
  </div>

  <div class="footer-grid">
    <div class="footer-left">
      <div class="contact-list">
        <div class="contact-row"><i class="fa fa-phone"></i><a href="tel:0552509241">0552509241</a></div>
        <div class="contact-row"><i class="fa fa-map-marker"></i><span>Tema Community 25, Devtraco</span></div>
        <div class="contact-row"><i class="fab fa-snapchat-ghost"></i><span>@kenneth_idk</span></div>
        <div class="contact-row"><i class="fa-solid fa-envelope"></i><a href="mailto:kennethkamkam22@gmail.com">kennethkamkam22@gmail.com</a></div>
 
      </div>

      <div class="pickup" aria-hidden="false">
        <i class="fa fa-store"></i>
        <div style="flex:1;">
          <div style="font-weight:900">Pickup available</div>
          <small style="color:rgba(255,255,255,0.78)">Devtraco — Tap Order to choose Pickup or Delivery</small>
        </div>
      </div>
    </div>

    <div class="footer-right">
      <div class="meta-block">
        <div class="hours"><i class="fa fa-clock"></i>&nbsp; Hours</div>
        <div style="text-align:right">
          <div style="font-weight:900">Mon–Fri: 5pm • Sat–Sun: 9am</div>
          <div class="delivery" style="margin-top:4px">Delivery: Available — fees at checkout</div>
        </div>
      </div>

      <div style="margin-top:10px">
        <button id="footer-locate" class="btn-footer btn-wa" aria-label="Show pickup location">
          <i class="fa fa-map"></i> Our location
        </button>
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    <small>© Wrap District — Built for mobile • Images and prices subject to change</small>
  </div>
</footer>
    <!-- PREORDER MODAL -->
<div id="preorder-modal" class="modal" role="dialog" style ="display: none" aria-modal="true" aria-hidden="true">
  <div class="modal-inner">
    <button class="icon-btn modal-close" id="preorder-close" aria-label="Close"><i class="fa fa-times"></i></button>
    <div class="modal-body">
      <h3><i class="fa fa-calendar-plus"></i> Preorder for next Promo</h3>
      <p class="lead">We will reserve your current cart items for the next Tuesday promo window.</p>

      <form id="preorder-form">
        <label class="label">Name</label>
        <input id="preorder-name" class="input" type="text" placeholder="Your name" required>

        <label class="label">Phone</label>
        <input id="preorder-phone" class="input" type="tel" placeholder="0550xxxxxx" required>

        <label class="label">Note (optional)</label>
        <input id="preorder-note" class="input" type="text" placeholder="Delivery/pickup notes">

        <div style="display:flex; gap:8px; margin-top:10px;">
          <button type="submit" class="btn primary" id="preorder-confirm"><i class="fa fa-check"></i> Confirm Preorder</button>
          <button type="button" class="btn ghost" id="preorder-cancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
  </main>
  

<style>
/* Purchase history modal (lightweight; reuses your .modal/.modal-inner patterns) */
#purchase-history-modal { display:none; position:fixed; inset:0; z-index:9000; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; padding:12px; box-sizing:border-box; }
#purchase-history-modal[aria-hidden="false"]{ display:flex; }
#purchase-history-modal .ph-inner { width:100%; max-width:820px; border-radius:12px; background: linear-gradient(180deg,#0b0b0b,#070707); color:#fff; box-shadow: 0 40px 120px rgba(0,0,0,0.7); padding:14px; }
#purchase-history-modal h3 { margin:0 0 8px 0; color:var(--accent-2); font-weight:900; }
.ph-list { margin-top:12px; display:flex; flex-direction:column; gap:10px; max-height:60vh; overflow:auto; padding-right:6px; }
.ph-item { display:grid; grid-template-columns: 1fr 200px; gap:12px; align-items:center; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); }
.ph-meta { min-width:0; }
.ph-meta .ref { font-weight:900; color:#fff; }
.ph-meta .ts { font-size:13px; color:rgba(255,255,255,0.72); }
.ph-actions { display:flex; gap:8px; justify-self:end; }
.ph-empty { padding:20px; text-align:center; color:rgba(255,255,255,0.7); }
.ph-footer { display:flex; gap:8px; justify-content:space-between; align-items:center; margin-top:12px; }
.ph-search { width:260px; padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; }
.btn.small-xs{ padding:6px 8px; border-radius:8px; font-size:13px; }
</style>

<!-- Modal skeleton (will be appended dynamically if you prefer a JS-only injection) -->
<div id="purchase-history-modal" role="dialog" aria-hidden="true" aria-label="Purchase history">
  <div class="ph-inner">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
      <h3><i class="fa fa-history"></i> Purchase history</h3>
      <div>
        <input id="ph-search" class="ph-search" placeholder="Search ref, name or phone" />
        <button id="ph-clear" class="btn ghost small-xs" style="margin-left:8px">Clear</button>
        <button id="ph-close" class="icon-btn" aria-label="Close history"><i class="fa fa-times"></i></button>
      </div>
    </div>

    <div id="ph-list" class="ph-list" aria-live="polite">
      <!-- items injected here -->
    </div>

    <div class="ph-footer">
      <div class="small-muted">Your recent purchases are stored locally on this device.</div>
      <div style="display:flex;gap:8px;align-items:center;">
        <button id="ph-clear-all" class="btn ghost small-xs">Clear all</button>
        <button id="ph-refresh" class="btn primary small-xs">Refresh</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // key used in localStorage for purchases
  const KEY = 'wrap_purchases';
  const MAX_SAVE = 50; // keep last 50 purchases

  // utilities
  function _nowTs(){ return Date.now(); }
  function fmtDate(ts){ try { return new Date(ts).toLocaleString(); } catch(e){ return String(ts); } }
  function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  function readPurchases(){ try{ return JSON.parse(localStorage.getItem(KEY) || '[]'); }catch(e){ return []; } }
  function writePurchases(arr){ try{ localStorage.setItem(KEY, JSON.stringify(arr.slice(0, MAX_SAVE))); }catch(e){ console.warn('Could not save purchases', e); } }

  // Build a printable invoice HTML for a given order object
  function createInvoiceHtml(order){
    const escape = escapeHtml;
    const ref = escape(order.reference || ('ref-' + (order.ts || _nowTs())));
    const name = escape(order.name || '—');
    const phone = escape(order.phone || '—');
    const email = escape(order.email || '');
    const type = escape(order.type || '—');
    const address = escape(order.address || '—');
    const note = escape(order.note || '-');
    const placed = escape(new Date(order.ts || _nowTs()).toLocaleString());

    // Build rows from order.cart
    let rowsHtml = '';
    let computedSubtotal = 0;
    const lines = Array.isArray(order.cart) ? order.cart : [];
    if (!lines.length) {
      rowsHtml = `<tr><td colspan="4" style="text-align:center;padding:12px 0;color:#666">No line items recorded.</td></tr>`;
    } else {
      lines.forEach(l => {
        const qty = Number(l.qty || 1);
        const unit = Number(l.unitPrice || l.unit_price || 0);
        const lineTotal = Math.round(qty * unit);
        computedSubtotal += lineTotal;
        // meta
        let meta = '';
        try {
          if (l.meta) {
            const parts = [];
            if (Array.isArray(l.meta.addons) && l.meta.addons.length) parts.push('Extras: ' + l.meta.addons.map(a => escape(a.label || a.key || a)).join(', '));
            Object.keys(l.meta).forEach(k => { if (k === 'addons') return; const v = l.meta[k]; if (v && v.label) parts.push(escape(k) + ': ' + escape(v.label)); else if (v && v.text) parts.push(escape(k) + ': ' + escape(v.text)); });
            if (parts.length) meta = `<div style="font-size:12px;color:#444;margin-top:6px;">${parts.join(' • ')}</div>`;
          }
        } catch(e){}

        rowsHtml += `
          <tr>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee;"> <strong>${escape(l.title||l.name||'Item')}</strong> ${meta} </td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:center;">${qty}</td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:right;">GHC ${Number(unit).toFixed(0)}</td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:right;">GHC ${Number(lineTotal).toFixed(0)}</td>
          </tr>
        `;
      });
    }

    const totals = order.totals || {};
    const subtotal = (typeof totals.subtotal !== 'undefined') ? Number(totals.subtotal) : computedSubtotal;
    const delivery = Number(totals.delivery || 0);
    const promo = Number(totals.promo || totals.promoDiscount || 0);
    const total = (typeof totals.total !== 'undefined') ? Number(totals.total) : Math.max(0, subtotal - promo + delivery);

    const printable = `<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Wrap District — Invoice ${ref}</title>
<style>
  body{font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial; color:#222; margin:0; padding:18px}
  .logo{display:flex;align-items:center;gap:12px}
  .logo-mark{background:linear-gradient(135deg,#FF6A00,#ff8c2b);color:#111;padding:6px 10px;border-radius:8px;font-weight:900}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th{text-align:left;padding:10px 8px;border-bottom:2px solid #eee}
  td{padding:8px;border-bottom:1px solid #eee}
  .totals{max-width:420px;margin-left:auto;margin-top:12px;border-top:1px dashed #ddd;padding-top:10px}
</style>
</head>
<body>
  <div class="logo"><div class="logo-mark">WRAP</div><div><h2 style="margin:0">Wrap District</h2><div style="color:#666;font-size:13px">Fresh • Hot • Fast — Devtraco, Tema</div></div></div>
  <div style="display:flex;gap:12px;margin-top:12px">
    <div style="flex:1">
      <div><strong>Customer</strong></div>
      <div style="margin-top:6px"><strong>${name}</strong></div>
      <div style="font-size:13px;color:#666">${phone} • ${email}</div>
      <div style="margin-top:8px;font-size:13px;color:#666"><strong>Order type:</strong> ${type}</div>
      <div style="margin-top:4px;font-size:13px;color:#666"><strong>Address:</strong> ${address}</div>
    </div>
    <div style="width:250px">
      <div style="font-size:13px;color:#666"><strong>Reference:</strong> ${ref}</div>
      <div style="margin-top:6px;font-size:13px;color:#666"><strong>Placed:</strong> ${placed}</div>
      <div style="margin-top:6px;font-size:13px;color:#666"><strong>Prepared:</strong> ${new Date().toLocaleString()}</div>
    </div>
  </div>

  <table aria-label="Order lines">
    <thead>
      <tr><th style="width:60%">Item & options</th><th style="width:10%;text-align:center">Qty</th><th style="width:15%;text-align:right">Unit</th><th style="width:15%;text-align:right">Line</th></tr>
    </thead>
    <tbody>
      ${rowsHtml}
    </tbody>
  </table>

  <div class="totals">
    <div style="display:flex;justify-content:space-between"><div>Subtotal</div><div>GHC ${Number(subtotal).toFixed(0)}</div></div>
    <div style="display:flex;justify-content:space-between"><div>Delivery</div><div>GHC ${Number(delivery).toFixed(0)}</div></div>
    <div style="display:flex;justify-content:space-between"><div>Promo Discount</div><div>-GHC ${Number(promo).toFixed(0)}</div></div>
    <div style="display:flex;justify-content:space-between;font-weight:900;margin-top:8px"><div>Total</div><div>GHC ${Number(total).toFixed(0)}</div></div>
  </div>

  <div style="margin-top:14px;color:#666;font-size:13px">Contact: Wrap District • 0552509241 • Devtraco, Tema. Keep this reference for inquiries.</div>
</body>
</html>`;

    return printable;
  }

  // Save purchase into history (dedupe by reference)
  function savePurchase(order){
    try {
      if (!order || !order.reference) {
        // assign one if missing
        order.reference = order.reference || ('LOCAL-' + Date.now());
      }
      const purchases = readPurchases();
      const exists = purchases.find(p => p.reference === order.reference);
      if (exists) return exists; // don't duplicate

      // create invoice html and store with purchase record
      const invoiceHtml = createInvoiceHtml(order);
      const item = {
        id: order.reference.replace(/[^a-zA-Z0-9-_]/g,'') || ('p-' + Date.now()),
        reference: order.reference,
        name: order.name || '',
        phone: order.phone || '',
        totals: order.totals || {},
        ts: order.ts || Date.now(),
        invoiceHtml: invoiceHtml,
        raw: order
      };
      purchases.unshift(item);
      writePurchases(purchases);
      return item;
    } catch (e) { console.error('savePurchase error', e); }
  }

  // Render list into modal
  function renderPurchaseList(filter){
    const wrap = document.getElementById('ph-list');
    if (!wrap) return;
    const arr = readPurchases();
    const q = (filter || '').trim().toLowerCase();
    const filtered = q ? arr.filter(p => (p.reference||'').toLowerCase().includes(q) || (p.name||'').toLowerCase().includes(q) || (p.phone||'').toLowerCase().includes(q)) : arr;
    wrap.innerHTML = '';
    if (!filtered.length) { wrap.innerHTML = `<div class="ph-empty">No purchases yet.</div>`; return; }

    filtered.forEach(p => {
      const div = document.createElement('div'); div.className = 'ph-item';
      const meta = document.createElement('div'); meta.className = 'ph-meta';
      meta.innerHTML = `<div class="ref">${escapeHtml(p.reference)}</div><div class="ts">${fmtDate(p.ts)} • Total: GHC ${Number((p.totals && (p.totals.total || p.totals.totalAmount)) || p.raw?.totals?.total || 0).toFixed(0)}</div><div style="margin-top:6px; color: rgba(255,255,255,0.78);">${escapeHtml(p.name||'')} ${p.phone? ' • ' + escapeHtml(p.phone) : ''}</div>`;
      const actions = document.createElement('div'); actions.className = 'ph-actions';

      const openBtn = document.createElement('button'); openBtn.className = 'btn ghost small-xs'; openBtn.innerHTML = '<i class="fa fa-eye"></i> Open';
      openBtn.addEventListener('click', () => openPrintable(p));

      const dlBtn = document.createElement('button'); dlBtn.className = 'btn primary small-xs'; dlBtn.innerHTML = '<i class="fa fa-file-download"></i> Download';
      dlBtn.addEventListener('click', () => downloadInvoiceHtml(p));

      const printBtn = document.createElement('button'); printBtn.className = 'btn small-xs'; printBtn.innerHTML = '<i class="fa fa-print"></i> Print';
      printBtn.addEventListener('click', () => { openPrintable(p, true); });

      actions.appendChild(openBtn); actions.appendChild(dlBtn); actions.appendChild(printBtn);

      div.appendChild(meta); div.appendChild(actions);
      wrap.appendChild(div);
    });
  }

  // Open printable invoice in new window (user can Print -> Save as PDF)
  function openPrintable(purchase, autoPrint){
    try {
      const html = purchase.invoiceHtml || (purchase.raw ? createInvoiceHtml(purchase.raw) : '<html><body>Invoice not available</body></html>');
      const w = window.open('', '_blank', 'toolbar=0,location=0,menubar=0,width=900,height=1100');
      if (!w) { alert('Popup blocked. Allow popups to open printable invoice.'); return; }
      w.document.open(); w.document.write(html); w.document.close();
      w.focus();
      if (autoPrint) setTimeout(()=> { try { w.print(); } catch(e){} }, 400);
    } catch(e){ console.error('openPrintable error', e); }
  }

  function downloadInvoiceHtml(purchase){
    try {
      const html = purchase.invoiceHtml || (purchase.raw ? createInvoiceHtml(purchase.raw) : '<html><body>Invoice not available</body></html>');
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `wrap-invoice-${purchase.reference || purchase.id}.html`;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 2000);
    } catch(e){ console.error('download error', e); alert('Could not download invoice.'); }
  }

  function clearAllPurchases(){ if (!confirm('Clear all saved purchases? This cannot be undone.')) return; writePurchases([]); renderPurchaseList(''); }

  // Build UI (add header button + mobile nav link) and wire modal events
  document.addEventListener('DOMContentLoaded', () => {
    // header: insert to .header-inner after logo (if not already present)
    const headerInner = document.querySelector('.header-inner');
    if (headerInner && !document.getElementById('ph-open')) {
      const btn = document.createElement('button');
      btn.id = 'ph-open'; btn.className = 'icon-btn';
      btn.title = 'Purchase history';
      btn.innerHTML = '<i class="fa fa-history"></i>';
      btn.addEventListener('click', (e) => { openPhModal(); });
      // insert before hamburger if present
      const ham = headerInner.querySelector('.ham-btn');
      if (ham) headerInner.insertBefore(btn, ham);
      else headerInner.appendChild(btn);
    }

    // mobile nav: add link into .nav-list if not present
    const mobileNavList = document.querySelector('#mobile-nav .nav-list');
    if (mobileNavList && !mobileNavList.querySelector('.nav-link.ph-link')) {
      const li = document.createElement('li');
      const a = document.createElement('a'); a.href = '#purchase-history'; a.className = 'nav-link ph-link'; a.innerHTML = '<i class="fa fa-history"></i> Purchase history';
      a.addEventListener('click', (e) => { e.preventDefault(); openPhModal(); });
      li.appendChild(a); mobileNavList.appendChild(li);
    }

    // modal controls
    const modal = document.getElementById('purchase-history-modal');
    const phClose = document.getElementById('ph-close');
    const phRefresh = document.getElementById('ph-refresh');
    const phClear = document.getElementById('ph-clear');
    const phClearAll = document.getElementById('ph-clear-all');
    const phSearch = document.getElementById('ph-search');

    function openPhModal(){
      const m = document.getElementById('purchase-history-modal');
      if (!m) return;
      m.style.display = 'flex'; m.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
      renderPurchaseList(phSearch && phSearch.value ? phSearch.value : '');
      setTimeout(()=> phClose && phClose.focus(), 120);
    }
    function closePhModal(){ const m = document.getElementById('purchase-history-modal'); if (!m) return; m.style.display='none'; m.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    phClose && phClose.addEventListener('click', closePhModal);
    phRefresh && phRefresh.addEventListener('click', () => renderPurchaseList(phSearch.value));
    phClear && phClear.addEventListener('click', () => { phSearch.value=''; renderPurchaseList(''); });
    phClearAll && phClearAll.addEventListener('click', clearAllPurchases);
    phSearch && phSearch.addEventListener('input', () => renderPurchaseList(phSearch.value));

    // close on ESC
    document.addEventListener('keydown', (ev) => { if (ev.key === 'Escape') { const m = document.getElementById('purchase-history-modal'); if (m && m.getAttribute('aria-hidden') === 'false') closePhModal(); } });

    // Auto-save last order into purchases if wrap_show_confirmation flag present
    try {
      const showFlag = localStorage.getItem('wrap_show_confirmation');
      const raw = localStorage.getItem('wrap_last_order');
      if (showFlag === '1' && raw) {
        try {
          const order = JSON.parse(raw);
          if (order) {
            // Save if not already saved
            savePurchase(order);
            // Also ensure list is fresh
            renderPurchaseList('');
          }
        } catch(e){}
      }
    } catch(e){ console.warn('purchase auto-save error', e); }

    // Expose helpers to global for other scripts to call after a successful order
    window.wrapSavePurchase = savePurchase; // call with order object
    window.wrapOpenPurchaseHistory = openPhModal;

  }); // DOMContentLoaded
})();
</script>

<!-- End of Purchase History code -->

<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    // Order button: prefer opening cart if it has items, else scroll to menu
    const orderBtn = document.getElementById('footer-order');
    const menuAnchor = document.getElementById('menu');
    const cartToggle = document.getElementById('cart-toggle');

    orderBtn && orderBtn.addEventListener('click', function(e){
      // If there's a cart with items, open drawer; otherwise scroll to menu
      try {
        const cartCount = Number((document.getElementById('cart-count')||{}).innerText) || 0;
        if (cartCount > 0 && cartToggle) {
          cartToggle.click();
        } else if (menuAnchor) {
          menuAnchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          window.location.hash = '#menu';
        }
      } catch(err) {
        if (menuAnchor) menuAnchor.scrollIntoView({ behavior: 'smooth' });
      }
    });

    // Our location - open checkout map modal if present (map modal id #map-modal)
    const locBtn = document.getElementById('footer-locate');
  locBtn && locBtn.addEventListener('click', function(){
     const contact = document.getElementById('contact');
     if (contact) contact.scrollIntoView({ behavior: 'smooth' });
     else window.location.hash = '#contact';
   });

    // small accessibility: ensure links open new tab for external glances
    const wa = document.getElementById('footer-wa');
    if (wa) wa.setAttribute('rel','noopener noreferrer');
  });
})();
</script>
  <script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    const mobileNav = document.getElementById('mobile-nav');
    const hamburger = document.getElementById('hamburger');
    const navCloseBtn = document.getElementById('nav-close');

    if (!mobileNav) return;

    // Helper to close nav (keeps ARIA + visual in sync)
    function closeMobileNav() {
      mobileNav.style.display = 'none';
      mobileNav.setAttribute('aria-hidden', 'true');
      if (hamburger) hamburger.setAttribute('aria-expanded', 'false');
      // return focus to hamburger for keyboard users
      try { hamburger && hamburger.focus(); } catch(e){}
      // restore page scroll if other scripts toggled it
      try { document.body.style.overflow = ''; } catch(e){}
    }

    // Attach handler to each nav link inside mobile nav
    const navLinks = Array.from(mobileNav.querySelectorAll('a.nav-link, .nav-list a'));
    navLinks.forEach(link => {
      link.addEventListener('click', function(e){
        // Close menu immediately (visual)
        closeMobileNav();

        // If it's an internal anchor, do smooth scroll to target instead of default jump
        const href = (link.getAttribute('href') || '').trim();
        if (href && href.startsWith('#')) {
          const target = document.querySelector(href);
          if (target) {
            // prevent default jump (we already closed nav)
            e.preventDefault();
            // small delay so closing animation (if any) feels natural
            setTimeout(() => {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 120);
          }
        }
      }, { passive: true });
    });

    // Also ensure the "close" button and Escape key work (safe fallback)
    navCloseBtn && navCloseBtn.addEventListener('click', closeMobileNav);
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && mobileNav.getAttribute('aria-hidden') === 'false') closeMobileNav();
    });

    // If other scripts toggle nav by setting aria-hidden/display, keep state consistent when opening:
    // (optional convenience) when hamburger opens, ensure mobileNav is focusable
    if (hamburger) {
      hamburger.addEventListener('click', () => {
        const expanded = hamburger.getAttribute('aria-expanded') === 'true';
        // If it becomes open (expanded true), ensure mobileNav is visible and focusable
        setTimeout(() => {
          if (hamburger.getAttribute('aria-expanded') === 'true') {
            mobileNav.style.display = 'block';
            mobileNav.setAttribute('aria-hidden', 'false');
            mobileNav.setAttribute('tabindex','-1');
            try { mobileNav.focus(); } catch(e){}
          }
        }, 60);
      });
    }
  });
})();
</script>
  <style>
/* Checkout page (in-file, not a modal) — REPLACED: ensures it sits below the header and is scrollable on mobile */
#checkout-page {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 3200;
  background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));
  /* place checkout below the fixed header so it doesn't get overlapped by browser UI */
  align-items: flex-start;
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
  /* allow the page container itself to scroll if content taller than viewport */
  overflow: auto;
}
#checkout-page[aria-hidden="false"] { display: flex; }

/* keep the inner dialog visually below the header and inside safe area */
#checkout-inner {
  width: 100%;
  max-width: 920px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  background: linear-gradient(180deg,#080808,#050505);
  color: #fff;
  display: grid;
  grid-template-columns: 1fr 360px;
  gap: 0;
  /* push the dialog down so it appears like a page below your header + safe-area */
  margin-top: calc(56px + var(--safe-top, 12px) + 12px);
  /* keep the dialog height bounded so inner columns can scroll independently */
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 48px));
}
@media (max-width: 900px) { #checkout-inner { grid-template-columns: 1fr; } }

/* left and right columns should scroll individually */
.checkout-left {
  padding: 16px 18px;
  max-height: 100%;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
.checkout-right {
  padding: 16px 18px;
  border-left: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  overflow: auto;
  max-height: 100%;
  -webkit-overflow-scrolling: touch;
}

/* small banner to highlight delivery-not-included message (style used by script) */
#checkout-delivery-note {
  display: block;
  margin-top: 8px;
  padding: 10px 12px;
  border-radius: 10px;
  background: linear-gradient(90deg, rgba(255,160,80,0.06), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,160,80,0.08);
  color: rgba(255,255,255,0.9);
  font-weight:800;
  font-size:13px;
}

/* small responsive tweaks */
@media (max-width:600px){
  .checkout-right { padding-top:6px; }
  .order-line img { width:56px; height:44px; }
  .checkout-title { font-size:16px; }
}
</style>
  <style>
/* header right area inside cart header */
.cart-header .cart-header-right {
  display:flex;
  align-items:center;
  gap:10px;
  margin-left:auto;
}
.cart-header .cart-header-total {
  font-weight:900;
  color: var(--accent-2);
  font-size:14px;
  text-align:right;
  min-width:80px;
}
.cart-header .cart-header-checkout {
  border:0;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  font-weight:900;
  padding:8px 10px;
  border-radius:10px;
  display:inline-flex;
  gap:8px;
  align-items:center;
  cursor:pointer;
  box-shadow: 0 8px 26px rgba(255,106,0,0.10);
}
.cart-header .cart-header-checkout:active { transform: translateY(1px) scale(.995); }
.tab-btn[role="tab"] { cursor:pointer; }
</style>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    /* ---------- 1) Menu-tabs: filter behaviour ---------- */
    const tabButtons = Array.from(document.querySelectorAll('.menu-tabs .tab-btn'));
    const menuItems = Array.from(document.querySelectorAll('.menu-item'));

    function applyTabFilter(cat) {
      // cat is the data-cat value (e.g. "wraps" or "all")
      menuItems.forEach(item => {
        const itemCat = (item.dataset.category || '').toLowerCase();
        if (!cat || cat === 'all') {
          item.style.display = ''; // show
          item.setAttribute('aria-hidden','false');
        } else {
          // show when itemCat matches or contains cat
          const show = itemCat.split(' ').some(c => c === cat) || itemCat === cat;
          item.style.display = show ? '' : 'none';
          item.setAttribute('aria-hidden', show ? 'false' : 'true');
        }
      });
    }

    function setActiveTab(btn) {
      tabButtons.forEach(b => {
        const is = b === btn;
        b.classList.toggle('is-active', is);
        b.setAttribute('aria-selected', String(is));
        if (is) b.focus && b.focus();
      });
    }

    tabButtons.forEach(btn => {
      // Ensure accessible attributes present
      if (!btn.hasAttribute('role')) btn.setAttribute('role','tab');
      if (!btn.hasAttribute('tabindex')) btn.setAttribute('tabindex','0');

      btn.addEventListener('click', (e) => {
        const cat = (btn.dataset.cat || '').toLowerCase();
        setActiveTab(btn);
        applyTabFilter(cat);
      });

      // keyboard support: Enter / Space
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });

    // initialize: find active tab or default to first
    const initial = tabButtons.find(b => b.classList.contains('is-active')) || tabButtons[0];
    if (initial) {
      setActiveTab(initial);
      applyTabFilter((initial.dataset.cat || 'all').toLowerCase());
    }

    /* ---------- 2) Cart header: add total + checkout button ---------- */
    const cartHeader = document.querySelector('.cart-header');
if (cartHeader && !document.getElementById('cart-header-total')) {
      // create container (guarded: don't add if #cart-header-total is already present)
      const headerRight = document.createElement('div');
      headerRight.className = 'cart-header-right';

      const totalWrap = document.createElement('div');
      totalWrap.className = 'cart-header-total';
      totalWrap.id = 'cart-header-total';
      totalWrap.innerText = 'GHC 0';

      const headerCheckout = document.createElement('button');
      headerCheckout.className = 'cart-header-checkout';
      headerCheckout.id = 'cart-header-checkout';
      headerCheckout.type = 'button';
      headerCheckout.setAttribute('aria-label', 'Checkout and pay');
      headerCheckout.innerHTML = '<i class="fa fa-credit-card" aria-hidden="true"></i> Checkout';

      headerRight.appendChild(totalWrap);
      headerRight.appendChild(headerCheckout);
      cartHeader.appendChild(headerRight);
      // wire handlers (existing code)
    }

    // Sync header total with computeCartTotals or with #cart-total element
    const headerTotalEl = document.getElementById('cart-header-total');
    const cartTotalEl = document.getElementById('cart-total');
    const cartSubtotalEl = document.getElementById('cart-subtotal');

    function syncHeaderTotal() {
      try {
        // Prefer computeCartTotals if available (accurate), otherwise read #cart-total text
        if (typeof computeCartTotals === 'function') {
          const t = computeCartTotals();
          if (t && typeof t.total !== 'undefined') {
            headerTotalEl.innerText = `GHC ${Math.round(t.total)}`;
            return;
          }
        }
        if (cartTotalEl && cartTotalEl.innerText) {
          headerTotalEl.innerText = cartTotalEl.innerText;
        } else if (cartSubtotalEl && cartSubtotalEl.innerText) {
          headerTotalEl.innerText = cartSubtotalEl.innerText;
        }
      } catch (err) { /* ignore */ }
    }

    // Observe changes to cart totals (watch #cart-total and #cart-subtotal)
    const targets = [];
    if (cartTotalEl) targets.push(cartTotalEl);
    if (cartSubtotalEl) targets.push(cartSubtotalEl);

    if (targets.length) {
      const mo = new MutationObserver(syncHeaderTotal);
      targets.forEach(t => mo.observe(t, { childList:true, subtree:true, characterData:true }));
      // call once now
      syncHeaderTotal();
    } else {
      // fallback: poll every 700ms
      syncHeaderTotal();
      setInterval(syncHeaderTotal, 700);
    }

    // Also update when renderCart() is called by hooking into the global renderCart if present
    // (non-invasive override: wrap existing renderCart to call syncHeaderTotal after)
    if (typeof window.renderCart === 'function') {
      const originalRenderCart = window.renderCart;
      window.renderCart = function() {
        const result = originalRenderCart.apply(this, arguments);
        try { syncHeaderTotal(); } catch(e){/*ignore*/ }
        return result;
      };
    } else {
      // If renderCart is defined as local function (not on window), we can't wrap it — rely on MutationObserver/polling.
    }

  });
})();
</script>
<!-- Product detail modal (Task 2) -->
<style>
/* Basic modal sizing tweaks (uses existing .modal/.modal-inner from your CSS) */
#product-modal .modal-inner { max-width:520px; width:100%; padding:0; border-radius:14px; overflow:hidden; }
#product-modal .pm-header{ display:flex; gap:12px; padding:12px; align-items:center; background:linear-gradient(180deg, rgba(10,10,10,0.98), rgba(6,6,6,0.98)); border-bottom:1px solid rgba(255,255,255,0.03);}
#product-modal .pm-thumb{ width:110px; height:86px; object-fit:cover; border-radius:10px; flex: 0 0 110px; border:1px solid rgba(255,255,255,0.04); }
#product-modal .pm-title{ font-weight:900; color:#fff; font-size:16px; margin:0; }
#product-modal .pm-body{ padding:12px; max-height:60vh; overflow:auto; background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(8,8,8,0.98)); }
#product-modal .pm-footer{ display:flex; gap:8px; align-items:center; justify-content:space-between; padding:12px; border-top:1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(8,8,8,0.98), rgba(6,6,6,0.98)); }
#product-modal .pm-price{ font-weight:900; color:var(--accent-2); font-size:18px; }
#product-modal .pm-actions .btn{ min-width:120px; }
</style>

<!-- modal skeleton -->
<div id="product-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;">
  <div class="modal-inner">
    <button class="icon-btn modal-close" id="pm-close" aria-label="Close"><i class="fa fa-times"></i></button>
    <div class="pm-header">
      <img src="" alt="" class="pm-thumb" id="pm-thumb">
      <div style="flex:1; min-width:0">
        <h3 class="pm-title" id="pm-title"></h3>
        <div class="small muted" id="pm-desc"></div>
      </div>
    </div>
    <div class="pm-body" id="pm-body">
      <!-- cloned .item-config will be inserted here -->
    </div>
    <div class="pm-footer">
      <div class="pm-price" id="pm-price">GHC 0</div>
      <div class="pm-actions">
        <button id="pm-add" class="btn primary"><i class="fa fa-plus-circle"></i> Add to cart</button>
        <button id="pm-cancel" class="btn ghost">Cancel</button>
      </div>
    </div>
  </div>
</div>
<!-- ========== PAYSTACK FRONTEND: Checkout modal, handlers, InlineJS ========== -->
<!-- InlineJS CDN (Popup V2) - required for resumeTransaction() -->
<script src="https://js.paystack.co/v2/inline.js"></script>

<!-- ======= Enhanced Checkout + Map Picker (paste before </body>) ======= -->

<!-- Leaflet (Map) CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
/* Checkout modal (full form) */
#checkout-full-modal { display:none; position:fixed; inset:0; z-index:3000; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; padding:12px; }
#checkout-full-modal[aria-hidden="false"] { display:flex; }
.checkout-full-inner { width:100%; max-width:720px; border-radius:12px; background:linear-gradient(180deg,#0b0b0b,#070707); border:1px solid rgba(255,255,255,0.04); box-shadow:0 40px 120px rgba(0,0,0,0.7); color:#fff; padding:0; overflow:hidden; display:grid; grid-template-columns: 1fr 360px; gap:0; }
@media (max-width:900px) { .checkout-full-inner { grid-template-columns: 1fr; } }

.checkout-left { padding:16px 18px; }
.checkout-right { padding:16px 18px; border-left:1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); overflow:auto; max-height: 82vh; }

.checkout-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.checkout-title { color:var(--accent-2); font-weight:900; font-size:18px; margin:0; }

.form-row { display:flex; gap:8px; margin-bottom:10px; }
.form-col { flex:1; display:flex; flex-direction:column; gap:6px; }
.input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; font-weight:800; box-sizing:border-box; }
.input[readonly] { cursor:pointer; background: rgba(255,255,255,0.01); }
.small-muted { color: rgba(255,255,255,0.72); font-size:13px; }

.order-line { display:flex; gap:8px; align-items:center; margin-bottom:10px; }
.order-line img { width:64px; height:48px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
.order-line .ol-meta { flex:1; min-width:0; }
.order-line .ol-meta strong { display:block; font-weight:900; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.order-line .ol-meta small { color: rgba(255,255,255,0.75); }
.order-line .ol-price { font-weight:900; color:var(--accent-2); min-width:70px; text-align:right; }

.checkout-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:12px; }
.btn.full { padding:12px 16px; border-radius:12px; font-weight:900; min-width:140px; }
.btn.primary.full { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#111; border:0; box-shadow: 0 12px 36px rgba(255,106,0,0.12); }

/* Map modal */
#map-modal { display:none; position:fixed; inset:0; z-index:3600; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; padding:8px; }
#map-modal[aria-hidden="false"] { display:flex; }
.map-inner { width:100%; max-width:920px; height:78vh; border-radius:12px; overflow:hidden; background:#fff; display:flex; flex-direction:column; }
.map-top { display:flex; gap:8px; padding:8px; align-items:center; background:#fff; border-bottom:1px solid #eee; }
.map-search { flex:1; padding:8px 12px; border-radius:8px; border:1px solid #ddd; }
#map { flex:1; }
.map-results { max-height:160px; overflow:auto; background:#fff; border-top:1px solid #eee; }
.map-result { padding:8px 10px; border-bottom:1px solid #f1f1f1; cursor:pointer; }
.map-result:hover { background:#f7f7f7; }

.map-actions { display:flex; gap:10px; padding:8px; justify-content:flex-end; background:#fff; border-top:1px solid #eee; }

.toast.wrap-toast { position:fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:4000; background:rgba(0,0,0,0.85); color:#fff; padding:10px 14px; border-radius:999px; font-weight:800; display:none; }
.toast.wrap-toast.show { display:block; animation: toast-in 320ms cubic-bezier(.2,.9,.3,1); }

</style>



  <script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    // find cart header
    const cartHeader = document.querySelector('.cart-header');
    if (!cartHeader) return;

    // avoid adding twice
    if (!cartHeader.querySelector('.cart-header-right')) {
      const headerRight = document.createElement('div');
      headerRight.className = 'cart-header-right';

      const totalWrap = document.createElement('div');
      totalWrap.className = 'cart-header-total';
      totalWrap.id = 'cart-header-total';
      totalWrap.innerText = 'GHC 0';

      const headerCheckout = document.createElement('button');
      headerCheckout.className = 'cart-header-checkout';
      headerCheckout.id = 'cart-header-checkout';
      headerCheckout.type = 'button';
      headerCheckout.setAttribute('aria-label', 'Checkout and pay');
      headerCheckout.innerHTML = '<i class="fa fa-credit-card" aria-hidden="true"></i> Checkout';

      headerRight.appendChild(totalWrap);
      headerRight.appendChild(headerCheckout);
      cartHeader.appendChild(headerRight);
    }

    // wire header checkout to existing footer checkout or to checkout modal opener
    const headerCheckoutBtn = document.getElementById('cart-header-checkout');
    const footerCheckoutBtn = document.getElementById('checkout-btn');

    headerCheckoutBtn && headerCheckoutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      // prefer the footer checkout button (keeps single handler)
      if (footerCheckoutBtn) {
        footerCheckoutBtn.click();
        return;
      }
      // fallback: click any element that looks like a checkout opener
      const alt = document.querySelector('[data-action="checkout"], [data-action="pay"], #cf-submit');
      if (alt) { alt.click(); return; }
      // as last resort call openCheckoutFull if it's available
      if (typeof openCheckoutFull === 'function') {
        openCheckoutFull();
      } else {
        alert('Checkout is not available. Please use the Pay button.');
      }
    });

    // sync header total with main cart totals
    const headerTotalEl = document.getElementById('cart-header-total');
    const cartTotalEl = document.getElementById('cart-total');
    const cartSubtotalEl = document.getElementById('cart-subtotal');

    function syncHeaderTotal() {
      try {
        // prefer computeCartTotals if available
        if (typeof computeCartTotals === 'function') {
          const t = computeCartTotals();
          if (t && typeof t.total !== 'undefined') {
            headerTotalEl.innerText = `GHC ${Math.round(t.total)}`;
            return;
          }
        }
        // else read DOM totals
        if (cartTotalEl && cartTotalEl.innerText) {
          headerTotalEl.innerText = cartTotalEl.innerText;
        } else if (cartSubtotalEl && cartSubtotalEl.innerText) {
          headerTotalEl.innerText = cartSubtotalEl.innerText;
        } else {
          headerTotalEl.innerText = 'GHC 0';
        }
      } catch (err) {
        // ignore
      }
    }

    // Observe DOM changes on totals if present
    const observeTargets = [];
    if (cartTotalEl) observeTargets.push(cartTotalEl);
    if (cartSubtotalEl) observeTargets.push(cartSubtotalEl);

    if (observeTargets.length) {
      const mo = new MutationObserver(syncHeaderTotal);
      observeTargets.forEach(t => mo.observe(t, { childList:true, subtree:true, characterData:true }));
      syncHeaderTotal();
    } else {
      // fallback to polling
      syncHeaderTotal();
      setInterval(syncHeaderTotal, 700);
    }

    // If your renderCart is a global function, wrap it to call syncHeaderTotal after rendering
    if (typeof window.renderCart === 'function' && !window.__wrapped_renderCart_for_header_total) {
      window.__wrapped_renderCart_for_header_total = true;
      const orig = window.renderCart;
      window.renderCart = function() {
        const r = orig.apply(this, arguments);
        try { syncHeaderTotal(); } catch(e){}
        return r;
      };
    }
  });
})();
</script>
<!-- ===== In-page Checkout Section (Task 3) ===== -->
<style>
/* Checkout page (in-file, not a modal) */
#checkout-page { display: none; position: fixed; inset: 0; z-index: 3200; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6)); align-items: center; justify-content: center; padding: 12px; box-sizing: border-box; }
#checkout-page[aria-hidden="false"] { display: flex; }
#checkout-inner { width: 100%; max-width: 920px; border-radius: 12px; overflow: hidden; box-shadow: 0 40px 120px rgba(0,0,0,0.7); background: linear-gradient(180deg,#080808,#050505); color: #fff; display: grid; grid-template-columns: 1fr 360px; gap:0; }
@media (max-width: 900px) { #checkout-inner { grid-template-columns: 1fr; } }

.checkout-left { padding: 16px 18px; max-height: 90vh; overflow:auto; }
.checkout-right { padding: 16px 18px; border-left: 1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); overflow:auto; max-height: 90vh; }

.checkout-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.checkout-title { color: var(--accent-2); font-weight:900; font-size:18px; margin:0; }

.form-row { display:flex; gap:8px; margin-bottom:10px; }
.form-col { flex:1; display:flex; flex-direction:column; gap:6px; }
.input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; font-weight:800; box-sizing:border-box; }
.input[readonly] { cursor:pointer; background: rgba(255,255,255,0.01); }

.order-line { display:flex; gap:8px; align-items:center; margin-bottom:10px; }
.order-line img { width:64px; height:48px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
.order-line .ol-meta { flex:1; min-width:0; }
.order-line .ol-meta strong { display:block; font-weight:900; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.order-line .ol-meta small { color: rgba(255,255,255,0.75); }
.order-line .ol-price { font-weight:900; color:var(--accent-2); min-width:70px; text-align:right; }

.checkout-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:12px; }
.btn.full { padding:12px 16px; border-radius:12px; font-weight:900; min-width:140px; }
.btn.primary.full { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#111; border:0; box-shadow: 0 12px 36px rgba(255,106,0,0.12); }

/* small helper area */
.checkout-note { color: rgba(255,255,255,0.78); font-size:13px; margin-top:12px; }

/* header close button */
#checkout-close { background:transparent; border:0; color: var(--muted); font-size:18px; padding:8px; }

/* subtle responsive */
@media (max-width:600px){
  .checkout-right { padding-top:6px; }
  .order-line img { width:56px; height:44px; }
  .checkout-title { font-size:16px; }
}
</style>
<script>
// --- Checkout UX improvements (replace the previous map-click handler with this) ---
(function(){
  // Use the same STORE_COORDS and DELIVERY_CONFIG already defined in your checkout script
  const STORE_LABEL = 'Devtraco, Tema Community 25';
  // Grab the existing DOM refs used in your checkout script
  const page = document.getElementById('checkout-page');
  const inpType = document.getElementById('cf-type');
  const inpAddress = document.getElementById('cf-address');
  const inpLat = document.getElementById('cf-lat');
  const inpLon = document.getElementById('cf-lon');
  const cfDelivery = document.getElementById('cf-delivery');
  const cfTotal = document.getElementById('cf-total');
  const cfSubtotal = document.getElementById('cf-subtotal');

  // Inject a clear delivery-notice if not already present
  (function ensureDeliveryNote(){
    const header = document.querySelector('.checkout-header');
    if (!header) return;
    if (!document.getElementById('checkout-delivery-note')) {
      const note = document.createElement('div');
      note.id = 'checkout-delivery-note';
      note.innerHTML = '<strong>Important:</strong> The price shown at checkout <em>does NOT</em> include delivery fees. Delivery fee will be estimated and communicated after checkout based on your address.';
      header.parentNode.insertBefore(note, header.nextSibling);
    }
  })();

  // Toggle address input behavior depending on Order Type
  function toggleAddressField() {
    const type = (inpType && inpType.value) || 'delivery';
    if (!inpAddress) return;
    if (type === 'delivery') {
      // allow user to type their address manually for delivery
      inpAddress.removeAttribute('readonly');
      // if the input currently contains the store address placeholder, clear it for user to type
      if ((inpAddress.value || '').trim() === STORE_LABEL) inpAddress.value = '';
      // clear any stored lat/lon (user should optionally provide if available)
      // Keep existing lat/lon if user previously selected
      // visually hint the input
      inpAddress.placeholder = 'Enter your delivery address (e.g., House #, Street, Landmark)';
    } else {
      // Pickup: lock address field to store address and set coords
      inpAddress.value = STORE_LABEL;
      inpAddress.setAttribute('readonly', 'true');
      // write store coords so delivery calc sees store coordinates
      if (typeof STORE_COORDS !== 'undefined') {
        if (inpLat) inpLat.value = String(STORE_COORDS.lat || '');
        if (inpLon) inpLon.value = String(STORE_COORDS.lon || '');
      }
      inpAddress.placeholder = 'Pickup location (store address)';
    }
    // After toggling, refresh totals so Delivery line updates accordingly
    try { refreshTotals && refreshTotals(); } catch(e){}
  }

  // Wire change event on order type select to toggle address behavior
  if (inpType) {
    inpType.addEventListener('change', () => {
      toggleAddressField();
    });
  }

  // On page open ensure correct mode
  try { toggleAddressField(); } catch(e){}

  // Replace address click handler: do NOT open map modal automatically.
  // Users will type their address in the address field when delivery is selected.
  if (inpAddress) {
    inpAddress.addEventListener('click', (e) => {
      // if pickup selected, do nothing (address is store address & readonly)
      const type = (inpType && inpType.value) || 'delivery';
      if (type === 'pickup') {
        // keep focus but don't open any map
        return;
      }
      // for delivery: allow typing. (If you still want an optional "Use map" button later you can add it)
      inpAddress.removeAttribute('readonly');
      // focus so user can type immediately
      setTimeout(()=> inpAddress.focus(), 60);
    });
  }

  // Ensure refreshTotals recalculates delivery only when type is delivery and address is present
  // (your existing computeDeliveryFee/refreshTotals already handles lat/lon; we simply ensure it runs on address edits)
  if (inpAddress) {
    inpAddress.addEventListener('input', () => {
      // Clear lat/lon if user types a new free-text address (unless you implement geocoding later)
      if (inpLat) inpLat.value = '';
      if (inpLon) inpLon.value = '';
      try { refreshTotals && refreshTotals(); } catch(e){}
    });
  }

  // When checkout opens make sure it's positioned under the header (safety) and focus first field
 (function ensureOpenPositioning(){
    // Guard against referencing undefined global. Only capture/override if function exists.
    if (typeof openCheckoutPage === 'function') {
      const origOpen = openCheckoutPage;
      window.openCheckoutPage = function() {
        // call original then ensure checkout dialog is scrolled below the header
        origOpen.apply(this, arguments);
        try {
          const inner = document.getElementById('checkout-inner');
          if (inner) inner.scrollIntoView({ behavior: 'auto', block: 'start' });
        } catch(e){}
      };
    }
  })();

  // Run once to set initial UI correctly
  try { toggleAddressField(); } catch(e){}
})();
</script>
<section id="checkout-page" aria-hidden="true" role="dialog" aria-label="Checkout page">
  <div id="checkout-inner" role="document">
    <div class="checkout-left">
      <div class="checkout-header">
        <h3 class="checkout-title"><i class="fa fa-shopping-basket"></i> Complete Order</h3>
        <div>
          <button id="checkout-close" class="icon-btn" aria-label="Close checkout"><i class="fa fa-times"></i></button>
        </div>
      </div>
<form
  action="https://formspree.io/f/mvglponq"
  method="POST"
>
      <div>
        <div class="form-row">
          <div class="form-col">
            <label class="small-muted">Full name *</label>
            <input id="cf-name" class="input" type="text" name="Full_name" placeholder="..." required />
          </div>
          <div class="form-col">
            <label class="small-muted">Phone *</label>
            <input id="cf-phone" class="input" type="tel" name="Phone_number" placeholder="0550xxxxxx" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <label class="small-muted">Email *</label>
            <input id="cf-email" class="input" type="email" name="Email" placeholder="you@example.com" required />
          </div>
          <div class="form-col">
            <label class="small-muted">Order type *</label>
            <select id="cf-type" class="input" name="Order_type">
              <option value="delivery">Delivery</option>
              <option value="pickup">Pickup</option>
            </select>
          </div>
        </div>

        <div style="margin-top:6px;">
          <label class="small-muted">Your Address*</label>
        <input id="cf-address" class="input" type="text" name="Delivery_address" placeholder="Enter delivery address (only when Delivery selected)" readonly />
          <input type="hidden" id="cf-lat" />
          <input type="hidden" id="cf-lon" />
        </div>

        <div class="form-row" style="margin-top:10px;">
          <div class="form-col">
            <label class="small-muted">Preferred date</label>
            <input id="cf-date" class="input" name="Date" type="date" />
          </div>
          <div class="form-col">
            <label class="small-muted">Preferred time</label>
            <input id="cf-time" class="input" type="time" name="Time" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="small-muted">Notes </label>
          <textarea id="cf-note" class="input" rows="3" placeholder="e.g., no vegetables, not too spicy, etc. " name="Notes"></textarea>
        </div>

        
 
      </div>
      <aside class="checkout-right" aria-label="Order summary">
      <h4 style="margin:0 0 10px 0; color:var(--accent-2); font-weight:900;">Your order</h4>
      <div id="cf-order-lines" style="margin-bottom:6px;">
        <!-- order lines injected here -->
      </div>

      <div style="border-top:1px dashed rgba(255,255,255,0.04); padding-top:10px; margin-top:12px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="small-muted">Subtotal</div>
          <div id="cf-subtotal" class="small-muted">GHC 0</div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
          <div class="small-muted">Delivery</div>
          <div id="cf-delivery" class="small-muted"> * </div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
          <div class="small-muted">Promo</div>
          <div id="cf-promo" class="small-muted">-GHC 0</div>
        </div>
           <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
          <div class="small-muted">Processing fee</div>
        <div id="cf-processing" class="small-muted">GHC 0</div>
       </div>

        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px; font-weight:900; color:#fff;">
          <div>Total</div>
          <div id="cf-total" style="color:var(--accent-2)">GHC 0</div>
        </div>
      </div>

      <div style="margin-top:12px;" class="small-muted">
        Please confirm your details before proceeding. You will receive an email & SMS after payment.
      </div>
        <div style="margin-top:12px;">
          <label class="small-muted">Payment method</label>
          <select id="cf-paymethod" class="input" name="Payment_method">
            <option value="paystack">Pay with Mobile Money / Card (Paystack)</option>
            <option value="cash" disabled>Cash on Delivery</option>
          </select>
        </div>

        <div class="checkout-actions">
          <button id="cf-submit" class="btn primary full">Confirm & Pay</button>
          <button id="cf-cancel" class="btn ghost full">Cancel</button>
        </div>

      <div id="cart-delivery-note" class="small-muted" style="margin-top:8px; padding:10px; border-radius:10px; background: linear-gradient(90deg, rgba(255,160,80,0.04), rgba(255,255,255,0.01)); border:1px solid rgba(255,160,80,0.06);">
         <strong>Important*:</strong> The checkout price shown <em>does NOT</em> include delivery fees. Delivery fee will be estimated after checkout based on your address and communicated to you.
        
       </div>
    </aside>
</form>
    </div>


  </div>
</section>
  <!-- ========== ORDER CONFIRMATION MODAL (shows after successful payment + reload) ========= -->
<style>
/* Confirmation modal styles */
#order-confirmation-modal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 8000;
  background: rgba(0,0,0,0.6);
  align-items: center;
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
}
#order-confirmation-modal[aria-hidden="false"] { display:flex; }

.oc-inner {
  width: 100%;
  max-width: 720px;
  border-radius: 12px;
  background: linear-gradient(180deg,#0b0b0b,#060606);
  color: #fff;
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
}
.oc-header { display:flex; gap:12px; align-items:center; justify-content:space-between; }
.oc-title { font-size:18px; font-weight:900; color: var(--accent-2, #FFD166); margin:0; }
.oc-body { display:flex; gap:12px; flex-direction:column; max-height: 60vh; overflow:auto; padding:6px 0; }
.oc-grid { display:grid; grid-template-columns: 1fr 160px; gap:12px; align-items:start; }
.oc-lines { border-top:1px dashed rgba(255,255,255,0.04); padding-top:8px; }
.oc-line { display:flex; justify-content:space-between; gap:8px; padding:6px 0; border-bottom:1px solid rgba(255,255,255,0.02); }
.oc-total { font-weight:900; color: var(--accent-2, #FFD166); font-size:18px; }
.oc-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }
.btn.print { padding:10px 12px; border-radius:10px; font-weight:900; background: linear-gradient(90deg, var(--accent-1, #FF6A00), var(--accent-2, #FFD166)); color:#111; border:0; }
.btn.ok { padding:10px 12px; border-radius:10px; font-weight:900; background: transparent; color: #fff; border: 1px solid rgba(255,255,255,0.06); }

/* print-only styles: print only modal content */
@media print {
  body * { visibility: hidden; }
  #order-confirmation-modal, #order-confirmation-modal * { visibility: visible; }
  #order-confirmation-modal { position: static; background: #fff; }
  .oc-inner { box-shadow: none; background: #fff; color: #000; }
}
</style>

<div id="order-confirmation-modal" role="dialog" aria-hidden="true" aria-label="Order confirmation">
  <div class="oc-inner" role="document">
    <div class="oc-header">
      <h3 class="oc-title"><i class="fa fa-check-circle"></i> Order Confirmed</h3>
      <button id="oc-close" class="icon-btn" aria-label="Close confirmation"><i class="fa fa-times"></i></button>
    </div>

    <div class="oc-body">
      <div id="oc-summary" class="oc-grid">
        <div>
          <div><strong>Reference:</strong> <span id="oc-ref">—</span></div>
          <div><strong>Name:</strong> <span id="oc-name">—</span></div>
          <div><strong>Phone:</strong> <span id="oc-phone">—</span></div>
          <div><strong>Email:</strong> <span id="oc-email">—</span></div>
          <div><strong>Order type:</strong> <span id="oc-type">—</span></div>
          <div><strong>Address:</strong> <span id="oc-address">—</span></div>
          <div><strong>Notes:</strong> <span id="oc-note">—</span></div>
        </div>
        <div style="text-align:right;">
          <div class="small-muted">Placed at</div>
          <div id="oc-ts" style="font-weight:800;margin-bottom:10px">—</div>
          <div class="oc-total" id="oc-total">GHC 0</div>
        </div>
      </div>

      <div class="oc-lines" id="oc-lines">
        <!-- order lines inserted here -->
      </div>

      <div style="margin-top:8px" class="small-muted">
        <p><strong>Important:</strong> Delivery fee is calculated separately and will be communicated after we confirm your exact location. The total shown at checkout did <em>not</em> include delivery unless explicitly shown as added.</p>
        <p>Please keep this reference for inquiries. We will contact you (phone/SMS/WhatsApp) with an estimated delivery fee and ETA.</p>
     
      </div>
    </div>

    <div class="oc-actions">
      <button id="oc-print" class="btn print"><i class="fa fa-file-pdf"></i> Save as PDF</button>
      <button id="oc-ok" class="btn ok">Okay</button>
    </div>
  </div>
</div>

<script>
/* ORDER CONFIRMATION modal behaviour:
   - On load, if localStorage.wrap_show_confirmation === '1', read wrap_last_order and show modal.
   - Save as PDF -> window.print()
   - Okay -> clear cart and confirmation data, reload to original page (cart empty).
*/
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('order-confirmation-modal');
    const ocRef = document.getElementById('oc-ref');
    const ocName = document.getElementById('oc-name');
    const ocPhone = document.getElementById('oc-phone');
    const ocEmail = document.getElementById('oc-email');
    const ocType = document.getElementById('oc-type');
    const ocAddress = document.getElementById('oc-address');
    const ocNote = document.getElementById('oc-note');
    const ocTs = document.getElementById('oc-ts');
    const ocLines = document.getElementById('oc-lines');
    const ocTotal = document.getElementById('oc-total');
    const btnPrint = document.getElementById('oc-print');
    const btnOk = document.getElementById('oc-ok');
    const btnClose = document.getElementById('oc-close');

    function showModal(order) {
      if (!order) return;
      ocRef.innerText = order.reference || ('ref-'+Math.floor(Math.random()*1000000));
      ocName.innerText = order.name || '-';
      ocPhone.innerText = order.phone || '-';
      ocEmail.innerText = order.email || '-';
      ocType.innerText = order.type || '-';
      ocAddress.innerText = order.address || '-';
      ocNote.innerText = order.note || '-';
      ocTs.innerText = new Date(order.ts || Date.now()).toLocaleString();
      ocTotal.innerText = `GHC ${Number(order.totals?.total || order.totals?.total || 0).toFixed(0)}`;

      // populate order lines
      ocLines.innerHTML = '';
      const lines = Array.isArray(order.cart) ? order.cart : [];
      if (!lines.length) {
        ocLines.innerHTML = '<div class="small-muted">No line items recorded.</div>';
      } else {
        lines.forEach(l => {
          const div = document.createElement('div');
          div.className = 'oc-line';
          const title = document.createElement('div');
          title.innerHTML = `<strong>${escapeHtml(l.title || 'Item')}</strong><div class="small-muted">${(l.meta && l.meta.addons) ? 'Extras: '+ l.meta.addons.map(a=>escapeHtml(a.label||a.key)).join(', ') : ''}</div>`;
          const right = document.createElement('div');
          right.style.textAlign = 'right';
          right.innerHTML = `${Number(l.qty || 1)} × GHC ${Number(l.unitPrice||0).toFixed(0)}<div style="font-weight:900;margin-top:4px">${'GHC ' + (Number(l.unitPrice||0) * Number(l.qty||1)).toFixed(0)}</div>`;
          div.appendChild(title);
          div.appendChild(right);
          ocLines.appendChild(div);
        });
      }

      modal.setAttribute('aria-hidden','false');
      modal.style.display = 'flex';
      // prevent background scroll
      document.body.style.overflow = 'hidden';
    }

    function hideModal() {
      modal.setAttribute('aria-hidden','true');
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }

    // Print — use window.print which will be constrained by the @media print CSS above
    // Replace the existing btnPrint handler with this improved printable window generator
btnPrint && btnPrint.addEventListener('click', () => {
  try {
    // Try to load the last order from localStorage (the confirmation modal uses this already)
    const raw = localStorage.getItem('wrap_last_order');
    const order = raw ? JSON.parse(raw) : null;

    if (!order) {
      alert('No order data available to print.');
      return;
    }

    // Helper to escape HTML
    const escapeHtml = (s) => String(s || '').replace(/&/g,'&amp;').replace(/"/g,'&quot;')
      .replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

    // Build lines HTML; ensure we display all meta info (addons, size, protein, etc.)
    const lines = Array.isArray(order.cart) ? order.cart : [];
    let linesHtml = '';
    let computedSubtotal = 0;
    if (!lines.length) {
      linesHtml = '<tr><td colspan="5" style="text-align:center;padding:12px 0;color:#666">No line items recorded.</td></tr>';
    } else {
      lines.forEach((l, idx) => {
        const qty = Number(l.qty || 1);
        const unit = Number(l.unitPrice || l.unit_price || 0);
        const lineTotal = Math.round(qty * unit);
        computedSubtotal += lineTotal;

        // Build meta details string (extras, protein, size, any other keys)
        const metaParts = [];
        if (l.meta) {
          try {
            // addons (common structure)
            if (Array.isArray(l.meta.addons) && l.meta.addons.length) {
              metaParts.push('Extras: ' + l.meta.addons.map(a => escapeHtml(a.label || a.key || a)).join(', '));
            }
            // other keys
            Object.keys(l.meta).forEach(k => {
              if (k === 'addons') return;
              const v = l.meta[k];
              if (!v) return;
              if (typeof v === 'object') {
                if (v.text) metaParts.push(`${escapeHtml(k)}: ${escapeHtml(v.text)}`);
                else if (v.label) metaParts.push(`${escapeHtml(k)}: ${escapeHtml(v.label)}`);
                else {
                  // stringify basic object
                  metaParts.push(`${escapeHtml(k)}: ${escapeHtml(JSON.stringify(v))}`);
                }
              } else {
                metaParts.push(`${escapeHtml(k)}: ${escapeHtml(String(v))}`);
              }
            });
          } catch (e) { /* ignore meta parsing errors */ }
        }
        const metaHtml = metaParts.length ? `<div style="font-size:12px;color:#444;margin-top:6px;">${metaParts.join(' • ')}</div>` : '';

        linesHtml += `
          <tr>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee;">
              <strong>${escapeHtml(l.title || l.name || 'Item')}</strong>${metaHtml}
            </td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:center;">${qty}</td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:right;">GHC ${Number(unit).toFixed(0)}</td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:right;">GHC ${lineTotal.toFixed(0)}</td>
          </tr>
        `;
      });
    }

    // Use totals from order.totals if present; otherwise fall back to computedSubtotal and order fields
    const totals = order.totals || {};
    const subtotal = (typeof totals.subtotal !== 'undefined') ? Number(totals.subtotal) : computedSubtotal;
    const delivery = (typeof totals.delivery !== 'undefined') ? Number(totals.delivery || 0) : Number(totals.delivery || 0);
    const promoDiscount = (typeof totals.promo !== 'undefined') ? Number(totals.promo || totals.promoDiscount || 0) : Number(totals.promoDiscount || 0);
    const total = (typeof totals.total !== 'undefined') ? Number(totals.total) : Math.max(0, subtotal - (promoDiscount||0) + (delivery||0));

    // Build printable HTML (minimal, stable layout)
    const printable = `
      <!doctype html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>Wrap District — Invoice ${escapeHtml(order.reference || '')}</title>
        <style>
          /* Page & printing */
          @page { size: auto; margin: 12mm; }
          html,body { margin:0; padding:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:#222; }
          body { padding: 18px; background: #fff; -webkit-print-color-adjust: exact; }
          .wrap-header { display:flex; align-items:center; gap:12px; }
          .logo-mark { background: linear-gradient(135deg,#FF6A00,#ff8c2b); color:#111; padding:6px 10px; border-radius:8px; font-weight:900; letter-spacing:1px; }
          .brand { margin-left:6px; }
          .brand h1 { margin:0; font-size:20px; }
          .brand p { margin:3px 0 0 0; font-size:12px; color:#444; }
          .meta { margin-top:14px; display:flex; justify-content:space-between; gap:12px; align-items:flex-start; }
          .meta .left, .meta .right { width:48%; }
          .box { border:1px solid #eee; padding:12px; border-radius:8px; background:#fafafa; }
          table { width:100%; border-collapse:collapse; margin-top:12px; }
          th { text-align:left; padding:10px 8px; font-size:13px; color:#333; border-bottom:2px solid #eee; }
          td { padding:8px; font-size:13px; vertical-align:top; }
          .totals { margin-top:12px; width:100%; max-width:420px; margin-left:auto; border-top:1px dashed #ddd; padding-top:10px; }
          .totals .row { display:flex; justify-content:space-between; padding:6px 0; color:#222; }
          .small { font-size:12px; color:#666; }
          .note { margin-top:14px; font-size:12px; color:#666; }
          /* prevent page breaks inside important sections */
          .box, table, .totals { page-break-inside: avoid; }
          /* ensure single page layout (avoid unexpected blank pages) */
          html, body { height: auto !important; }
        </style>
      </head>
      <body>
        <div class="wrap-header">
          <div class="logo-mark">WRAP</div>
          <div class="brand">
            <h1>Wrap District</h1>
            <p class="small">Fresh • Hot • Fast — Tema Community 25</p>
            <p class="small">Phone: 0552509241 • Location: Devtraco, Tema</p>
          </div>
        </div>

        <div class="meta">
          <div class="left box">
            <div><strong>Customer</strong></div>
            <div style="margin-top:6px"><strong>${escapeHtml(order.name || '—')}</strong></div>
            <div class="small">${escapeHtml(order.phone || '—')} • ${escapeHtml(order.email || '')}</div>
            <div style="margin-top:8px" class="small"><strong>Order type:</strong> ${escapeHtml(order.type || '—')}</div>
            <div style="margin-top:4px" class="small"><strong>Address:</strong> ${escapeHtml(order.address || '—')}</div>
            <div style="margin-top:4px" class="small"><strong>Notes:</strong> ${escapeHtml(order.note || '-')}</div>
          </div>
          <div class="right box">
            <div><strong>Order</strong></div>
            <div style="margin-top:6px"><strong>Reference:</strong> ${escapeHtml(order.reference || ('ref-'+(Date.now())))}</div>
            <div class="small" style="margin-top:6px"><strong>Placed:</strong> ${escapeHtml(new Date(order.ts || Date.now()).toLocaleString())}</div>
            <div class="small" style="margin-top:6px"><strong>Prepared for PDF:</strong> ${escapeHtml(new Date().toLocaleString())}</div>
          </div>
        </div>

        <table aria-label="Order lines" style="margin-top:14px;">
          <thead>
            <tr>
              <th style="width:60%">Item & options</th>
              <th style="width:10%; text-align:center">Qty</th>
              <th style="width:15%; text-align:right">Unit</th>
              <th style="width:15%; text-align:right">Line</th>
            </tr>
          </thead>
          <tbody>
            ${linesHtml}
          </tbody>
        </table>

        <div class="totals" role="complementary" aria-label="Totals summary">
          <div class="row"><div class="small">Subtotal</div><div class="small">GHC ${Number(subtotal).toFixed(0)}</div></div>
          <div class="row"><div class="small">Delivery</div><div class="small">GHC ${Number(delivery || 0).toFixed(0)}</div></div>
          <div class="row"><div class="small">Promo Discount</div><div class="small">-GHC ${Number(promoDiscount || 0).toFixed(0)}</div></div>
          <div class="row" style="font-weight:900; font-size:16px;"><div>Total</div><div>GHC ${Number(total).toFixed(0)}</div></div>
        </div>

        <div class="note">
          <div><strong>Contact:</strong> Wrap District • 0552509241 • Tema Community 25, Devtraco</div>
          <div style="margin-top:6px"><strong>Note:</strong> Delivery fee may be confirmed separately. Keep this reference for inquiries.</div>
        </div>
      </body>
      </html>
    `;

    // Open a focused new window with the invoice HTML, print, then close.
    const w = window.open('', '_blank', 'toolbar=0,location=0,menubar=0,width=900,height=1100');
    if (!w) {
      // fallback: print current window (less ideal)
      alert('Unable to open print window; your browser may be blocking popups. Please allow popups and try again.');
      return;
    }
    w.document.open();
    w.document.write(printable);
    w.document.close();

    // Wait for content to be rendered, then print and close
    w.focus();
    // Give the browser a short moment to layout
    setTimeout(() => {
      try {
        w.print();
      } catch (e) {
        console.warn('Print failed in new window:', e);
      }
      // Close the print window shortly after print dialog invoked
      setTimeout(() => {
        try { w.close(); } catch (e) { /* ignore */ }
      }, 800);
    }, 350);

  } catch (err) {
    console.error('Print invoice error', err);
    alert('Could not create invoice for printing. See console for details.');
  }
});

    // Okay -> clear stored confirmation + empty cart + reload original page
    btnOk && btnOk.addEventListener('click', () => {
      try {
        // clear stored order flag & data
        localStorage.removeItem('wrap_show_confirmation');
        localStorage.removeItem('wrap_last_order');
        // clear cart storage used by your persistent cart
        localStorage.removeItem('wrap_cart_v2');
        // also clear window.cart if present
        try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch(e){}
      } catch (e) { /* ignore */ }
      hideModal();
      // reload to original page (strip hash/qs)
      window.location.href = window.location.pathname;
    });

    // close X (same as okay but keep data? user asked to refresh to original page on Okay — for close we'll just hide)
    btnClose && btnClose.addEventListener('click', () => {
      hideModal();
      // DO NOT remove the stored confirmation so the user can re-open if they refresh — but you can change this behavior if desired
    });

    // show modal on page load if flag present
    try {
      const showFlag = localStorage.getItem('wrap_show_confirmation');
      if (showFlag === '1') {
        const raw = localStorage.getItem('wrap_last_order');
        const order = raw ? JSON.parse(raw) : null;
        // show after a small delay so page finishes rendering
        setTimeout(() => showModal(order), 220);
      }
    } catch (e) { console.warn('order confirm show error', e); }

    // small helper
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  });
})();
</script>
 
<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    // 1) Soft-filter any alert/confirm that contains the ORDER SUMMARY text so it never blocks UX.
    try {
      const _alert = window.alert;
      const _confirm = window.confirm;
      window.alert = function(msg){
        try {
          if (typeof msg === 'string' && msg.includes('ORDER SUMMARY')) {
            // swallow the noisy test/order-summary alert
            console.info('Suppressed alert containing ORDER SUMMARY');
            return;
          }
        } catch(e){}
        return _alert.apply(window, arguments);
      };
      window.confirm = function(msg){
        try {
          if (typeof msg === 'string' && msg.includes('ORDER SUMMARY')) {
            console.info('Suppressed confirm containing ORDER SUMMARY');
            return true; // pretend user pressed OK if needed by legacy flows
          }
        } catch(e){}
        return _confirm.apply(window, arguments);
      };
    } catch(e){ console.warn('Could not override alert/confirm', e); }

    // 2) Intercept clicks on all checkout/pay triggers so any legacy alert-based flow can't fire.
   const CHECKOUT_SELECTORS = [
      '#checkout-btn',
      '#cart-header-checkout',
      '.cart-header .cart-header-checkout',
      '[data-action="checkout"]',
      '[data-action="pay"]',
      '.cart-footer .btn.primary'
    ];

    function safeOpenCheckout() {
      // Prefer the in-page checkout function(s) if present
      if (typeof openCheckoutPage === 'function') { try { openCheckoutPage(); return; } catch(e){} }
      if (typeof openCheckoutFull === 'function') { try { openCheckoutFull(); return; } catch(e){} }
      // fallback: click the footer checkout if present
      const footer = document.getElementById('checkout-btn');
      if (footer) { try { footer.click(); return; } catch(e){} }
      // last resort: open the cart drawer
      const cart = document.getElementById('cart-drawer');
      if (cart) { cart.style.display = 'block'; cart.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
    }

    function attachInterceptor(el){
      if (!el) return;
      // clear inline onclick if present (helps some simple use-cases)
      try { if (el.getAttribute && el.getAttribute('onclick')) el.removeAttribute('onclick'); } catch(e){}

      // Add a capture-phase listener that prevents other click handlers from running on this element.
      // We use capture + stopImmediatePropagation to be robust to duplicate handlers.
      el.addEventListener('click', function(ev){
        try {
          ev.preventDefault();
          // stop other handlers attached to this element from executing
          ev.stopImmediatePropagation();
        } catch(e){}
        // Temporarily silence alerts/confirm used synchronously by other scripts
        const oldAlert = window.alert;
        const oldConfirm = window.confirm;
        try {
          window.alert = function(){};
          window.confirm = function(){ return true; };
          // Open the proper checkout UI
          safeOpenCheckout();
        } catch(e){ console.error(e); }
        finally {
          // restore original functions (rest of app behavior unchanged)
          try { window.alert = oldAlert; window.confirm = oldConfirm; } catch(e){}
        }
      }, true); // capture = true
    }

    // Attach interceptors to all matching elements (existing + future)
    function attachAllInterceptors() {
      CHECKOUT_SELECTORS.forEach(sel => {
        Array.from(document.querySelectorAll(sel)).forEach(el => attachInterceptor(el));
      });
    }
    attachAllInterceptors();

    // If checkout buttons are injected later, watch the body and attach interceptors for new nodes
    const mo = new MutationObserver((mutations) => {
      let found = false;
      mutations.forEach(m => {
        if (m.addedNodes && m.addedNodes.length) found = true;
      });
      if (found) attachAllInterceptors();
    });
    mo.observe(document.body, { childList: true, subtree: true });
  });
})();
</script>
  <!-- === REPLACE your existing checkout CSS with this block === -->
<style>
/* CHECKOUT PAGE — unified, mobile-friendly, scrollable under fixed header */
#checkout-page {
  display: none;
  position: fixed;
  inset: 0;                 /* fill viewport */
  z-index: 3200;
  background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));
  /* place checkout below header and allow page-level scroll if content taller than viewport */
  align-items: flex-start;                  /* ensures top-aligned so margin-top works predictably */
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
  overflow: auto;                           /* page can scroll if inner is taller than viewport */
  -webkit-overflow-scrolling: touch;
}

/* show when opened */
#checkout-page[aria-hidden="false"] { display: flex; }

/* Inner dialog
   - Use margin-top to sit under the sticky header safely
   - Use max-height so inner columns can scroll independently
*/
#checkout-inner {
  width: 100%;
  max-width: 920px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  background: linear-gradient(180deg,#080808,#050505);
  color: #fff;
  display: grid;
  grid-template-columns: 1fr 360px;
  gap: 0;
  margin: calc(56px + var(--safe-top,12px) + 12px) auto 24px; /* pushes it below fixed header */
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 48px)); /* keeps dialog within viewport */
  box-sizing: border-box;
}

/* On narrow screens stack into single column */
@media (max-width: 900px) {
  #checkout-inner { grid-template-columns: 1fr; max-width: 680px; }
}

/* Left & right columns scroll independently */
.checkout-left,
.checkout-right {
  padding: 16px 18px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  max-height: calc(100%); /* ensures columns don't overflow the dialog */
  box-sizing: border-box;
}

/* Right column: give it a visual top so "Your order" stays visible while lines scroll */
.checkout-right {
  border-left: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  position: relative;
}

/* Make the "Your order" heading sticky within the right column so the user always sees the header.
   The order lines themselves scroll under it. This prevents the feeling that the section is "stuck". */
.checkout-right > h4 {
  position: sticky;
  top: 0;
  z-index: 5;
  margin: 0 0 10px 0;
  padding-top: 6px;
  background: transparent; /* inherits dialog BG */
  color: var(--accent-2);
  font-weight: 900;
}

/* constrain the order lines area so it scrolls nicely */
#cf-order-lines {
  overflow: auto;
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 240px)); /* adapt so lines area remains scrollable */
  -webkit-overflow-scrolling: touch;
}

/* Make the checkout close button comfortable to tap */
#checkout-close { background: transparent; border: 0; color: var(--muted); font-size: 18px; padding: 8px; cursor: pointer; }

/* small responsive tweaks */
@media (max-width: 600px) {
  #checkout-inner { margin-top: calc(56px + var(--safe-top, 12px) + 6px); padding-bottom: 8px; }
  .checkout-right { border-left: none; border-top: 1px solid rgba(255,255,255,0.03); }
  .checkout-right > h4 { top: 0; }
  #cf-order-lines { max-height: calc(60vh); }
}
</style>

<!-- === Small JS helper: ensure the checkout dialog and its inner scroll positions reset when opened === -->
<script>
(function(){
  // call this when opening the checkout page (we already wire a few openers in your scripts)
  function resetCheckoutScroll() {
    try {
      const page = document.getElementById('checkout-page');
      const inner = document.getElementById('checkout-inner');
      const left = inner && inner.querySelector('.checkout-left');
      const right = inner && inner.querySelector('.checkout-right');
      const lines = document.getElementById('cf-order-lines');

      if (page) { page.scrollTop = 0; }
      if (inner) { inner.scrollTop = 0; }
      if (left) { left.scrollTop = 0; }
      if (right) { right.scrollTop = 0; }
      if (lines) { lines.scrollTop = 0; }

      // put focus on the first input so mobile keyboard appears predictably
      const first = document.querySelector('#cf-name, #cf-phone, #cf-email');
      if (first) setTimeout(()=> first.focus(), 120);
    } catch(e){ /* ignore */ }
  }

  // Expose helper so existing openCheckoutPage() can call it
  window.resetCheckoutScroll = resetCheckoutScroll;
})();
</script>
  
  
<script>


(function(){
  document.addEventListener('DOMContentLoaded', () => {
    // Configurable store coordinates (set your store exact lat/lon here)
    const STORE_COORDS = { lat: 5.6600, lon: 0.0190 }; // <-- change to your store's lat/lon (Tema Community 25 / Devtraco approx)
    const DELIVERY_CONFIG = {
      baseFee: 6,        // base GHC
      perKm: 2.5,        // GHC per km
      minFee: 4,         // minimum fee
      maxFee: 60,        // maximum fee
      freeWithinKm: 0.8  // free delivery inside this radius (in km)
    };
    const PAYSTACK_PERCENT = 0.0195;
 const MTN_WITHDRAWAL_PERCENT = 0.01;
 const PROCESSING_PERCENT = PAYSTACK_PERCENT + MTN_WITHDRAWAL_PERCENT; // 0.0295

 // Helper: compute processing fee (returns value in GHC, rounded to 2 decimals)
function computeProcessingFee(amountGhc) {
 if (!amountGhc || isNaN(amountGhc)) return 0;
 const fee = Number(amountGhc) * PROCESSING_PERCENT;
  // Round to 2 decimals (we keep cents/pesewa precision for Paystack)
 return Math.round(fee * 100) / 100;
 }

// Helper: format GHC with two decimals for checkout display
function fmtGhc2(n) { return `GHC ${Number(n || 0).toFixed(2)}`; }
const PAYSTACK_PUBLIC_KEY = 'pk_live_ad7d0e0b164d83ec61bf2bf4fdb2af366c41c0ed';
    // DOM
    const page = document.getElementById('checkout-page');
    const inner = document.getElementById('checkout-inner');
    const closeBtn = document.getElementById('checkout-close');
    const cancelBtn = document.getElementById('cf-cancel');
    const submitBtn = document.getElementById('cf-submit');

    const inpName = document.getElementById('cf-name');
    const inpPhone = document.getElementById('cf-phone');
    const inpEmail = document.getElementById('cf-email');
    const inpType = document.getElementById('cf-type');
    const inpAddress = document.getElementById('cf-address');
    const inpLat = document.getElementById('cf-lat');
    const inpLon = document.getElementById('cf-lon');
    const inpDate = document.getElementById('cf-date');
    const inpTime = document.getElementById('cf-time');
    const inpNote = document.getElementById('cf-note');
    const inpPayMethod = document.getElementById('cf-paymethod');

    const orderLinesWrap = document.getElementById('cf-order-lines');
    const cfSubtotal = document.getElementById('cf-subtotal');
    const cfDelivery = document.getElementById('cf-delivery');
    const cfPromo = document.getElementById('cf-promo');
    const cfProcessing = document.getElementById('cf-processing');
    const cfTotal = document.getElementById('cf-total');

    // Map modal already exists (#map-modal) and populates #cf-address/#cf-lat/#cf-lon — reuse it
    // Helper: show checkout page
    function openCheckoutPage() {
      // hide any other modals/popups that might have been shown earlier
      Array.from(document.querySelectorAll('.modal, .entry-promo, #preorder-modal')).forEach(m => {
        try { m.style.display = 'none'; m.setAttribute && m.setAttribute('aria-hidden','true'); } catch(e){}
      });

      // prefill user details
      inpName.value = localStorage.getItem('wrap_user_name') || '';
      inpPhone.value = localStorage.getItem('wrap_user_phone') || '';
      inpEmail.value = localStorage.getItem('wrap_checkout_email') || '';

      populateOrderLines();
      refreshTotals();

      page.style.display = 'flex';
      page.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> inpName.focus && inpName.focus(), 120);
    }

    function closeCheckoutPage() {
      page.style.display = 'none';
      page.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    try {
      window.openCheckoutPage = openCheckoutPage;
      window.closeCheckoutPage = closeCheckoutPage;
      // optional alias for other code that expects openCheckoutFull
      window.openCheckoutFull = openCheckoutPage;
      // helper to reset scroll (also referenced elsewhere) — safe to overwrite
      window.resetCheckoutScroll = window.resetCheckoutScroll || function(){
        try {
          const inner = document.getElementById('checkout-inner');
          if (inner) inner.scrollTop = 0;
          const left = inner && inner.querySelector('.checkout-left');
          const right = inner && inner.querySelector('.checkout-right');
          if (left) left.scrollTop = 0;
          if (right) right.scrollTop = 0;
        } catch(e){}
      };
    } catch(e) { /* harmless if globals can't be written */ }

    // wire openers (override previous handlers so no pre-popup appears)
    const footerPayBtn = document.getElementById('checkout-btn');
    const headerCheckoutBtn = document.getElementById('cart-header-checkout');

    function bindOpeners() {
      if (footerPayBtn) {
        footerPayBtn.removeEventListener('click', openCheckoutPage);
        footerPayBtn.addEventListener('click', (e) => { e.preventDefault(); openCheckoutPage(); });
      }
      if (headerCheckoutBtn) {
        headerCheckoutBtn.removeEventListener('click', openCheckoutPage);
        headerCheckoutBtn.addEventListener('click', (e) => { e.preventDefault(); openCheckoutPage(); });
      }
    }
    bindOpeners();

    // close/cancel handlers
    closeBtn && closeBtn.addEventListener('click', closeCheckoutPage);
    cancelBtn && cancelBtn.addEventListener('click', closeCheckoutPage);
    page && page.addEventListener('click', (e)=> { if (e.target === page) closeCheckoutPage(); });
    document.addEventListener('keydown', (e)=> { if (e.key === 'Escape' && page.getAttribute('aria-hidden') === 'false') closeCheckoutPage(); });

    // Populate order lines from window.cart if present, else read existing cart DOM
    function populateOrderLines() {
      orderLinesWrap.innerHTML = '';
      const cartObj = window.cart || {};
      const lines = Object.keys(cartObj).length ? Object.values(cartObj) : extractCartFromDom();
      if (!lines.length) {
        orderLinesWrap.innerHTML = '<div class="small-muted">Your cart is empty.</div>';
        return;
      }
      lines.forEach(line => {
        const div = document.createElement('div');
        div.className = 'order-line';
        div.innerHTML = `
          <img src="${escapeHtml(line.imageSrc||'')}" alt="${escapeHtml(line.title||'Item')}" />
          <div class="ol-meta">
            <strong>${escapeHtml(line.title||'Item')}</strong>
            <small>${escapeHtml(buildMetaText(line.meta || {}))}</small>
          </div>
          <div class="ol-price">${fmtGhc((line.unitPrice||0) * (line.qty||1))}</div>
        `;
        orderLinesWrap.appendChild(div);
      });
    }

    function extractCartFromDom() {
      const arr = [];
      const rows = Array.from(document.querySelectorAll('#cart-items li.cart-line')).filter(r=>!r.classList.contains('cart-free'));
      rows.forEach(r => {
        try {
          const title = (r.querySelector('.line-title')?.innerText || '').trim();
          const qty = Number(r.querySelector('.line-qty')?.innerText || 1) || 1;
          const priceText = r.querySelector('.line-meta strong')?.innerText || '';
          // attempt to parse unit price from "GHC 45 × 1 = GHC 45" area
          const match = (r.querySelector('.line-meta')?.innerText || '').match(/GHC\s*([0-9]+)/);
          const unitPrice = match ? Number(match[1]) : 0;
          const img = r.querySelector('img')?.src || '';
          arr.push({ title, qty, unitPrice, unitPrice, meta: {}, imageSrc: img });
        } catch(e){}
      });
      return arr;
    }

    function buildMetaText(meta) {
      const parts = [];
      try {
        if (meta.addons && Array.isArray(meta.addons)) parts.push(meta.addons.map(a=>a.label || a.key).join(', '));
        Object.keys(meta||{}).forEach(k => {
          if (k==='addons') return;
          const v = meta[k];
          if (v && v.text) parts.push(String(v.text));
        });
      } catch(e){}
      return parts.join(' • ');
    }

    // Totals: prefer computeCartTotals() if available else compute from window.cart or fallback DOM
    function getTotals() {
     // If the app already provides a computeCartTotals() use it (server logic preferred).
       try {
       // If the app already provides a computeCartTotals() use it (server logic preferred).
        if (typeof computeCartTotals === 'function') {
          const t = computeCartTotals() || {};
          // normalize common fields
          t.promoDiscount = t.promoDiscount || t.promo || t.promoAmount || 0;
          t.subtotal = typeof t.subtotal !== 'undefined' ? t.subtotal : (t.subtotal || 0);
          return t;
        }

        // (rest of getTotals logic continues here...)
      } catch (err) {
        // If anything goes wrong, don't break the whole site — return a safe fallback totals object.
        console.warn('getTotals() error — returning fallback totals', err);
        return { subtotal: 0, delivery: 0, promoDiscount: 0, freeItems: [], total: 0 };
      }

      const cartObj = window.cart || {};
      const lines = Object.values(cartObj).length ? Object.values(cartObj) : extractCartFromDom();
     let subtotal = 0;
      // Build a list of shawarma unit prices (expanded by qty) to compute B2G1 properly
      const shawarmaUnitPrices = [];

      lines.forEach(l => {
        const qty = Number(l.qty) || 1;
        const unit = Number(l.unitPrice || l.unit_price || 0) || 0;
        subtotal += unit * qty;
        const title = String(l.title || l.name || '').toLowerCase();
        const idKeys = [l.baseId, l.id, l.itemId, l.productId].map(x => String(x || '').toLowerCase());
        // robust detection: either base id equals 'shawarma' or title contains 'shawarma'
        const isShawarma = idKeys.includes('shawarma') || title.includes('shawarma') || (String(l.sku||'').toLowerCase().includes('shawarma'));
        if (isShawarma) {
         for (let i = 0; i < qty; i++) shawarmaUnitPrices.push(unit);
       }
     });

     // Promo rules: Buy 2 Get 1 free applies only on Tuesdays (or when user explicitly claimed the promo)
    const todayIsFriday = (new Date()).getDay() === 5; // Sunday=0, Friday=5
    const promoClaimed = !!localStorage.getItem('wrap_claimed_promo_FRIDAY-B2G1');
      let promoDiscount = 0;
     const freeItems = [];

     if ((todayIsFriday || promoClaimed) && shawarmaUnitPrices.length >= 3) {
       // Number of free items is floor(total_shawarmas / 3)
        const freeCount = Math.floor(shawarmaUnitPrices.length / 3);
       // discount the cheapest items (common retail pattern)
        const sorted = shawarmaUnitPrices.slice().sort((a,b) => a - b);
        const amountsToDiscount = sorted.slice(0, freeCount);
       promoDiscount = amountsToDiscount.reduce((s, v) => s + Number(v || 0), 0);

       // Add friendly freeLines so invoices and checkout can display them
        if (promoDiscount > 0) {
          freeItems.push({
           id: 'promo-FRIDAY-B2G1',
           title: 'Shawarma (Free — Promo)',
           unitPrice: 0,
            qty: freeCount,
            meta: { promo: 'TUES-B2G1', originalPricePerItem: amountsToDiscount }  
          });
        }
      }

      const delivery = 0; // your logic sets delivery elsewhere; keep 0 here as before
     const total = Math.max(0, Math.round(subtotal - promoDiscount + (delivery || 0)));

      return {
        subtotal: Math.round(subtotal),
       delivery,
        promoDiscount: Math.round(promoDiscount),
        freeItems: freeItems,
        total
      };
    }

    function refreshTotals() {
      const totals = getTotals();
   cfSubtotal.innerText = fmtGhc(totals.subtotal || 0);
    // compute delivery: only if delivery selected and we have coords
    const type = inpType.value;
    let deliveryFee = 0; // Delivery intentionally set to 0 (no delivery price by default)
    cfDelivery.innerText = fmtGhc(deliveryFee || 0);
    cfPromo.innerText = `-GHC ${Math.round(totals.promoDiscount || 0)}`;

  // Processing fee (dynamic: Paystack % + MTN withdrawal %)
 const beforeProcessing = Math.max(0, (totals.subtotal || 0) - (totals.promoDiscount || 0) + (deliveryFee || 0));
const processingFee = computeProcessingFee(beforeProcessing); // GHC, 2-decimal
if (cfProcessing) cfProcessing.innerText = fmtGhc2(processingFee);

// Final total now includes processing fee
const total = Math.max(0, beforeProcessing + processingFee);
// show total with 2 decimals in checkout (keeps cents)
if (cfTotal) cfTotal.innerText = fmtGhc2(total);
    }

    // compute delivery fee using haversine distance
    function computeDeliveryFee(lat, lon) {
      if (typeof lat !== 'number' || typeof lon !== 'number' || isNaN(lat) || isNaN(lon)) return DELIVERY_CONFIG.baseFee;
      const dist = haversineKm(STORE_COORDS.lat, STORE_COORDS.lon, lat, lon);
      if (dist <= DELIVERY_CONFIG.freeWithinKm) return 0;
      let fee = DELIVERY_CONFIG.baseFee + (dist * DELIVERY_CONFIG.perKm);
      fee = Math.max(fee, DELIVERY_CONFIG.minFee);
      fee = Math.min(fee, DELIVERY_CONFIG.maxFee);
      return Math.round(fee);
    }

    // Haversine formula
    function haversineKm(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    function toRad(v){ return v * Math.PI / 180; }

    // Address click opens existing map modal (your code already links #cf-address -> #map-modal)
    inpAddress && inpAddress.addEventListener('click', (e) => {
     const type = (inpType && inpType.value) || 'delivery';
      if (type === 'pickup') {
        // keep it readonly and do nothing
        e.preventDefault();
        return;
      }
     // Delivery — ensure the field is editable and focus so the user can type
      inpAddress.removeAttribute('readonly');
      setTimeout(()=> { try { inpAddress.focus(); } catch(e){} }, 60);
    });

    // When map selection happens, your existing map-confirm logic already writes cf-address/cf-lat/cf-lon.
    // We just add a MutationObserver or poll to react to changes and update totals.
    const latEl = inpLat, lonEl = inpLon;
    if (latEl && lonEl) {
      const mo = new MutationObserver(() => { refreshTotals(); });
      mo.observe(latEl, { attributes:true, childList:true, characterData:true, subtree:true });
      mo.observe(lonEl, { attributes:true, childList:true, characterData:true, subtree:true });
    }

    // also refresh totals when order type changes or when cart changes
    inpType && inpType.addEventListener('change', refreshTotals);
    // attempt to watch cart totals element if present
    const cartTotalEl = document.getElementById('cart-total');
    if (cartTotalEl) {
      const mo2 = new MutationObserver(() => { populateOrderLines(); refreshTotals(); });
      mo2.observe(cartTotalEl, { childList:true, subtree:true, characterData:true });
    } else {
      // fallback: poll for cart changes
      setInterval(()=> { populateOrderLines(); refreshTotals(); }, 1000);
    }

    // Submit handler: validate fields and assemble payload (same shape as previous modal-based flow)
    // === REPLACE checkout submit handler with the robust version below ===
submitBtn && submitBtn.addEventListener('click', async (ev) => {
  ev.preventDefault();
  try {
    // prevent double submit
    if (submitBtn.dataset.processing === '1') {
      console.info('Checkout already processing — ignoring duplicate click');
      return;
    }
    submitBtn.dataset.processing = '1';
    submitBtn.setAttribute('aria-busy', 'true');
    submitBtn.disabled = true;
    console.info('Checkout: start processing');

    // gather inputs
    const name = (inpName.value || '').trim();
    const phone = (inpPhone.value || '').trim();
    const email = (inpEmail.value || '').trim();
    const type = inpType.value;
    const address = (inpAddress.value || '').trim();
    const lat = inpLat.value || '';
    const lon = inpLon.value || '';
    const date = inpDate.value || '';
    const time = inpTime.value || '';
    const note = inpNote.value || '';
    const paymethod = inpPayMethod.value || 'paystack';

    if (!name || !phone || !email) {
      alert('Please complete your name, phone and email.');
      return;
    }
    if (type === 'delivery' && !address) {
      alert('Please select your address on the map for delivery.');
      return;
    }

    // build/validate cart
    const baseCartLines = Object.values(window.cart || {});
    if (!baseCartLines.length) {
      alert('Your cart is empty. Add items before checkout.');
      return;
    }
const totals = getTotals();
    const cartLines = baseCartLines.map(l => ({
     baseId: l.baseId, title: l.title, unitPrice: Number(l.unitPrice) || 0, qty: Number(l.qty) || 0, meta: l.meta || {}
    }));
    if (totals && Array.isArray(totals.freeItems) && totals.freeItems.length) {
      totals.freeItems.forEach(fi => {
       cartLines.push({
          baseId: fi.id || 'promo-free',
         title: fi.title || 'Promo free item',
          unitPrice: Number(fi.unitPrice || 0),
         qty: Number(fi.qty || 1),
         meta: fi.meta || {}
        });
     });
    }

    // Delivery value used earlier in this script; keep same logic (0 if not calculated)
    const delivery = 0;
   // Compute processing fee (dynamic) and final amount to charge
const totalBase = (typeof totals.total !== 'undefined') ? Number(totals.total) : ((totals.subtotal || 0) - (totals.promoDiscount || 0) + Number(delivery || 0));
 // processingFee in GHC (2-decimals)
const processingFee = computeProcessingFee(totalBase);
// totalAmountCedis keep cents (GHC)
const totalAmountCedis = Math.round((totalBase + processingFee) * 100) / 100;
try { localStorage.setItem('wrap_user_name', name); localStorage.setItem('wrap_user_phone', phone); } catch(e){}

    // Cash flow (local)
    if (paymethod === 'cash') {
      const fakeOrder = {
        id: 'local-' + Date.now(),
        reference: 'CASH-' + Date.now(),
        name, phone, email, type, address, lat, lon, date, time, note,
        cart: cartLines,
        totals: { subtotal: totals.subtotal, delivery, promo: totals.promoDiscount, total: totalAmount },
        ts: new Date().toISOString()
      };
      try {
        localStorage.setItem('wrap_last_order', JSON.stringify(fakeOrder));
        localStorage.setItem('wrap_show_confirmation', '1');
      } catch (e) {}
      try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch (e) {}
      closeCheckoutPage();
      window.location.reload();
      return;
    }

    // Paystack flow
    if (paymethod === 'paystack') {
      if (!PAYSTACK_PUBLIC_KEY) {
        alert('Paystack public key is not configured. Cannot proceed.');
        return;
      }
      if (typeof totalAmountCedis === 'undefined' || Number(totalAmountCedis) <= 0) {
             alert('Invalid amount to pay. Please review your cart.');
              return;
            }

      // guard + helpers
      function ensurePaystackLoaded(cb) {
        if (window.PaystackPop) return cb(null);
        const s = document.createElement('script');
        s.src = 'https://js.paystack.co/v2/inline.js';
        s.async = true;
        s.onload = () => cb(null);
        s.onerror = () => cb(new Error('Could not load Paystack script'));
        document.head.appendChild(s);
      }

      // Wait for Paystack to load and then open the inline UI. Use a promise so we can recover on timeout.
      await new Promise((resolve, reject) => {
        let fallbackTimer = null;
        let paystackOpened = false;

        ensurePaystackLoaded((err) => {
          if (err) {
            console.error('Paystack load error', err);
            // allow UI to recover
            reject(err);
            return;
          }

          try {
            const PUBLIC_KEY = PAYSTACK_PUBLIC_KEY;
            const ref = 'PSK-' + Date.now() + '-' + Math.floor(Math.random() * 10000);
            const amountInMinor = Math.round(Number(totalAmountCedis) * 100);

            if (!amountInMinor || amountInMinor <= 0) {
              reject(new Error('Payment amount is zero.'));
              return;
            }

            // Setup handler
            const handler = window.PaystackPop.setup({
              key: PUBLIC_KEY,
              email: email,
              amount: amountInMinor,
              currency: 'GHS',
              ref,
              onClose: function() {
                console.warn('Paystack inline closed by user');
                paystackOpened = false;
                // clear fallback and re-enable UI
                if (fallbackTimer) clearTimeout(fallbackTimer);
                submitBtn.disabled = false;
                submitBtn.dataset.processing = '0';
                submitBtn.setAttribute('aria-busy', 'false');
                resolve(new Error('User closed payment window'));
              },
              callback: function(response) {
                // success path: save order & show confirmation
                console.info('Paystack callback', response);
                paystackOpened = false;
                if (fallbackTimer) clearTimeout(fallbackTimer);
                try {
                  const order = {
                    reference: response.reference || ref,
                   name, phone, email, type, address, lat, lon, date, time, note,
                    cart: cartLines,
                    totals: {
   subtotal: Math.round(totals.subtotal || 0),
   delivery: Number(delivery || 0),
   promo: Math.round(totals.promoDiscount || 0),
   processing: Number(processingFee || 0),      // GHC (2-decimal)
   total: Number(totalAmountCedis)               // GHC (2-decimal)
 },
                    ts: new Date().toISOString()
                 };
                  localStorage.setItem('wrap_last_order', JSON.stringify(order));
                  localStorage.setItem('wrap_show_confirmation', '1');
                } catch (e) { console.warn('Could not persist order after payment', e); }
                try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch (e) {}
                closeCheckoutPage();
                // reload (confirmation modal will show)
                window.location.reload();
                // resolve — but reload will happen before next tick
                resolve();
              }
            });

            // open iframe and set a safety fallback timer
            try {
              handler.openIframe();
              paystackOpened = true;
            } catch (err) {
              console.error('Paystack openIframe error', err);
              reject(err);
              return;
            }

            // fallback: re-enable if nothing happens in 30s
            fallbackTimer = setTimeout(() => {
              if (paystackOpened) {
                console.warn('Paystack did not respond within timeout — re-enabling UI');
                paystackOpened = false;
                submitBtn.disabled = false;
                submitBtn.dataset.processing = '0';
                submitBtn.setAttribute('aria-busy', 'false');
                alert('Payment is taking longer than expected. If the Paystack UI did not appear, please check your browser settings (popups/iframes) and try again.');
                resolve(new Error('Paystack timeout'));
              }
            }, 30000);
          } catch (ex) {
            console.error('openPaystackInline exception', ex);
            reject(ex);
            return;
          }
        }); // ensurePaystackLoaded
      }); // end promise
      return;
    } // end paystack branch

    // if other paymethods added later — ensure UI is reset
  } catch (err) {
    console.error('checkout handler error', err);
    alert('Checkout failed: ' + (err && err.message ? err.message : err));
  } finally {
    // If page is navigating/reloading (successful payment path) the finally may not run, but if nothing redirected we must re-enable UI.
    try {
      if (submitBtn && submitBtn.dataset.processing === '1') {
        submitBtn.dataset.processing = '0';
        submitBtn.setAttribute('aria-busy', 'false');
        submitBtn.disabled = false;
      }
    } catch (e) { /* ignore */ }
    console.info('Checkout: processing ended (UI reset)');
  }
});
    
    // small helpers
    function fmtGhc(n){ return `GHC ${Number(n||0).toFixed(0)}`; }
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // When the map modal sets cf-address/cf-lat/cf-lon, we react and refresh totals
    // (your mapConfirm earlier already sets these inputs). We simply listen to changes
    const addrObserver = new MutationObserver(() => { populateOrderLines(); refreshTotals(); });
    if (inpAddress) addrObserver.observe(inpAddress, { childList:true, subtree:true, characterData:true, attributes:true });

    // initial small sync
    populateOrderLines();
    refreshTotals();
  });
})();
</script>
<script>

(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('product-modal');
    const pmThumb = document.getElementById('pm-thumb');
    const pmTitle = document.getElementById('pm-title');
    const pmDesc = document.getElementById('pm-desc');
    const pmBody = document.getElementById('pm-body');
    const pmPrice = document.getElementById('pm-price');
    const pmAdd = document.getElementById('pm-add');
    const pmCancel = document.getElementById('pm-cancel');
    const pmClose = document.getElementById('pm-close');

    let activeMenuItem = null;     // original menu-item element
    let clonedConfig = null;       // clone of .item-config to show inside modal

    // helper: format as GHC
    const fmtGhc = (n) => `GHC ${Number(n||0).toFixed(0)}`;

    // local price calculation (mirrors your calculateItemPrice)
    function calculatePriceFromContainer(container){
       try {
        const menuItem = container.closest('.menu-item');
        if (menuItem && menuItem.dataset.itemId === 'jollof') {
          const fridayPrice = Number(menuItem.dataset.fridayPrice || 75);
          const todayIsFriday = (new Date()).getDay() === 5;
          // base price = friday or normal (normal is in price-value)
          const basePrice = todayIsFriday ? fridayPrice : Number(menuItem.querySelector('.price-value')?.innerText || 85);
          // still include checked addons if any
          let addonsTotal = 0;
          container.querySelectorAll('input.addon-checkbox').forEach(cb => { if (cb.checked) addonsTotal += Number(cb.value) || 0; });
          return Math.round(basePrice + addonsTotal);
        }
      } catch (e) { /* ignore and fall back to normal calc */ }
      let total = 0;
      try {
        if (itemElement && itemElement.dataset.itemId === 'jollof') {
          const fridayPrice = Number(itemElement.dataset.fridayPrice || 75);
          const todayIsFriday = (new Date()).getDay() === 5;
          total = todayIsFriday ? fridayPrice : Number(itemElement.querySelector('.price-value')?.innerText || 85);
        }
      } catch(e){}
      // selects
      const selects = container.querySelectorAll('select');
      selects.forEach(s => { total += Number(s.value) || 0; });
      // addons (checkboxes with class addon-checkbox inside input)
      const addons = container.querySelectorAll('input.addon-checkbox, input[type="checkbox"]');
      addons.forEach(cb => { if (cb.checked) total += Number(cb.value) || 0; });
      // fallback: if no select found, try price-value span
      if (selects.length === 0) {
        const fallback = Number(container.querySelector('.price-value')?.innerText || 0);
        if (fallback) total = fallback;
      }
      return Math.round(total);
    }

    // update modal price display based on clonedConfig
    function updateModalPrice(){
      if (!clonedConfig) return;
      const p = calculatePriceFromContainer(clonedConfig);
      pmPrice.innerText = fmtGhc(p);
    }

    // open modal for a given menu-item element
    function openProductModal(menuItem){
      if (!menuItem) return;
      activeMenuItem = menuItem;

      // set image + title + desc
      const thumb = menuItem.querySelector('.item-thumb');
      const title = menuItem.querySelector('.item-title')?.innerText || 'Item';
      const desc = menuItem.querySelector('.item-desc')?.innerText || '';

      pmThumb.src = thumb?.src || '';
      pmThumb.alt = title;
      pmTitle.innerText = title;
      pmDesc.innerText = desc;

      // clone the .item-config if exists, else create a basic view
      const config = menuItem.querySelector('.item-config');
      pmBody.innerHTML = ''; // clear previous
      clonedConfig = config ? config.cloneNode(true) : null;

      if (clonedConfig) {
        // ensure cloned controls are interactive
        // Remove any ids that may conflict
        Array.from(clonedConfig.querySelectorAll('[id]')).forEach(el => el.removeAttribute('id'));
        pmBody.appendChild(clonedConfig);

        // add listeners to cloned controls to update price live
        clonedConfig.querySelectorAll('select, input[type="checkbox"]').forEach(inp => {
          inp.addEventListener('change', updateModalPrice);
        });
      } else {
        // fallback: create a summary
        const fallback = document.createElement('div');
        fallback.className = 'glass-card small';
        fallback.innerText = 'No configurable options for this item.';
        pmBody.appendChild(fallback);
      }

      // initial price update
      updateModalPrice();

      // show modal
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> pmClose && pmClose.focus(), 80);
    }

    // close modal and cleanup
    function closeProductModal(){
      // clear cloned config
      pmBody.innerHTML = '';
      clonedConfig = null;
      activeMenuItem = null;
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    // Wire clicks on image and title to open modal
    function attachOpeners(){
      // find all menu items
      const menuItems = Array.from(document.querySelectorAll('.menu-item'));
      menuItems.forEach(mi => {
        const thumb = mi.querySelector('.item-thumb');
        const titleEl = mi.querySelector('.item-title');
        [thumb, titleEl].forEach(openEl => {
          if (!openEl) return;
          openEl.style.cursor = 'pointer';
          openEl.addEventListener('click', (e) => {
            e.stopPropagation();
            openProductModal(mi);
          });
        });
      });
    }

    // On Add in modal: copy cloned selections back to the original menu-item controls, then trigger original add-btn
    pmAdd.addEventListener('click', () => {
      if (!activeMenuItem) return;
      if (!clonedConfig) {
        // no config -> just click original add button
        const origAdd = activeMenuItem.querySelector('.add-btn');
        origAdd && origAdd.click();
        closeProductModal();
        return;
      }

      // copy selects by name (or position) and checkboxes by data-addon-key / label text
      try {
        // Selects
        const clonedSelects = Array.from(clonedConfig.querySelectorAll('select'));
        clonedSelects.forEach(cs => {
          const name = cs.name;
          if (!name) return;
          const orig = activeMenuItem.querySelector(`select[name="${name}"]`);
          if (orig) orig.value = cs.value;
          // trigger change event on orig so price update listeners run
          if (orig) orig.dispatchEvent(new Event('change', { bubbles: true }));
        });

        // Checkboxes (addons)
        const clonedCbs = Array.from(clonedConfig.querySelectorAll('input[type="checkbox"]'));
        clonedCbs.forEach(ccb => {
          const key = ccb.dataset.addonKey;
          // try matching by data-addon-key first
          let origCb = key ? activeMenuItem.querySelector(`input.addon-checkbox[data-addon-key="${key}"]`) : null;
          // fallback: match by label text (span)
          if (!origCb) {
            const labelText = ccb.closest('.addon')?.querySelector('span')?.innerText?.trim();
            if (labelText) {
              origCb = Array.from(activeMenuItem.querySelectorAll('.addon')).map(a=>({el:a, txt:a.querySelector('span')?.innerText?.trim()})).find(x=>x.txt===labelText)?.el?.querySelector('input[type="checkbox"]') || null;
            }
          }
          if (origCb) {
            origCb.checked = !!ccb.checked;
            origCb.dispatchEvent(new Event('change', { bubbles: true }));
          }
        });

        // After copying inputs back to original, click the original add button to use existing cart logic
        const origAddBtn = activeMenuItem.querySelector('.add-btn');
        if (origAddBtn) {
          origAddBtn.click();
          // close modal shortly after
          setTimeout(() => closeProductModal(), 260);
        } else {
          // fallback: just close and show toast
          closeProductModal();
          console.warn('Original add button not found for item', activeMenuItem);
        }
      } catch (err) {
        console.error('Error copying modal selections back to original item:', err);
        closeProductModal();
      }
    });

    // cancel/close handlers
    pmCancel.addEventListener('click', closeProductModal);
    pmClose.addEventListener('click', closeProductModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeProductModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.style.display === 'flex') closeProductModal(); });

    // Attach openers initially and whenever new menu items might be added later (MutationObserver)
    attachOpeners();
    const menuGrid = document.getElementById('menu-grid');
    if (menuGrid) {
      const mo = new MutationObserver(() => attachOpeners());
      mo.observe(menuGrid, { childList: true, subtree: true });
    }
  });
})();
</script>
  <!-- Task 3: Promo slideshow (paste after your scripts, before </body>) -->
<style>
/* Promo slideshow styles — mobile-first, uses your accent variables */
.promo-carousel {
  width:100%;
  max-width: var(--max-width,420px);
  margin: 8px auto 18px;
  position: relative;
  box-sizing: border-box;
  overflow: visible;
}
.promo-carousel .pc-slides { position: relative; width:100%; height: 42vh; min-height:220px; border-radius:14px; overflow: clip; box-shadow: var(--card-shadow); }
.promo-carousel .pc-slide {
  position: absolute; inset:0;
  display: none;
  will-change: transform, opacity;
  transition: opacity 520ms cubic-bezier(.2,.9,.3,1), transform 520ms cubic-bezier(.2,.9,.3,1);
  background-size: cover;
  background-position: center;
}
.promo-carousel .pc-slide.is-active { display:block; opacity:1; transform: none; }
.promo-carousel .pc-slide .overlay {
  position:absolute; inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.55) 70%);
  display:flex; align-items:flex-end; padding:14px; box-sizing:border-box;
}
.promo-card {
  width:100%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 12px;
  padding: 12px;
  box-sizing:border-box;
  backdrop-filter: blur(6px) saturate(120%);
  display:flex; gap:10px; align-items:center;
}
.promo-left { flex:0 0 72px; display:flex; align-items:center; justify-content:center; }
.promo-left .pc-ico { font-size:34px; color: #fff; opacity:0.98; text-shadow: 0 6px 20px rgba(0,0,0,0.6); }
.promo-right { flex:1 1 auto; min-width:0; display:flex; flex-direction:column; gap:6px; }
.promo-eyebrow { font-size:12px; color:var(--accent-2); font-weight:900; text-transform:uppercase; letter-spacing:0.8px; }
.promo-title { font-size:16px; font-weight:900; color:#fff; margin:0; line-height:1.05; }
.promo-desc { font-size:13px; color: rgba(255,255,255,0.9); }
.promo-cta-row { display:flex; gap:8px; margin-top:8px; align-items:center; }
.promo-cta-row .btn { min-height:40px; padding:8px 12px; font-weight:900; border-radius:10px; }

.promo-controls { position:absolute; left:12px; right:12px; bottom:12px; display:flex; align-items:center; justify-content:space-between; gap:8px; pointer-events:none; }
.pc-dots { display:flex; gap:8px; align-items:center; pointer-events:auto; }
.pc-dot { width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.04); padding:0; }
.pc-dot.is-active { width:34px; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); box-shadow: 0 8px 20px rgba(255,106,0,0.14); border-radius:999px; }

.pc-nav { display:flex; gap:8px; pointer-events:auto; }
.pc-nav .icon-btn { background: rgba(0,0,0,0.45); color:#fff; border-radius:10px; padding:8px; }

@media (max-width:360px){
  .promo-left { flex:0 0 56px; }
  .promo-left .pc-ico { font-size:28px; }
  .promo-title { font-size:15px; }
  .promo-card { padding:10px; border-radius:10px; }
}
</style>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const promoContainer = document.getElementById('promo-details');
    if (!promoContainer) return;

    // Build carousel markup (2 slides)
    promoContainer.innerHTML = `
      <div class="promo-carousel" aria-roledescription="carousel" aria-label="Promotions carousel">
        <div class="pc-slides" id="pc-slides">
          <section class="pc-slide" data-index="0" id="pc-slide-0" role="group" aria-roledescription="slide" aria-label="Shawarma Promo" style="background-image: url('promo-shawarma.jpg');">
            <div class="overlay">
              <div class="promo-card">
                <div class="promo-left"><i class="fa fa-fire pc-ico" aria-hidden="true"></i></div>
                <div class="promo-right">
                   <div class="promo-eyebrow">Limited • Friday</div>
                  <h3 class="promo-title">Buy 2 Shawarmas — Get 1 Free</h3>
                  <div class="promo-desc">Add 2 qualifying shawarmas at checkout on Tuesdays and the third becomes free automatically. Applies per 3 items.</div>
                  <div class="promo-cta-row">
                     <button class="btn primary" data-action="apply-promo" data-promo-code="FRIDAY-B2G1" aria-label="Claim Shawarma promo"><i class="fa fa-tag"></i> Claim Promo</button>
                    <button class="btn ghost" data-action="promo-details" data-target="shawarma" aria-expanded="false"><i class="fa fa-info-circle"></i> Details</button>
                    <button class="btn primary" data-action="preorder-promo"><i class="fa fa-calendar-check"></i> Preorder</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="pc-slide" data-index="1" id="pc-slide-1" role="group" aria-roledescription="slide" aria-label="Loaded Fries Promo" style="background-image: url('promo-fries.jpg');">
            <div class="overlay">
              <div class="promo-card">
                <div class="promo-left"><i class="fa fa-bolt pc-ico" aria-hidden="true"></i></div>
                <div class="promo-right">
                  <div class="promo-eyebrow">Freebie • All Days (promo hours)</div>
                  <h3 class="promo-title">Loaded Fries → Free Coke</h3>
                  <div class="promo-desc">Buy qualifying Loaded Fries during promo hours and get a free Coke added to your cart automatically.</div>
                  <div class="promo-cta-row">
                    <button class="btn primary" data-action="apply-promo" data-promo-code="FRIES-FCOKE" aria-label="Claim Fries promo"><i class="fa fa-tag"></i> Claim Promo</button>
                    <button class="btn ghost" data-action="promo-details" data-target="fries" aria-expanded="false"><i class="fa fa-info-circle"></i> Details</button>
                    <button class="btn primary" data-action="preorder-promo"><i class="fa fa-calendar-check"></i> Preorder</button>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="promo-controls" aria-hidden="false">
          <div class="pc-nav">
            <button class="slide-prev icon-btn" aria-label="Previous promo"><i class="fa fa-chevron-left"></i></button>
          </div>

          <div class="pc-dots" role="tablist" aria-label="Promo slides">
            <button class="pc-dot is-active" data-index="0" aria-label="Slide 1"></button>
            <button class="pc-dot" data-index="1" aria-label="Slide 2"></button>
          </div>

          <div class="pc-nav">
            <button class="slide-next icon-btn" aria-label="Next promo"><i class="fa fa-chevron-right"></i></button>
          </div>
        </div>
      </div>

      <!-- hidden area for details text toggling -->
      <div id="promo-more" class="promo-help hidden" style="margin-top:10px;">
        <div class="glass-card">
          <div id="promo-more-content" class="small muted"></div>
        </div>
      </div>
    `;

    // Slide behavior
    const slides = Array.from(document.querySelectorAll('.pc-slide'));
    const dots = Array.from(document.querySelectorAll('.pc-dot'));
    const prevBtn = document.querySelector('.slide-prev');
    const nextBtn = document.querySelector('.slide-next');
    let current = 0;
    let autoTimer = null;
    const AUTO_DELAY = 6000;

    function showSlide(idx) {
      idx = (idx + slides.length) % slides.length;
      slides.forEach((s,i) => {
        s.classList.toggle('is-active', i===idx);
        s.setAttribute('aria-hidden', i===idx ? 'false' : 'true');
      });
      dots.forEach((d,i) => d.classList.toggle('is-active', i===idx));
      current = idx;
    }

    function nextSlide() { showSlide(current+1); }
    function prevSlide() { showSlide(current-1); }

    // auto-rotate
    function startAuto() { stopAuto(); autoTimer = setInterval(() => nextSlide(), AUTO_DELAY); }
    function stopAuto() { if (autoTimer) { clearInterval(autoTimer); autoTimer = null; } }

    // event listeners
    nextBtn?.addEventListener('click', (e) => { e.preventDefault(); nextSlide(); startAuto(); });
    prevBtn?.addEventListener('click', (e) => { e.preventDefault(); prevSlide(); startAuto(); });
    dots.forEach(d => d.addEventListener('click', () => { showSlide(Number(d.dataset.index)); startAuto(); }));

    // pause on hover / touchstart
    const carouselEl = document.querySelector('.promo-carousel');
    carouselEl?.addEventListener('mouseenter', stopAuto);
    carouselEl?.addEventListener('mouseleave', startAuto);
    carouselEl?.addEventListener('touchstart', stopAuto, {passive:true});
    carouselEl?.addEventListener('touchend', startAuto, {passive:true});

    // init
    showSlide(0);
    startAuto();

    // Promo CTA handlers: Claim Promo, Details, Preorder
    function showToast(msg, t = 2200) {
      let tEl = document.querySelector('.wrap-toast');
      if (!tEl) { tEl = document.createElement('div'); tEl.className = 'toast wrap-toast'; document.body.appendChild(tEl); }
      tEl.textContent = msg;
      tEl.classList.add('show');
      setTimeout(()=> tEl.classList.remove('show'), t);
    }

    // Claim buttons: record in localStorage and show quick feedback
    promoContainer.querySelectorAll('button[data-action="apply-promo"]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const code = btn.dataset.promoCode || 'UNKNOWN';
        // store claim flag (not tied to cart logic yet)
        try { localStorage.setItem('wrap_claimed_promo_'+code, JSON.stringify({ ts: Date.now() })); } catch (err) {}
        showToast('Promo claimed: ' + code + '. Add qualifying items at checkout.');
        btn.classList.add('is-claimed');
      });
    });

    // Details toggles: show more copy in #promo-more-content
    const detailsMap = {
      'shawarma': `<strong>Shawarma Promo (Buy 2 Get 1 Free)</strong><br>
                   Promo works per 3 Shawarmas. On Fridays, the cheapest of each group of 3 will be discounted to free automatically at checkout. Add 2 qualifying shawarmas to your cart during Friday Madness and the third will appear as a free line.`,
      'fries': `<strong>Loaded Fries (Free Coke)</strong><br>
                Buy a qualifying Loaded Fries during promo hours and we will add a free Coke to your cart. If not auto-added, use the "Add missing items" helper inside the cart.`
    };
    promoContainer.querySelectorAll('button[data-action="promo-details"]').forEach(btn => {
      btn.addEventListener('click', () => {
        const t = btn.dataset.target;
        const content = detailsMap[t] || 'More promo details coming soon.';
        const more = document.getElementById('promo-more');
        const moreContent = document.getElementById('promo-more-content');
        moreContent.innerHTML = content;
        more.classList.toggle('hidden');
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
      });
    });

    // Preorder buttons: reuse your existing `data-action="preorder-promo"` behavior by triggering click on any matching element (your earlier script opened preorder modal for these)
    promoContainer.querySelectorAll('[data-action="preorder-promo"]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        // Try to find existing preorder openers; trigger their click if present, else open #preorder-modal directly
        const opener = document.querySelector('[data-action="preorder-promo"], #promo-preorder-btn');
        if (opener && opener !== btn) opener.click(); // your other script listens on those and will open modal
        else {
          const pm = document.getElementById('preorder-modal');
          if (pm) { pm.style.display = 'flex'; pm.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
        }
      });
    });

    // keyboard navigation for dots (left/right)
    document.addEventListener('keydown', (e) => {
      if (document.activeElement && document.activeElement.tagName === 'INPUT') return; // don't interfere with typing
      if (e.key === 'ArrowRight') { nextSlide(); startAuto(); }
      if (e.key === 'ArrowLeft') { prevSlide(); startAuto(); }
    });
  });
})();
</script>
  <!-- END BODY -->
</body>
<!-- REPLACEMENT: Complete Preorder wiring + resilient cart toggle -->
<script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    /* ---------- Preorder modal wiring ---------- */
    const preorderModal = document.getElementById('preorder-modal');
    const preorderClose = document.getElementById('preorder-close');
    const preorderCancel = document.getElementById('preorder-cancel');
    const preorderForm = document.getElementById('preorder-form');
    const preorderName = document.getElementById('preorder-name');
    const preorderPhone = document.getElementById('preorder-phone');
    const preorderNote = document.getElementById('preorder-note');
    const preorderOpeners = Array.from(document.querySelectorAll('[data-action="preorder-promo"], #promo-preorder-btn'));

    function openPreorder() {
      if (!preorderModal) return;
      preorderModal.style.display = 'flex';
      preorderModal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> { try { preorderName && preorderName.focus(); } catch(e){} }, 80);
    }
    function closePreorder() {
      if (!preorderModal) return;
      preorderModal.style.display = 'none';
      preorderModal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    // attach openers
    preorderOpeners.forEach(btn => {
      try { btn.addEventListener('click', (ev) => { ev.preventDefault(); openPreorder(); }); } catch(e){}
    });

    // close/cancel handlers
    preorderClose && preorderClose.addEventListener('click', closePreorder);
    preorderCancel && preorderCancel.addEventListener('click', closePreorder);
    preorderModal && preorderModal.addEventListener('click', (ev) => { if (ev.target === preorderModal) closePreorder(); });

    // submit handler: light client-side save + feedback
    if (preorderForm) {
      preorderForm.addEventListener('submit', (ev) => {
        ev.preventDefault();
        try {
          const name = (preorderName && preorderName.value || '').trim();
          const phone = (preorderPhone && preorderPhone.value || '').trim();
          const note = (preorderNote && preorderNote.value || '').trim();

          if (!name || !phone) {
            alert('Please provide both name and phone to preorder.');
            return;
          }

          const payload = { name, phone, note, ts: Date.now() };
          // persist locally (replace with server call if you have one)
          try { localStorage.setItem('wrap_preorder_' + Date.now(), JSON.stringify(payload)); } catch(e){}

          // lightweight UX feedback (replace with a nicer toast if you have)
          alert('Preorder saved. We will contact you via phone/WhatsApp to confirm.');
          closePreorder();
        } catch (err) {
          console.error('Preorder submit error', err);
          alert('Could not save preorder. See console for details.');
        }
      });
    }

    /* ---------- CART DRAWER TOGGLE (resilient, minimal) ---------- */
    const cartToggle = document.getElementById('cart-toggle');
    const cartDrawer = document.getElementById('cart-drawer');
    const cartClose = document.getElementById('cart-close');

    function openCart() {
      if (!cartDrawer) return;
      cartDrawer.style.display = 'block';
      cartDrawer.setAttribute('aria-hidden','false');
      // ensure transform/opacity match your CSS visible state
      cartDrawer.style.transform = 'translateX(0)';
      cartDrawer.style.opacity = '1';
      document.body.style.overflow = 'hidden';
      try { cartDrawer.focus(); } catch(e){}
    }
    function closeCart() {
      if (!cartDrawer) return;
      cartDrawer.style.transform = 'translateX(110%)';
      cartDrawer.style.opacity = '0';
      cartDrawer.setAttribute('aria-hidden','true');
      // wait for CSS transition to finish then hide to avoid flicker
      setTimeout(()=> {
        try { if (cartDrawer.getAttribute('aria-hidden') === 'true') cartDrawer.style.display = 'none'; } catch(e){}
        document.body.style.overflow = '';
      }, 420);
    }

    // toggle on click
    if (cartToggle) {
      cartToggle.addEventListener('click', (ev) => {
        const open = cartDrawer && cartDrawer.getAttribute('aria-hidden') === 'false';
        if (open) closeCart(); else openCart();
      });
    }

    // close button inside drawer
    if (cartClose) cartClose.addEventListener('click', closeCart);

    // escape key closes drawer / preorder
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape') {
        if (cartDrawer && cartDrawer.getAttribute('aria-hidden') === 'false') closeCart();
        if (preorderModal && preorderModal.getAttribute('aria-hidden') === 'false') closePreorder();
      }
    });

    // defensive: if cart-drawer is already visible (maybe from server markup), keep aria consistent
    if (cartDrawer && cartDrawer.style.display !== 'none' && cartDrawer.getAttribute('aria-hidden') === 'true') {
      cartDrawer.setAttribute('aria-hidden','false');
    }
  });
})();
</script>

  <!-- Cart footer enhancement: paste after your main script and before </body> -->
<style>
/* Override / enhancement for cart drawer footer behavior */
.cart-drawer {
  /* make the drawer a column flex container so footer stays pinned */
  display: flex !important;
  flex-direction: column;
  justify-content: space-between;
  height: 100vh;          /* fill viewport so footer anchors to bottom */
  overflow: hidden;       /* inner scrolling happens in .cart-body */
}

/* .cart-body becomes the scrollable area */
.cart-body {
  flex: 1 1 auto;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  /* ensure content never gets hidden under footer */
  padding-bottom: calc(var(--cart-footer-h, 96px) + 18px);
}

/* footer pinned inside flex layout */
.cart-footer {
  position: relative;     /* keep it in flow but pinned to bottom via flex */
  z-index: 60;
  flex: 0 0 var(--cart-footer-h, 96px);
  height: var(--cart-footer-h, 96px);
  box-shadow: 0 -10px 36px rgba(0,0,0,0.55);
  border-top: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(6,6,6,0.98), rgba(8,8,8,0.98));
  box-sizing: border-box;
}

/* compact the footer on very small screens to avoid being too tall */
@media (max-width: 380px) {
  :root { --cart-footer-h: 84px; }
  .cart-footer { height: var(--cart-footer-h); }
  .footer-summary .total-label { font-size: 12px; }
  .footer-summary .total-value { font-size: 14px; }
}

/* ensure checkout button remains visible & tappable */
.cart-footer .footer-actions { align-items: center; gap: 8px; }
.cart-footer .btn.primary { min-width: 120px; }

/* small improvement: when drawer is open, slightly dim body (applies when JS adds class) */
body.cart-open::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.28);
  z-index: 1350; /* behind the drawer (drawer 1400) */
  pointer-events: none;
}
</style>

<script>
/* Cart footer behavior + totals sync
   Place after your main script. Non-invasive: doesn't rewrite your cart logic.
*/
(function () {
  document.addEventListener('DOMContentLoaded', () => {
    const cartDrawer = document.getElementById('cart-drawer');
    const cartToggle = document.getElementById('cart-toggle');
    const cartClose = document.getElementById('cart-close');
    const cartMiniCount = document.getElementById('cart-mini-count');
    const cartSubtotal = document.getElementById('cart-subtotal');
    const cartTotal = document.getElementById('cart-total');
    const footerSubtotal = document.getElementById('footer-subtotal');
    const footerTotal = document.getElementById('footer-total');

    if (!cartDrawer) return;

    // Ensure drawer is flex-column (in case some earlier CSS is applied late)
    cartDrawer.style.display = cartDrawer.style.display || 'block';

    // When the drawer opens/closes, toggle body scroll and add subtle dim
    function setDrawerOpen(open) {
      if (open) {
        cartDrawer.style.display = 'block';
        cartDrawer.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';     // prevent background scroll
        document.body.classList.add('cart-open');    // small dim overlay via CSS
        // ensure drawer gets focus for keyboard navigation
        cartDrawer.setAttribute('tabindex','-1');
        cartDrawer.focus && cartDrawer.focus();
      } else {
        cartDrawer.style.display = 'none';
        cartDrawer.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        document.body.classList.remove('cart-open');
      }
    }

    // Attach to existing buttons (we add handlers in addition to your existing ones)
    cartToggle && cartToggle.addEventListener('click', (e) => {
      // If it's already open (aria-hidden false) then close, else open.
      const isOpen = cartDrawer.getAttribute('aria-hidden') === 'false' || cartDrawer.style.transform === 'translateX(0)';
      setDrawerOpen(!isOpen);
    });
    cartClose && cartClose.addEventListener('click', () => setDrawerOpen(false));

    // Also close drawer on Escape
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && cartDrawer.getAttribute('aria-hidden') === 'false') {
        setDrawerOpen(false);
      }
    });

    // Small helper: sync the small footer totals with the main totals
    function syncFooterTotals(){
      try {
        if (cartSubtotal && footerSubtotal) footerSubtotal.innerText = cartSubtotal.innerText || footerSubtotal.innerText;
        if (cartTotal && footerTotal) footerTotal.innerText = footerTotal.innerText && cartTotal.innerText ? cartTotal.innerText : footerTotal.innerText;
      } catch (err) { /* ignore */ }
    }

    // Run once on start
    syncFooterTotals();

    // Watch for changes to the main totals and sync them to the footer
    const watchTargets = [];
    if (cartSubtotal) watchTargets.push(cartSubtotal);
    if (cartTotal) watchTargets.push(cartTotal);

    if (watchTargets.length) {
      const observer = new MutationObserver(() => { syncFooterTotals(); });
      watchTargets.forEach(el => {
        try {
          observer.observe(el, { characterData: true, childList: true, subtree: true });
        } catch (err) { /* fallback: periodic sync */ }
      });
      // fallback periodic sync in case mutationobserver couldn't attach
      setInterval(syncFooterTotals, 700);
    } else {
      // If those elements don't exist, still try to sync periodically
      setInterval(syncFooterTotals, 700);
    }

    // Also ensure cart-body scroll area is sized properly on orientation/resize
    function adjustCartBodyPadding() {
      const bodyEl = cartDrawer.querySelector('.cart-body');
      const footerEl = cartDrawer.querySelector('.cart-footer');
      if (!bodyEl || !footerEl) return;
      const footerH = footerEl.getBoundingClientRect().height || 96;
      // ensure bottom padding is at least footer height + 12px
      bodyEl.style.paddingBottom = (footerH + 18) + 'px';
    }
    window.addEventListener('resize', adjustCartBodyPadding);
    setTimeout(adjustCartBodyPadding, 120);
  });
})();
</script>
<script>
/* Persistent Cart — Replacement for your cart script
   Paste this in place of (or immediately after) your current cart script block.
   It preserves your UI behavior and adds localStorage persistence + menu selection restore.
*/
(function () {
  const q = (s, ctx = document) => ctx.querySelector(s);
  const qa = (s, ctx = document) => Array.from((ctx || document).querySelectorAll(s));
  const fmtGhc = (n) => `GHC ${Number(n).toFixed(0)}`;

  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const hamburger = q('#hamburger'), mobileNav = q('#mobile-nav'), navClose = q('#nav-close');
    const cartToggle = q('#cart-toggle'), cartDrawer = q('#cart-drawer'), cartClose = q('#cart-close');
    const cartCountBadge = q('#cart-count'), cartMiniCount = q('#cart-mini-count');
    const cartItemsList = q('#cart-items'), cartSubtotalEl = q('#cart-subtotal'), cartDeliveryEl = q('#cart-delivery'), cartTotalEl = q('#cart-total');
    const cartPromoBlock = q('#cart-promo'), promoDiscountEl = q('#promo-discount'), promoHelpText = q('#promo-help-text'), addMissingBtn = q('#add-missing');
    const checkoutBtn = q('#checkout-btn'), clearCartBtn = q('#clear-cart');
    const slidesWrap = q('#slides'), slideDots = qa('.dot'), slideElements = qa('.slide'), slidePrev = q('.slide-prev'), slideNext = q('.slide-next');
    const promoCountdownEl = q('#promo-timer'), entryPromoModal = q('#entry-promo'), entryCloseBtn = q('#entry-close');
    const claimPromoEntryBtn = q('#claim-promo-entry'), dontShowAgainCheckbox = q('#dont-show-again');

    // Storage keys (bump version if you change format later)
    const CART_KEY = 'wrap_cart_v2';
    const MENU_STATE_KEY = 'wrap_menu_state_v2';

    // App state
    // cart keys are unique per configuration: { key -> { id(key), baseId, title, unitPrice, qty, meta, imageSrc } }
    let cart = loadCartFromStorage();

    // Expose for other scripts that may read window.cart
    window.cart = cart;

  const promo = {
     // Friday Madness: active on Fridays (day 5).
      activeDays: [5],
      isActive() {
        const now = new Date();
        return this.activeDays.includes(now.getDay());
      }
    };

    // slideshow state
    let slideIndex = 0, slideTimer = null, slideAutoDelay = 5000;

    // init small UI
    hamburger?.addEventListener('click', () => {
      const expanded = hamburger.getAttribute('aria-expanded') === 'true';
      hamburger.setAttribute('aria-expanded', String(!expanded));
      if (mobileNav) {
        mobileNav.setAttribute('aria-hidden', String(expanded));
        mobileNav.style.display = expanded ? 'none' : 'block';
      }
    });
    navClose?.addEventListener('click', () => {
      if (mobileNav) { mobileNav.style.display = 'none'; mobileNav.setAttribute('aria-hidden','true'); hamburger.setAttribute('aria-expanded','false'); }
    });
    cartToggle?.addEventListener('click', openCart);
    cartClose?.addEventListener('click', closeCart);
    addMissingBtn?.addEventListener('click', handleAddMissing);
    checkoutBtn?.addEventListener('click', handleCheckout);
    clearCartBtn?.addEventListener('click', handleClearCart);

    // entry promo handlers
    entryCloseBtn?.addEventListener('click', () => { entryPromoModal.classList.add('hidden'); });
    claimPromoEntryBtn?.addEventListener('click', () => {
      if (!promo.isActive()) {
        alert('The Tuesday promo applies only on Fridays. You will be able to claim it when it is Tuesday in your local time.');
        return;
      }
      alert('Promo is active — add qualifying items to see discounts at checkout (Fridays).');
    });
    dontShowAgainCheckbox?.addEventListener('change', (e) => {
      if (e.target.checked) { localStorage.setItem('wrap_hide_entry_promo','1'); } else { localStorage.removeItem('wrap_hide_entry_promo'); }
    });

    // slideshow
    initSlideshow();

    // menu interactions & preview price
    initMenuInteractions();

    // restore menu selections saved previously (so UI stays the same after refresh)
    restoreMenuSelections();

    // promo countdown
    updatePromoCountdown();
    setInterval(updatePromoCountdown, 1000);

    // initial render (use renderCart defined below)
    renderCart();

    /* ----------------- Persistence helpers ----------------- */
    function saveCartToStorage() {
      try {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
        // also sync exposed window.cart
        window.cart = cart;
      } catch (err) {
        console.warn('Could not save cart to localStorage:', err);
      }
    }

    function loadCartFromStorage() {
      try {
        const raw = localStorage.getItem(CART_KEY);
        if (!raw) return {};
        const parsed = JSON.parse(raw);
        // ensure numbers are numbers
        Object.keys(parsed).forEach(k => {
          const l = parsed[k];
          l.unitPrice = Number(l.unitPrice) || 0;
          l.qty = Number(l.qty) || 0;
        });
        return parsed;
      } catch (err) {
        console.warn('Could not load cart from storage:', err);
        return {};
      }
    }

    function saveMenuSelections() {
      try {
        const state = {};
        qa('.menu-item').forEach(mi => {
          const id = mi.dataset.itemId;
          if (!id) return;
          const selects = {};
          qa('select', mi).forEach(s => { selects[s.name || s.className || s.dataset.item || 'select'] = s.value; });
          const addons = [];
          qa('input.addon-checkbox', mi).forEach(cb => { if (cb.checked) addons.push(cb.dataset.addonKey || cb.value || 'x'); });
          state[id] = { selects, addons };
        });
        localStorage.setItem(MENU_STATE_KEY, JSON.stringify(state));
      } catch (err) {
        console.warn('Could not save menu selections:', err);
      }
    }

    function restoreMenuSelections() {
      try {
        const raw = localStorage.getItem(MENU_STATE_KEY);
        if (!raw) return;
        const saved = JSON.parse(raw);
        Object.keys(saved).forEach(itemId => {
          const mi = q(`[data-item-id="${itemId}"]`);
          if (!mi) return;
          const info = saved[itemId];
          if (info.selects) {
            Object.keys(info.selects).forEach(name => {
              const sel = mi.querySelector(`select[name="${name}"]`);
              if (sel) sel.value = info.selects[name];
            });
          }
          if (Array.isArray(info.addons)) {
            qa('input.addon-checkbox', mi).forEach(cb => {
              cb.checked = info.addons.includes(cb.dataset.addonKey) || info.addons.includes(cb.value);
            });
          }
          // trigger a change so price recalculation picks up restored values
          mi.querySelectorAll('select, input[type="checkbox"]').forEach(el => el.dispatchEvent(new Event('change', { bubbles:true })));
        });
      } catch (err) {
        console.warn('Could not restore menu selections:', err);
      }
    }

    // Ensure menu selections saved whenever user interacts with selects/checkboxes
    document.addEventListener('change', (e) => {
      if (e.target && (e.target.tagName === 'SELECT' || (e.target.type === 'checkbox' && e.target.classList.contains('addon-checkbox')))) {
        // tiny debounce
        clearTimeout(document._saveMenuTimer);
        document._saveMenuTimer = setTimeout(() => { saveMenuSelections(); }, 180);
      }
    });

    /* ----------------- Cart & Menu logic (same API as your previous script) ----------------- */

    function openCart(){ cartDrawer.style.display='block'; cartDrawer.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
    function closeCart(){ cartDrawer.style.display='none'; cartDrawer.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    /* Slideshow */
    function initSlideshow(){
      slideElements.forEach((el, idx)=> {
        el.style.display = idx===slideIndex ? 'block' : 'none';
        el.setAttribute('aria-hidden', idx===slideIndex ? 'false' : 'true');
      });
      updateDots();
      slidePrev?.addEventListener('click', ()=> goToSlide((slideIndex - 1 + slideElements.length) % slideElements.length));
      slideNext?.addEventListener('click', ()=> goToSlide((slideIndex + 1) % slideElements.length));
      slideDots.forEach(dot => dot.addEventListener('click', () => goToSlide(Number(dot.dataset.index))));
      restartSlideTimer();
    }
    function restartSlideTimer(){ clearInterval(slideTimer); slideTimer = setInterval(()=> goToSlide((slideIndex+1)%slideElements.length), slideAutoDelay); }
    function goToSlide(idx){ if (idx===slideIndex) return; slideElements[slideIndex].style.display='none'; slideElements[slideIndex].setAttribute('aria-hidden','true'); slideIndex=idx; slideElements[slideIndex].style.display='block'; slideElements[slideIndex].setAttribute('aria-hidden','false'); updateDots(); restartSlideTimer(); }
    function updateDots(){ qa('.dot').forEach((dot,i)=> dot.classList.toggle('is-active', i===slideIndex)); }

    /* Menu interactions:
       - preview price updates when selects or addons change
       - when Add clicked, collect selects + addons into meta, compute price, create unique cart key, add to cart
    */
    function initMenuInteractions(){
      const menuItems = qa('.menu-item');
      menuItems.forEach(item => {
        updateItemPriceDisplay(item);
        item.addEventListener('change', () => updateItemPriceDisplay(item));

        const addBtn = q('.add-btn', item);
        const removeBtn = q('.remove-btn', item);

        addBtn?.addEventListener('click', () => {
          const baseId = item.dataset.itemId || 'item';
          // collect selected options
          const meta = {};
          qa('select', item).forEach(sel => {
            const key = sel.name || sel.dataset.item || sel.className || ('opt_'+Math.random().toString(36).slice(2,6));
            meta[key] = {
              value: sel.value,
              text: sel.options[sel.selectedIndex]?.text || ''
            };
          });
          // collect addons (labels)
          const addons = [];
          qa('input.addon-checkbox', item).forEach(cb => {
            if (cb.checked) {
              const ownerLabel = cb.closest('.addon');
              const labelText = ownerLabel?.querySelector('span')?.innerText || ownerLabel?.innerText || '';
              addons.push({ key: cb.dataset.addonKey || '', label: labelText, value: Number(cb.value) || 0 });
            }
          });
          if (addons.length) meta.addons = addons;

          const price = calculateItemPrice(item);
          const titleBase = q('.item-title', item)?.innerText?.trim() || baseId;
          const imageSrc = q('.item-thumb', item)?.src || '';

          // create a stable unique key per configuration
          const configId = encodeURIComponent(JSON.stringify({ baseId, meta }));
          const lineKey = `${baseId}::${configId}`;

          addToCart(lineKey, { baseId, title: titleBase, unitPrice: price, qty: 1, meta, imageSrc });

          // toggle buttons: show remove if any baseId in cart
          addBtn.classList.add('hidden');
          removeBtn.classList.remove('hidden');

          // save menu selections too (makes UI persistent)
          saveMenuSelections();
        });

        removeBtn?.addEventListener('click', () => {
          const baseId = item.dataset.itemId;
          const foundKey = Object.keys(cart).find(k => cart[k].baseId === baseId);
          if (foundKey) removeItemFully(foundKey);
          const addBtn = q('.add-btn', item), removeBtn2 = q('.remove-btn', item);
          addBtn?.classList.remove('hidden'); removeBtn2?.classList.add('hidden');
          saveMenuSelections();
        });
      });
    }

    function updateItemPriceDisplay(item){
      try {
        const price = calculateItemPrice(item);
      const displayEl = q('.price-value', item);
      if (displayEl) displayEl.innerText = Math.round(price);

      // Jollof-specific UI toggle (show strikethrough normal price -> replace with Friday price when Friday)
      try {
        if (item.dataset.itemId === 'jollof') {
          const fridayPrice = Number(item.dataset.fridayPrice || 75);
          const normalPrice = Number(item.querySelector('.price-value')?.innerText || 85);
         const isFriday = (new Date()).getDay() === 5;
         const normalEl = item.querySelector('.normal-price');
          const fridayEl = item.querySelector('.friday-price');
          if (normalEl) normalEl.classList.toggle('hidden', isFriday);
          if (fridayEl) fridayEl.classList.toggle('hidden', !isFriday);
          // ensure the visible .price-value matches the shown price (above we already set it via calculateItemPrice)
          if (displayEl) displayEl.innerText = isFriday ? String(fridayPrice) : String(normalPrice);
        }
      } catch(e){}
       const priceWrap = q('.item-price', item);
        if (priceWrap) { priceWrap.classList.add('updated'); setTimeout(()=> priceWrap.classList.remove('updated'), 300); }
      } catch (err) {
        console.error('updateItemPriceDisplay error', err);
      }
    }

    function calculateItemPrice(itemElement){
      let total = 0;
      qa('select', itemElement).forEach(sel => { total += Number(sel.value) || 0; });
      qa('input.addon-checkbox', itemElement).forEach(cb => { if (cb.checked) total += Number(cb.value) || 0; });
      if (qa('select', itemElement).length === 0) {
        const fallback = Number(q('.price-value', itemElement)?.innerText || 0);
        if (fallback) total = fallback;
      }
      return Math.round(total);
    }

    /* ---------- Cart utilities ---------- */

    function addToCart(key, { baseId, title, unitPrice, qty = 1, meta = {}, imageSrc = '' } = {}) {
      if (!key) return;
      if (!cart[key]) {
        cart[key] = {
          id: key,
          baseId: baseId || (key.split('::')[0] || 'item'),
          title: title || 'Item',
          unitPrice: Number(unitPrice) || 0,
          qty: 0,
          meta: meta || {},
          imageSrc: imageSrc || ''
        };
      }
      cart[key].qty += Number(qty) || 1;
      cart[key].unitPrice = Number(unitPrice) || cart[key].unitPrice;
      cart[key].meta = meta || cart[key].meta;
      cart[key].imageSrc = imageSrc || cart[key].imageSrc;

      // persist
      saveCartToStorage();
      renderCart();
    }

    function removeItemFully(key) {
      if (!cart[key]) return;
      delete cart[key];
      saveCartToStorage();
      renderCart();
    }

    function changeItemQty(key, newQty) {
      if (!cart[key]) return;
      cart[key].qty = Math.max(0, Math.floor(newQty));
      if (cart[key].qty <= 0) delete cart[key];
      saveCartToStorage();
      renderCart();
    }

    function computeCartTotals() {
      let subtotal = 0, delivery = 0, promoDiscount = 0;
      const freeItemsToShow = [];
      Object.values(cart).forEach(line => { subtotal += (Number(line.unitPrice) || 0) * (Number(line.qty) || 0); });

      // Promo logic: Buy 2 Get 1 free for baseId 'shawarma' only on Tuesdays
      if (promo.isActive()) {
        const shawarmaLines = Object.values(cart).filter(l => l.baseId === 'shawarma');
        const shawarmaQty = shawarmaLines.reduce((s,l) => s + (l.qty||0), 0);
        if (shawarmaQty >= 3) {
          const freeCount = Math.floor(shawarmaQty / 3);
          let pricePool = [];
          shawarmaLines.forEach(l => { for (let i=0;i<l.qty;i++) pricePool.push(l.unitPrice); });
          pricePool.sort((a,b)=>a-b);
          let discount = 0;
          for (let i=0;i<freeCount;i++){ discount += Number(pricePool[i] || 0); }
          if (discount > 0) { promoDiscount = Math.round(discount); freeItemsToShow.push({ id:'free-shawarma', title: 'Free Shawarma (promo)', qty: freeCount, unitPrice: 0 }); }
        }
        const friesQty = Object.values(cart).filter(l => l.baseId === 'loaded-fries').reduce((s,l)=> s + (l.qty||0), 0);
        if (friesQty > 0) freeItemsToShow.push({ id:'free-coke', title: 'Free Coke (promo)', qty: friesQty, unitPrice: 0 });
      }

      const total = Math.max(0, subtotal - promoDiscount + delivery);
      return { subtotal, delivery, promoDiscount, total, freeItems: freeItemsToShow };
    }

    /* Render cart */
    function renderCart() {
      cartItemsList.innerHTML = '';
      const keys = Object.keys(cart);
      if (!keys.length) {
        cartItemsList.innerHTML = '<li class="empty">Your cart is empty. Add something delicious!</li>';
      } else {
        keys.forEach(key => {
          const line = cart[key];
          const li = document.createElement('li');
          li.className = 'cart-line';
          li.dataset.itemId = key;
          const metaLines = [];
          try {
            if (line.meta) {
              Object.keys(line.meta).forEach(k=>{
                if (k === 'addons' && Array.isArray(line.meta.addons)) {
                  metaLines.push('Extras: ' + line.meta.addons.map(a=>a.label||a.key).join(', '));
                } else {
                  const v = line.meta[k];
                  if (v && v.text) metaLines.push(`${k.replace(/[-_]/g,' ')}: ${v.text}`);
                }
              });
            }
          } catch(e){ }
          li.innerHTML = `
            <div style="display:flex;gap:12px;align-items:center;min-width:0">
              <img src="${escapeHtml(line.imageSrc||'')}" alt="${escapeHtml(line.title)}" style="width:68px;height:56px;object-fit:cover;border-radius:10px;flex:0 0 68px;border:1px solid rgba(255,255,255,0.04)">
              <div style="flex:1 1 auto;min-width:0">
                <strong class="line-title" style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escapeHtml(line.title)}</strong>
                <div class="line-meta" style="font-size:13px;color:rgba(255,255,255,0.8);margin-top:6px">
                  ${metaLines.length ? `<div style="font-weight:700">${metaLines.join(' • ')}</div>` : ''}
                  <div style="margin-top:6px">${fmtGhc(line.unitPrice)} × <span class="line-qty" style="font-weight:900">${line.qty}</span> = <strong style="display:inline-block;margin-left:6px">${fmtGhc(line.unitPrice * line.qty)}</strong></div>
                </div>
              </div>
            </div>
            <div class="line-controls" style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;justify-content:center">
              <button class="icon-btn cart-increase" aria-label="Increase quantity">+</button>
              <button class="icon-btn cart-decrease" aria-label="Decrease quantity">-</button>
              <button class="icon-btn cart-remove" aria-label="Remove item"><i class="fa fa-trash"></i></button>
            </div>
          `;
          cartItemsList.appendChild(li);
        });
      }

      const totals = computeCartTotals();

      // promo block
      if (totals.promoDiscount > 0) {
        promoDiscountEl.innerText = `-GHC ${Math.round(totals.promoDiscount)}`;
        promoHelpText.innerText = `Promo applied — discount: GHC ${Math.round(totals.promoDiscount)} (Tuesday only).`;
        cartPromoBlock.classList.remove('hidden');
      } else {
        const shawQty = Object.values(cart).filter(l => l.baseId === 'shawarma').reduce((s,l)=> s + (l.qty||0), 0);
        if (shawQty > 0 && promo.isActive()) {
          const missing = (3 - (shawQty % 3)) % 3;
          promoHelpText.innerText = `Add ${missing} more Shawarma${missing>1?'s':''} to get one free.`;
          cartPromoBlock.classList.remove('hidden');
        } else {
          cartPromoBlock.classList.add('hidden');
        }
      }

      (totals.freeItems || []).forEach(fi => {
        const li = document.createElement('li');
        li.className = 'cart-line cart-free';
        li.innerHTML = `
          <div class="line-left">
            <strong class="line-title">${escapeHtml(fi.title)}</strong>
            <div class="line-meta">Free × <span class="line-qty">${fi.qty}</span></div>
          </div>
          <div class="line-controls"></div>
        `;
        cartItemsList.appendChild(li);
      });

      cartSubtotalEl.innerText = fmtGhc(totals.subtotal);
      cartDeliveryEl.innerText = fmtGhc(totals.delivery);
      cartTotalEl.innerText = fmtGhc(totals.total);

      const cartCount = Object.values(cart).reduce((s,li) => s + (li.qty||0), 0);
      cartCountBadge.innerText = String(cartCount);
      cartMiniCount.innerText = String(cartCount);

      // attach cart control listeners (rebind after rerender)
      qa('.cart-increase', cartItemsList).forEach(btn => btn.addEventListener('click', (e) => {
        const key = e.target.closest('.cart-line').dataset.itemId;
        if (!key) return;
        changeItemQty(key, (cart[key].qty || 0) + 1);
      }));
      qa('.cart-decrease', cartItemsList).forEach(btn => btn.addEventListener('click', (e) => {
        const key = e.target.closest('.cart-line').dataset.itemId;
        if (!key) return;
        changeItemQty(key, (cart[key].qty || 0) - 1);
      }));
      qa('.cart-remove', cartItemsList).forEach(btn => btn.addEventListener('click', (e) => {
        const key = e.target.closest('.cart-line').dataset.itemId;
        if (!key) return;
        removeItemFully(key);
      }));

      // sync menu add/remove buttons (by baseId)
      qa('.menu-item').forEach(mi => {
        const baseId = mi.dataset.itemId;
        const addBtn = q('.add-btn', mi), removeBtn = q('.remove-btn', mi);
        const present = Object.values(cart).some(l => l.baseId === baseId && l.qty > 0);
        if (present) { addBtn?.classList.add('hidden'); removeBtn?.classList.remove('hidden'); } else { addBtn?.classList.remove('hidden'); removeBtn?.classList.add('hidden'); }
      });

      // persist after render as well (safety)
      saveCartToStorage();
    }

    function handleAddMissing() {
      const shawQty = Object.values(cart).filter(l => l.baseId === 'shawarma').reduce((s,l) => s + (l.qty||0), 0);
      const missing = (3 - (shawQty % 3)) % 3;
      if (missing === 0) { alert('You already qualify for the Buy 2 Get 1 promo for shawarma.'); return; }
      if (!promo.isActive()) { alert('Tuesday promo is only available on Tuesdays in your local time.'); return; }

      const menuEl = q('[data-item-id="shawarma"]');
      if (!menuEl) { alert('Shawarma item not found in menu.'); return; }
      const price = calculateItemPrice(menuEl);
      const title = q('.item-title', menuEl)?.innerText?.trim() || 'Shawarma';
      const imageSrc = q('.item-thumb', menuEl)?.src || '';
      const meta = {};
      qa('select', menuEl).forEach(sel => {
        const key = sel.name || sel.dataset.item || sel.className || ('opt_'+Math.random().toString(36).slice(2,6));
        meta[key] = { value: sel.value, text: sel.options[sel.selectedIndex]?.text || '' };
      });
      const addons = [];
      qa('input.addon-checkbox', menuEl).forEach(cb => { if (cb.checked) { const owner = cb.closest('.addon'); addons.push({ key: cb.dataset.addonKey || '', label: owner?.querySelector('span')?.innerText || '', value: Number(cb.value) || 0 }); } });
      if (addons.length) meta.addons = addons;

      const configId = encodeURIComponent(JSON.stringify({ baseId:'shawarma', meta }));
      const lineKey = `shawarma::${configId}`;

      for (let i=0;i<missing;i++) addToCart(lineKey, { baseId:'shawarma', title, unitPrice: price, qty:1, meta, imageSrc });
      renderCart(); openCart();
    }

    function handleCheckout(){
      const totals = computeCartTotals();
      let summary = 'ORDER SUMMARY:\\n';
      Object.values(cart).forEach(li => {
        summary += `${li.title} (${Object.keys(li.meta).length? 'configured':'default'}) x${li.qty} — ${fmtGhc(li.unitPrice * li.qty)}\\n`;
      });
      if (totals.promoDiscount > 0) summary += `Promo discount: -GHC ${Math.round(totals.promoDiscount)}\\n`;
      summary += `Subtotal: ${fmtGhc(totals.subtotal)}\\nDelivery: ${fmtGhc(totals.delivery)}\\nTotal: ${fmtGhc(totals.total)}\\n\\n`;
      summary += 'This is a simulated checkout. Integrate Paystack flow here.';
      alert(summary);
    }

    function handleClearCart(){
      if (!confirm('Clear all items from cart?')) return;
      cart = {};
      saveCartToStorage();
      renderCart();
    }

    function updatePromoCountdown(){
      const now = new Date();
      const day = now.getDay();
      const targetDay = 2; // Tuesday
      let daysUntil = (targetDay - day + 7) % 7;
      if (daysUntil === 0) {
        const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
        const diff = endOfDay - now;
        promoCountdownEl && (promoCountdownEl.innerText = formatMs(diff));
        return;
      }
      const nextPromo = new Date(now.getFullYear(), now.getMonth(), now.getDate() + daysUntil, 0, 0, 0);
      const diff = nextPromo - now;
      promoCountdownEl && (promoCountdownEl.innerText = formatMs(diff));
    }
    function formatMs(ms) {
      if (ms <= 0) return '00:00:00';
      const secs = Math.floor(ms / 1000);
      const days = Math.floor(secs / 86400);
      const hours = Math.floor((secs % 86400) / 3600);
      const minutes = Math.floor((secs % 3600) / 60);
      const seconds = secs % 60;
      if (days > 0) return `${days}d ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
      return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }
    function pad(n){ return String(n).padStart(2,'0'); }

    function escapeHtml(str){ return String(str||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // End DOMContentLoaded
  });
})();
</script>
<!-- A: Safe openCheckoutPage wrapper — paste near the end of <body> -->
<script>
(function(){
  // Guarded wrapper: attach after DOM is ready so we don't reference a missing symbol at parse time.
  document.addEventListener('DOMContentLoaded', function(){
    try {
      if (typeof window.openCheckoutPage === 'function') {
        const origOpen = window.openCheckoutPage;
        if (!window.__wrapped_openCheckoutPage_for_positioning) {
          window.__wrapped_openCheckoutPage_for_positioning = true;
          window.openCheckoutPage = function() {
            // call original
            const result = origOpen.apply(this, arguments);
            // safe positioning effort (no assumptions)
            try {
              const inner = document.getElementById('checkout-inner');
              if (inner) inner.scrollIntoView({ behavior: 'auto', block: 'start' });
              // also reset checkout scroll helper if available
              if (typeof window.resetCheckoutScroll === 'function') window.resetCheckoutScroll();
            } catch (e) { /* ignore */ }
            return result;
          };
        }
      } else {
        // If function isn't present yet we skip; other scripts will bind openers to the checkout buttons
        console.info('openCheckoutPage not available at DOMContentLoaded — skipping wrapper (safe).');
      }
    } catch (err) {
      console.warn('Safe wrapper for openCheckoutPage failed', err);
    }
  });
})();
</script>
<!-- B: Cart open/close manager — paste near the end of <body> -->
<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    const cartDrawer = document.getElementById('cart-drawer');
    const cartToggle = document.getElementById('cart-toggle');
    const cartClose  = document.getElementById('cart-close');
    // defensive: if any of these are missing, abort gracefully
    if (!cartDrawer || !cartToggle) return;

    // Ensure cart is closed on page load (prevents accidental open on refresh)
    function forceCloseCartOnLoad() {
      try {
        cartDrawer.style.display = 'none';
        cartDrawer.setAttribute('aria-hidden', 'true');
        // If any element inside has focus, move focus to body (or to cartToggle) to avoid aria-hidden block
        if (document.activeElement && cartDrawer.contains(document.activeElement)) {
          try { document.activeElement.blur(); } catch(e){}
        }
      } catch (e) { /* ignore */ }
    }
    forceCloseCartOnLoad();

    // Open cart (only when user clicks)
    function openCart() {
      try {
        // make visible for assistive tech first
        cartDrawer.setAttribute('aria-hidden', 'false');
        cartDrawer.style.display = 'block';
        // prevent background scroll
        document.body.style.overflow = 'hidden';
        // put focus on close button
        setTimeout(() => {
          try {
            if (cartClose) cartClose.focus();
            else {
              // focus first focusable inside drawer if close missing
              const f = cartDrawer.querySelector('button, a, [tabindex]');
              if (f) f.focus();
            }
          } catch(e){}
        }, 50);
      } catch (e) { console.warn('openCart error', e); }
    }

    // Close cart and manage focus so descendant focus is not hidden
    function closeCart() {
      try {
        // If a child inside the drawer currently has focus, blur it so assistive tech isn't blocked.
        const active = document.activeElement;
        if (active && cartDrawer.contains(active)) {
          try { active.blur(); } catch(e){}
        }
        // Move focus back to the cart toggle (so keyboard users don't lose context)
        try { cartToggle.focus(); } catch(e){}
      } catch(e){ /* ignore */ }

      // Now hide the drawer
      try {
        cartDrawer.setAttribute('aria-hidden', 'true');
        cartDrawer.style.display = 'none';
        document.body.style.overflow = '';
      } catch (err) { console.warn('closeCart hide error', err); }
    }

    // Toggle handler
    cartToggle.addEventListener('click', function(e){
      const hidden = cartDrawer.getAttribute('aria-hidden') === 'true' || cartDrawer.style.display === 'none';
      if (hidden) openCart();
      else closeCart();
    });

    // Close button inside drawer
    if (cartClose) cartClose.addEventListener('click', function(){ closeCart(); });

    // Close when clicking on backdrop (clicks on #cart-drawer itself)
    cartDrawer.addEventListener('click', function(e){
      if (e.target === cartDrawer) closeCart();
    });

    // Close on Escape key when drawer is open
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape' && cartDrawer.getAttribute('aria-hidden') === 'false') {
        closeCart();
      }
    });

    // Prevent accidental scripts from opening the drawer by setting inline style directly
    // We observe attribute/style changes and enforce our closed state if aria-hidden="true"
    const mo = new MutationObserver(function(mutations){
      mutations.forEach(m => {
        try {
          // if some other script sets display:block or aria-hidden false on load,
          // we only allow it when the user actually clicked (we track via a flag)
          // simple rule: if drawer is visible but cartToggle wasn't focused or clicked, close it.
          const isVisible = (cartDrawer.getAttribute('aria-hidden') === 'false' || cartDrawer.style.display === 'block');
          if (isVisible) {
            // only allow open if user recently clicked cartToggle (we rely on pointerdown event to set flag)
            // implement a short-lived flag
            if (!cartDrawer.__userOpenedRecently) {
              // auto-close
              cartDrawer.setAttribute('aria-hidden', 'true');
              cartDrawer.style.display = 'none';
            } else {
              // clear the quick flag after a short period
              clearTimeout(cartDrawer.___userOpenedTimer);
              cartDrawer.__userOpenedTimer = setTimeout(()=> { cartDrawer.__userOpenedRecently = false; }, 600);
            }
          }
        } catch(e){}
      });
    });
    mo.observe(cartDrawer, { attributes: true, attributeFilter: ['style','aria-hidden'] });

    // Track user direct open intent (short window)
    cartToggle.addEventListener('pointerdown', function(){
      cartDrawer.__userOpenedRecently = true;
      clearTimeout(cartDrawer.__userOpenedTimer);
      cartDrawer.__userOpenedTimer = setTimeout(()=> { cartDrawer.__userOpenedRecently = false; }, 800);
    });

    // If other scripts call cartDrawer.style.display = 'block' or set aria-hidden incorrectly on load,
    // forceCloseCartOnLoad() already ran. This handler further ensures the drawer remains closed until user click.
    // Final safety: apply closed state after small timeout (cover late-running scripts)
    setTimeout(forceCloseCartOnLoad, 220);
    setTimeout(forceCloseCartOnLoad, 1200);
  });
})();
</script>
<!-- C: Menu single-column override — paste near the end of your styles or before </body> -->
<style>
/* Force menu to always be one item per row (overrides earlier grid rules) */
.menu-grid {
  display: flex !important;
  flex-direction: column !important;
  gap: 14px !important;
  grid-template-columns: none !important;
}

/* Extra: ensure .menu-item takes full width */
.menu-item {
  width: 100% !important;
  box-sizing: border-box;
}

/* Remove accidental two-column grid on intermediate breakpoints */
@media (min-width: 420px), (min-width: 540px) {
  .menu-grid { grid-template-columns: none !important; display:flex !important; flex-direction:column !important; }
}
</style>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    const cartToggle = document.getElementById('cart-toggle');
    const cartClose = document.getElementById('cart-close');
    const cartDrawer = document.getElementById('cart-drawer');

    if (!cartToggle || !cartDrawer) return;

    function openCart() {
      cartDrawer.style.display = 'block';
      cartDrawer.setAttribute('aria-hidden', 'false');
      // focus first focusable in drawer, fallback to cartClose
      try {
        const focusable = cartDrawer.querySelector('button, [tabindex], a, input');
        (focusable || cartClose || cartToggle).focus();
      } catch(e){}
      document.body.style.overflow = 'hidden';
    }

    function closeCart() {
      try {
        // If active element is inside cart, move focus to cart toggle first
        const active = document.activeElement;
        if (cartDrawer.contains(active)) {
          try { cartToggle.focus(); } catch(e){}
        }
      } catch(e){}
      cartDrawer.style.display = 'none';
      cartDrawer.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    cartToggle.addEventListener('click', function(e){
      const hidden = cartDrawer.getAttribute('aria-hidden') === 'true' || cartDrawer.style.display === 'none';
      if (hidden) openCart(); else closeCart();
    });

    cartClose && cartClose.addEventListener('click', function(e){ closeCart(); });

    // clicking backdrop (cart-drawer itself) should close
    cartDrawer.addEventListener('click', function(e){
      if (e.target === cartDrawer) closeCart();
    });

    // If some other script toggles aria-hidden directly, ensure focus isn't trapped inside
    const mo = new MutationObserver((mutations) => {
      for (const m of mutations) {
        if (m.attributeName === 'aria-hidden') {
          const val = cartDrawer.getAttribute('aria-hidden');
          if (val === 'true') {
            try {
              if (cartDrawer.contains(document.activeElement)) cartToggle.focus();
            } catch(e){}
          }
        }
      }
    });
    mo.observe(cartDrawer, { attributes: true });
  });
})();
</script>
<script>
  // If the real openCheckoutPage hasn't been registered yet, this fallback will open the cart drawer.
  // Once the real function is defined it will replace this stub (see Patch B).
  window.openCheckoutPage = window.openCheckoutPage || function() {
    console.warn('openCheckoutPage stub: opening cart drawer as fallback (real function not yet registered)');
    const cart = document.getElementById('cart-drawer');
    if (cart) {
      cart.style.display = 'block';
      cart.setAttribute('aria-hidden','false');
      // make drawer visible and prevent body scroll
      document.body.style.overflow = 'hidden';
    } else {
      // last-resort: scroll to menu
      const menu = document.getElementById('menu');
      if (menu) menu.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  };
  // provide a no-op close until real one is set
  window.closeCheckoutPage = window.closeCheckoutPage || function() {
    const cart = document.getElementById('cart-drawer');
    if (cart) { cart.style.display = 'none'; cart.setAttribute('aria-hidden','true'); document.body.style.overflow = ''; }
  };
</script>

<script>
/*
  Auto-send order to Formspree for Wrap District
  - Detects localStorage.wrap_last_order (set by your checkout flow)
  - Builds a detailed payload: Reference, name, email, phone, address, items (JSON + text), extras totals, subtotal, promo, delivery, total
  - Posts to your Formspree endpoint and marks it as sent to avoid duplicates
  - Non-invasive: doesn't modify your existing checkout handlers; will run when order is saved
*/

(function () {
  const FORM_ENDPOINT = 'https://formspree.io/f/xeonoevj'; // keep your existing formspree endpoint
  const SENT_FLAG_KEY = 'wrap_last_order_formspree_sent_ref';

  // small helper: parse "GHC 55" or "55" -> number
  function parseGhc(text) {
    if (text == null) return 0;
    try {
      return Number(String(text).replace(/[^\d.-]/g, '')) || 0;
    } catch (e) { return 0; }
  }
  function fmtGhc(n) { return `GHC ${Math.round(Number(n)||0)}`; }

  // Build a human-friendly summary and a JSON-safe items array from an "order" object
  function buildOrderPayload(order) {
    // order expected shape (based on your checkout): { reference, name, phone, email, type, address, lat, lon, date, time, note, cart: [ { title, qty, unitPrice, meta } ], totals: { subtotal, delivery, promo, total } }
    const payload = {};

    // create reference if missing
    const ref = order.reference || ('WD-' + Date.now() + '-' + (Math.floor(Math.random()*9000)+1000));
    payload.Reference = ref;

    // basics
    payload.Full_name = order.name || '';
    payload.Phone_number = order.phone || '';
    payload.Email = order.email || '';
    payload.Order_type = order.type || '';
    payload.Delivery_address = order.address || '';
    payload.Lat = order.lat || '';
    payload.Lon = order.lon || '';
    payload.Date = order.date || '';
    payload.Time = order.time || '';
    payload.Notes = order.note || '';

    // Totals (try order.totals first, else try DOM fallbacks)
    const totals = order.totals || {};
    payload.Subtotal = Math.round(totals.subtotal || parseGhc(totals.subtotal) || 0);
    payload.Promo_Discount = Math.round(totals.promo || totals.promoDiscount || parseGhc(totals.promo) || 0);
    payload.Delivery_Fee = Math.round(totals.delivery || parseGhc(totals.delivery) || 0);
    payload.Total_Amount = Math.round(totals.total || parseGhc(totals.total) || (payload.Subtotal - payload.Promo_Discount + payload.Delivery_Fee));

    // Build items detail: prefer order.cart (array). If not available, try scanning DOM
    const items = Array.isArray(order.cart) ? order.cart : [];

    // Normalize items array: ensure fields title, qty, unitPrice, meta/addons
    const normalized = items.map(it => {
      const qty = Number(it.qty || it.quantity || 1);
      const unitPrice = Number(it.unitPrice || it.unit_price || it.price || 0);
      const addons = Array.isArray(it.meta?.addons) ? it.meta.addons.map(a => ({
        key: a.key || a.id || (a.label||a),
        label: a.label || a.key || a,
        price: Number(a.price || a.value || a.amount || 0)
      })) : (it.meta && it.meta.addonsText ? (String(it.meta.addonsText).split(',').map(s => ({ key:s.trim(), label:s.trim(), price:0 })) ) : []);
      const extrasTotal = addons.reduce((s,a)=> s + (Number(a.price)||0), 0);
      return {
        id: it.baseId || it.id || '',
        title: it.title || it.name || 'Item',
        qty,
        unitPrice,
        lineTotal: Math.round(qty * unitPrice + extrasTotal),
        addons,
        meta: it.meta || {}
      };
    });

    // extras totals & list
    const extrasTotal = normalized.reduce((s, it) => s + (it.addons ? it.addons.reduce((ss,a) => ss + Number(a.price||0), 0) : 0), 0);
    const extrasList = normalized.flatMap(it => (it.addons || []).map(a => `${a.label} (${a.price ? 'GHC ' + a.price : 'GHC 0'})`));

    payload.Extras_Total = Math.round(extrasTotal);
    payload.Extras_List = extrasList.join(' • ');

    // attach items JSON and human-readable summary
     function humanizeItem(it){
     const addonText = (it.addons && it.addons.length)
        ? ` [+ ${it.addons.map(a => `${a.label} ${fmtGhc(a.price)}`).join(', ')}]`
        : '';
      const metaText = it.meta && Object.keys(it.meta).length
       ? ' • ' + Object.values(it.meta).map(m => (m && m.text) ? m.text : String(m)).join(' • ')
       : '';
      return `${it.qty} × ${it.title} — ${fmtGhc(it.unitPrice)} → ${fmtGhc(it.lineTotal)}${addonText}${metaText}`;
    }
    payload.Order_Items = normalized.map(humanizeItem).join('\n');
    // readable summary
    const summaryLines = normalized.map(it => {
      const addonText = (it.addons && it.addons.length) ? ` [+ ${it.addons.map(a=>a.label+' GHC '+a.price).join(', ')}]` : '';
      return `${it.qty} × ${it.title} (${fmtGhc(it.unitPrice)}) ${addonText} → ${fmtGhc(it.lineTotal)}`;
    });
    payload.Order_Items_Summary = summaryLines.join(' ; ');

    // add small meta
    payload.Order_TS = order.ts || new Date().toISOString();

    return payload;
  }

  // Send to Formspree via JSON POST (Formspree accepts JSON)
  async function sendToFormspree(payload) {
    try {
      // Formspree expects field names as properties. We'll send JSON.
      const res = await fetch(FORM_ENDPOINT, {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
      if (!res.ok) {
        const text = await res.text().catch(()=> '');
        console.warn('Formspree returned non-OK:', res.status, text);
        return { ok: false, status: res.status, text };
      }
      return { ok: true, status: res.status };
    } catch (err) {
      console.error('Error sending to Formspree:', err);
      return { ok: false, error: err };
    }
  }

  // Small UI toast to show success/failure (non-blocking)
  function showToast(msg, ok = true) {
    try {
      let t = document.getElementById('wrap-formspree-toast');
      if (!t) {
        t = document.createElement('div');
        t.id = 'wrap-formspree-toast';
        t.className = 'wrap-toast';
        t.style.cssText = 'position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:9999;padding:10px 14px;border-radius:999px;background:rgba(0,0,0,0.8);color:#fff;font-weight:800;display:none;';
        document.body.appendChild(t);
      }
      t.innerText = msg;
      t.style.display = 'block';
      setTimeout(()=> { t.style.display = 'none'; }, 3600);
    } catch(e){ /* ignore UI failures */ }
  }

  // Primary watcher function
  async function trySendIfNewOrder() {
    try {
      const raw = localStorage.getItem('wrap_last_order');
      if (!raw) return;
      let order;
      try { order = JSON.parse(raw); } catch (e) { console.warn('wrap_last_order not JSON'); order = { raw }; }
      const ref = order.reference || order.ref || order.reference_id || ('WD-' + Date.now());

      // if already sent ref recorded, skip
      const sentRef = localStorage.getItem(SENT_FLAG_KEY);
      if (sentRef && String(sentRef) === String(ref)) {
        // already sent
        return;
      }

      // Build payload
      const payload = buildOrderPayload(order);

      // Send
      const result = await sendToFormspree(payload);
      if (result && result.ok) {
        localStorage.setItem(SENT_FLAG_KEY, String(payload.Reference || ref));
        console.info('Order sent to Formspree:', payload.Reference || ref);
        showToast('Order sent — confirmation email queued ✔');
      } else {
        // if failed, keep retrying next poll but log
        console.warn('Failed to send order to Formspree', result);
        showToast('Order NOT sent (Formspree) — will retry', false);
      }
    } catch (err) {
      console.error('formspree auto-sender error', err);
    }
  }

  // Poll + storage-event listener so we detect when wrap_last_order is set by other code
  let lastKnown = localStorage.getItem('wrap_last_order');
  // run immediately in case it already exists
  setTimeout(trySendIfNewOrder, 450);

  // Poll every 1.2s for changes (lightweight)
  setInterval(() => {
    const now = localStorage.getItem('wrap_last_order');
    if (now && now !== lastKnown) {
      lastKnown = now;
      trySendIfNewOrder();
    }
  }, 1200);

  // Also listen to storage events (for other tabs)
  window.addEventListener('storage', (e) => {
    if (e.key === 'wrap_last_order') {
      lastKnown = e.newValue;
      trySendIfNewOrder();
    }
  });

  // Expose a manual sender if you want to call programmatically:
  window.sendWrapOrderToFormspreeNow = async function(orderOverride) {
    try {
      if (orderOverride) {
        const payload = buildOrderPayload(orderOverride);
        const res = await sendToFormspree(payload);
        if (res.ok) {
          localStorage.setItem(SENT_FLAG_KEY, String(payload.Reference));
          showToast('Order sent — manual ✔');
        }
        return res;
      } else {
        await trySendIfNewOrder();
      }
    } catch (e) { console.error(e); }
  };

})();
</script>
<script>
/* small parallax on desktop hero slides — non-essential but nice */
(function(){
  if (window.matchMedia && !window.matchMedia('(min-width:900px)').matches) return;

  document.querySelectorAll('.slide').forEach(slide => {
    const img = slide.querySelector('.slide-img');
    const content = slide.querySelector('.slide-content');

    if (!img || !content) return;

    slide.addEventListener('mousemove', (e) => {
      const r = slide.getBoundingClientRect();
      const px = (e.clientX - r.left) / r.width - 0.5;
      const py = (e.clientY - r.top) / r.height - 0.5;
      // subtle transforms
      img.style.transform = `translate(${px * 10}px, ${py * 8}px) scale(1.02)`;
      content.style.transform = `translate(${px * 6}px, ${py * 4}px)`;
    });

    slide.addEventListener('mouseleave', () => {
      img.style.transform = '';
      content.style.transform = '';
    });
  });
})();
</script>

<!-- Preload Paystack safely and add debug helpers -->
<script>
  (function(){
    // Ensure Paystack script is present early (preload)
    if (!window.PaystackPop) {
      var s = document.createElement('script');
      s.src = 'https://js.paystack.co/v2/inline.js';
      s.async = true;
      s.onload = function(){ console.info('Paystack script loaded'); };
      s.onerror = function(){ console.error('Paystack script failed to load'); };
      document.head.appendChild(s);
    } else {
      console.info('Paystack already available');
    }

    // Helper to open Paystack inline (expects payKey + email + amount)
    window.openPaystackInline = function({ publicKey, email, amountGhc, ref }) {
      try {
        console.log('openPaystackInline called', { publicKey, email, amountGhc, ref });
        if (!window.PaystackPop) {
          alert('Payment service not ready. Please refresh the page (check console for details).');
          console.error('PaystackPop not available');
          return Promise.reject(new Error('PaystackPop not available'));
        }
        if (!publicKey) {
          alert('Payment key not configured.');
          return Promise.reject(new Error('No public key'));
        }
        const amountMinor = Math.round(Number(amountGhc || 0) * 100);
        if (!amountMinor || amountMinor <= 0) {
          alert('Invalid payment amount. Add items to cart first.');
          return Promise.reject(new Error('Invalid amount'));
        }
        // create handler synchronously on user gesture
        const handler = window.PaystackPop.setup({
          key: publicKey,
          email: email || 'no-email@example.com',
          amount: amountMinor,
          currency: 'GHS',
          ref: ref || ('PSK-' + Date.now()),
          onClose: function() {
            console.warn('Paystack window closed by user');
          },
          callback: function(response) {
            console.info('Paystack success callback', response);
            // you already persist order + show confirmation in your flow
            window.location.reload(); // or you can do your normal success flow
          }
        });

        // open iframe immediately (this is a synchronous call on the user gesture)
        handler.openIframe();
        return Promise.resolve();
      } catch (err) {
        console.error('openPaystackInline error', err);
        alert('Could not open payment window. See console for details.');
        return Promise.reject(err);
      }
    }

    // Small dev helper: test function to run in console
    window.testPaystackReady = function() {
      console.log('protocol', location.protocol);
      console.log('PaystackPop', typeof window.PaystackPop);
      return typeof window.PaystackPop !== 'undefined';
    };
  })();
</script>


<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    try {
      const isTuesday = (new Date()).getDay() === 5; // Sunday=0, Monday=1, Tuesday=2

      // promo-only selectors (safe to hide/show)
      const promoSelectors = [
        '.promo-badge',
        '.promo-badge-small',
        '.promo-cta-row',
        '.slide-promo',
        '.promo-countdown',
        '.promo-countdown-chip',
        '#entry-promo',
        '#promo-details .promo-cta-row'
      ];

      // Hide/show explicit promo elements
      document.querySelectorAll(promoSelectors.join(',')).forEach(el => {
        if (!isTuesday) {
          el.dataset._promoHiddenByDay = '1';
          el.style.display = 'none';
          try { el.setAttribute('aria-hidden', 'true'); } catch(e){}
        } else {
          if (el.dataset._promoHiddenByDay) {
            el.style.display = '';
            delete el.dataset._promoHiddenByDay;
          }
          try { el.setAttribute('aria-hidden', 'false'); } catch(e){}
        }
      });

      // If you must hide elements marked [data-promo], be careful:
      // skip any element that is inside a menu/catalog/product container so real menu items aren't hidden.
      const menuContainerSelectors = '.menu, .catalog, .menu-list, .product-list, .menu-item, .catalog-item, .product-card';

      if (!isTuesday) {
        document.querySelectorAll('[data-promo]').forEach(el => {
          // skip if this element is inside something that looks like a menu/product
          if (el.closest(menuContainerSelectors)) return;
          el.dataset._promoHiddenByDay = '1';
          el.style.display = 'none';
          try { el.setAttribute('aria-hidden', 'true'); } catch(e){}
        });
      } else {
        // restore [data-promo] elements that we hid previously
        document.querySelectorAll('[data-promo]').forEach(el => {
          if (el.dataset._promoHiddenByDay) {
            el.style.display = '';
            delete el.dataset._promoHiddenByDay;
          }
          try { el.setAttribute('aria-hidden', 'false'); } catch(e){}
        });
      }

    } catch (err) {
      console.warn('Promo show/hide script failed', err);
    }
  });
})();
</script>

  <script>
document.addEventListener('DOMContentLoaded', () => {
  // Adjust selectors to match your markup:
  const modal = document.querySelector('.checkout-modal');
  const modalBody = modal && modal.querySelector('.modal-body');

  if (!modal || !modalBody) return;

  // when modal opens, ensure body scroll is available inside modal
  const observer = new MutationObserver(() => {
    // if modal becomes visible, ensure scrolling on its body
    const style = window.getComputedStyle(modal);
    const visible = style.display !== 'none' && style.visibility !== 'hidden' && style.opacity !== '0';
    if (visible) {
      // ensure the scrollable area has touch scrolling enabled
      modalBody.style.overflowY = 'auto';
      modalBody.style.webkitOverflowScrolling = 'touch';
      // small hack: if footer hidden offscreen scroll to bottom (optional)
      // modalBody.scrollTop = 0; // or modalBody.scrollTop = modalBody.scrollHeight;
    }
  });

  observer.observe(modal, { attributes: true, attributeFilter: ['style', 'class'] });
});
</script>

<script>
(function(){
  function enableCheckoutScroll() {
    const modal = document.getElementById('checkout-page');
    if (!modal) return;
    const inner = document.getElementById('checkout-inner');
    if (!inner) return;
    const form = inner.querySelector('form');
    if (!form) return;

    // set inline styles as a backup for CSS (helps override inline styles from other scripts)
    inner.style.maxHeight = 'calc(100vh - 24px)';
    inner.style.overflow = 'hidden';
    inner.style.display = 'flex';
    inner.style.boxSizing = 'border-box';

    form.style.display = 'flex';
    form.style.flexDirection = (window.innerWidth <= 760) ? 'column' : 'row';
    form.style.minHeight = '0';

    // left column = the first div child of the form (contains inputs)
    const left = form.querySelector(':scope > div:first-child');
    if (left) {
      left.style.flex = '1 1 auto';
      left.style.minHeight = '0';
      left.style.overflowY = (window.innerWidth <= 760) ? 'visible' : 'auto';
      left.style.webkitOverflowScrolling = 'touch';
      left.setAttribute('data-checkout-scrollable', 'true');
    }

    const aside = form.querySelector('aside.checkout-right');
    if (aside) {
      aside.style.flex = (window.innerWidth <= 760) ? '0 0 auto' : '0 0 320px';
      aside.style.width = (window.innerWidth <= 760) ? '100%' : '320px';
      aside.style.maxHeight = (window.innerWidth <= 760) ? 'none' : 'calc(100vh - 80px)';
      aside.style.overflowY = 'auto';
      aside.setAttribute('data-checkout-aside', 'true');
    }
  }

  // Stop propagation for touch events that start inside the scrollable left area so global handlers
  // (that might call preventDefault) don't block the native scroll. We DO NOT call preventDefault().
  function touchCapture(e) {
    try {
      const t = e.target;
      if (!t || !t.closest) return;
      // if the touch started inside the area we marked as scrollable, stop propagation
      const sc = t.closest('[data-checkout-scrollable="true"]');
      if (sc) {
        e.stopPropagation();
        // do not call preventDefault — allow browser native scroll
      }
    } catch (err) {
      // ignore
    }
  }

  document.addEventListener('DOMContentLoaded', function(){
    enableCheckoutScroll();
    // re-run on resize (switch between stacked/columns)
    window.addEventListener('resize', enableCheckoutScroll);

    // Observe for DOM changes (modal libraries often toggle classes/styles)
    const mo = new MutationObserver(function(){ enableCheckoutScroll(); });
    mo.observe(document.body, { childList:true, subtree:true, attributes:true, attributeFilter:['class','style'] });

    // Capture-phase touch listener to block external handlers from intercepting touches
    document.addEventListener('touchmove', touchCapture, { passive:false, capture:true });
  });

  // convenience for devtools
  window.__fixCheckoutScroll = enableCheckoutScroll;
})();
</script>
<style>
 @media (min-width: 900px) {
   /* container sizing like promo */
   .hero-slideshow {
     max-width: 920px;
     margin: 18px auto;
     position: relative;
  ️  box-sizing: border-box;
   }

   /* slides wrapper becomes a single-layer carousel container */
   .hero-slideshow .slides {
     position: relative;
     height: 42vh;
     min-height: 360px;
     border-radius: 14px;
     overflow: hidden;
     box-shadow: var(--card-shadow);
     background: transparent;
   }

   /* each slide becomes absolutely positioned like promo slides */
   .hero-slideshow .slide {
     position: absolute;
     inset: 0;
     display: none;
     background-size: cover;
     background-position: center;
    transition: opacity 520ms cubic-bezier(.2,.9,.3,1), transform 520ms cubic-bezier(.2,.9,.3,1);
  }
   /* show the active slide by reading aria-hidden (keeps your existing JS) */
   .hero-slideshow .slide[aria-hidden="false"] {
     display: block;
     opacity: 1;
     transform: none;
     z-index: 2;
   }

   /* make the slide image cover the slide (keeps your <img> sources) */
   .hero-slideshow .slide-img {
     position: absolute;
     inset: 0;
     width: 100%;
    height: 100%;
     object-fit: cover;
     object-position: center;
     z-index: 1;
    display: block; /* keep images visible but behind overlay */
  }

   /* overlay becomes the promo-like overlay + content area */
   .hero-slideshow .slide-overlay {
     position: absolute;
     inset: 0;
     display: flex;
     align-items: flex-end;
    padding: 14px;
     box-sizing: border-box;
     z-index: 2;
     background: linear-gradient(180deg, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.55) 70%);
   }

   /* mimic the promo-card look for the slide content */
   .hero-slideshow .slide-content {
    width: 100%;
     max-width: 880px;
    display: flex;
     gap: 12px;
     align-items: center;
   box-sizing: border-box;
     background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
     padding: 12px;
    border-radius: 12px;
     backdrop-filter: blur(6px) saturate(120%);
   }

  /* CTA buttons match promo sizing */
   .hero-slideshow .slide-ctas .btn {
     min-height: 40px;
     padding: 8px 12px;
     font-weight: 900;
     border-radius: 10px;
   }

   /* place slideshow controls (dots / prev / next) like promo-controls */
   .slideshow-controls {
     position: absolute;
     left: 12px;
    right: 12px;
    bottom: 12px;
     display: flex;
     align-items: center;
     justify-content: space-between;
     gap: 8px;
     pointer-events: none;
     z-index: 3;
   }
  .slideshow-controls .slide-prev,
   .slideshow-controls .slide-next {
     pointer-events: auto;
    background: rgba(0,0,0,0.45);
     color: #fff;
     border-radius: 10px;
     padding: 8px;
   }

   /* dots like promo */
   .slideshow-controls .slide-dots { pointer-events:auto; display:flex; gap:8px; align-items:center; }
   .slideshow-controls .dot {
     width: 8px;
     height: 8px;
     border-radius: 999px;
     background: rgba(255,255,255,0.18);
     border: 1px solid rgba(255,255,255,0.04);
     transition: width 260ms, background 260ms;
     padding: 0;
   }
   .slideshow-controls .dot.is-active {
     width: 34px;
     background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
     box-shadow: 0 8px 20px rgba(255,106,0,0.14);
     border-radius: 999px;
   }

   /* small responsive tweak on very wide screens */
   @media (min-width: 1200px) {
     .hero-slideshow .slides { height: 48vh; min-height: 440px; }
    .hero-slideshow .slide-content { max-width: 960px; }
   }
 }

</style>
<style>
  /* ---------- Option A: grid layout when cart is in-flow ---------- */
:root {
  --cart-width: 360px;   /* change to your cart width */
  --breakpoint-lg: 900px;
}

@media (min-width: var(--breakpoint-lg)) {
  /* container that wraps hero + cart */
  .page-layout {
    display: grid;
    grid-template-columns: 1fr var(--cart-width); /* hero takes remaining space, cart fixed width */
    gap: 0;
    align-items: start;
  }

  /* hero stretches to fill the left column */
  .hero-slideshow {
    width: 100%;
    max-width: 100%;
    margin: 0; /* no centering — column controls width */
  }

  /* keep slide visuals intact and full width of column */
  .hero-slideshow .slides,
  .hero-slideshow .slide {
    width: 100%;
    height: 100%;
  }

  /* ensure cart sits at the right column */
  .cart {
    width: var(--cart-width);
  }
}

</style>
<style>
  /* ---------- Option B: fixed/sticky cart on the right ---------- */
:root{
  --cart-width: 360px;    /* cart width */
  --cart-offset: 24px;    /* space from right edge if cart is not flush (adjust) */
  --breakpoint-lg: 900px;
}

@media (min-width: var(--breakpoint-lg)) {
  /* ensure main content doesn't go behind the fixed cart */
  .main-content, .hero-wrapper {
    padding-right: calc(var(--cart-width) + var(--cart-offset));
  }

  /* allow the hero to grow so its right edge aligns with cart left */
  .hero-slideshow {
    max-width: calc(100vw - (var(--cart-width) + var(--cart-offset))); /* hero stops where cart begins */
    margin: 18px auto 0 0; /* adjust vertical spacing as needed */
    box-sizing: border-box;
  }

  /* make image fill the hero container */
  .hero-slideshow .slides,
  .hero-slideshow .slide-img {
    width: 100%;
    height: auto;
    object-fit: cover;
  }

  /* ensure your fixed cart CSS remains */
  .cart {
    position: fixed;
    right: var(--cart-offset);
    top: 90px;             /* example — keep your existing positioning */
    width: var(--cart-width);
  }
}

</style>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const sel = document.querySelector('.portion-select');
  if (!sel) return;

  // If no selection or value is empty, force the first option
  if (sel.selectedIndex < 0 || sel.value === '') {
    sel.selectedIndex = 0;
    // also set defaultSelected so browser form-restoration respects it
    Array.from(sel.options).forEach((opt, i) => opt.defaultSelected = (i === 0));
    // notify any event listeners
    sel.dispatchEvent(new Event('change', { bubbles: true }));
  }

  // If you use a custom dropdown wrapper that exposes a JS API (like the custom-select earlier),
  // keep it in sync by calling its method if present:
  const custom = document.querySelector('[data-target-select=".portion-select"]');
  if (custom && custom._select && typeof custom._select.selectIndex === 'function') {
    custom._select.selectIndex(sel.selectedIndex);
  }
});
</script>
</html>
  
