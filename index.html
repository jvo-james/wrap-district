<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wrap District — Mobile</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ----------------------------
  APPETIZING COLOR THEME — Food-focused
  Replace the original :root and body background rules with this block.
  ---------------------------- */
:root{
  /* Primary palette — warm & appetizing */
  --accent-1: #FF6A00;        /* vibrant orange - primary CTA */
  --accent-2: #FFD166;        /* warm golden yellow - highlight */
  --accent-3: #78C267;        /* fresh green - freshness / success */
  --accent-4: #D96A2B;        /* secondary orange (for subtle contrast) */

  /* Neutral / text */
  --bg-start: #0b0b0b;        /* deep charcoal for dramatic food photography */
  --bg-end:   #20140d;        /* warm deep brown tint */
  --muted:    #E6E1DC;        /* off-white for readable small text */
  --muted-2:  rgba(230,225,220,0.78);
  --text:     #FFF9F6;        /* main content text */

  /* Glass / cards */
  --glass: rgba(255,255,255,0.03);
  --glass-2: rgba(255,255,255,0.02);
  --glass-border: rgba(255,255,255,0.04);

  /* Shadows / radii */
  --card-shadow: 0 12px 40px rgba(0,0,0,0.65);
  --accent-shadow: 0 10px 30px rgba(255,106,0,0.12);
  --radius-lg: 14px;
  --radius-sm: 10px;

  --max-width: 420px;
  --safe-top: env(safe-area-inset-top, 12px);
}

/* Page background — warm, slightly textured gradient to make food photos pop */
body {
  background: linear-gradient(180deg, var(--bg-start) 0%, var(--bg-end) 100%);
  color: var(--text);
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  margin: 0;
  -webkit-text-size-adjust: 100%;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Small tweaks to key UI pieces to match the palette */
.logo-mark{
  background: linear-gradient(135deg, var(--accent-1), var(--accent-4));
  color: #111; /* dark text on bright badge gives premium stamp look */
  font-weight:900;
  padding:6px 10px;
  border-radius:8px;
  font-size:16px;
  letter-spacing:1px;
  box-shadow: 0 8px 26px rgba(217,106,43,0.10), inset 0 -2px 0 rgba(0,0,0,0.06);
}

.logo-name{
  color: var(--accent-2);
  font-weight:700;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:1px;
}

/* CTAs — primary and ghost tuned for better contrast */
.btn.primary{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  box-shadow: var(--accent-shadow);
  border: 0;
}
.btn.ghost{
  background: rgba(255,255,255,0.03);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.04);
}

/* Slide eyebrow & titles tuned */
.eyebrow{ color: var(--accent-2); font-weight: 800; }
.slide-title{ color: var(--text); text-shadow: 0 10px 30px rgba(0,0,0,0.6); }
.slide-sub{ color: var(--muted-2); }

/* Accent icon colors used around slides */
.art-icon{ color: rgba(255,230,200,0.95); }

/* Cart badge uses the same appetizing gradient */
.cart-count, .cart-mini-count {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:800;
  box-shadow: var(--accent-shadow);
}

/* Menu cards: slightly warmer surfaces to read as food cards */
.menu-item{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: var(--radius-lg);
  padding: 10px;
  box-shadow: var(--card-shadow);
  border: 1px solid var(--glass-border);
}

/* Price chips: make them pop without feeling loud */
.menu-item::after{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  padding:6px 10px;
  border-radius:999px;
}

/* Promo badges */
.badge, .promo-badge, .promo-badge-small{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:900;
}

/* Cart lines warm accent for quantities */
.line-qty{ color: var(--accent-2); font-weight:900; }

/* Promo countdown chip tuned */
.promo-countdown-chip{ background: linear-gradient(90deg, var(--accent-1), var(--accent-2)); color:#111; }

/* Modal inner highlight for promo */
.entry-promo .modal-inner{
  background: linear-gradient(90deg, rgba(255,106,0,0.07), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,204,51,0.08);
}

/* Small accessibility improvement: ensure links on dark backgrounds are readable */
a { color: var(--accent-2); text-decoration: none; }



/* ---------- STICKY HEADER ---------- */
.sticky-header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: calc(56px + var(--safe-top));
  padding-top: var(--safe-top);
  z-index: 1200;
  display: flex;
  align-items: center;
  justify-content: center;
  backdrop-filter: blur(8px) saturate(130%);
  background: linear-gradient(180deg, rgba(10,10,10,0.6), rgba(10,10,10,0.45));
  border-bottom: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 6px 18px rgba(0,0,0,0.45);
}

/* header inner row */
.header-inner{
  width: 100%;
  max-width: var(--max-width);
  display:flex;
  align-items:center;
  gap:12px;
  padding:8px 14px;
  box-sizing: border-box;
}

/* Logo (left) */
.logo{
  display:flex;
  align-items:center;
  gap:8px;
  flex: 1 1 auto;
  cursor: default;
  user-select: none;
}
.logo-mark{
  background: linear-gradient(135deg, var(--accent-1), #ff8c2b);
  color: #111;
  font-weight:900;
  padding:6px 10px;
  border-radius:8px;
  font-size:16px;
  letter-spacing:1px;
  box-shadow: 0 6px 18px rgba(255,106,0,0.12), inset 0 -2px 0 rgba(0,0,0,0.08);
}
.logo-name{
  color: var(--accent-2);
  font-weight:700;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:1px;
}

/* Icon buttons (cart, hamburger) */
.icon-btn{
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size:20px;
  line-height:1;
  padding:8px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:10px;
  -webkit-tap-highlight-color: transparent;
}
.icon-btn:active{ transform: translateY(1px) scale(.995); }

/* Cart button specifically */
.cart-btn{
  position: relative;
  margin-right: 6px;
  color: var(--accent-2);
  font-size:20px;
  min-width:44px;
  min-height:44px;
  display:inline-grid;
  place-items:center;
}

/* cart count badge */
.cart-count{
  position: absolute;
  top: 6px;
  right: 6px;
  transform: translate(25%, -10%);
  background: linear-gradient(180deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:800;
  font-size:12px;
  padding:4px 6px;
  border-radius:999px;
  box-shadow: 0 6px 16px rgba(255,106,0,0.14);
  border: 2px solid rgba(255,255,255,0.05);
  min-width: 22px;
  text-align:center;
}

/* Hamburger on far right */
.ham-btn{
  color: var(--muted);
  font-size:20px;
  width:44px;
  height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* Ensure header elements are keyboard-focusable and visible */
.icon-btn:focus{ outline: 3px solid rgba(255,204,51,0.12); outline-offset: 3px; }

/* ---------- HERO SLIDESHOW (mobile-first, full-bleed) ---------- */
.hero-slideshow{
  margin-top: calc(56px + var(--safe-top)); /* push content under fixed header */
  width: 100%;
  max-width: var(--max-width);
  margin-left: auto;
  margin-right: auto;
  position: relative;
  overflow: visible;
  padding-bottom: 10px;
}

/* Slide wrapper */
.slides{
  position: relative;
  width: 100%;
  height: 66vh; /* large visual on phones */
  max-height: 560px;
  min-height: 360px;
  border-bottom-left-radius: 22px;
  border-bottom-right-radius: 22px;
  overflow: clip;
  box-shadow: var(--card-shadow);
}

/* Each slide - JS toggles display:block/none; keep transitions for overlay */
.slide{
  position: absolute;
  inset: 0;
  display: none; /* JS will set block for active one */
  will-change: opacity, transform;
}

/* full-bleed image */
.slide-img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
  -webkit-user-drag: none;
  transform-origin: center center;
  transition: transform 900ms cubic-bezier(.2,.9,.3,1);
  filter: saturate(1.05) contrast(1.02);
  transform: scale(1.02);
}

/* subtle parallax on active slide */
.slide[style*="display: block"] .slide-img {
  transform: scale(1);
}

/* gradient overlay + frosted glass content */
.slide-overlay{
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, rgba(10,10,10,0.08) 0%, rgba(0,0,0,0.55) 70%);
  display: flex;
  align-items: flex-end;
  padding: 18px;
  box-sizing: border-box;
}

/* Slide content container (frosted card) */
.slide-content{
  width: 100%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 14px;
  padding: 14px;
  backdrop-filter: blur(6px) saturate(120%);
  border: 1px solid var(--glass-border);
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  display: flex;
  flex-direction: column;
  gap:8px;
  transform: translateY(8px);
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), opacity 420ms ease;
}
/* ===== Header: larger cart icon, smaller badge ===== */
.cart-btn{
  position: relative;
  margin-right: 6px;
  color: var(--accent-2);
  /* made the icon visually larger and a bit more tappable */
  font-size: 26px;        /* was 20px */
  min-width:52px;        /* increased tap area */
  min-height:52px;
  display:inline-grid;
  place-items:center;
  border-radius:12px;
}
/* ---------- HERO IMAGE IMPROVEMENT (replace existing .slide-img block) ---------- */

/* show full image without aggressive cropping; keeps it centered and avoids upscaling */
.slide-img{
  width: 100%;
  height: 100%;
  object-fit: contain;        /* show the whole image (no crop) */
  object-position: center;    /* keeps the subject centered */
  display: block;
  -webkit-user-drag: none;
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), filter 300ms ease;
  filter: saturate(1.03) contrast(1.02);
  transform: scale(1);        /* remove the intentional zoom */
  background-color: #000;     /* hides any tiny gaps with a neutral background */
}

/* keep slide-content animation behavior but no scale-change on active state */
.slide[style*="display: block"] .slide-img {
  transform: scale(1);
}

  .slide-img{
  width:100%;
  height:100%;
  object-fit: cover;   /* still fills container */
  object-position: center;
  transform: scale(0.98);   /* slight zoom-out to reduce aggressive cropping */
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), filter 300ms ease;
  filter: saturate(1.03) contrast(1.02);
}
.slide[style*="display: block"] .slide-img { transform: scale(0.98); }
  
/* cart count badge — smaller, tighter, and repositioned */
.cart-count{
  position: absolute;
  top: 6px;
  right: 6px;
  transform: translate(35%, -35%); /* nudged so it sits nicely on a bigger icon */
  background: linear-gradient(180deg, var(--accent-1), var(--accent-2));
  color: #111;
  font-weight:800;
  font-size:10px;        /* reduced from 12px */
  padding:3px 5px;       /* reduced padding for compactness */
  border-radius:999px;
  box-shadow: 0 6px 16px rgba(255,106,0,0.14);
  border: 2px solid rgba(255,255,255,0.05);
  min-width: 18px;       /* slightly smaller */
  text-align:center;
  line-height:1;
}

/* Keep the badge readable on very small screens */
@media (max-width:360px){
  .cart-btn{ font-size:24px; min-width:48px; min-height:48px; }
  .cart-count{ font-size:9px; padding:2px 5px; min-width:16px; transform: translate(35%, -40%); }
}
/* When slide is active, lift the card a bit */
.slide[style*="display: block"] .slide-content {
  transform: translateY(0);
  opacity: 1;
}

/* Eyebrow small label */
.eyebrow{
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-size:12px;
  color: var(--accent-2);
  font-weight:700;
  text-transform:uppercase;
}

/* Headline */
.slide-title{
  font-size:20px;
  line-height:1.05;
  margin:0;
  color: #fff;
  text-shadow: 0 8px 30px rgba(0,0,0,0.6);
  letter-spacing: -0.2px;
  font-weight:800;
}

/* sub text */
.slide-sub{
  font-size:13px;
  color: rgba(255,255,255,0.86);
  margin:0;
}

/* CTA Buttons inside slides */
.slide-ctas{
  display:flex;
  gap:8px;
  margin-top:6px;
  flex-wrap:wrap;
}

/* Buttons style (used across site) */
.btn{
  border: 0;
  padding:10px 12px;
  border-radius: 12px;
  font-weight:700;
  font-size:13px;
  display:inline-flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  min-height:44px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.btn.primary{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  box-shadow: 0 10px 30px rgba(255,106,0,0.12);
}
.btn.ghost{
  background: rgba(255,255,255,0.03);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.04);
}

/* small / tiny */
.btn.small{ padding:8px 10px; font-size:13px; border-radius:10px; min-height:36px; }

/* decorative art icons floating around slide content */
.slide-art{
  position: absolute;
  right: 14px;
  top: 12px;
  display:flex;
  gap:8px;
  z-index: 15;
  pointer-events: none;
}
.art-icon{
  font-size:20px;
  color: rgba(255,255,255,0.9);
  opacity: 0.95;
  transform-origin: center;
  filter: drop-shadow(0 6px 20px rgba(0,0,0,0.4));
  animation: float 6s ease-in-out infinite;
}
.art-icon:nth-child(2){ animation-delay: 1.2s; transform: scale(.92); }

/* slide promo specific look */
.slide-promo .slide-content{
  border: 1px solid rgba(255,204,51,0.12);
  background: linear-gradient(180deg, rgba(255,106,0,0.06), rgba(255,255,255,0.02));
}

/* slideshow controls (bottom center) */
.slideshow-controls{
  position: absolute;
  left: 0;
  right: 0;
  bottom: 8px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  z-index: 30;
  pointer-events: none;
}
.slideshow-controls .icon-btn { pointer-events: auto; background: rgba(0,0,0,0.45); color: #fff; border-radius: 10px; padding:8px; }

/* dots */
.slide-dots{
  display:flex;
  gap:8px;
  align-items:center;
  pointer-events: auto;
}
.dot{
  width:10px;
  height:10px;
  border-radius:999px;
  background: rgba(255,255,255,0.18);
  border: 1px solid rgba(255,255,255,0.04);
  padding:0;
}
.dot.is-active{
  width:34px;
  border-radius:999px;
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  box-shadow: 0 8px 20px rgba(255,106,0,0.14);
}

/* ---------- Accessibility / touch improvements ---------- */
.icon-btn, .btn { touch-action: manipulation; -webkit-user-select: none; user-select: none; }
.slide .slide-content a, .slide .slide-content button { -webkit-tap-highlight-color: transparent; }

/* ---------- Animations ---------- */
@keyframes float{
  0% { transform: translateY(0) rotate(-2deg); opacity: .95; }
  50% { transform: translateY(-8px) rotate(2deg); opacity: 1; }
  100% { transform: translateY(0) rotate(-2deg); opacity: .95; }
}

/* ---------- Responsive tweaks for very small phones ---------- */
@media (max-width:360px){
  .slide-title { font-size:18px; }
  .slide-sub { font-size:12px; }
  .slide-content { padding: 12px; border-radius: 12px; }
  .slides { height: 62vh; min-height: 320px; }
}

/* ---------- Desktop (wider) graceful scale (won't be used as primary) ---------- */
@media (min-width: 640px){
  .hero-slideshow{ margin-top: calc(64px + var(--safe-top)); }
  .slides { height: 56vh; }
  .slide-title { font-size: 28px; }
  .slide-sub { font-size: 15px; }
}

/* ---------- Tiny utility classes used in body markup ---------- */
.hidden { display: none !important; }
.container-small { padding: 14px; max-width: var(--max-width); margin: 0 auto; box-sizing: border-box; }

</style>
  <style>
/* =========================
   Wrap District — Cart / Cart Drawer Styling (Mobile-first, gorgeous)
   Complements header & hero styles. Drop into your stylesheet.
   ========================= */

/* Reuse theme variables from earlier; provide fallbacks */
:root{
  --accent-1: #ff6a00;
  --accent-2: #ffcc33;
  --muted: #d7d7d7;
  --bg-card: rgba(17,17,17,0.85);
  --glass-strong: rgba(255,255,255,0.04);
  --glass-soft: rgba(255,255,255,0.02);
  --shadow-xl: 0 22px 50px rgba(0,0,0,0.6);
  --radius-lg: 16px;
  --radius-sm: 10px;
  --cart-header-h: 72px;
  --cart-footer-h: 96px;
  --max-width: 420px;
}

/* ---------- CART DRAWER (off-canvas) ---------- */
.cart-drawer{
  position: fixed;
  top: 0;
  right: 0;
  width: 94%;
  max-width: var(--max-width);
  height: 100vh;
  background: linear-gradient(180deg, rgba(12,12,12,0.96), rgba(8,8,8,0.98));
  box-shadow: -28px 0 60px rgba(0,0,0,0.65);
  z-index: 1400;
  transform: translateX(110%);
  transition: transform 420ms cubic-bezier(.2,.9,.3,1), opacity 300ms ease;
  opacity: 0;
  display: none; /* JS toggles block + aria-hidden */
  border-left: 1px solid rgba(255,255,255,0.03);
  overflow: hidden;
  border-top-left-radius: 18px;
  border-bottom-left-radius: 18px;
}

/* When visible (JS sets aria-hidden="false" and display:block) */
.cart-drawer[aria-hidden="false"]{
  transform: translateX(0);
  opacity: 1;
  display: block;
}

/* ---------- Cart header ---------- */
.cart-header{
  height: var(--cart-header-h);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 14px 14px;
  gap:10px;
  box-sizing: border-box;
  background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-bottom: 1px solid rgba(255,255,255,0.03);
  position: relative;
  backdrop-filter: blur(6px) saturate(120%);
}
.cart-header h3{
  margin:0;
  font-size:16px;
  letter-spacing: .2px;
  color: var(--accent-2);
  font-weight:800;
  display:flex;
  align-items:center;
  gap:10px;
}
.cart-header .cart-mini-count{
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color:#111;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
  font-size:12px;
  box-shadow: 0 8px 30px rgba(255,106,0,0.12);
  border: 2px solid rgba(255,255,255,0.04);
}

/* close button */
#cart-close{
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size:18px;
  padding:8px;
  border-radius:10px;
}
#cart-close:focus{ outline: 3px solid rgba(255,204,51,0.10); outline-offset:2px; }

/* ---------- Cart body (scrollable) ---------- */
.cart-body{
  padding: 12px;
  height: calc(100vh - var(--cart-header-h) - var(--cart-footer-h));
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  scroll-behavior: smooth;
}

    /* ---------- Cart: thumbnails + sticky footer polish (add after your cart styles) ---------- */

/* thumbnail inside cart line */
.cart-thumb{
  width:64px;
  height:56px;
  object-fit: cover;
  border-radius:8px;
  flex: 0 0 64px;
  margin-right:12px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.45);
  border: 1px solid rgba(255,255,255,0.03);
}

/* adjust cart-line left area to align image + text nicely */
.cart-line .line-left{
  display:flex;
  align-items:center;
  gap:12px;
}

/* make footer sticky and slightly elevated */
.cart-footer{
  position: sticky;
  bottom: 0;
  z-index: 60;
  height: var(--cart-footer-h);
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(6,6,6,0.96), rgba(8,8,8,0.98));
  backdrop-filter: blur(6px) saturate(120%);
  box-shadow: 0 -8px 28px rgba(0,0,0,0.6);
  box-sizing: border-box;
}

/* give cart-body bottom padding so content never hides under sticky footer */
.cart-body{
  padding-bottom: calc(var(--cart-footer-h) + 18px);
}

/* small condensed summary inside footer for immediate totals */
.cart-footer .footer-summary{
  display:flex;
  align-items:center;
  gap:12px;
  min-width: 0;
  flex: 1 1 auto;
}
.cart-footer .footer-summary .total-label{ color: rgba(255,255,255,0.85); font-weight:800; font-size:13px; }
.cart-footer .footer-summary .total-value{ font-weight:900; font-size:16px; color: var(--accent-2); }

/* make checkout/clear buttons share space nicely on small screens */
.cart-footer .footer-actions{
  display:flex;
  gap:8px;
  width: 48%;
  min-width: 160px;
  justify-content: flex-end;
}

/* ensure cart-drawer content height calculation still works on larger screens */
@media (min-width: 640px) {
  .cart-body{ height: calc(100vh - var(--cart-header-h) - var(--cart-footer-h)); }
}
    
/* Nice custom scrollbar (WebKit) */
.cart-body::-webkit-scrollbar{ width:8px; }
.cart-body::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  border-radius: 999px;
  border: 2px solid rgba(0,0,0,0.3);
}

/* Empty cart message */
.cart-items .empty{
  padding: 28px 12px;
  text-align: center;
  color: rgba(255,255,255,0.75);
  font-weight:700;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius: 12px;
  margin: 6px 0 14px;
  box-shadow: 0 8px 30px rgba(0,0,0,0.45) inset;
}

/* ---------- Cart line items ---------- */
.cart-items{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; }

.cart-line{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 8px 28px rgba(0,0,0,0.45);
}

/* Free promo lines look lighter and friendly */
.cart-line.cart-free{
  background: linear-gradient(180deg, rgba(34,34,34,0.65), rgba(20,20,20,0.6));
  border: 1px dashed rgba(255,204,51,0.09);
  color: var(--accent-2);
}

/* left area - title & meta */
.line-left{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width: 0;
  flex: 1 1 auto;
}
.line-title{
  font-size:14px;
  font-weight:800;
  color: #fff;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.line-meta{
  color: rgba(255,255,255,0.66);
  font-size:13px;
  font-weight:700;
}

/* right area - controls */
.line-controls{
  display:flex;
  align-items:center;
  gap:8px;
  flex: 0 0 auto;
}

/* round quantity controls */
.icon-btn.cart-increase, .icon-btn.cart-decrease, .icon-btn.cart-remove {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.04);
  width:40px;
  height:40px;
  display:inline-grid;
  place-items:center;
  border-radius:10px;
  color: var(--muted);
  font-size:16px;
  transition: transform 150ms ease, background 180ms ease, color 180ms ease;
}
.icon-btn.cart-increase:hover, .icon-btn.cart-decrease:hover {
  transform: translateY(-3px);
  color: var(--accent-2);
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
}
.icon-btn.cart-remove{ color: rgba(255,140,100,0.95); border-color: rgba(255,140,100,0.06); }
.icon-btn.cart-remove:hover{ transform: translateY(-3px); color: #ff6a00; }

/* quantity number inside meta (if present) */
.line-qty{ font-weight:900; color: var(--accent-2); }

/* ---------- Promo / discount block ---------- */
.cart-promo{
  margin-top: 12px;
  padding: 12px;
  border-radius: 12px;
  background: linear-gradient(90deg, rgba(255,204,51,0.06), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,204,51,0.08);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.promo-applied{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}
.promo-label{ font-weight:800; color: #fff; }
.promo-value{ font-weight:900; color: #111; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); padding:6px 10px; border-radius:999px; }

/* helper row */
.promo-cta{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:6px; }
#add-missing{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  padding:8px 10px;
  border-radius:10px;
  border:0;
  font-weight:800;
  min-width:120px;
  box-shadow: 0 10px 30px rgba(255,106,0,0.12);
}
.promo-cta small{ color: rgba(255,255,255,0.78); font-weight:700; }

/* ---------- Cart summary ---------- */
.cart-summary{
  margin-top: 14px;
  padding: 12px;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.03);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.summary-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  color: rgba(255,255,255,0.9);
  font-weight:700;
  font-size:15px;
  padding:6px 0;
}
.summary-row.total{
  font-size:18px;
  color:#fff;
  font-weight:900;
  border-top: 1px dashed rgba(255,255,255,0.04);
  padding-top:10px;
}

/* ---------- Cart footer (checkout actions) ---------- */
.cart-footer{
  height: var(--cart-footer-h);
  padding: 12px;
  border-top: 1px solid rgba(255,255,255,0.03);
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  background: linear-gradient(180deg, rgba(0,0,0,0.0), rgba(0,0,0,0.04));
  box-sizing: border-box;
}
.btn.fullwidth{ width: 100%; padding: 14px; font-size:16px; border-radius:12px; }
.btn.primary.fullwidth{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  font-weight:900;
  box-shadow: 0 12px 36px rgba(255,106,0,0.14);
}
.btn.ghost.fullwidth{
  background: transparent;
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.04);
}

/* small / tiny btn used in promo helper */
.btn.tiny{ padding:8px 10px; border-radius:10px; font-weight:800; }

/* ---------- Utility & focus ---------- */
.cart-drawer :focus { outline: none; }
.cart-drawer button:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset: 3px; border-radius: 10px; }

/* ---------- Micro animations ---------- */
.cart-line { transition: transform 250ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms ease; }
.cart-line:hover { transform: translateY(-3px); box-shadow: 0 30px 60px rgba(0,0,0,0.55); }

/* ---------- Responsive tweaks ---------- */
@media (min-width: 640px){
  .cart-drawer{
    width: 420px;
  }
  .cart-body{ height: calc(100vh - var(--cart-header-h) - var(--cart-footer-h)); }
  .cart-header h3{ font-size:18px; }
  .cart-line{ padding:14px; }
}

/* ---------- Small polish: badges used inside cart if any ---------- */
.badge-inline{
  background: rgba(255,204,51,0.08);
  color: var(--accent-2);
  font-weight:800;
  padding:6px 8px;
  border-radius: 999px;
  font-size:12px;
  border: 1px solid rgba(255,204,51,0.08);
}

/* ---------- End of cart styles ---------- */
</style>

  <style>
/* =========================
   Wrap District — Menu Section Styling (Mobile-first, ultra-appealing & appetizing)
   Use with the existing header / hero / cart styles. Focused on:
   - bold food photography cards
   - clear pricing tiers & CTA
   - tasty color palette, gradients, micro-anim
   ========================= */

/* Fallback theme variables (will reuse if already defined) */
:root{
  --accent-1: #ff6a00;
  --accent-2: #ffcc33;
  --muted: #d7d7d7;
  --card-bg: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  --glass: rgba(255,255,255,0.03);
  --shadow-lg: 0 18px 40px rgba(0,0,0,0.6);
  --radius-lg: 14px;
  --radius-md: 12px;
  --max-width: 420px;
}

/* Container for menu section */
.menu-section{
  width: 100%;
  max-width: var(--max-width);
  margin: 12px auto 28px;
  padding: 0 14px;
  box-sizing: border-box;
}

/* Section heading */
.section-title{
  display:flex;
  align-items:center;
  gap:10px;
  font-size:18px;
  color: var(--accent-2);
  font-weight:900;
  margin-bottom:8px;
  text-transform: none;
}
.section-sub{
  color: rgba(255,255,255,0.78);
  font-size:13px;
  margin-bottom:12px;
}

/* Menu grid (vertical list on mobile) */
.menu-grid{
  display:flex;
  flex-direction:column;
  gap:14px;
}

    /* ------- Menu container & tabs polish (add after menu styles) ------- */
.menu-container {
  padding: 12px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(6,6,6,0.92), rgba(12,12,12,0.95));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.55);
}

/* tabs */
.menu-tabs {
  display:flex;
  gap:8px;
  overflow-x:auto;
  padding: 8px 4px 12px;
  -webkit-overflow-scrolling: touch;
}
.menu-tabs .tab-btn {
  white-space:nowrap;
  flex:0 0 auto;
  border:0;
  padding:8px 12px;
  border-radius: 999px;
  background: rgba(255,255,255,0.02);
  color: var(--muted);
  font-weight:900;
  font-size:13px;
  cursor:pointer;
  outline: none;
  border: 1px solid rgba(255,255,255,0.02);
}
.menu-tabs .tab-btn.is-active {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color: #111;
  box-shadow: 0 12px 36px rgba(255,106,0,0.10);
}

/* visually distinct card: left accent + stronger contrast */
.menu-item {
  position: relative;
  padding: 12px;
  border-radius: 12px;
  display:block;
  transition: transform 220ms cubic-bezier(.2,.9,.3,1), box-shadow 220ms ease;
  border-left: 6px solid transparent;
  background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
}
.menu-item:focus,
.menu-item:hover {
  transform: translateY(-6px);
  box-shadow: 0 36px 80px rgba(0,0,0,0.6);
  border-left-color: rgba(255,106,0,0.95);
  outline: none;
}

/* larger, rounder thumbnail so items are easier to distinguish */
.item-thumb {
  width:110px;
  height:86px;
  border-radius:12px;
  flex:0 0 110px;
  object-fit: cover;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 8px 28px rgba(0,0,0,0.45);
}

/* stronger title contrast */
.item-title { font-size:16px; color:#fff; }

/* small spacing improvements */
.menu-grid { display:flex; flex-direction:column; gap:14px; }

/* On larger widths show two-column grid */
@media (min-width: 540px) {
  .menu-grid { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
}

/* increase hit-target for add/remove on mobile */
.action-row .btn { min-width:48px; padding:10px 14px; }

/* small focus ring for keyboard users */
.menu-item:focus { box-shadow: 0 8px 30px rgba(0,0,0,0.55), 0 0 0 3px rgba(255,204,51,0.06); }
    
/* Each menu card */
.menu-item{
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 10px;
  box-shadow: var(--shadow-lg);
  border: 1px solid rgba(255,255,255,0.03);
  overflow: hidden;
  transition: transform 240ms cubic-bezier(.2,.9,.3,1), box-shadow 240ms ease;
}

/* Lift on hover/tap */
.menu-item:active,
.menu-item:hover{
  transform: translateY(-6px);
  box-shadow: 0 36px 80px rgba(0,0,0,0.6);
}

/* Top row: image + meta */
.item-top{
  display:flex;
  gap:12px;
  align-items:flex-start;
}

/* Round-edge image thumb */
.item-thumb{
  width:94px;
  height:84px;
  object-fit:cover;
  border-radius:12px;
  flex: 0 0 94px;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 10px 30px rgba(0,0,0,0.45);
  transform-origin: center;
  transition: transform 420ms cubic-bezier(.2,.9,.3,1);
}

/* Zoom subtle on hover */
.menu-item:hover .item-thumb{ transform: scale(1.03) rotate(-0.5deg); }

/* Title + desc area */
.item-meta{
  display:flex;
  flex-direction:column;
  gap:6px;
  min-width: 0;
}
.item-title{
  font-size:16px;
  color: #fff;
  font-weight:900;
  line-height:1;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  display:flex;
  align-items:center;
  gap:8px;
}
.item-desc{
  color: rgba(255,255,255,0.78);
  font-size:13px;
  margin-top:2px;
}

/* Badges (promo, small) */
.badge, .promo-badge, .promo-badge-small{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  font-weight:900;
  font-size:11px;
  padding:6px 8px;
  border-radius:999px;
  box-shadow: 0 10px 26px rgba(255,106,0,0.12);
  border: 1px solid rgba(255,255,255,0.04);
  display:inline-flex;
  align-items:center;
  gap:8px;
}

/* Smaller badge variant */
.promo-badge-small{ padding:4px 6px; font-size:11px; font-weight:800; background: rgba(255,255,255,0.03); color: var(--accent-2); border:1px solid rgba(255,255,255,0.03); box-shadow:none; }

/* Item config area (selects, addons) */
.item-config{
  margin-top:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

/* Labels */
.label{ font-size:12px; color: var(--muted); font-weight:800; text-transform:uppercase; letter-spacing: .8px; }

/* Custom styled select (appearance: none replacement) */
.select{
  appearance: none;
  -webkit-appearance: none;
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border: 1px solid rgba(255,255,255,0.04);
  color: #fff;
  font-weight:800;
  font-size:14px;
  outline: none;
  box-shadow: 0 6px 20px rgba(0,0,0,0.45) inset;
  background-image: linear-gradient(45deg, rgba(255,255,255,0.06) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.06) 75%, transparent 75%, transparent);
  background-size: 12px 12px;
  background-position: right 12px center;
}

/* Add-ons row */
.addons-row{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

/* Styled addon checkbox label */
.addon{
  display:flex;
  gap:8px;
  align-items:center;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  padding:8px 10px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.03);
  font-weight:800;
  color: var(--muted);
  font-size:13px;
  cursor: pointer;
  transition: transform 180ms ease, box-shadow 200ms ease;
}

/* Hide native checkbox visually but keep accessible */
.addon input[type="checkbox"]{
  appearance:none;
  -webkit-appearance:none;
  width:18px;
  height:18px;
  border-radius:6px;
  border:2px solid rgba(255,255,255,0.06);
  background: transparent;
  margin:0;
  display:inline-block;
}

/* Checked state */
.addon input[type="checkbox"]:checked{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  border-color: rgba(255,255,255,0.02);
  box-shadow: 0 6px 18px rgba(255,106,0,0.12);
}

/* Text near checkbox */
.addon span{ font-weight:800; color: rgba(255,255,255,0.9); font-size:13px; }

/* Actions row: price + buttons */
.item-actions{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-top:8px;
}

/* Price display */
.price-row{
  display:flex;
  flex-direction:column;
  gap:4px;
  align-items:flex-start;
}
.price-label{ font-size:12px; color: var(--muted); font-weight:800; }
.item-price{ font-size:16px; font-weight:900; color: var(--accent-2); }

/* Action buttons */
.action-row{ display:flex; gap:8px; align-items:center; }
.add-btn, .remove-btn{
  border:0;
  padding:10px 12px;
  border-radius:12px;
  font-weight:900;
  font-size:13px;
  min-height:44px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
  transition: transform 160ms ease, box-shadow 200ms ease;
}
.add-btn{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  box-shadow: 0 10px 30px rgba(255,106,0,0.12);
  border: 1px solid rgba(255,255,255,0.02);
}
.remove-btn{
  background: rgba(255,255,255,0.02);
  color: var(--muted);
  border: 1px solid rgba(255,255,255,0.03);
}

/* Hidden utility */
.hidden{ display:none !important; }

/* Micro interactions */
.add-btn:active, .remove-btn:active{ transform: translateY(1px) scale(.995); }
.menu-item:hover .add-btn{ transform: translateY(-3px); }

/* Price chip inside card for quick glance (top-right) */
.menu-item::after{
  content: attr(data-price);
  position: absolute;
  right: 18px;
  top: 12px;
  font-size:12px;
  font-weight:900;
  color:#111;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  padding:6px 10px;
  border-radius:999px;
  box-shadow: 0 10px 26px rgba(255,106,0,0.12);
  display:none; /* hidden by default; optional */
}

/* Promo microcopy when tapping eligible item (small note area) */
.menu-item .promo-note{
  margin-top:8px;
  background: rgba(255,255,255,0.02);
  padding:8px 10px;
  border-radius:10px;
  color: rgba(255,255,255,0.86);
  font-size:13px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
}

/* "Add missing items" small CTA inside menu (non-blocking) */
.menu-item .promo-cta-small{
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  padding:6px 8px;
  border-radius:8px;
  font-weight:900;
  font-size:12px;
}

/* Accessibility & touch improvements */
.select, .add-btn, .remove-btn, .addon, .item-thumb { -webkit-tap-highlight-color: transparent; touch-action: manipulation; }

/* Responsive adjustments */
@media (min-width: 420px){
  .menu-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:16px;
  }
  .item-thumb{ width:120px; height:100px; flex:0 0 120px; border-radius:14px; }
  .item-title{ font-size:17px; }
}

/* Small polish: shimmer on price value when user changes options */
.item-price .price-value {
  display:inline-block;
  transition: transform 220ms cubic-bezier(.2,.9,.3,1);
}
.item-price.updated .price-value { transform: translateY(-4px); }

    /* ==========================
   Preorder Modal Styles
   Matches site variables (uses --accent-1 / --accent-2)
   Mobile-first, accessible, animated, with sticky CTA bar
   ========================== */

.preorder-modal { /* overlay wrapper */
  position: fixed;
  inset: 0;
  display: none; /* JS toggles display / aria-modal */
  align-items: flex-end; /* slide-up from bottom on mobile */
  justify-content: center;
  z-index: 2200;
  background: rgba(6,6,6,0.6);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  padding: 12px;
  box-sizing: border-box;
}

/* show when aria-modal true */
.preorder-modal[aria-modal="true"] {
  display: flex;
  animation: preorder-overlay-in 260ms cubic-bezier(.2,.9,.3,1);
}

/* inner card */
.preorder-modal .modal-inner-preorder {
  width: 100%;
  max-width: 420px;
  border-radius: 14px 14px 8px 8px;
  background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(8,8,8,0.98));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 30px 80px rgba(0,0,0,0.7);
  transform: translateY(18px);
  animation: preorder-card-in 360ms cubic-bezier(.2,.9,.3,1) forwards;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* header row */
.preorder-modal .preorder-header {
  display:flex;
  gap:12px;
  align-items:center;
  padding: 14px;
  border-bottom: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
.preorder-modal .preorder-header .thumb {
  width:72px;
  height:64px;
  border-radius:10px;
  object-fit:cover;
  flex: 0 0 72px;
  border:1px solid rgba(255,255,255,0.04);
  box-shadow: 0 8px 30px rgba(0,0,0,0.45);
}
.preorder-modal .preorder-header .meta {
  flex: 1 1 auto;
  min-width:0;
}
.preorder-modal .preorder-header .meta .title {
  font-size:16px;
  font-weight:900;
  color:#fff;
  margin:0 0 4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.preorder-modal .preorder-header .meta .subtitle {
  font-size:13px;
  color: rgba(255,255,255,0.82);
  margin:0;
}

/* countdown / weekday chip */
.preorder-modal .preorder-when {
  display:flex;
  gap:8px;
  align-items:center;
  padding: 12px 14px;
  border-bottom: 1px dashed rgba(255,255,255,0.02);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
}
.preorder-modal .countdown-chip {
  display:inline-flex;
  gap:8px;
  align-items:center;
  padding:8px 10px;
  border-radius:999px;
  font-weight:900;
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  color:#111;
  box-shadow: 0 12px 30px rgba(255,106,0,0.12);
  font-size:13px;
}

/* form area */
.preorder-modal .preorder-body {
  padding: 12px 14px 84px; /* bottom padding to allow for sticky CTA bar */
  display:flex;
  flex-direction:column;
  gap:12px;
  max-height: calc(100vh - 220px);
  overflow:auto;
}

/* qty + extras row */
.preorder-modal .row {
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
}

/* quantity control */
.preorder-modal .qty-control {
  display:flex;
  gap:8px;
  align-items:center;
}
.preorder-modal .qty-control button {
  width:40px;
  height:40px;
  border-radius:10px;
  border:0;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  color:var(--muted);
  font-weight:900;
  font-size:18px;
}
.preorder-modal .qty-control .qty-value {
  min-width:36px;
  text-align:center;
  font-weight:900;
  color: var(--accent-2);
}

/* date/time picker row */
.preorder-modal .datetime {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.preorder-modal .datetime input[type="date"],
.preorder-modal .datetime input[type="time"],
.preorder-modal .datetime select,
.preorder-modal .datetime .prefetch-select {
  padding:10px 12px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color:#fff;
  font-weight:800;
  font-size:14px;
  box-sizing:border-box;
}

/* extras list */
.preorder-modal .extras {
  display:flex;
  flex-direction:column;
  gap:8px;
}
.preorder-modal .extras label {
  display:flex;
  gap:10px;
  align-items:center;
  padding:8px 10px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  cursor:pointer;
  font-weight:800;
  color: var(--muted);
}
.preorder-modal .extras input[type="checkbox"] {
  width:18px;
  height:18px;
  border-radius:6px;
  border:2px solid rgba(255,255,255,0.06);
  appearance:none;
  -webkit-appearance:none;
}
.preorder-modal .extras input[type="checkbox"]:checked {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  border-color: rgba(255,255,255,0.02);
}

/* contact inputs */
.preorder-modal .contact-row {
  display:flex;
  gap:8px;
  flex-direction:column;
}
.preorder-modal .contact-row input[type="text"],
.preorder-modal .contact-row input[type="tel"],
.preorder-modal .contact-row input[type="email"] {
  padding:10px 12px;
  border-radius:10px;
  border:1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color:#fff;
  font-weight:800;
  font-size:14px;
  box-sizing:border-box;
}

/* small helper text */
.preorder-modal .helper {
  font-size:13px;
  color: rgba(255,255,255,0.75);
  margin-top:2px;
}

/* sticky CTA bar (fixed to modal bottom) */
.preorder-modal .preorder-cta {
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  padding: 12px;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(8,8,8,0.00), rgba(0,0,0,0.6));
  border-top: 1px solid rgba(255,255,255,0.03);
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
}
.preorder-modal .preorder-cta .price {
  font-weight:900;
  font-size:16px;
  color: var(--accent-2);
  min-width:120px;
  text-align:left;
}
.preorder-modal .preorder-cta .btn {
  min-width: 140px;
  padding:12px 14px;
  border-radius:12px;
  font-weight:900;
}

/* disabled state for submit */
.preorder-modal .btn[disabled] {
  opacity: 0.4;
  transform: none;
  pointer-events: none;
}

/* small close button top-right */
.preorder-modal .preorder-close {
  position:absolute;
  right: 10px;
  top: 8px;
  background: transparent;
  border: 0;
  color: var(--muted);
  font-size:18px;
  padding:8px;
  z-index: 10;
}

/* success state/shimmer for confirmation */
.preorder-modal .success {
  display:none;
  padding:18px;
  text-align:center;
  color: var(--accent-2);
  font-weight:900;
}
.preorder-modal.success-visible .success { display:block; }
.preorder-modal.success-visible .modal-inner-preorder { opacity: 0.2; pointer-events: none; }

/* Animations */
@keyframes preorder-overlay-in {
  from { opacity: 0; } to { opacity: 1; }
}
@keyframes preorder-card-in {
  from { transform: translateY(22px); opacity: 0; } to { transform: translateY(0); opacity: 1; }
}

/* Responsive tweaks for larger screens */
@media (min-width: 640px) {
  .preorder-modal { align-items: center; padding: 30px; }
  .preorder-modal .modal-inner-preorder { width: 560px; border-radius: 12px; }
  .preorder-modal .preorder-body { padding-bottom: 16px; max-height: calc(100vh - 160px); }
  .preorder-modal .preorder-cta { position: relative; background: transparent; border-top: none; }
}
/* End of menu styles */
</style>
  <style>
    /* -------------------------
   INPUT VISIBILITY FIX — paste after your other styles
   Applies to #checkout-page (Complete Order) and menu controls (.select, .addon)
   ------------------------- */

:root{
  /* fallback highlight when needed */
  --input-bg: rgba(255,255,255,0.03);
  --input-border: rgba(255,255,255,0.10);
  --placeholder: rgba(255,255,255,0.72);
  --input-focus: rgba(255,204,51,0.16);
}

/* Generic inputs / textareas used in checkout & preorders */
#checkout-page .input,
#preorder-modal .input,
#checkout-full-modal .input,
.input, input[type="text"], input[type="tel"], input[type="email"], textarea,
.select {
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  /* slightly brighter so it sits above the page background */
  border: 1px solid var(--input-border);
  color: #fff !important;
  padding: 10px 12px;
  border-radius: 10px;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.45);
  -webkit-appearance: none;
  appearance: none;
  outline: none;
}

/* Ensure placeholder text is readable */
input::placeholder, textarea::placeholder, .input::placeholder,
.select::placeholder {
  color: var(--placeholder) !important;
  opacity: 1;
}

/* Stronger focus state for accessibility */
#checkout-page .input:focus,
#preorder-modal .input:focus,
.input:focus,
.select:focus,
select:focus {
  box-shadow: 0 6px 24px var(--input-focus), inset 0 2px 6px rgba(0,0,0,0.5);
  border-color: rgba(255,204,51,0.22);
  outline: none;
  transform: translateZ(0);
}

/* Selects: show custom arrow and make the arrow visible on dark background */
.select, select {
  background-image:
    linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24'%3E%3Cpath fill='%23FFFFFF' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  background-size: 14px;
  padding-right: 38px; /* room for arrow */
  cursor: pointer;
}

/* Make select text bold & clear */
.select, select { font-weight:800; color:#fff; }

/* Checkbox / addon styling — uses markup: <label class="addon"><input type="checkbox"/><span>Label</span></label> */
.addon {
  --box-size: 18px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color: rgba(255,255,255,0.92);
  cursor: pointer;
}

/* Visually hide native checkbox but keep accessible — we style a clear square instead */
.addon input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: var(--box-size);
  height: var(--box-size);
  min-width: var(--box-size);
  display:inline-grid;
  place-items: center;
  border-radius: 6px;
  border: 2px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.02);
  margin: 0;
  transition: background 180ms ease, border-color 180ms ease, box-shadow 180ms ease, transform 120ms ease;
}

/* Unchecked: subtle contrast */
.addon input[type="checkbox"] + span { position: relative; padding-left: 0; }

/* Checked state: gradient + subtle checkmark */
.addon input[type="checkbox"]:checked {
  background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
  border-color: rgba(255,255,255,0.02);
  box-shadow: 0 8px 24px rgba(255,106,0,0.12);
  transform: translateY(-1px);
}

/* place a checkmark using adjacent span ::before for crisp vector-free rendering */
.addon input[type="checkbox"]:checked + span::before {
  content: '✔';
  position: absolute;
  left: -26px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 13px;
  color: #111;
  font-weight: 900;
  line-height: 1;
  /* give it a circle-like padding so it sits within the checkbox area visually */
  width: var(--box-size);
  height: var(--box-size);
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* ensure the text next to checkbox remains readable */
.addon span { color: rgba(255,255,255,0.95); font-weight:800; }

/* When the checkbox is focused via keyboard, show clear ring */
.addon input[type="checkbox"]:focus {
  outline: 3px solid rgba(255,204,51,0.14);
  outline-offset: 2px;
}

/* Make radio / hidden inputs / small selects visible inside modal / checkout too */
#checkout-page select, #checkout-page .input, #checkout-page textarea { color: #fff !important; }

/* Print/Save as PDF hints:
   - When printing we want input values to be visible (browser may hide backgrounds).
   - This rule brightens inputs when printing.
*/
@media print {
  input, textarea, select { background: #ffffff !important; color: #000 !important; -webkit-print-color-adjust: exact; }
  .addon input[type="checkbox"] { background: #000 !important; color:#fff !important; }
}
  </style>
  <style>
/* =========================
   Wrap District — Remaining UI: Modals, Promo Details, Mobile Nav, Entry Modal,
   Contact/Footer, Global utilities and finishing touches.
   Mobile-first, polished, accessible.
   Drop into your stylesheet after other styles.
   ========================= */

/* Reuse / fallback variables */
:root{
  --accent-1: #ff6a00;
  --accent-2: #ffcc33;
  --muted: #d7d7d7;
  --glass: rgba(255,255,255,0.03);
  --glass-strong: rgba(255,255,255,0.06);
  --bg-dark: #071013;
  --card-shadow: 0 12px 40px rgba(0,0,0,0.6);
  --max-width: 420px;
  --safe-top: env(safe-area-inset-top, 12px);
  --radius-lg: 14px;
}

/* ---------- GLOBAL / UTILITIES ---------- */
.container-small{ max-width:var(--max-width); margin:0 auto; padding:0 14px; box-sizing:border-box; }
.muted{ color: rgba(255,255,255,0.6); }
.small{ font-size:12px; color: rgba(255,255,255,0.7); }
.lead{ color: rgba(255,255,255,0.9); font-weight:700; }

/* subtle glass card */
.glass-card{
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,255,255,0.03);
  border-radius: 12px;
  box-shadow: var(--card-shadow);
  padding: 12px;
}

/* Links */
a { color: var(--accent-2); text-decoration: none; }
a:focus, button:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset: 2px; }

/* ---------- MOBILE NAV (OFF-CANVAS) ---------- */
.mobile-nav{
  position: fixed;
  top: calc(56px + var(--safe-top));
  right: 0;
  left: 0;
  bottom: 0;
  background: linear-gradient(180deg, rgba(6,6,6,0.98), rgba(4,4,4,0.98));
  z-index: 1300;
  display: none;
  padding: 20px 14px;
  box-sizing: border-box;
  overflow-y: auto;
}
.mobile-nav[aria-hidden="false"]{ display:block; }
.mobile-nav-inner{ max-width: var(--max-width); margin: 0 auto; }
.mobile-nav .nav-list{ list-style:none; padding:0; margin: 20px 0; display:flex; flex-direction:column; gap:12px; }
.mobile-nav .nav-link{
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px 14px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border: 1px solid rgba(255,255,255,0.03);
  color: #fff;
  font-weight:800;
}
.mobile-nav .nav-link i{ width:20px; text-align:center; color: var(--accent-2); }

/* ---------- MODALS (generic) ---------- */
.modal{
  position: fixed;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1600;
  padding: 20px;
  background: rgba(3,3,3,0.6);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
}
.modal[aria-modal="true"]{ display:flex; }

.modal .modal-inner{
  width: 100%;
  max-width: 420px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(6,6,6,0.98));
  border: 1px solid rgba(255,255,255,0.03);
  padding: 14px;
  box-shadow: 0 30px 80px rgba(0,0,0,0.65);
  transform: translateY(12px);
  transition: transform 260ms cubic-bezier(.2,.9,.3,1), opacity 240ms ease;
}
.modal .modal-inner .modal-body{ padding: 6px 2px; }
.modal .modal-close{ position:absolute; right:14px; top:12px; background:transparent; border:0; color:var(--muted); font-size:18px; }

/* small CTA in modal */
.modal .modal-actions{ display:flex; gap:10px; margin-top:10px; align-items:center; justify-content:flex-start; }

/* ---------- ENTRY PROMO STYLE (slide-in modal variant) ---------- */
.entry-promo.modal .modal-inner{
  background: linear-gradient(90deg, rgba(255,106,0,0.09), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,204,51,0.08);
}
.entry-promo .lead{ font-size:15px; color:#fff; }

/* "Don't show again" label */
.dont-show{ display:flex; gap:8px; align-items:center; font-size:13px; color: rgba(255,255,255,0.8); margin-top:10px; }
.dont-show input{ width:18px; height:18px; }

/* ---------- PROMO DETAILS SECTION (in-page) ---------- */
.promo-detail{
  width: 100%;
  max-width: var(--max-width);
  margin: 6px auto 18px;
  padding: 0 14px;
  box-sizing: border-box;
}
.promo-copy{
  margin-top:8px;
  display:flex;
  gap:12px;
  flex-direction:column;
}
.promo-copy p{ margin: 6px 0; color: rgba(255,255,255,0.9); font-weight:700; }
.promo-help{ margin-top:8px; color: rgba(255,255,255,0.78); font-size:13px; }

/* Promo countdown inline chip used elsewhere */
.promo-countdown-chip{
  display:inline-flex;
  gap:8px;
  align-items:center;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  padding:8px 10px;
  border-radius: 999px;
  font-weight:900;
  box-shadow: 0 12px 30px rgba(255,106,0,0.12);
}

/* ---------- PROMO DETAILS - HELPFUL MICROCOPY ---------- */
.promo-note-inline{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:space-between;
  background: rgba(255,255,255,0.02);
  padding:10px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.02);
  color: rgba(255,255,255,0.9);
}

/* ---------- CONTACT / FOOTER ---------- */
.site-footer{
  width:100%;
  max-width: var(--max-width);
  margin: 20px auto 40px;
  padding: 12px 14px;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
}
.footer-row{
  display:flex;
  gap:12px;
  justify-content:space-between;
  align-items:flex-start;
  flex-direction:row;
}
.footer-left, .footer-right{ flex:1 1 50%; }
.footer-left h4, .footer-right h4{ margin:0 0 6px; color: var(--accent-2); font-weight:900; }
.footer-left p, .footer-right p{ margin:6px 0; color: rgba(255,255,255,0.8); font-weight:700; }
.footer-bottom{ margin-top:12px; text-align:center; color: rgba(255,255,255,0.6); font-size:12px; }

/* Footer small screen layout */
@media (max-width:520px){
  .footer-row{ flex-direction:column; gap:10px; }
}

/* ---------- TOAST / TEMP FEEDBACK (inline) ---------- */
.toast {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 14px;
  z-index: 1800;
  background: rgba(0,0,0,0.7);
  color: #fff;
  padding: 10px 14px;
  border-radius: 999px;
  font-weight:800;
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  display:none;
}
.toast.show{ display:block; animation: toast-in 320ms cubic-bezier(.2,.9,.3,1); }
@keyframes toast-in { from { opacity:0; transform: translateX(-50%) translateY(8px); } to { opacity:1; transform: translateX(-50%) translateY(0); } }

/* ---------- FORMS / INPUTS (if used in future) ---------- */
.input, input[type="text"], input[type="tel"], textarea {
  width:100%;
  padding:10px 12px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.04);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  color:#fff;
  font-weight:700;
  box-sizing: border-box;
}

/* ---------- SMALL POLISH: focus ring for keyboard users ---------- */
:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset:2px; border-radius:8px; }

/* ---------- PRINT & REDUCTION (if user prints) ---------- */
@media print {
  body * { visibility: hidden; }
  #cart-drawer, #cart-drawer * { visibility: visible; }
}
/* -------------------------
   Premium Mobile-First Footer
   Paste this after existing styles (overrides old .site-footer)
   ------------------------- */
.site-footer {
  width: 100%;
  max-width: 420px;
  margin: 18px auto 34px;
  box-sizing: border-box;
  padding: 14px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(18,18,18,0.98), rgba(8,8,8,0.95));
  border: 1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  color: #fff;
  font-weight: 700;
  -webkit-font-smoothing: antialiased;
}

/* Top callout */
.footer-top {
  display: flex;
  gap: 12px;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
}
.footer-brand {
  display:flex;
  gap:10px;
  align-items:center;
}
.footer-brand .logo-mark { font-size:14px; padding:6px 10px; border-radius:10px; }
.footer-brand .tagline { font-size:13px; color: rgba(255,255,255,0.88); font-weight:900; }

/* CTA group */
.footer-ctas { display:flex; gap:8px; align-items:center; }
.btn-footer {
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  font-weight:900;
  font-size:14px;
  border:0;
  cursor:pointer;
  -webkit-tap-highlight-color: transparent;
}
.btn-order {
  background: linear-gradient(90deg, var(--accent-1, #FF6A00), var(--accent-2, #FFD166));
  color:#111;
  box-shadow: 0 12px 36px rgba(255,106,0,0.12);
}
.btn-wa {
  background: rgba(255,255,255,0.03);
  color: var(--accent-2, #FFD166);
  border: 1px solid rgba(255,255,255,0.04);
}

/* Footer content layout */
.footer-grid {
  display:flex;
  gap:12px;
  margin-top:6px;
  align-items:flex-start;
  justify-content:space-between;
  flex-direction:column;
}
.footer-row {
  display:flex;
  gap:10px;
  align-items:flex-start;
  justify-content:space-between;
  width:100%;
}
.footer-left, .footer-right {
  width:100%;
}

/* contact list */
.contact-list { display:flex; flex-direction:column; gap:8px; margin-top:8px; }
.contact-row { display:flex; gap:10px; align-items:center; color: rgba(255,255,255,0.9); font-weight:800; font-size:14px; }
.contact-row i { color: var(--accent-2, #FFD166); min-width:22px; text-align:center; }

/* small meta blocks */
.meta-block { margin-top:12px; display:flex; gap:8px; align-items:center; justify-content:space-between; }
.meta-block .hours { color: rgba(255,255,255,0.85); font-weight:800; }
.meta-block .delivery { color: rgba(255,255,255,0.78); font-weight:700; font-size:14px; }

/* pickup / map small row */
.pickup {
  margin-top:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  padding:10px;
  border-radius:10px;
  border: 1px solid rgba(255,255,255,0.03);
  display:flex;
  align-items:center;
  gap:10px;
  color: rgba(255,255,255,0.88);
  font-weight:800;
  font-size:13px;
}

/* bottom legal line */
.footer-bottom {
  margin-top:12px;
  font-size:12px;
  color: rgba(255,255,255,0.6);
  text-align:center;
}

/* responsive layout — two columns on wider phones */
@media (min-width: 420px) {
  .footer-grid { flex-direction: row; }
  .footer-left, .footer-right { width: 50%; }
  .footer-top { gap: 18px; }
}

/* small accessibility */
.site-footer a { color: inherit; text-decoration: none; }
.site-footer button:focus, .site-footer a:focus { outline: 3px solid rgba(255,204,51,0.10); outline-offset: 3px; border-radius:10px; }
    
/* ---------- END of remaining UI styles ---------- */
</style>
</head>
<body>
  <!-- STICKY HEADER (mobile-first: only logo, cart with badge, hamburger) -->
  <header id="site-header" class="sticky-header" role="banner" aria-live="polite">
    <div class="header-inner">
      <!-- Logo (left) -->
      <div class="logo" aria-label="Wrap District logo">
        <span class="logo-mark">WRAP</span>
        <span class="logo-name">District</span>
      </div>

      <!-- Cart (center/right) -->
      <button id="cart-toggle" class="icon-btn cart-btn" aria-haspopup="dialog" aria-controls="cart-drawer" aria-label="Open cart">
        <i class="fa fa-shopping-cart" aria-hidden="true"></i>
        <span id="cart-count" class="cart-count" aria-live="polite">0</span>
      </button>

      <!-- Hamburger -->
      <button id="hamburger" class="icon-btn ham-btn" aria-expanded="false" aria-controls="mobile-nav" aria-label="Open menu">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </button>
    </div>
  </header>

  <!-- MOBILE NAV (off-canvas) -->
  <nav id="mobile-nav" class="mobile-nav" aria-hidden="true">
    <div class="mobile-nav-inner">
      <button id="nav-close" class="icon-btn" aria-label="Close menu"><i class="fa fa-times"></i></button>
      <ul class="nav-list">
        <li><a href="#hero" class="nav-link"><i class="fa fa-home"></i> Home</a></li>
        <li><a href="#menu" class="nav-link"><i class="fa fa-list"></i> Menu</a></li>
        <li><a href="#promo" class="nav-link"><i class="fa fa-bullhorn"></i> Promo</a></li>
        <li><a href="#contact" class="nav-link"><i class="fa fa-map-marker"></i> Contact</a></li>
      </ul>
    </div>
  </nav>

  <!-- HERO: Mobile-first slideshow with 3 slides -->
  <main id="main">
    <section id="hero" class="hero-slideshow" aria-roledescription="carousel" aria-label="Hero slideshow">
      <div class="slides" id="slides">
        <!-- Slide 1: Business introduction (wraps & brand) -->
        <article class="slide" data-slide-index="0" aria-hidden="false">
          <img class="slide-img" src="hero-shawarma-large.jpg" alt="Close up shawarma wrap">
          <div class="slide-overlay">
            <div class="slide-content">
              <p class="eyebrow"><i class="fa fa-fire"></i> Fresh & Hot</p>
              <h1 class="slide-title">Shawarma & Wraps — Made to Order</h1>
              <p class="slide-sub">Premium fillings, house sauces, and fast delivery to Tema Community 25.</p>
              <div class="slide-ctas">
                <a href="#menu" class="btn primary"><i class="fa fa-utensils"></i> See Menu</a>
                <button class="btn ghost" data-action="order-now" data-feature="shawarma"><i class="fa fa-phone"></i> Order via WhatsApp</button>
              </div>
              <!-- decorative icons/artwork -->
              <div class="slide-art">
                <i class="fa fa-leaf art-icon"></i>
                <i class="fa fa-star art-icon"></i>
              </div>
            </div>
          </div>
        </article>

        <!-- Slide 2: Business highlight (fries & rice) -->
        <article class="slide" data-slide-index="1" aria-hidden="true">
          <img class="slide-img" src="hero-fries-large.jpg" alt="Loaded fries">
          <div class="slide-overlay">
            <div class="slide-content">
              <p class="eyebrow"><i class="fa fa-thumbs-up"></i> Crowd Favorite</p>
              <h2 class="slide-title">Loaded Fries • Fried Rice • Angwamo</h2>
              <p class="slide-sub">Generous portions, tasty toppings, and affordable tiers.</p>
              <div class="slide-ctas">
                <a href="#menu" class="btn primary"><i class="fa fa-list-alt"></i> Explore Portions</a>
                <a href="#promo" class="btn ghost"><i class="fa fa-gift"></i> Current Deals</a>
              </div>
              <div class="slide-art">
                <i class="fa fa-bolt art-icon"></i>
                <i class="fa fa-heart art-icon"></i>
              </div>
            </div>
          </div>
        </article>

        <!-- Slide 3: Promo -->
        <article class="slide" data-slide-index="2" aria-hidden="true">
          <img class="slide-img" src="promo-shawarma.jpg" alt="Promo: buy 2 get 1">
          <div class="slide-overlay slide-promo">
            <div class="slide-content">
              <p class="eyebrow"><i class="fa fa-clock"></i> Limited Time</p>
              <h2 class="slide-title">Tuesday Promo — Buy 2 Shawarmas, Get 1 Free</h2>
              <p class="slide-sub">Loaded Fries come with a free Coke when ordered during promo hours.</p>

           <!-- inside your Slide 3 slide-content where promo-cta-row exists -->
<div class="promo-cta-row">
  <button class="btn primary" data-action="apply-promo" data-promo-code="TUES-B2G1">
    <i class="fa fa-tag"></i> Claim Promo
  </button>

  <button class="btn ghost" data-action="learn-more" aria-controls="promo-details">
    <i class="fa fa-info-circle"></i> Details
  </button>

  <!-- NEW: Preorder button for the upcoming promo -->
  <button class="btn primary" data-action="preorder-promo" id="promo-preorder-btn">
    <i class="fa fa-calendar-check"></i> Preorder for next promo
  </button>
</div>

              <div class="promo-urgency">
                <span class="promo-countdown" id="promo-countdown" aria-live="polite">Promo ends in: <strong id="promo-timer">—</strong></span>
                <small class="promo-note">Next promo: Tuesdays • Add 2 Shawarmas to auto-apply.</small>
              </div>
            </div>
          </div>
        </article>
      </div>

      <!-- slideshow controls -->
      <div class="slideshow-controls">
        <button class="slide-prev icon-btn" aria-label="Previous slide"><i class="fa fa-chevron-left"></i></button>
        <div id="slide-dots" class="slide-dots" role="tablist" aria-label="Slide dots">
          <button class="dot is-active" data-index="0" aria-label="Slide 1"></button>
          <button class="dot" data-index="1" aria-label="Slide 2"></button>
          <button class="dot" data-index="2" aria-label="Slide 3"></button>
        </div>
        <button class="slide-next icon-btn" aria-label="Next slide"><i class="fa fa-chevron-right"></i></button>
      </div>
    </section>

    <!-- MENU: mobile-friendly, card-based, not a long table -->
<!-- MENU: mobile-friendly, card-based, improved -->
<section id="menu" class="menu-section" aria-labelledby="menu-heading">
  <div class="container-small">
    <h2 id="menu-heading" class="section-title"><i class="fa fa-utensils"></i> Menu</h2>
    <p class="section-sub">Tap an item to configure size, protein and add-ons. Use the tabs to filter quickly.</p>

    <!-- Category tabs (mobile horizontal scroll) -->
    <div class="menu-tabs" role="tablist" aria-label="Menu categories">
      <button class="tab-btn is-active" data-cat="all" role="tab" aria-selected="true">All</button>
      <button class="tab-btn" data-cat="wraps" role="tab">Wraps</button>
      <button class="tab-btn" data-cat="fries" role="tab">Fries</button>
      <button class="tab-btn" data-cat="rice" role="tab">Rice</button>
      <button class="tab-btn" data-cat="angwamo" role="tab">Angwamo</button>
      <button class="tab-btn" data-cat="noodles" role="tab">Noodles</button>
    </div>

    <!-- visual container for menu items -->
    <div class="menu-container glass-card">
      <div class="menu-grid" id="menu-grid">
        <!-- Shawarma (structured pricing tiers) -->
        <article class="menu-item" id="item-shawarma" data-item-id="shawarma" data-category="wraps" data-promo="buy2get1" tabindex="0">
          <!-- ...same inner markup as before (keeps selects/addons) ... -->
          <div class="item-top">
            <img class="item-thumb" src="thumb-shawarma.jpg" alt="Shawarma thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Shawarma <span class="badge promo-badge">Buy 2 → 1 Free</span></h3>
              <p class="item-desc">Choose size, then protein. Clear pricing tiers.</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Size</label>
            <select class="select size-select" name="shawarma-size" aria-label="Shawarma size" data-item="shawarma">
              <option value="45" data-size-key="lite">Lite — GHC 45</option>
              <option value="55" data-size-key="classic">Classic — GHC 55</option>
              <option value="70" data-size-key="district-max">District Max — GHC 70</option>
            </select>

            <label class="label">Protein</label>
            <select class="select protein-select" name="shawarma-protein" aria-label="Shawarma protein" data-item="shawarma">
              <option value="0" data-protein="none">No meat (Veg) — +GHC 0</option>
              <option value="5" data-protein="chicken">Chicken — +GHC 5</option>
              <option value="10" data-protein="beef">Beef — +GHC 10</option>
              <option value="15" data-protein="mixed">Mixed — +GHC 15</option>
            </select>

            <div class="item-addons">
              <label class="label">Extras</label>
              <div class="addons-row">
                <label class="addon">
                  <input type="checkbox" class="addon-checkbox" value="5" data-addon-key="extra-sauce" />
                  <span>Extra Sauce (+GHC 5)</span>
                </label>
                <label class="addon">
                  <input type="checkbox" class="addon-checkbox" value="10" data-addon-key="cheese" />
                  <span>Extra Cheese (+GHC 10)</span>
                </label>
              </div>
            </div>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">45</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="shawarma">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="shawarma">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Loaded Fries -->
        <article class="menu-item" id="item-fries" data-item-id="loaded-fries" data-category="fries" data-promo="freecoke" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="thumb-fries.jpg" alt="Loaded fries thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Loaded Fries <span class="badge promo-badge-small">Free Coke</span></h3>
              <p class="item-desc">Choose portion & add protein/cheese.</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Portion</label>
            <select class="select portion-select" name="fries-portion" aria-label="Fries portion" data-item="loaded-fries">
              <option value="55" data-size="regular">Regular — GHC 55</option>
              <option value="65" data-size="large">Large — GHC 65</option>
            </select>

            <label class="label">Toppings</label>
            <div class="addons-row">
              <label class="addon">
                <input type="checkbox" class="addon-checkbox" value="15" data-addon-key="extra-chicken" />
                <span>Extra Chicken (+GHC 15)</span>
              </label>
              <label class="addon">
                <input type="checkbox" class="addon-checkbox" value="10" data-addon-key="extra-cheese" />
                <span>Extra Cheese (+GHC 10)</span>
              </label>
            </div>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">55</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="loaded-fries">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="loaded-fries">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Fried Rice -->
        <article class="menu-item" id="item-fried-rice" data-item-id="fried-rice" data-category="rice" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="hero-friedrice-large.jpg" alt="Fried rice thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Fried Rice</h3>
              <p class="item-desc">Classic spiced fried rice — choose protein.</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Choice</label>
            <select class="select protein-select" name="rice-protein" aria-label="Fried rice protein" data-item="fried-rice">
              <option value="60" data-protein="chicken">Classic (+Chicken) — GHC 60</option>
              <option value="60" data-protein="beef">Beef (+Beef) — GHC 60</option>
              <option value="60" data-protein="gizzard">Gizzard (+Gizzard) — GHC 60</option>
            </select>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">60</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="fried-rice">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="fried-rice">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Loaded Angwamo -->
        <article class="menu-item" id="item-angwamo" data-item-id="loaded-angwamo" data-category="angwamo" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="hero-angwamo-large.jpg" alt="Angwamo thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Loaded Angwamo</h3>
              <p class="item-desc">Tiered: Basic / Classic / Max</p>
            </div>
          </div>

          <div class="item-config">
            <label class="label">Tier</label>
            <select class="select tier-select" name="angwamo-tier" aria-label="Angwamo tier" data-item="loaded-angwamo">
              <option value="55" data-tier="basic">Basic — GHC 55</option>
              <option value="60" data-tier="classic">Classic — GHC 60</option>
              <option value="70" data-tier="max">Max — GHC 70</option>
            </select>

            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Total</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">55</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="loaded-angwamo">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="loaded-angwamo">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

        <!-- Noodles -->
        <article class="menu-item" id="item-noodles" data-item-id="noodles" data-category="noodles" tabindex="0">
          <div class="item-top">
            <img class="item-thumb" src="thumb-noodle.jpg" alt="Noodles thumbnail">
            <div class="item-meta">
              <h3 class="item-title">Noodles</h3>
              <p class="item-desc">Assorted proteins available — GHC 50</p>
            </div>
          </div>

          <div class="item-config">
            <div class="item-actions">
              <div class="price-row">
                <span class="price-label">Price</span>
                <strong class="item-price" data-price-display>GHC <span class="price-value">50</span></strong>
              </div>

              <div class="action-row">
                <button class="btn small add-btn" data-action="add" data-item-id="noodles">
                  <i class="fa fa-plus-circle"></i> Add
                </button>
                <button class="btn small remove-btn hidden" data-action="remove" data-item-id="noodles">
                  <i class="fa fa-minus-circle"></i> Remove
                </button>
              </div>
            </div>
          </div>
        </article>

      </div> <!-- .menu-grid -->
    </div> <!-- .menu-container -->
  </div>
</section>

    <!-- PROMO DETAILS (collapsible region referenced by the slide CTA) -->
    <section id="promo" class="promo-detail" aria-labelledby="promo-heading">
      <div class="container-small">
        <h2 id="promo-heading" class="section-title"><i class="fa fa-gift"></i> Promo</h2>
        <div id="promo-details" class="promo-copy">
          <p><strong>Buy 2 Shawarmas, Get 1 Free (Tuesdays)</strong> — Promo applies automatically at checkout. Add two qualifying shawarmas and the third will be discounted to free.</p>
          <p><strong>Loaded Fries</strong> — Get a free Coke when purchasing during promo hours. Free item will appear in cart once qualifying product is added.</p>
         <!-- somewhere inside #promo-details (promo-copy) -->
<div style="margin-top:10px;">
  <button class="btn primary" data-action="preorder-promo">Preorder for next Tuesday Promo</button>
</div>
          <div class="promo-help">
            <small id="promo-helper" class="muted">Tip: use the "Add missing items" button in cart to reach a promo threshold instantly.</small>
          </div>
        </div>
      </div>
    </section>

    <!-- CART DRAWER (off-canvas, mobile-friendly) -->
    <aside id="cart-drawer" class="cart-drawer" role="dialog" aria-label="Shopping cart" aria-hidden="true">
      <div class="cart-header">
        <h3>Your Cart <span class="cart-mini-count" id="cart-mini-count">0</span></h3>
        <button class="icon-btn" id="cart-close" aria-label="Close cart"><i class="fa fa-times"></i></button>
      </div>

      <div class="cart-body" id="cart-body">
        <!-- line items will be injected here by JS -->
        <ul id="cart-items" class="cart-items" aria-live="polite"></ul>

        <!-- promo helper / discount line -->
        <div id="cart-promo" class="cart-promo hidden" aria-live="polite">
          <div class="promo-applied">
            <span class="promo-label">Promo discount</span>
            <span class="promo-value" id="promo-discount">-GHC 0</span>
          </div>
          <div class="promo-cta">
            <small id="promo-help-text">Add 1 more Shawarma to get one free.</small>
            <button class="btn tiny" id="add-missing">Add missing items</button>
          </div>
        </div>

        <div class="cart-summary">
          <div class="summary-row">
            <span>Subtotal</span>
            <strong id="cart-subtotal">GHC 0</strong>
          </div>
          <div class="summary-row">
            <span>Delivery</span>
            <strong id="cart-delivery">GHC 0</strong>
          </div>
          <div class="summary-row total">
            <span>Total</span>
            <strong id="cart-total">GHC 0</strong>
          </div>
        </div>
      </div>

      <div class="cart-footer">
  <div class="footer-summary" style="display: none">
    <div>
      <div class="small">Subtotal</div>
      <div class="total-label">Total</div>
    </div>
    <div style="margin-left:auto; text-align:right;">
      <div id="footer-subtotal" class="small">GHC 0</div>
      <div id="footer-total" class="total-value">GHC 0</div>
    </div>
  </div>

  <div class="footer-actions" style="margin-left:12px;">
   <button id="checkout-btn" type="button" class="btn primary" data-action="checkout" style="min-width:120px;">
  <i class="fa fa-credit-card"></i> Pay
</button>
    <button id="clear-cart" class="btn ghost" data-action="clear" style="min-width:80px;">
      <i class="fa fa-trash"></i>
    </button>
  </div>
</div>
    </aside>

    <!-- ENTRY PROMO MODAL / SLIDE-IN for new visitors -->
    <div id="entry-promo" class="entry-promo modal hidden" role="dialog" aria-modal="true" aria-label="Tuesday Promo">
      <div class="modal-inner">
        <button id="entry-close" class="icon-btn modal-close" aria-label="Close promo"><i class="fa fa-times"></i></button>
        <div class="modal-body">
          <h3><i class="fa fa-gift"></i> Tuesday Promo</h3>
          <p class="lead">Buy 2 Shawarmas, get one free. Valid Tuesdays. Tap to claim now.</p>
          <div class="modal-actions">
            <button class="btn primary" id="claim-promo-entry" data-promo="TUES-B2G1"><i class="fa fa-tag"></i> Claim Promo</button>
            <label class="dont-show">
              <input type="checkbox" id="dont-show-again" />
              Don't show again
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- CONTACT / FOOTER -->
<footer id="contact" class="site-footer" role="contentinfo" aria-label="Contact and footer">
  <div class="footer-top">
    <div class="footer-brand" aria-hidden="false">
      <span class="logo-mark">WRAP</span>
      <div style="display:flex;flex-direction:column;">
        <span class="logo-name" style="font-weight:900; color:var(--accent-2)">District</span>
        <small class="tagline">Fresh. Hot. Fast — Delivered to Tema</small>
      </div>
    </div>

    <div class="footer-ctas" role="group" aria-label="Footer actions">
      <!-- Order: scrolls to menu / opens cart -->
      <button id="footer-order" class="btn-footer btn-order" aria-label="Order now">
        <i class="fa fa-utensils" aria-hidden="true"></i> Order
      </button>

      <!-- WhatsApp quick contact -->
      <a id="footer-wa" class="btn-footer btn-wa" href="https://wa.me/233552509241" target="_blank" rel="noopener noreferrer" aria-label="Chat on WhatsApp">
        <i class="fa fa-whatsapp" aria-hidden="true"></i> WhatsApp
      </a>
    </div>
  </div>

  <div class="footer-grid">
    <div class="footer-left">
      <div class="contact-list">
        <div class="contact-row"><i class="fa fa-phone"></i><a href="tel:0552509241">0552509241</a></div>
        <div class="contact-row"><i class="fa fa-map-marker"></i><span>Tema Community 25, Devtraco</span></div>
        <div class="contact-row"><i class="fa fa-snapchat-ghost"></i><span>@kenneth_idk</span></div>
      </div>

      <div class="pickup" aria-hidden="false">
        <i class="fa fa-store"></i>
        <div style="flex:1;">
          <div style="font-weight:900">Pickup available</div>
          <small style="color:rgba(255,255,255,0.78)">Devtraco — Tap Order to choose Pickup or Delivery</small>
        </div>
      </div>
    </div>

    <div class="footer-right">
      <div class="meta-block">
        <div class="hours"><i class="fa fa-clock"></i>&nbsp; Hours</div>
        <div style="text-align:right">
          <div style="font-weight:900">Mon–Fri: 5pm • Sat–Sun: 9am</div>
          <div class="delivery" style="margin-top:4px">Delivery: Available — fees at checkout</div>
        </div>
      </div>

      <div style="margin-top:10px">
        <button id="footer-locate" class="btn-footer btn-wa" aria-label="Show pickup location">
          <i class="fa fa-map"></i> Our location
        </button>
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    <small>© Wrap District — Built for mobile • Images and prices subject to change</small>
  </div>
</footer>
    <!-- PREORDER MODAL -->
<div id="preorder-modal" class="modal" role="dialog" style ="display: none" aria-modal="true" aria-hidden="true">
  <div class="modal-inner">
    <button class="icon-btn modal-close" id="preorder-close" aria-label="Close"><i class="fa fa-times"></i></button>
    <div class="modal-body">
      <h3><i class="fa fa-calendar-plus"></i> Preorder for next Promo</h3>
      <p class="lead">We will reserve your current cart items for the next Tuesday promo window.</p>

      <form id="preorder-form">
        <label class="label">Name</label>
        <input id="preorder-name" class="input" type="text" placeholder="Your name" required>

        <label class="label">Phone</label>
        <input id="preorder-phone" class="input" type="tel" placeholder="0550xxxxxx" required>

        <label class="label">Note (optional)</label>
        <input id="preorder-note" class="input" type="text" placeholder="Delivery/pickup notes">

        <div style="display:flex; gap:8px; margin-top:10px;">
          <button type="submit" class="btn primary" id="preorder-confirm"><i class="fa fa-check"></i> Confirm Preorder</button>
          <button type="button" class="btn ghost" id="preorder-cancel">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>
  </main>
  <!-- ===== Menu tabs + Cart header checkout enhancements ===== -->
<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    // Order button: prefer opening cart if it has items, else scroll to menu
    const orderBtn = document.getElementById('footer-order');
    const menuAnchor = document.getElementById('menu');
    const cartToggle = document.getElementById('cart-toggle');

    orderBtn && orderBtn.addEventListener('click', function(e){
      // If there's a cart with items, open drawer; otherwise scroll to menu
      try {
        const cartCount = Number((document.getElementById('cart-count')||{}).innerText) || 0;
        if (cartCount > 0 && cartToggle) {
          cartToggle.click();
        } else if (menuAnchor) {
          menuAnchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
        } else {
          window.location.hash = '#menu';
        }
      } catch(err) {
        if (menuAnchor) menuAnchor.scrollIntoView({ behavior: 'smooth' });
      }
    });

    // Our location - open checkout map modal if present (map modal id #map-modal)
    const locBtn = document.getElementById('footer-locate');
  locBtn && locBtn.addEventListener('click', function(){
     const contact = document.getElementById('contact');
     if (contact) contact.scrollIntoView({ behavior: 'smooth' });
     else window.location.hash = '#contact';
   });

    // small accessibility: ensure links open new tab for external glances
    const wa = document.getElementById('footer-wa');
    if (wa) wa.setAttribute('rel','noopener noreferrer');
  });
})();
</script>
  <script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    const mobileNav = document.getElementById('mobile-nav');
    const hamburger = document.getElementById('hamburger');
    const navCloseBtn = document.getElementById('nav-close');

    if (!mobileNav) return;

    // Helper to close nav (keeps ARIA + visual in sync)
    function closeMobileNav() {
      mobileNav.style.display = 'none';
      mobileNav.setAttribute('aria-hidden', 'true');
      if (hamburger) hamburger.setAttribute('aria-expanded', 'false');
      // return focus to hamburger for keyboard users
      try { hamburger && hamburger.focus(); } catch(e){}
      // restore page scroll if other scripts toggled it
      try { document.body.style.overflow = ''; } catch(e){}
    }

    // Attach handler to each nav link inside mobile nav
    const navLinks = Array.from(mobileNav.querySelectorAll('a.nav-link, .nav-list a'));
    navLinks.forEach(link => {
      link.addEventListener('click', function(e){
        // Close menu immediately (visual)
        closeMobileNav();

        // If it's an internal anchor, do smooth scroll to target instead of default jump
        const href = (link.getAttribute('href') || '').trim();
        if (href && href.startsWith('#')) {
          const target = document.querySelector(href);
          if (target) {
            // prevent default jump (we already closed nav)
            e.preventDefault();
            // small delay so closing animation (if any) feels natural
            setTimeout(() => {
              target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 120);
          }
        }
      }, { passive: true });
    });

    // Also ensure the "close" button and Escape key work (safe fallback)
    navCloseBtn && navCloseBtn.addEventListener('click', closeMobileNav);
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && mobileNav.getAttribute('aria-hidden') === 'false') closeMobileNav();
    });

    // If other scripts toggle nav by setting aria-hidden/display, keep state consistent when opening:
    // (optional convenience) when hamburger opens, ensure mobileNav is focusable
    if (hamburger) {
      hamburger.addEventListener('click', () => {
        const expanded = hamburger.getAttribute('aria-expanded') === 'true';
        // If it becomes open (expanded true), ensure mobileNav is visible and focusable
        setTimeout(() => {
          if (hamburger.getAttribute('aria-expanded') === 'true') {
            mobileNav.style.display = 'block';
            mobileNav.setAttribute('aria-hidden', 'false');
            mobileNav.setAttribute('tabindex','-1');
            try { mobileNav.focus(); } catch(e){}
          }
        }, 60);
      });
    }
  });
})();
</script>
  <style>
/* Checkout page (in-file, not a modal) — REPLACED: ensures it sits below the header and is scrollable on mobile */
#checkout-page {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 3200;
  background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));
  /* place checkout below the fixed header so it doesn't get overlapped by browser UI */
  align-items: flex-start;
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
  /* allow the page container itself to scroll if content taller than viewport */
  overflow: auto;
}
#checkout-page[aria-hidden="false"] { display: flex; }

/* keep the inner dialog visually below the header and inside safe area */
#checkout-inner {
  width: 100%;
  max-width: 920px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  background: linear-gradient(180deg,#080808,#050505);
  color: #fff;
  display: grid;
  grid-template-columns: 1fr 360px;
  gap: 0;
  /* push the dialog down so it appears like a page below your header + safe-area */
  margin-top: calc(56px + var(--safe-top, 12px) + 12px);
  /* keep the dialog height bounded so inner columns can scroll independently */
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 48px));
}
@media (max-width: 900px) { #checkout-inner { grid-template-columns: 1fr; } }

/* left and right columns should scroll individually */
.checkout-left {
  padding: 16px 18px;
  max-height: 100%;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
}
.checkout-right {
  padding: 16px 18px;
  border-left: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  overflow: auto;
  max-height: 100%;
  -webkit-overflow-scrolling: touch;
}

/* small banner to highlight delivery-not-included message (style used by script) */
#checkout-delivery-note {
  display: block;
  margin-top: 8px;
  padding: 10px 12px;
  border-radius: 10px;
  background: linear-gradient(90deg, rgba(255,160,80,0.06), rgba(255,255,255,0.01));
  border: 1px solid rgba(255,160,80,0.08);
  color: rgba(255,255,255,0.9);
  font-weight:800;
  font-size:13px;
}

/* small responsive tweaks */
@media (max-width:600px){
  .checkout-right { padding-top:6px; }
  .order-line img { width:56px; height:44px; }
  .checkout-title { font-size:16px; }
}
</style>
  <style>
/* header right area inside cart header */
.cart-header .cart-header-right {
  display:flex;
  align-items:center;
  gap:10px;
  margin-left:auto;
}
.cart-header .cart-header-total {
  font-weight:900;
  color: var(--accent-2);
  font-size:14px;
  text-align:right;
  min-width:80px;
}
.cart-header .cart-header-checkout {
  border:0;
  background: linear-gradient(90deg,var(--accent-1),var(--accent-2));
  color:#111;
  font-weight:900;
  padding:8px 10px;
  border-radius:10px;
  display:inline-flex;
  gap:8px;
  align-items:center;
  cursor:pointer;
  box-shadow: 0 8px 26px rgba(255,106,0,0.10);
}
.cart-header .cart-header-checkout:active { transform: translateY(1px) scale(.995); }
.tab-btn[role="tab"] { cursor:pointer; }
</style>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    /* ---------- 1) Menu-tabs: filter behaviour ---------- */
    const tabButtons = Array.from(document.querySelectorAll('.menu-tabs .tab-btn'));
    const menuItems = Array.from(document.querySelectorAll('.menu-item'));

    function applyTabFilter(cat) {
      // cat is the data-cat value (e.g. "wraps" or "all")
      menuItems.forEach(item => {
        const itemCat = (item.dataset.category || '').toLowerCase();
        if (!cat || cat === 'all') {
          item.style.display = ''; // show
          item.setAttribute('aria-hidden','false');
        } else {
          // show when itemCat matches or contains cat
          const show = itemCat.split(' ').some(c => c === cat) || itemCat === cat;
          item.style.display = show ? '' : 'none';
          item.setAttribute('aria-hidden', show ? 'false' : 'true');
        }
      });
    }

    function setActiveTab(btn) {
      tabButtons.forEach(b => {
        const is = b === btn;
        b.classList.toggle('is-active', is);
        b.setAttribute('aria-selected', String(is));
        if (is) b.focus && b.focus();
      });
    }

    tabButtons.forEach(btn => {
      // Ensure accessible attributes present
      if (!btn.hasAttribute('role')) btn.setAttribute('role','tab');
      if (!btn.hasAttribute('tabindex')) btn.setAttribute('tabindex','0');

      btn.addEventListener('click', (e) => {
        const cat = (btn.dataset.cat || '').toLowerCase();
        setActiveTab(btn);
        applyTabFilter(cat);
      });

      // keyboard support: Enter / Space
      btn.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        }
      });
    });

    // initialize: find active tab or default to first
    const initial = tabButtons.find(b => b.classList.contains('is-active')) || tabButtons[0];
    if (initial) {
      setActiveTab(initial);
      applyTabFilter((initial.dataset.cat || 'all').toLowerCase());
    }

    /* ---------- 2) Cart header: add total + checkout button ---------- */
    const cartHeader = document.querySelector('.cart-header');
    if (cartHeader && !cartHeader.querySelector('.cart-header-right')) {
      // create container
      const headerRight = document.createElement('div');
      headerRight.className = 'cart-header-right';

      // total display
      const totalWrap = document.createElement('div');
      totalWrap.className = 'cart-header-total';
      totalWrap.id = 'cart-header-total';
      totalWrap.innerText = 'GHC 0';

      // checkout button
      const headerCheckout = document.createElement('button');
      headerCheckout.className = 'cart-header-checkout';
      headerCheckout.id = 'cart-header-checkout';
      headerCheckout.type = 'button';
      headerCheckout.setAttribute('aria-label', 'Checkout and pay');
      headerCheckout.innerHTML = '<i class="fa fa-credit-card" aria-hidden="true"></i> Checkout';

      headerRight.appendChild(totalWrap);
      headerRight.appendChild(headerCheckout);

      cartHeader.appendChild(headerRight);

      // wire checkout click to existing footer checkout (preferred)
      headerCheckout.addEventListener('click', () => {
        // try to reuse modal: if #checkout-btn exists -> trigger click
        const footerCheckout = document.getElementById('checkout-btn');
        if (footerCheckout) {
          footerCheckout.click(); // will open checkout modal already wired
        } else if (typeof window.openCheckoutModal === 'function') {
          window.openCheckoutModal(); // fallback if we exposed it earlier
        } else {
          // fallback: simulate click on modal opener if present
          const alt = document.querySelector('[data-action="checkout"], [data-action="pay"]');
          if (alt) alt.click();
          else alert('Checkout not available. Please use the Pay button.');
        }
      });
    }

    // Sync header total with computeCartTotals or with #cart-total element
    const headerTotalEl = document.getElementById('cart-header-total');
    const cartTotalEl = document.getElementById('cart-total');
    const cartSubtotalEl = document.getElementById('cart-subtotal');

    function syncHeaderTotal() {
      try {
        // Prefer computeCartTotals if available (accurate), otherwise read #cart-total text
        if (typeof computeCartTotals === 'function') {
          const t = computeCartTotals();
          if (t && typeof t.total !== 'undefined') {
            headerTotalEl.innerText = `GHC ${Math.round(t.total)}`;
            return;
          }
        }
        if (cartTotalEl && cartTotalEl.innerText) {
          headerTotalEl.innerText = cartTotalEl.innerText;
        } else if (cartSubtotalEl && cartSubtotalEl.innerText) {
          headerTotalEl.innerText = cartSubtotalEl.innerText;
        }
      } catch (err) { /* ignore */ }
    }

    // Observe changes to cart totals (watch #cart-total and #cart-subtotal)
    const targets = [];
    if (cartTotalEl) targets.push(cartTotalEl);
    if (cartSubtotalEl) targets.push(cartSubtotalEl);

    if (targets.length) {
      const mo = new MutationObserver(syncHeaderTotal);
      targets.forEach(t => mo.observe(t, { childList:true, subtree:true, characterData:true }));
      // call once now
      syncHeaderTotal();
    } else {
      // fallback: poll every 700ms
      syncHeaderTotal();
      setInterval(syncHeaderTotal, 700);
    }

    // Also update when renderCart() is called by hooking into the global renderCart if present
    // (non-invasive override: wrap existing renderCart to call syncHeaderTotal after)
    if (typeof window.renderCart === 'function') {
      const originalRenderCart = window.renderCart;
      window.renderCart = function() {
        const result = originalRenderCart.apply(this, arguments);
        try { syncHeaderTotal(); } catch(e){/*ignore*/ }
        return result;
      };
    } else {
      // If renderCart is defined as local function (not on window), we can't wrap it — rely on MutationObserver/polling.
    }

  });
})();
</script>
<!-- Product detail modal (Task 2) -->
<style>
/* Basic modal sizing tweaks (uses existing .modal/.modal-inner from your CSS) */
#product-modal .modal-inner { max-width:520px; width:100%; padding:0; border-radius:14px; overflow:hidden; }
#product-modal .pm-header{ display:flex; gap:12px; padding:12px; align-items:center; background:linear-gradient(180deg, rgba(10,10,10,0.98), rgba(6,6,6,0.98)); border-bottom:1px solid rgba(255,255,255,0.03);}
#product-modal .pm-thumb{ width:110px; height:86px; object-fit:cover; border-radius:10px; flex: 0 0 110px; border:1px solid rgba(255,255,255,0.04); }
#product-modal .pm-title{ font-weight:900; color:#fff; font-size:16px; margin:0; }
#product-modal .pm-body{ padding:12px; max-height:60vh; overflow:auto; background: linear-gradient(180deg, rgba(12,12,12,0.98), rgba(8,8,8,0.98)); }
#product-modal .pm-footer{ display:flex; gap:8px; align-items:center; justify-content:space-between; padding:12px; border-top:1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(8,8,8,0.98), rgba(6,6,6,0.98)); }
#product-modal .pm-price{ font-weight:900; color:var(--accent-2); font-size:18px; }
#product-modal .pm-actions .btn{ min-width:120px; }
</style>

<!-- modal skeleton -->
<div id="product-modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true" style="display:none;">
  <div class="modal-inner">
    <button class="icon-btn modal-close" id="pm-close" aria-label="Close"><i class="fa fa-times"></i></button>
    <div class="pm-header">
      <img src="" alt="" class="pm-thumb" id="pm-thumb">
      <div style="flex:1; min-width:0">
        <h3 class="pm-title" id="pm-title"></h3>
        <div class="small muted" id="pm-desc"></div>
      </div>
    </div>
    <div class="pm-body" id="pm-body">
      <!-- cloned .item-config will be inserted here -->
    </div>
    <div class="pm-footer">
      <div class="pm-price" id="pm-price">GHC 0</div>
      <div class="pm-actions">
        <button id="pm-add" class="btn primary"><i class="fa fa-plus-circle"></i> Add to cart</button>
        <button id="pm-cancel" class="btn ghost">Cancel</button>
      </div>
    </div>
  </div>
</div>
<!-- ========== PAYSTACK FRONTEND: Checkout modal, handlers, InlineJS ========== -->
<!-- InlineJS CDN (Popup V2) - required for resumeTransaction() -->
<script src="https://js.paystack.co/v2/inline.js"></script>

<!-- ======= Enhanced Checkout + Map Picker (paste before </body>) ======= -->

<!-- Leaflet (Map) CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
/* Checkout modal (full form) */
#checkout-full-modal { display:none; position:fixed; inset:0; z-index:3000; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; padding:12px; }
#checkout-full-modal[aria-hidden="false"] { display:flex; }
.checkout-full-inner { width:100%; max-width:720px; border-radius:12px; background:linear-gradient(180deg,#0b0b0b,#070707); border:1px solid rgba(255,255,255,0.04); box-shadow:0 40px 120px rgba(0,0,0,0.7); color:#fff; padding:0; overflow:hidden; display:grid; grid-template-columns: 1fr 360px; gap:0; }
@media (max-width:900px) { .checkout-full-inner { grid-template-columns: 1fr; } }

.checkout-left { padding:16px 18px; }
.checkout-right { padding:16px 18px; border-left:1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); overflow:auto; max-height: 82vh; }

.checkout-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.checkout-title { color:var(--accent-2); font-weight:900; font-size:18px; margin:0; }

.form-row { display:flex; gap:8px; margin-bottom:10px; }
.form-col { flex:1; display:flex; flex-direction:column; gap:6px; }
.input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; font-weight:800; box-sizing:border-box; }
.input[readonly] { cursor:pointer; background: rgba(255,255,255,0.01); }
.small-muted { color: rgba(255,255,255,0.72); font-size:13px; }

.order-line { display:flex; gap:8px; align-items:center; margin-bottom:10px; }
.order-line img { width:64px; height:48px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
.order-line .ol-meta { flex:1; min-width:0; }
.order-line .ol-meta strong { display:block; font-weight:900; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.order-line .ol-meta small { color: rgba(255,255,255,0.75); }
.order-line .ol-price { font-weight:900; color:var(--accent-2); min-width:70px; text-align:right; }

.checkout-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:12px; }
.btn.full { padding:12px 16px; border-radius:12px; font-weight:900; min-width:140px; }
.btn.primary.full { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#111; border:0; box-shadow: 0 12px 36px rgba(255,106,0,0.12); }

/* Map modal */
#map-modal { display:none; position:fixed; inset:0; z-index:3600; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; padding:8px; }
#map-modal[aria-hidden="false"] { display:flex; }
.map-inner { width:100%; max-width:920px; height:78vh; border-radius:12px; overflow:hidden; background:#fff; display:flex; flex-direction:column; }
.map-top { display:flex; gap:8px; padding:8px; align-items:center; background:#fff; border-bottom:1px solid #eee; }
.map-search { flex:1; padding:8px 12px; border-radius:8px; border:1px solid #ddd; }
#map { flex:1; }
.map-results { max-height:160px; overflow:auto; background:#fff; border-top:1px solid #eee; }
.map-result { padding:8px 10px; border-bottom:1px solid #f1f1f1; cursor:pointer; }
.map-result:hover { background:#f7f7f7; }

.map-actions { display:flex; gap:10px; padding:8px; justify-content:flex-end; background:#fff; border-top:1px solid #eee; }

.toast.wrap-toast { position:fixed; left:50%; transform:translateX(-50%); bottom:18px; z-index:4000; background:rgba(0,0,0,0.85); color:#fff; padding:10px 14px; border-radius:999px; font-weight:800; display:none; }
.toast.wrap-toast.show { display:block; animation: toast-in 320ms cubic-bezier(.2,.9,.3,1); }

  /* ========== Cart icon & badge styles ========== */
.cart-icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 8px 10px;
  border-radius: 10px;
  cursor: pointer;
  background: transparent;
  border: none;
  position: relative;
  font: inherit;
  color: inherit;
}

.cart-icon-btn:focus { outline: 2px solid rgba(0,0,0,0.12); outline-offset: 2px; }

.cart-icon-svg { width: 20px; height: 20px; display:block; }

.cart-badge {
  position: absolute;
  top: 4px;
  right: 4px;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 700;
  line-height: 18px;
  text-align: center;
  background: var(--gold-500, #FFBF00);
  color: #000;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
  transform-origin: center;
  transition: transform .18s cubic-bezier(.2,.9,.3,1);
  will-change: transform;
  pointer-events: none;
}

/* small pulse when count changes */
.cart-badge.pulse {
  transform: scale(1.22);
}

/* small responsive adjustments */
@media (max-width: 640px) {
  .cart-icon-btn { padding: 6px; border-radius: 8px; }
  .cart-icon-svg { width: 18px; height: 18px; }
  .cart-badge { top: 3px; right: 3px; min-width:16px; height:16px; font-size:10px; line-height:16px; }
}
/* ========== Responsive media: drop-in ========== */
/* Root responsive variables (safe to override) */
:root{
  --hero-padding-lg: 64px;
  --hero-padding-md: 40px;
  --hero-padding-sm: 20px;
  --hero-gap-lg: 36px;
  --hero-gap-sm: 18px;
  --hero-max-width: 1200px;
  --panel-radius: 14px;
}

/* Smooth responsive type that scales between min and max */
.hero-title {
  font-size: clamp(1.6rem, 4vw, 2.6rem); /* adjust to taste */
  line-height: 1.05;
  margin: 0 0 0.6rem 0;
}
.hero-subtitle {
  font-size: clamp(1rem, 2.2vw, 1.125rem);
  line-height: 1.4;
  margin: 0 0 1rem 0;
}

/* Hero container (desktop behavior: side-by-side) */
.hero {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--hero-gap-lg);
  padding: var(--hero-padding-lg);
  max-width: var(--hero-max-width);
  margin: 0 auto;
  box-sizing: border-box;
}

/* hero content + image blocks */
.hero .hero-content { flex: 1 1 48%; min-width: 280px; }
.hero .hero-media   { flex: 1 1 48%; min-width: 250px; display:flex; align-items:center; justify-content:center; }

/* ensure images scale well */
.hero .hero-media img, .hero .hero-media video {
  max-width: 100%;
  height: auto;
  display:block;
  border-radius: 12px;
  object-fit: cover;
}

/* Call-to-action styling (keeps nice tappable area on mobile) */
.hero .cta {
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding: 12px 18px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 1rem;
  white-space: nowrap;
}

/* Prevent overflow of long copy/buttons */
.hero * { word-break: break-word; }

/* Modal / drawer baseline */
.modal,
.drawer {
  position: fixed;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 1200;
}
.modal.open,
.drawer.open {
  display: flex;
}
.modal .modal-content,
.drawer .drawer-content {
  width: min(720px, 96%);
  max-height: calc(100vh - 48px);
  overflow: auto;
  border-radius: var(--panel-radius);
  padding: 20px;
  box-sizing: border-box;
  background: var(--panel, rgba(255,255,255,0.02));
  -webkit-overflow-scrolling: touch;
}

/* modal close button */
.modal .close, .drawer .close {
  position: absolute;
  right: 12px;
  top: 12px;
  background: transparent;
  border: none;
  font-size: 18px;
  padding: 8px;
  border-radius: 8px;
}

/* cart icon adjustments (mobile) */
.cart-icon-btn {
  padding: 8px;
  border-radius: 10px;
  font-size: 15px;
}
.cart-badge {
  min-width: 18px;
  height: 18px;
  font-size: 11px;
  line-height: 18px;
  top: 4px;
  right: 4px;
}

/* ===== Breakpoints ===== */
/* Medium tablets / small laptops */
@media (max-width: 900px) {
  .hero {
    padding: var(--hero-padding-md);
    gap: calc(var(--hero-gap-lg) * 0.7);
  }
  .hero .hero-content { padding-right: 12px; }
  .hero .hero-media   { padding-left: 12px; }
  .hero-title { font-size: clamp(1.5rem, 5vw, 2.2rem); }
}

/* Mobile phones: keep layout, just scale down and stack if necessary */
@media (max-width: 640px) {
  .hero {
    /* keep same order visually but stack - looks like desktop but scaled */
    flex-direction: column-reverse; /* image below content — preserves visual flow on narrow screens */
    align-items: stretch;
    gap: var(--hero-gap-sm);
    padding: var(--hero-padding-sm);
  }

  /* make the hero look exactly like desktop but smaller:
     - reduce gaps/paddings, shrink image & text proportionally */
  .hero .hero-content,
  .hero .hero-media {
    flex: 0 0 auto;
    width: 100%;
  }

  .hero .hero-media img {
    border-radius: 10px;
    max-height: 42vw; /* keeps images from dominating on tall phones */
    width: 100%;
    object-fit: cover;
  }

  .hero .cta {
    width: 100%;
    justify-content: center;
    padding: 12px;
    font-size: 1rem;
    border-radius: 10px;
  }

  /* keep the cart in the header but smaller and tappable */
  .cart-icon-btn {
    padding: 6px;
    border-radius: 8px;
  }
  .cart-badge { top: 6px; right: 6px; min-width: 16px; height: 16px; font-size: 10px; }

  /* modals: full-screen friendly on mobile */
  .modal .modal-content,
  .drawer .drawer-content {
    width: 100%;
    max-height: 100vh;
    height: 100%;
    border-radius: 0;
    padding: calc(env(safe-area-inset-top) + 16px) 16px calc(env(safe-area-inset-bottom) + 20px);
    align-self: flex-end;
  }

  /* ensure body isn't pushed by fixed items */
  html, body { height: 100%; min-height: 100%; }
}

/* Extra small phones */
@media (max-width: 420px) {
  .hero-title { font-size: clamp(1.25rem, 5.5vw, 1.8rem); }
  .hero-subtitle { font-size: clamp(.95rem, 3.8vw, 1.0rem); }
  .hero { padding-left: 14px; padding-right: 14px; }
  .hero .hero-media img { max-height: 48vw; }
}

/* Accessibility: trap focus visually for modals */
.modal[aria-hidden="false"] { display:flex; }

</style>



  <script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    // find cart header
    const cartHeader = document.querySelector('.cart-header');
    if (!cartHeader) return;

    // avoid adding twice
    if (!cartHeader.querySelector('.cart-header-right')) {
      const headerRight = document.createElement('div');
      headerRight.className = 'cart-header-right';

      const totalWrap = document.createElement('div');
      totalWrap.className = 'cart-header-total';
      totalWrap.id = 'cart-header-total';
      totalWrap.innerText = 'GHC 0';

      const headerCheckout = document.createElement('button');
      headerCheckout.className = 'cart-header-checkout';
      headerCheckout.id = 'cart-header-checkout';
      headerCheckout.type = 'button';
      headerCheckout.setAttribute('aria-label', 'Checkout and pay');
      headerCheckout.innerHTML = '<i class="fa fa-credit-card" aria-hidden="true"></i> Checkout';

      headerRight.appendChild(totalWrap);
      headerRight.appendChild(headerCheckout);
      cartHeader.appendChild(headerRight);
    }

    // wire header checkout to existing footer checkout or to checkout modal opener
    const headerCheckoutBtn = document.getElementById('cart-header-checkout');
    const footerCheckoutBtn = document.getElementById('checkout-btn');

    headerCheckoutBtn && headerCheckoutBtn.addEventListener('click', (e) => {
      e.preventDefault();
      // prefer the footer checkout button (keeps single handler)
      if (footerCheckoutBtn) {
        footerCheckoutBtn.click();
        return;
      }
      // fallback: click any element that looks like a checkout opener
      const alt = document.querySelector('[data-action="checkout"], [data-action="pay"], #cf-submit');
      if (alt) { alt.click(); return; }
      // as last resort call openCheckoutFull if it's available
      if (typeof openCheckoutFull === 'function') {
        openCheckoutFull();
      } else {
        alert('Checkout is not available. Please use the Pay button.');
      }
    });

    // sync header total with main cart totals
    const headerTotalEl = document.getElementById('cart-header-total');
    const cartTotalEl = document.getElementById('cart-total');
    const cartSubtotalEl = document.getElementById('cart-subtotal');

    function syncHeaderTotal() {
      try {
        // prefer computeCartTotals if available
        if (typeof computeCartTotals === 'function') {
          const t = computeCartTotals();
          if (t && typeof t.total !== 'undefined') {
            headerTotalEl.innerText = `GHC ${Math.round(t.total)}`;
            return;
          }
        }
        // else read DOM totals
        if (cartTotalEl && cartTotalEl.innerText) {
          headerTotalEl.innerText = cartTotalEl.innerText;
        } else if (cartSubtotalEl && cartSubtotalEl.innerText) {
          headerTotalEl.innerText = cartSubtotalEl.innerText;
        } else {
          headerTotalEl.innerText = 'GHC 0';
        }
      } catch (err) {
        // ignore
      }
    }

    // Observe DOM changes on totals if present
    const observeTargets = [];
    if (cartTotalEl) observeTargets.push(cartTotalEl);
    if (cartSubtotalEl) observeTargets.push(cartSubtotalEl);

    if (observeTargets.length) {
      const mo = new MutationObserver(syncHeaderTotal);
      observeTargets.forEach(t => mo.observe(t, { childList:true, subtree:true, characterData:true }));
      syncHeaderTotal();
    } else {
      // fallback to polling
      syncHeaderTotal();
      setInterval(syncHeaderTotal, 700);
    }

    // If your renderCart is a global function, wrap it to call syncHeaderTotal after rendering
    if (typeof window.renderCart === 'function' && !window.__wrapped_renderCart_for_header_total) {
      window.__wrapped_renderCart_for_header_total = true;
      const orig = window.renderCart;
      window.renderCart = function() {
        const r = orig.apply(this, arguments);
        try { syncHeaderTotal(); } catch(e){}
        return r;
      };
    }
  });
})();
</script>
<!-- ===== In-page Checkout Section (Task 3) ===== -->
<style>
/* Checkout page (in-file, not a modal) */
#checkout-page { display: none; position: fixed; inset: 0; z-index: 3200; background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6)); align-items: center; justify-content: center; padding: 12px; box-sizing: border-box; }
#checkout-page[aria-hidden="false"] { display: flex; }
#checkout-inner { width: 100%; max-width: 920px; border-radius: 12px; overflow: hidden; box-shadow: 0 40px 120px rgba(0,0,0,0.7); background: linear-gradient(180deg,#080808,#050505); color: #fff; display: grid; grid-template-columns: 1fr 360px; gap:0; }
@media (max-width: 900px) { #checkout-inner { grid-template-columns: 1fr; } }

.checkout-left { padding: 16px 18px; max-height: 90vh; overflow:auto; }
.checkout-right { padding: 16px 18px; border-left: 1px solid rgba(255,255,255,0.03); background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); overflow:auto; max-height: 90vh; }

.checkout-header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
.checkout-title { color: var(--accent-2); font-weight:900; font-size:18px; margin:0; }

.form-row { display:flex; gap:8px; margin-bottom:10px; }
.form-col { flex:1; display:flex; flex-direction:column; gap:6px; }
.input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; font-weight:800; box-sizing:border-box; }
.input[readonly] { cursor:pointer; background: rgba(255,255,255,0.01); }

.order-line { display:flex; gap:8px; align-items:center; margin-bottom:10px; }
.order-line img { width:64px; height:48px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,0.04); }
.order-line .ol-meta { flex:1; min-width:0; }
.order-line .ol-meta strong { display:block; font-weight:900; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.order-line .ol-meta small { color: rgba(255,255,255,0.75); }
.order-line .ol-price { font-weight:900; color:var(--accent-2); min-width:70px; text-align:right; }

.checkout-actions { display:flex; gap:10px; justify-content:flex-end; margin-top:12px; }
.btn.full { padding:12px 16px; border-radius:12px; font-weight:900; min-width:140px; }
.btn.primary.full { background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); color:#111; border:0; box-shadow: 0 12px 36px rgba(255,106,0,0.12); }

/* small helper area */
.checkout-note { color: rgba(255,255,255,0.78); font-size:13px; margin-top:12px; }

/* header close button */
#checkout-close { background:transparent; border:0; color: var(--muted); font-size:18px; padding:8px; }

/* subtle responsive */
@media (max-width:600px){
  .checkout-right { padding-top:6px; }
  .order-line img { width:56px; height:44px; }
  .checkout-title { font-size:16px; }
}
</style>
<script>
// --- Checkout UX improvements (replace the previous map-click handler with this) ---
(function(){
  // Use the same STORE_COORDS and DELIVERY_CONFIG already defined in your checkout script
  const STORE_LABEL = 'Devtraco, Tema Community 25';
  // Grab the existing DOM refs used in your checkout script
  const page = document.getElementById('checkout-page');
  const inpType = document.getElementById('cf-type');
  const inpAddress = document.getElementById('cf-address');
  const inpLat = document.getElementById('cf-lat');
  const inpLon = document.getElementById('cf-lon');
  const cfDelivery = document.getElementById('cf-delivery');
  const cfTotal = document.getElementById('cf-total');
  const cfSubtotal = document.getElementById('cf-subtotal');

  // Inject a clear delivery-notice if not already present
  (function ensureDeliveryNote(){
    const header = document.querySelector('.checkout-header');
    if (!header) return;
    if (!document.getElementById('checkout-delivery-note')) {
      const note = document.createElement('div');
      note.id = 'checkout-delivery-note';
      note.innerHTML = '<strong>Important:</strong> The price shown at checkout <em>does NOT</em> include delivery fees. Delivery fee will be estimated and communicated after checkout based on your address.';
      header.parentNode.insertBefore(note, header.nextSibling);
    }
  })();

  // Toggle address input behavior depending on Order Type
  function toggleAddressField() {
    const type = (inpType && inpType.value) || 'delivery';
    if (!inpAddress) return;
    if (type === 'delivery') {
      // allow user to type their address manually for delivery
      inpAddress.removeAttribute('readonly');
      // if the input currently contains the store address placeholder, clear it for user to type
      if ((inpAddress.value || '').trim() === STORE_LABEL) inpAddress.value = '';
      // clear any stored lat/lon (user should optionally provide if available)
      // Keep existing lat/lon if user previously selected
      // visually hint the input
      inpAddress.placeholder = 'Enter your delivery address (e.g., House #, Street, Landmark)';
    } else {
      // Pickup: lock address field to store address and set coords
      inpAddress.value = STORE_LABEL;
      inpAddress.setAttribute('readonly', 'true');
      // write store coords so delivery calc sees store coordinates
      if (typeof STORE_COORDS !== 'undefined') {
        if (inpLat) inpLat.value = String(STORE_COORDS.lat || '');
        if (inpLon) inpLon.value = String(STORE_COORDS.lon || '');
      }
      inpAddress.placeholder = 'Pickup location (store address)';
    }
    // After toggling, refresh totals so Delivery line updates accordingly
    try { refreshTotals && refreshTotals(); } catch(e){}
  }

  // Wire change event on order type select to toggle address behavior
  if (inpType) {
    inpType.addEventListener('change', () => {
      toggleAddressField();
    });
  }

  // On page open ensure correct mode
  try { toggleAddressField(); } catch(e){}

  // Replace address click handler: do NOT open map modal automatically.
  // Users will type their address in the address field when delivery is selected.
  if (inpAddress) {
    inpAddress.addEventListener('click', (e) => {
      // if pickup selected, do nothing (address is store address & readonly)
      const type = (inpType && inpType.value) || 'delivery';
      if (type === 'pickup') {
        // keep focus but don't open any map
        return;
      }
      // for delivery: allow typing. (If you still want an optional "Use map" button later you can add it)
      inpAddress.removeAttribute('readonly');
      // focus so user can type immediately
      setTimeout(()=> inpAddress.focus(), 60);
    });
  }

  // Ensure refreshTotals recalculates delivery only when type is delivery and address is present
  // (your existing computeDeliveryFee/refreshTotals already handles lat/lon; we simply ensure it runs on address edits)
  if (inpAddress) {
    inpAddress.addEventListener('input', () => {
      // Clear lat/lon if user types a new free-text address (unless you implement geocoding later)
      if (inpLat) inpLat.value = '';
      if (inpLon) inpLon.value = '';
      try { refreshTotals && refreshTotals(); } catch(e){}
    });
  }

  // When checkout opens make sure it's positioned under the header (safety) and focus first field
  (function ensureOpenPositioning(){
    const origOpen = openCheckoutPage;
    // If openCheckoutPage exists, wrap it to add a scrollIntoView to ensure top visible
    if (typeof openCheckoutPage === 'function') {
      window.openCheckoutPage = function() {
        origOpen.apply(this, arguments);
        try {
          // ensure the checkout dialog is visually scrolled into view (below header)
          const inner = document.getElementById('checkout-inner');
          if (inner) inner.scrollIntoView({ behavior: 'auto', block: 'start' });
        } catch(e){}
      };
    }
  })();

  // Run once to set initial UI correctly
  try { toggleAddressField(); } catch(e){}
})();
</script>
<section id="checkout-page" aria-hidden="true" role="dialog" aria-label="Checkout page">
  <div id="checkout-inner" role="document">
    <div class="checkout-left">
      <div class="checkout-header">
        <h3 class="checkout-title"><i class="fa fa-shopping-basket"></i> Complete Order</h3>
        <div>
          <button id="checkout-close" class="icon-btn" aria-label="Close checkout"><i class="fa fa-times"></i></button>
        </div>
      </div>

      <div>
        <div class="form-row">
          <div class="form-col">
            <label class="small-muted">Full name *</label>
            <input id="cf-name" class="input" type="text" placeholder="Jane Doe" required />
          </div>
          <div class="form-col">
            <label class="small-muted">Phone *</label>
            <input id="cf-phone" class="input" type="tel" placeholder="0550xxxxxx" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-col">
            <label class="small-muted">Email *</label>
            <input id="cf-email" class="input" type="email" placeholder="you@example.com" required />
          </div>
          <div class="form-col">
            <label class="small-muted">Order type *</label>
            <select id="cf-type" class="input">
              <option value="delivery">Delivery</option>
              <option value="pickup">Pickup</option>
            </select>
          </div>
        </div>

        <div style="margin-top:6px;">
          <label class="small-muted">Your Address*</label>
        <input id="cf-address" class="input" type="text" placeholder="Enter delivery address (only when Delivery selected)" readonly />
          <input type="hidden" id="cf-lat" />
          <input type="hidden" id="cf-lon" />
        </div>

        <div class="form-row" style="margin-top:10px;">
          <div class="form-col">
            <label class="small-muted">Preferred date</label>
            <input id="cf-date" class="input" type="date" />
          </div>
          <div class="form-col">
            <label class="small-muted">Preferred time</label>
            <input id="cf-time" class="input" type="time" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="small-muted">Notes (delivery/pickup instructions)</label>
          <textarea id="cf-note" class="input" rows="3" placeholder="e.g., knock twice, leave at gate"></textarea>
        </div>

        <div style="margin-top:12px;">
          <label class="small-muted">Payment method</label>
          <select id="cf-paymethod" class="input">
            <option value="paystack">Pay with Card / Mobile Money (Paystack)</option>
            <option value="cash">Cash on Delivery</option>
          </select>
        </div>

        <div class="checkout-actions">
          <button id="cf-submit" class="btn primary full">Confirm & Pay</button>
          <button id="cf-cancel" class="btn ghost full">Cancel</button>
        </div>

      <div id="cart-delivery-note" class="small-muted" style="margin-top:8px; padding:10px; border-radius:10px; background: linear-gradient(90deg, rgba(255,160,80,0.04), rgba(255,255,255,0.01)); border:1px solid rgba(255,160,80,0.06);">
         <strong>Important:</strong> The checkout price shown <em>does NOT</em> include delivery fees. Delivery fee will be estimated after checkout based on your address and communicated to you.
       </div>
 
      </div>
    </div>

    <aside class="checkout-right" aria-label="Order summary">
      <h4 style="margin:0 0 10px 0; color:var(--accent-2); font-weight:900;">Your order</h4>
      <div id="cf-order-lines" style="margin-bottom:6px;">
        <!-- order lines injected here -->
      </div>

      <div style="border-top:1px dashed rgba(255,255,255,0.04); padding-top:10px; margin-top:12px;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="small-muted">Subtotal</div>
          <div id="cf-subtotal" class="small-muted">GHC 0</div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
          <div class="small-muted">Delivery</div>
          <div id="cf-delivery" class="small-muted">GHC 0</div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
          <div class="small-muted">Promo</div>
          <div id="cf-promo" class="small-muted">-GHC 0</div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:10px; font-weight:900; color:#fff;">
          <div>Total</div>
          <div id="cf-total" style="color:var(--accent-2)">GHC 0</div>
        </div>
      </div>

      <div style="margin-top:12px;" class="small-muted">
        Please confirm your details before proceeding. You will receive an email & SMS after payment.
      </div>
    </aside>
  </div>
</section>
  <!-- ========== ORDER CONFIRMATION MODAL (shows after successful payment + reload) ========= -->
<style>
/* Confirmation modal styles */
#order-confirmation-modal {
  display: none;
  position: fixed;
  inset: 0;
  z-index: 8000;
  background: rgba(0,0,0,0.6);
  align-items: center;
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
}
#order-confirmation-modal[aria-hidden="false"] { display:flex; }

.oc-inner {
  width: 100%;
  max-width: 720px;
  border-radius: 12px;
  background: linear-gradient(180deg,#0b0b0b,#060606);
  color: #fff;
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 16px;
}
.oc-header { display:flex; gap:12px; align-items:center; justify-content:space-between; }
.oc-title { font-size:18px; font-weight:900; color: var(--accent-2, #FFD166); margin:0; }
.oc-body { display:flex; gap:12px; flex-direction:column; max-height: 60vh; overflow:auto; padding:6px 0; }
.oc-grid { display:grid; grid-template-columns: 1fr 160px; gap:12px; align-items:start; }
.oc-lines { border-top:1px dashed rgba(255,255,255,0.04); padding-top:8px; }
.oc-line { display:flex; justify-content:space-between; gap:8px; padding:6px 0; border-bottom:1px solid rgba(255,255,255,0.02); }
.oc-total { font-weight:900; color: var(--accent-2, #FFD166); font-size:18px; }
.oc-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }
.btn.print { padding:10px 12px; border-radius:10px; font-weight:900; background: linear-gradient(90deg, var(--accent-1, #FF6A00), var(--accent-2, #FFD166)); color:#111; border:0; }
.btn.ok { padding:10px 12px; border-radius:10px; font-weight:900; background: transparent; color: #fff; border: 1px solid rgba(255,255,255,0.06); }

/* print-only styles: print only modal content */
@media print {
  body * { visibility: hidden; }
  #order-confirmation-modal, #order-confirmation-modal * { visibility: visible; }
  #order-confirmation-modal { position: static; background: #fff; }
  .oc-inner { box-shadow: none; background: #fff; color: #000; }
}
</style>

<div id="order-confirmation-modal" role="dialog" aria-hidden="true" aria-label="Order confirmation">
  <div class="oc-inner" role="document">
    <div class="oc-header">
      <h3 class="oc-title"><i class="fa fa-check-circle"></i> Order Confirmed</h3>
      <button id="oc-close" class="icon-btn" aria-label="Close confirmation"><i class="fa fa-times"></i></button>
    </div>

    <div class="oc-body">
      <div id="oc-summary" class="oc-grid">
        <div>
          <div><strong>Reference:</strong> <span id="oc-ref">—</span></div>
          <div><strong>Name:</strong> <span id="oc-name">—</span></div>
          <div><strong>Phone:</strong> <span id="oc-phone">—</span></div>
          <div><strong>Email:</strong> <span id="oc-email">—</span></div>
          <div><strong>Order type:</strong> <span id="oc-type">—</span></div>
          <div><strong>Address:</strong> <span id="oc-address">—</span></div>
          <div><strong>Notes:</strong> <span id="oc-note">—</span></div>
        </div>
        <div style="text-align:right;">
          <div class="small-muted">Placed at</div>
          <div id="oc-ts" style="font-weight:800;margin-bottom:10px">—</div>
          <div class="oc-total" id="oc-total">GHC 0</div>
        </div>
      </div>

      <div class="oc-lines" id="oc-lines">
        <!-- order lines inserted here -->
      </div>

      <div style="margin-top:8px" class="small-muted">
        <p><strong>Important:</strong> Delivery fee is calculated separately and will be communicated after we confirm your exact location. The total shown at checkout did <em>not</em> include delivery unless explicitly shown as added.</p>
        <p>Please keep this reference for inquiries. We will contact you (phone/SMS/WhatsApp) with an estimated delivery fee and ETA.</p>
      </div>
    </div>

    <div class="oc-actions">
      <button id="oc-print" class="btn print"><i class="fa fa-file-pdf"></i> Save as PDF</button>
      <button id="oc-ok" class="btn ok">Okay</button>
    </div>
  </div>
</div>

<script>
/* ORDER CONFIRMATION modal behaviour:
   - On load, if localStorage.wrap_show_confirmation === '1', read wrap_last_order and show modal.
   - Save as PDF -> window.print()
   - Okay -> clear cart and confirmation data, reload to original page (cart empty).
*/
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('order-confirmation-modal');
    const ocRef = document.getElementById('oc-ref');
    const ocName = document.getElementById('oc-name');
    const ocPhone = document.getElementById('oc-phone');
    const ocEmail = document.getElementById('oc-email');
    const ocType = document.getElementById('oc-type');
    const ocAddress = document.getElementById('oc-address');
    const ocNote = document.getElementById('oc-note');
    const ocTs = document.getElementById('oc-ts');
    const ocLines = document.getElementById('oc-lines');
    const ocTotal = document.getElementById('oc-total');
    const btnPrint = document.getElementById('oc-print');
    const btnOk = document.getElementById('oc-ok');
    const btnClose = document.getElementById('oc-close');

    function showModal(order) {
      if (!order) return;
      ocRef.innerText = order.reference || ('ref-'+Math.floor(Math.random()*1000000));
      ocName.innerText = order.name || '-';
      ocPhone.innerText = order.phone || '-';
      ocEmail.innerText = order.email || '-';
      ocType.innerText = order.type || '-';
      ocAddress.innerText = order.address || '-';
      ocNote.innerText = order.note || '-';
      ocTs.innerText = new Date(order.ts || Date.now()).toLocaleString();
      ocTotal.innerText = `GHC ${Number(order.totals?.total || order.totals?.total || 0).toFixed(0)}`;

      // populate order lines
      ocLines.innerHTML = '';
      const lines = Array.isArray(order.cart) ? order.cart : [];
      if (!lines.length) {
        ocLines.innerHTML = '<div class="small-muted">No line items recorded.</div>';
      } else {
        lines.forEach(l => {
          const div = document.createElement('div');
          div.className = 'oc-line';
          const title = document.createElement('div');
          title.innerHTML = `<strong>${escapeHtml(l.title || 'Item')}</strong><div class="small-muted">${(l.meta && l.meta.addons) ? 'Extras: '+ l.meta.addons.map(a=>escapeHtml(a.label||a.key)).join(', ') : ''}</div>`;
          const right = document.createElement('div');
          right.style.textAlign = 'right';
          right.innerHTML = `${Number(l.qty || 1)} × GHC ${Number(l.unitPrice||0).toFixed(0)}<div style="font-weight:900;margin-top:4px">${'GHC ' + (Number(l.unitPrice||0) * Number(l.qty||1)).toFixed(0)}</div>`;
          div.appendChild(title);
          div.appendChild(right);
          ocLines.appendChild(div);
        });
      }

      modal.setAttribute('aria-hidden','false');
      modal.style.display = 'flex';
      // prevent background scroll
      document.body.style.overflow = 'hidden';
    }

    function hideModal() {
      modal.setAttribute('aria-hidden','true');
      modal.style.display = 'none';
      document.body.style.overflow = '';
    }

    // Print — use window.print which will be constrained by the @media print CSS above
    // Replace the existing btnPrint handler with this improved printable window generator
btnPrint && btnPrint.addEventListener('click', () => {
  try {
    // Try to load the last order from localStorage (the confirmation modal uses this already)
    const raw = localStorage.getItem('wrap_last_order');
    const order = raw ? JSON.parse(raw) : null;

    if (!order) {
      alert('No order data available to print.');
      return;
    }

    // Helper to escape HTML
    const escapeHtml = (s) => String(s || '').replace(/&/g,'&amp;').replace(/"/g,'&quot;')
      .replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;');

    // Build lines HTML; ensure we display all meta info (addons, size, protein, etc.)
    const lines = Array.isArray(order.cart) ? order.cart : [];
    let linesHtml = '';
    let computedSubtotal = 0;
    if (!lines.length) {
      linesHtml = '<tr><td colspan="5" style="text-align:center;padding:12px 0;color:#666">No line items recorded.</td></tr>';
    } else {
      lines.forEach((l, idx) => {
        const qty = Number(l.qty || 1);
        const unit = Number(l.unitPrice || l.unit_price || 0);
        const lineTotal = Math.round(qty * unit);
        computedSubtotal += lineTotal;

        // Build meta details string (extras, protein, size, any other keys)
        const metaParts = [];
        if (l.meta) {
          try {
            // addons (common structure)
            if (Array.isArray(l.meta.addons) && l.meta.addons.length) {
              metaParts.push('Extras: ' + l.meta.addons.map(a => escapeHtml(a.label || a.key || a)).join(', '));
            }
            // other keys
            Object.keys(l.meta).forEach(k => {
              if (k === 'addons') return;
              const v = l.meta[k];
              if (!v) return;
              if (typeof v === 'object') {
                if (v.text) metaParts.push(`${escapeHtml(k)}: ${escapeHtml(v.text)}`);
                else if (v.label) metaParts.push(`${escapeHtml(k)}: ${escapeHtml(v.label)}`);
                else {
                  // stringify basic object
                  metaParts.push(`${escapeHtml(k)}: ${escapeHtml(JSON.stringify(v))}`);
                }
              } else {
                metaParts.push(`${escapeHtml(k)}: ${escapeHtml(String(v))}`);
              }
            });
          } catch (e) { /* ignore meta parsing errors */ }
        }
        const metaHtml = metaParts.length ? `<div style="font-size:12px;color:#444;margin-top:6px;">${metaParts.join(' • ')}</div>` : '';

        linesHtml += `
          <tr>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee;">
              <strong>${escapeHtml(l.title || l.name || 'Item')}</strong>${metaHtml}
            </td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:center;">${qty}</td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:right;">GHC ${Number(unit).toFixed(0)}</td>
            <td style="padding:10px 8px; vertical-align:top; border-bottom:1px solid #eee; text-align:right;">GHC ${lineTotal.toFixed(0)}</td>
          </tr>
        `;
      });
    }

    // Use totals from order.totals if present; otherwise fall back to computedSubtotal and order fields
    const totals = order.totals || {};
    const subtotal = (typeof totals.subtotal !== 'undefined') ? Number(totals.subtotal) : computedSubtotal;
    const delivery = (typeof totals.delivery !== 'undefined') ? Number(totals.delivery || 0) : Number(totals.delivery || 0);
    const promoDiscount = (typeof totals.promo !== 'undefined') ? Number(totals.promo || totals.promoDiscount || 0) : Number(totals.promoDiscount || 0);
    const total = (typeof totals.total !== 'undefined') ? Number(totals.total) : Math.max(0, subtotal - (promoDiscount||0) + (delivery||0));

    // Build printable HTML (minimal, stable layout)
    const printable = `
      <!doctype html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>Wrap District — Invoice ${escapeHtml(order.reference || '')}</title>
        <style>
          /* Page & printing */
          @page { size: auto; margin: 12mm; }
          html,body { margin:0; padding:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:#222; }
          body { padding: 18px; background: #fff; -webkit-print-color-adjust: exact; }
          .wrap-header { display:flex; align-items:center; gap:12px; }
          .logo-mark { background: linear-gradient(135deg,#FF6A00,#ff8c2b); color:#111; padding:6px 10px; border-radius:8px; font-weight:900; letter-spacing:1px; }
          .brand { margin-left:6px; }
          .brand h1 { margin:0; font-size:20px; }
          .brand p { margin:3px 0 0 0; font-size:12px; color:#444; }
          .meta { margin-top:14px; display:flex; justify-content:space-between; gap:12px; align-items:flex-start; }
          .meta .left, .meta .right { width:48%; }
          .box { border:1px solid #eee; padding:12px; border-radius:8px; background:#fafafa; }
          table { width:100%; border-collapse:collapse; margin-top:12px; }
          th { text-align:left; padding:10px 8px; font-size:13px; color:#333; border-bottom:2px solid #eee; }
          td { padding:8px; font-size:13px; vertical-align:top; }
          .totals { margin-top:12px; width:100%; max-width:420px; margin-left:auto; border-top:1px dashed #ddd; padding-top:10px; }
          .totals .row { display:flex; justify-content:space-between; padding:6px 0; color:#222; }
          .small { font-size:12px; color:#666; }
          .note { margin-top:14px; font-size:12px; color:#666; }
          /* prevent page breaks inside important sections */
          .box, table, .totals { page-break-inside: avoid; }
          /* ensure single page layout (avoid unexpected blank pages) */
          html, body { height: auto !important; }
        </style>
      </head>
      <body>
        <div class="wrap-header">
          <div class="logo-mark">WRAP</div>
          <div class="brand">
            <h1>Wrap District</h1>
            <p class="small">Fresh • Hot • Fast — Tema Community 25</p>
            <p class="small">Phone: 0552509241 • Location: Devtraco, Tema</p>
          </div>
        </div>

        <div class="meta">
          <div class="left box">
            <div><strong>Customer</strong></div>
            <div style="margin-top:6px"><strong>${escapeHtml(order.name || '—')}</strong></div>
            <div class="small">${escapeHtml(order.phone || '—')} • ${escapeHtml(order.email || '')}</div>
            <div style="margin-top:8px" class="small"><strong>Order type:</strong> ${escapeHtml(order.type || '—')}</div>
            <div style="margin-top:4px" class="small"><strong>Address:</strong> ${escapeHtml(order.address || '—')}</div>
            <div style="margin-top:4px" class="small"><strong>Notes:</strong> ${escapeHtml(order.note || '-')}</div>
          </div>
          <div class="right box">
            <div><strong>Order</strong></div>
            <div style="margin-top:6px"><strong>Reference:</strong> ${escapeHtml(order.reference || ('ref-'+(Date.now())))}</div>
            <div class="small" style="margin-top:6px"><strong>Placed:</strong> ${escapeHtml(new Date(order.ts || Date.now()).toLocaleString())}</div>
            <div class="small" style="margin-top:6px"><strong>Prepared for PDF:</strong> ${escapeHtml(new Date().toLocaleString())}</div>
          </div>
        </div>

        <table aria-label="Order lines" style="margin-top:14px;">
          <thead>
            <tr>
              <th style="width:60%">Item & options</th>
              <th style="width:10%; text-align:center">Qty</th>
              <th style="width:15%; text-align:right">Unit</th>
              <th style="width:15%; text-align:right">Line</th>
            </tr>
          </thead>
          <tbody>
            ${linesHtml}
          </tbody>
        </table>

        <div class="totals" role="complementary" aria-label="Totals summary">
          <div class="row"><div class="small">Subtotal</div><div class="small">GHC ${Number(subtotal).toFixed(0)}</div></div>
          <div class="row"><div class="small">Delivery</div><div class="small">GHC ${Number(delivery || 0).toFixed(0)}</div></div>
          <div class="row"><div class="small">Promo Discount</div><div class="small">-GHC ${Number(promoDiscount || 0).toFixed(0)}</div></div>
          <div class="row" style="font-weight:900; font-size:16px;"><div>Total</div><div>GHC ${Number(total).toFixed(0)}</div></div>
        </div>

        <div class="note">
          <div><strong>Contact:</strong> Wrap District • 0552509241 • Tema Community 25, Devtraco</div>
          <div style="margin-top:6px"><strong>Note:</strong> Delivery fee may be confirmed separately. Keep this reference for inquiries.</div>
        </div>
      </body>
      </html>
    `;

    // Open a focused new window with the invoice HTML, print, then close.
    const w = window.open('', '_blank', 'toolbar=0,location=0,menubar=0,width=900,height=1100');
    if (!w) {
      // fallback: print current window (less ideal)
      alert('Unable to open print window; your browser may be blocking popups. Please allow popups and try again.');
      return;
    }
    w.document.open();
    w.document.write(printable);
    w.document.close();

    // Wait for content to be rendered, then print and close
    w.focus();
    // Give the browser a short moment to layout
    setTimeout(() => {
      try {
        w.print();
      } catch (e) {
        console.warn('Print failed in new window:', e);
      }
      // Close the print window shortly after print dialog invoked
      setTimeout(() => {
        try { w.close(); } catch (e) { /* ignore */ }
      }, 800);
    }, 350);

  } catch (err) {
    console.error('Print invoice error', err);
    alert('Could not create invoice for printing. See console for details.');
  }
});

    // Okay -> clear stored confirmation + empty cart + reload original page
    btnOk && btnOk.addEventListener('click', () => {
      try {
        // clear stored order flag & data
        localStorage.removeItem('wrap_show_confirmation');
        localStorage.removeItem('wrap_last_order');
        // clear cart storage used by your persistent cart
        localStorage.removeItem('wrap_cart_v2');
        // also clear window.cart if present
        try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch(e){}
      } catch (e) { /* ignore */ }
      hideModal();
      // reload to original page (strip hash/qs)
      window.location.href = window.location.pathname;
    });

    // close X (same as okay but keep data? user asked to refresh to original page on Okay — for close we'll just hide)
    btnClose && btnClose.addEventListener('click', () => {
      hideModal();
      // DO NOT remove the stored confirmation so the user can re-open if they refresh — but you can change this behavior if desired
    });

    // show modal on page load if flag present
    try {
      const showFlag = localStorage.getItem('wrap_show_confirmation');
      if (showFlag === '1') {
        const raw = localStorage.getItem('wrap_last_order');
        const order = raw ? JSON.parse(raw) : null;
        // show after a small delay so page finishes rendering
        setTimeout(() => showModal(order), 220);
      }
    } catch (e) { console.warn('order confirm show error', e); }

    // small helper
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  });
})();
</script>
<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    // 1) Soft-filter any alert/confirm that contains the ORDER SUMMARY text so it never blocks UX.
    try {
      const _alert = window.alert;
      const _confirm = window.confirm;
      window.alert = function(msg){
        try {
          if (typeof msg === 'string' && msg.includes('ORDER SUMMARY')) {
            // swallow the noisy test/order-summary alert
            console.info('Suppressed alert containing ORDER SUMMARY');
            return;
          }
        } catch(e){}
        return _alert.apply(window, arguments);
      };
      window.confirm = function(msg){
        try {
          if (typeof msg === 'string' && msg.includes('ORDER SUMMARY')) {
            console.info('Suppressed confirm containing ORDER SUMMARY');
            return true; // pretend user pressed OK if needed by legacy flows
          }
        } catch(e){}
        return _confirm.apply(window, arguments);
      };
    } catch(e){ console.warn('Could not override alert/confirm', e); }

    // 2) Intercept clicks on all checkout/pay triggers so any legacy alert-based flow can't fire.
    const CHECKOUT_SELECTORS = [
      '#checkout-btn',
      '#cart-header-checkout',
      '.cart-header .cart-header-checkout',
      '[data-action="checkout"]',
      '[data-action="pay"]',
      '.cart-footer .btn.primary',
      '#cart-toggle'
    ];

    function safeOpenCheckout() {
      // Prefer the in-page checkout function(s) if present
      if (typeof openCheckoutPage === 'function') { try { openCheckoutPage(); return; } catch(e){} }
      if (typeof openCheckoutFull === 'function') { try { openCheckoutFull(); return; } catch(e){} }
      // fallback: click the footer checkout if present
      const footer = document.getElementById('checkout-btn');
      if (footer) { try { footer.click(); return; } catch(e){} }
      // last resort: open the cart drawer
      const cart = document.getElementById('cart-drawer');
      if (cart) { cart.style.display = 'block'; cart.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; }
    }

    function attachInterceptor(el){
      if (!el) return;
      // clear inline onclick if present (helps some simple use-cases)
      try { if (el.getAttribute && el.getAttribute('onclick')) el.removeAttribute('onclick'); } catch(e){}

      // Add a capture-phase listener that prevents other click handlers from running on this element.
      // We use capture + stopImmediatePropagation to be robust to duplicate handlers.
      el.addEventListener('click', function(ev){
        try {
          ev.preventDefault();
          // stop other handlers attached to this element from executing
          ev.stopImmediatePropagation();
        } catch(e){}
        // Temporarily silence alerts/confirm used synchronously by other scripts
        const oldAlert = window.alert;
        const oldConfirm = window.confirm;
        try {
          window.alert = function(){};
          window.confirm = function(){ return true; };
          // Open the proper checkout UI
          safeOpenCheckout();
        } catch(e){ console.error(e); }
        finally {
          // restore original functions (rest of app behavior unchanged)
          try { window.alert = oldAlert; window.confirm = oldConfirm; } catch(e){}
        }
      }, true); // capture = true
    }

    // Attach interceptors to all matching elements (existing + future)
    function attachAllInterceptors() {
      CHECKOUT_SELECTORS.forEach(sel => {
        Array.from(document.querySelectorAll(sel)).forEach(el => attachInterceptor(el));
      });
    }
    attachAllInterceptors();

    // If checkout buttons are injected later, watch the body and attach interceptors for new nodes
    const mo = new MutationObserver((mutations) => {
      let found = false;
      mutations.forEach(m => {
        if (m.addedNodes && m.addedNodes.length) found = true;
      });
      if (found) attachAllInterceptors();
    });
    mo.observe(document.body, { childList: true, subtree: true });
  });
})();
</script>
  <!-- === REPLACE your existing checkout CSS with this block === -->
<style>
/* CHECKOUT PAGE — unified, mobile-friendly, scrollable under fixed header */
#checkout-page {
  display: none;
  position: fixed;
  inset: 0;                 /* fill viewport */
  z-index: 3200;
  background: linear-gradient(180deg, rgba(0,0,0,0.6), rgba(0,0,0,0.6));
  /* place checkout below header and allow page-level scroll if content taller than viewport */
  align-items: flex-start;                  /* ensures top-aligned so margin-top works predictably */
  justify-content: center;
  padding: 12px;
  box-sizing: border-box;
  overflow: auto;                           /* page can scroll if inner is taller than viewport */
  -webkit-overflow-scrolling: touch;
}

/* show when opened */
#checkout-page[aria-hidden="false"] { display: flex; }

/* Inner dialog
   - Use margin-top to sit under the sticky header safely
   - Use max-height so inner columns can scroll independently
*/
#checkout-inner {
  width: 100%;
  max-width: 920px;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  background: linear-gradient(180deg,#080808,#050505);
  color: #fff;
  display: grid;
  grid-template-columns: 1fr 360px;
  gap: 0;
  margin: calc(56px + var(--safe-top,12px) + 12px) auto 24px; /* pushes it below fixed header */
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 48px)); /* keeps dialog within viewport */
  box-sizing: border-box;
}

/* On narrow screens stack into single column */
@media (max-width: 900px) {
  #checkout-inner { grid-template-columns: 1fr; max-width: 680px; }
}

/* Left & right columns scroll independently */
.checkout-left,
.checkout-right {
  padding: 16px 18px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  max-height: calc(100%); /* ensures columns don't overflow the dialog */
  box-sizing: border-box;
}

/* Right column: give it a visual top so "Your order" stays visible while lines scroll */
.checkout-right {
  border-left: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  position: relative;
}

/* Make the "Your order" heading sticky within the right column so the user always sees the header.
   The order lines themselves scroll under it. This prevents the feeling that the section is "stuck". */
.checkout-right > h4 {
  position: sticky;
  top: 0;
  z-index: 5;
  margin: 0 0 10px 0;
  padding-top: 6px;
  background: transparent; /* inherits dialog BG */
  color: var(--accent-2);
  font-weight: 900;
}

/* constrain the order lines area so it scrolls nicely */
#cf-order-lines {
  overflow: auto;
  max-height: calc(100vh - (56px + var(--safe-top,12px) + 240px)); /* adapt so lines area remains scrollable */
  -webkit-overflow-scrolling: touch;
}

/* Make the checkout close button comfortable to tap */
#checkout-close { background: transparent; border: 0; color: var(--muted); font-size: 18px; padding: 8px; cursor: pointer; }

/* small responsive tweaks */
@media (max-width: 600px) {
  #checkout-inner { margin-top: calc(56px + var(--safe-top, 12px) + 6px); padding-bottom: 8px; }
  .checkout-right { border-left: none; border-top: 1px solid rgba(255,255,255,0.03); }
  .checkout-right > h4 { top: 0; }
  #cf-order-lines { max-height: calc(60vh); }
}
</style>

<!-- === Small JS helper: ensure the checkout dialog and its inner scroll positions reset when opened === -->
<script>
(function(){
  // call this when opening the checkout page (we already wire a few openers in your scripts)
  function resetCheckoutScroll() {
    try {
      const page = document.getElementById('checkout-page');
      const inner = document.getElementById('checkout-inner');
      const left = inner && inner.querySelector('.checkout-left');
      const right = inner && inner.querySelector('.checkout-right');
      const lines = document.getElementById('cf-order-lines');

      if (page) { page.scrollTop = 0; }
      if (inner) { inner.scrollTop = 0; }
      if (left) { left.scrollTop = 0; }
      if (right) { right.scrollTop = 0; }
      if (lines) { lines.scrollTop = 0; }

      // put focus on the first input so mobile keyboard appears predictably
      const first = document.querySelector('#cf-name, #cf-phone, #cf-email');
      if (first) setTimeout(()=> first.focus(), 120);
    } catch(e){ /* ignore */ }
  }

  // Expose helper so existing openCheckoutPage() can call it
  window.resetCheckoutScroll = resetCheckoutScroll;
})();
</script>
  
  
<script>
/* Checkout page script (Task 3)
   - Opens in-page checkout (#checkout-page)
   - Hides other modals/popups before opening
   - Populates order lines from window.cart or from cart DOM
   - Computes delivery fee using haversine distance; editable rates below
*/

(function(){
  document.addEventListener('DOMContentLoaded', () => {
    // Configurable store coordinates (set your store exact lat/lon here)
    const STORE_COORDS = { lat: 5.6600, lon: 0.0190 }; // <-- change to your store's lat/lon (Tema Community 25 / Devtraco approx)
    const DELIVERY_CONFIG = {
      baseFee: 6,        // base GHC
      perKm: 2.5,        // GHC per km
      minFee: 4,         // minimum fee
      maxFee: 60,        // maximum fee
      freeWithinKm: 0.8  // free delivery inside this radius (in km)
    };
const PAYSTACK_PUBLIC_KEY = 'pk_test_297586e51710e83d3c159bfe71ff45c7e23411fa';
    // DOM
    const page = document.getElementById('checkout-page');
    const inner = document.getElementById('checkout-inner');
    const closeBtn = document.getElementById('checkout-close');
    const cancelBtn = document.getElementById('cf-cancel');
    const submitBtn = document.getElementById('cf-submit');

    const inpName = document.getElementById('cf-name');
    const inpPhone = document.getElementById('cf-phone');
    const inpEmail = document.getElementById('cf-email');
    const inpType = document.getElementById('cf-type');
    const inpAddress = document.getElementById('cf-address');
    const inpLat = document.getElementById('cf-lat');
    const inpLon = document.getElementById('cf-lon');
    const inpDate = document.getElementById('cf-date');
    const inpTime = document.getElementById('cf-time');
    const inpNote = document.getElementById('cf-note');
    const inpPayMethod = document.getElementById('cf-paymethod');

    const orderLinesWrap = document.getElementById('cf-order-lines');
    const cfSubtotal = document.getElementById('cf-subtotal');
    const cfDelivery = document.getElementById('cf-delivery');
    const cfPromo = document.getElementById('cf-promo');
    const cfTotal = document.getElementById('cf-total');

    // Map modal already exists (#map-modal) and populates #cf-address/#cf-lat/#cf-lon — reuse it
    // Helper: show checkout page
    function openCheckoutPage() {
      // hide any other modals/popups that might have been shown earlier
      Array.from(document.querySelectorAll('.modal, .entry-promo, #preorder-modal')).forEach(m => {
        try { m.style.display = 'none'; m.setAttribute && m.setAttribute('aria-hidden','true'); } catch(e){}
      });

      // prefill user details
      inpName.value = localStorage.getItem('wrap_user_name') || '';
      inpPhone.value = localStorage.getItem('wrap_user_phone') || '';
      inpEmail.value = localStorage.getItem('wrap_checkout_email') || '';

      populateOrderLines();
      refreshTotals();

      page.style.display = 'flex';
      page.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> inpName.focus && inpName.focus(), 120);
    }

    function closeCheckoutPage() {
      page.style.display = 'none';
      page.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    // wire openers (override previous handlers so no pre-popup appears)
    const footerPayBtn = document.getElementById('checkout-btn');
    const headerCheckoutBtn = document.getElementById('cart-header-checkout');

    function bindOpeners() {
      if (footerPayBtn) {
        footerPayBtn.removeEventListener('click', openCheckoutPage);
        footerPayBtn.addEventListener('click', (e) => { e.preventDefault(); openCheckoutPage(); });
      }
      if (headerCheckoutBtn) {
        headerCheckoutBtn.removeEventListener('click', openCheckoutPage);
        headerCheckoutBtn.addEventListener('click', (e) => { e.preventDefault(); openCheckoutPage(); });
      }
    }
    bindOpeners();

    // close/cancel handlers
    closeBtn && closeBtn.addEventListener('click', closeCheckoutPage);
    cancelBtn && cancelBtn.addEventListener('click', closeCheckoutPage);
    page && page.addEventListener('click', (e)=> { if (e.target === page) closeCheckoutPage(); });
    document.addEventListener('keydown', (e)=> { if (e.key === 'Escape' && page.getAttribute('aria-hidden') === 'false') closeCheckoutPage(); });

    // Populate order lines from window.cart if present, else read existing cart DOM
    function populateOrderLines() {
      orderLinesWrap.innerHTML = '';
      const cartObj = window.cart || {};
      const lines = Object.keys(cartObj).length ? Object.values(cartObj) : extractCartFromDom();
      if (!lines.length) {
        orderLinesWrap.innerHTML = '<div class="small-muted">Your cart is empty.</div>';
        return;
      }
      lines.forEach(line => {
        const div = document.createElement('div');
        div.className = 'order-line';
        div.innerHTML = `
          <img src="${escapeHtml(line.imageSrc||'')}" alt="${escapeHtml(line.title||'Item')}" />
          <div class="ol-meta">
            <strong>${escapeHtml(line.title||'Item')}</strong>
            <small>${escapeHtml(buildMetaText(line.meta || {}))}</small>
          </div>
          <div class="ol-price">${fmtGhc((line.unitPrice||0) * (line.qty||1))}</div>
        `;
        orderLinesWrap.appendChild(div);
      });
    }

    function extractCartFromDom() {
      const arr = [];
      const rows = Array.from(document.querySelectorAll('#cart-items li.cart-line')).filter(r=>!r.classList.contains('cart-free'));
      rows.forEach(r => {
        try {
          const title = (r.querySelector('.line-title')?.innerText || '').trim();
          const qty = Number(r.querySelector('.line-qty')?.innerText || 1) || 1;
          const priceText = r.querySelector('.line-meta strong')?.innerText || '';
          // attempt to parse unit price from "GHC 45 × 1 = GHC 45" area
          const match = (r.querySelector('.line-meta')?.innerText || '').match(/GHC\s*([0-9]+)/);
          const unitPrice = match ? Number(match[1]) : 0;
          const img = r.querySelector('img')?.src || '';
          arr.push({ title, qty, unitPrice, unitPrice, meta: {}, imageSrc: img });
        } catch(e){}
      });
      return arr;
    }

    function buildMetaText(meta) {
      const parts = [];
      try {
        if (meta.addons && Array.isArray(meta.addons)) parts.push(meta.addons.map(a=>a.label || a.key).join(', '));
        Object.keys(meta||{}).forEach(k => {
          if (k==='addons') return;
          const v = meta[k];
          if (v && v.text) parts.push(String(v.text));
        });
      } catch(e){}
      return parts.join(' • ');
    }

    // Totals: prefer computeCartTotals() if available else compute from window.cart or fallback DOM
    function getTotals() {
      if (typeof computeCartTotals === 'function') return computeCartTotals();
      const cartObj = window.cart || {};
      let subtotal = 0, promo=0;
      const lines = Object.values(cartObj).length ? Object.values(cartObj) : extractCartFromDom();
      lines.forEach(l => subtotal += (Number(l.unitPrice)||0) * (Number(l.qty)||1));
      // basic promo detection (if global logic exists it will be used earlier)
      // delivery will be computed separately
      return { subtotal, delivery: 0, promoDiscount: promo, total: subtotal - promo };
    }

    function refreshTotals() {
      const totals = getTotals();
      cfSubtotal.innerText = fmtGhc(totals.subtotal || 0);
      // compute delivery: only if delivery selected and we have coords
      const type = inpType.value;
      let deliveryFee = 0;
      if (type === 'delivery') {
        const lat = parseFloat(inpLat.value), lon = parseFloat(inpLon.value);
        if (!isNaN(lat) && !isNaN(lon)) deliveryFee = computeDeliveryFee(lat, lon);
        else deliveryFee = DELIVERY_CONFIG.baseFee; // fallback
      }
      cfDelivery.innerText = fmtGhc(deliveryFee || 0);
      cfPromo.innerText = `-GHC ${Math.round(totals.promoDiscount || 0)}`;
      const total = Math.max(0, (totals.subtotal || 0) - (totals.promoDiscount || 0) + (deliveryFee || 0));
      cfTotal.innerText = fmtGhc(total);
    }

    // compute delivery fee using haversine distance
    function computeDeliveryFee(lat, lon) {
      if (typeof lat !== 'number' || typeof lon !== 'number' || isNaN(lat) || isNaN(lon)) return DELIVERY_CONFIG.baseFee;
      const dist = haversineKm(STORE_COORDS.lat, STORE_COORDS.lon, lat, lon);
      if (dist <= DELIVERY_CONFIG.freeWithinKm) return 0;
      let fee = DELIVERY_CONFIG.baseFee + (dist * DELIVERY_CONFIG.perKm);
      fee = Math.max(fee, DELIVERY_CONFIG.minFee);
      fee = Math.min(fee, DELIVERY_CONFIG.maxFee);
      return Math.round(fee);
    }

    // Haversine formula
    function haversineKm(lat1, lon1, lat2, lon2) {
      const R = 6371; // km
      const dLat = toRad(lat2 - lat1);
      const dLon = toRad(lon2 - lon1);
      const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    function toRad(v){ return v * Math.PI / 180; }

    // Address click opens existing map modal (your code already links #cf-address -> #map-modal)
    inpAddress && inpAddress.addEventListener('click', (e) => {
     const type = (inpType && inpType.value) || 'delivery';
      if (type === 'pickup') {
        // keep it readonly and do nothing
        e.preventDefault();
        return;
      }
     // Delivery — ensure the field is editable and focus so the user can type
      inpAddress.removeAttribute('readonly');
      setTimeout(()=> { try { inpAddress.focus(); } catch(e){} }, 60);
    });

    // When map selection happens, your existing map-confirm logic already writes cf-address/cf-lat/cf-lon.
    // We just add a MutationObserver or poll to react to changes and update totals.
    const latEl = inpLat, lonEl = inpLon;
    if (latEl && lonEl) {
      const mo = new MutationObserver(() => { refreshTotals(); });
      mo.observe(latEl, { attributes:true, childList:true, characterData:true, subtree:true });
      mo.observe(lonEl, { attributes:true, childList:true, characterData:true, subtree:true });
    }

    // also refresh totals when order type changes or when cart changes
    inpType && inpType.addEventListener('change', refreshTotals);
    // attempt to watch cart totals element if present
    const cartTotalEl = document.getElementById('cart-total');
    if (cartTotalEl) {
      const mo2 = new MutationObserver(() => { populateOrderLines(); refreshTotals(); });
      mo2.observe(cartTotalEl, { childList:true, subtree:true, characterData:true });
    } else {
      // fallback: poll for cart changes
      setInterval(()=> { populateOrderLines(); refreshTotals(); }, 1000);
    }

    // Submit handler: validate fields and assemble payload (same shape as previous modal-based flow)
    submitBtn && submitBtn.addEventListener('click', async (ev) => {
      ev.preventDefault();
      submitBtn.disabled = true;

      const name = (inpName.value || '').trim();
      const phone = (inpPhone.value || '').trim();
      const email = (inpEmail.value || '').trim();
      const type = inpType.value;
      const address = (inpAddress.value || '').trim();
      const lat = inpLat.value || '';
      const lon = inpLon.value || '';
      const date = inpDate.value || '';
      const time = inpTime.value || '';
      const note = inpNote.value || '';
      const paymethod = inpPayMethod.value || 'paystack';

      if (!name || !phone || !email) {
        alert('Please complete your name, phone and email.');
        submitBtn.disabled = false; return;
      }
      if (type === 'delivery' && !address) {
        alert('Please select your address on the map for delivery.');
        submitBtn.disabled = false; return;
      }

      // build cart lines
      const cartLines = Object.values(window.cart || {}).map(l => ({
        baseId: l.baseId, title: l.title, unitPrice: l.unitPrice, qty: l.qty, meta: l.meta || {}
      }));
      if (!cartLines.length) {
        alert('Your cart is empty. Add items before checkout.');
        submitBtn.disabled = false; return;
      }

      const totals = getTotals();
      const delivery = (type==='delivery') ? computeDeliveryFee(parseFloat(lat) || 0, parseFloat(lon) || 0) : 0;
      const totalAmount = Math.round((totals.subtotal || 0) - (totals.promoDiscount || 0) + delivery);

      // Save name/phone for convenience
      try { localStorage.setItem('wrap_user_name', name); localStorage.setItem('wrap_user_phone', phone); } catch(e){}

     if (paymethod === 'cash') {
       // simple local "order placed" flow (Cash)
      const fakeOrder = {
        id: 'local-' + Date.now(),
          reference: 'CASH-' + Date.now(),
         name, phone, email, type, address, lat, lon, date, time, note,
         cart: cartLines,
         totals: { subtotal: totals.subtotal, delivery, promo: totals.promoDiscount, total: totalAmount },
          ts: new Date().toISOString()
       };
       try {
          localStorage.setItem('wrap_last_order', JSON.stringify(fakeOrder));
         localStorage.setItem('wrap_show_confirmation', '1'); // -> triggers confirmation modal on next load
        } catch (e) { /* ignore storage errors */ }

       // clear cart, close and reload so confirmation modal appears
       try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch (e) {}
        closeCheckoutPage();
        // reload page (confirmation modal code will read localStorage and show modal)
       window.location.reload();
       return;
     }

      // paymethod === paystack -> call server init endpoint (same pattern as earlier)
    try {
       // If user chose inline Paystack and a public key is provided:
        if (paymethod === 'paystack' && PAYSTACK_PUBLIC_KEY && window.PaystackPop) {
          const PUBLIC_KEY = PAYSTACK_PUBLIC_KEY;
          const ref = 'PSK-' + Date.now() + '-' + Math.floor(Math.random()*10000);
          const handler = window.PaystackPop.setup({
           key: PUBLIC_KEY,
           email: email,
            amount: Math.round(totalAmount * 100),
            currency: 'GHS',
            ref,
            onClose: function() {
              alert('Payment cancelled');
              submitBtn.disabled = false;
            },
            callback: function(response) {
             // Inline Paystack returns a reference — we treat callback as success for frontend-only flow
             const order = {
                reference: response.reference || ref,
                name, phone, email, type, address, lat, lon, date, time, note,
                cart: cartLines,
               totals: { subtotal: totals.subtotal, delivery, promo: totals.promoDiscount, total: totalAmount },
                ts: new Date().toISOString()
             };
             try {
                localStorage.setItem('wrap_last_order', JSON.stringify(order));
               localStorage.setItem('wrap_show_confirmation', '1');
              } catch (e) {}
             try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch(e){}
             closeCheckoutPage();
             // reload to show confirmation modal (order data is in localStorage)
             window.location.reload();
            }
         });
         handler.openIframe();
          return;
       }

        // If Paystack public key missing or PaystackPop not loaded: ask user to simulate payment
       if (paymethod === 'paystack') {
         const simulate = confirm('No Paystack public key detected. Do you want to simulate a successful payment locally for testing? (No real money will be charged)');
          if (!simulate) {
            alert('Payment cancelled. To use real Paystack, set PAYSTACK_PUBLIC_KEY in the checkout script.');
            submitBtn.disabled = false;
            return;
          }
          // Simulate success
         const order = {
           reference: 'SIM-' + Date.now(),
           name, phone, email, type, address, lat, lon, date, time, note,
           cart: cartLines,
           totals: { subtotal: totals.subtotal, delivery, promo: totals.promoDiscount, total: totalAmount },
          ts: new Date().toISOString()
          };
         try {
           localStorage.setItem('wrap_last_order', JSON.stringify(order));
           localStorage.setItem('wrap_show_confirmation', '1');
         } catch (e) {}
          try { window.cart = {}; if (typeof renderCart === 'function') renderCart(); } catch(e){}
          closeCheckoutPage();
          window.location.reload();
         return;
       }
      } catch (err) {
        console.error('checkout error', err);
        alert('Checkout failed: ' + (err.message || err));
        submitBtn.disabled = false;
      }
    });
    
    // small helpers
    function fmtGhc(n){ return `GHC ${Number(n||0).toFixed(0)}`; }
    function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // When the map modal sets cf-address/cf-lat/cf-lon, we react and refresh totals
    // (your mapConfirm earlier already sets these inputs). We simply listen to changes
    const addrObserver = new MutationObserver(() => { populateOrderLines(); refreshTotals(); });
    if (inpAddress) addrObserver.observe(inpAddress, { childList:true, subtree:true, characterData:true, attributes:true });

    // initial small sync
    populateOrderLines();
    refreshTotals();
  });
})();
</script>
<script>
/* Product modal behavior (Task 2)
   - Opens when user clicks .item-thumb OR .item-title inside a .menu-item
   - Clones the .item-config into modal and keeps live price updates
   - On Add, copies selections back into original item's controls and triggers original add-btn
*/
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('product-modal');
    const pmThumb = document.getElementById('pm-thumb');
    const pmTitle = document.getElementById('pm-title');
    const pmDesc = document.getElementById('pm-desc');
    const pmBody = document.getElementById('pm-body');
    const pmPrice = document.getElementById('pm-price');
    const pmAdd = document.getElementById('pm-add');
    const pmCancel = document.getElementById('pm-cancel');
    const pmClose = document.getElementById('pm-close');

    let activeMenuItem = null;     // original menu-item element
    let clonedConfig = null;       // clone of .item-config to show inside modal

    // helper: format as GHC
    const fmtGhc = (n) => `GHC ${Number(n||0).toFixed(0)}`;

    // local price calculation (mirrors your calculateItemPrice)
    function calculatePriceFromContainer(container){
      let total = 0;
      // selects
      const selects = container.querySelectorAll('select');
      selects.forEach(s => { total += Number(s.value) || 0; });
      // addons (checkboxes with class addon-checkbox inside input)
      const addons = container.querySelectorAll('input.addon-checkbox, input[type="checkbox"]');
      addons.forEach(cb => { if (cb.checked) total += Number(cb.value) || 0; });
      // fallback: if no select found, try price-value span
      if (selects.length === 0) {
        const fallback = Number(container.querySelector('.price-value')?.innerText || 0);
        if (fallback) total = fallback;
      }
      return Math.round(total);
    }

    // update modal price display based on clonedConfig
    function updateModalPrice(){
      if (!clonedConfig) return;
      const p = calculatePriceFromContainer(clonedConfig);
      pmPrice.innerText = fmtGhc(p);
    }

    // open modal for a given menu-item element
    function openProductModal(menuItem){
      if (!menuItem) return;
      activeMenuItem = menuItem;

      // set image + title + desc
      const thumb = menuItem.querySelector('.item-thumb');
      const title = menuItem.querySelector('.item-title')?.innerText || 'Item';
      const desc = menuItem.querySelector('.item-desc')?.innerText || '';

      pmThumb.src = thumb?.src || '';
      pmThumb.alt = title;
      pmTitle.innerText = title;
      pmDesc.innerText = desc;

      // clone the .item-config if exists, else create a basic view
      const config = menuItem.querySelector('.item-config');
      pmBody.innerHTML = ''; // clear previous
      clonedConfig = config ? config.cloneNode(true) : null;

      if (clonedConfig) {
        // ensure cloned controls are interactive
        // Remove any ids that may conflict
        Array.from(clonedConfig.querySelectorAll('[id]')).forEach(el => el.removeAttribute('id'));
        pmBody.appendChild(clonedConfig);

        // add listeners to cloned controls to update price live
        clonedConfig.querySelectorAll('select, input[type="checkbox"]').forEach(inp => {
          inp.addEventListener('change', updateModalPrice);
        });
      } else {
        // fallback: create a summary
        const fallback = document.createElement('div');
        fallback.className = 'glass-card small';
        fallback.innerText = 'No configurable options for this item.';
        pmBody.appendChild(fallback);
      }

      // initial price update
      updateModalPrice();

      // show modal
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> pmClose && pmClose.focus(), 80);
    }

    // close modal and cleanup
    function closeProductModal(){
      // clear cloned config
      pmBody.innerHTML = '';
      clonedConfig = null;
      activeMenuItem = null;
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    // Wire clicks on image and title to open modal
    function attachOpeners(){
      // find all menu items
      const menuItems = Array.from(document.querySelectorAll('.menu-item'));
      menuItems.forEach(mi => {
        const thumb = mi.querySelector('.item-thumb');
        const titleEl = mi.querySelector('.item-title');
        [thumb, titleEl].forEach(openEl => {
          if (!openEl) return;
          openEl.style.cursor = 'pointer';
          openEl.addEventListener('click', (e) => {
            e.stopPropagation();
            openProductModal(mi);
          });
        });
      });
    }

    // On Add in modal: copy cloned selections back to the original menu-item controls, then trigger original add-btn
    pmAdd.addEventListener('click', () => {
      if (!activeMenuItem) return;
      if (!clonedConfig) {
        // no config -> just click original add button
        const origAdd = activeMenuItem.querySelector('.add-btn');
        origAdd && origAdd.click();
        closeProductModal();
        return;
      }

      // copy selects by name (or position) and checkboxes by data-addon-key / label text
      try {
        // Selects
        const clonedSelects = Array.from(clonedConfig.querySelectorAll('select'));
        clonedSelects.forEach(cs => {
          const name = cs.name;
          if (!name) return;
          const orig = activeMenuItem.querySelector(`select[name="${name}"]`);
          if (orig) orig.value = cs.value;
          // trigger change event on orig so price update listeners run
          if (orig) orig.dispatchEvent(new Event('change', { bubbles: true }));
        });

        // Checkboxes (addons)
        const clonedCbs = Array.from(clonedConfig.querySelectorAll('input[type="checkbox"]'));
        clonedCbs.forEach(ccb => {
          const key = ccb.dataset.addonKey;
          // try matching by data-addon-key first
          let origCb = key ? activeMenuItem.querySelector(`input.addon-checkbox[data-addon-key="${key}"]`) : null;
          // fallback: match by label text (span)
          if (!origCb) {
            const labelText = ccb.closest('.addon')?.querySelector('span')?.innerText?.trim();
            if (labelText) {
              origCb = Array.from(activeMenuItem.querySelectorAll('.addon')).map(a=>({el:a, txt:a.querySelector('span')?.innerText?.trim()})).find(x=>x.txt===labelText)?.el?.querySelector('input[type="checkbox"]') || null;
            }
          }
          if (origCb) {
            origCb.checked = !!ccb.checked;
            origCb.dispatchEvent(new Event('change', { bubbles: true }));
          }
        });

        // After copying inputs back to original, click the original add button to use existing cart logic
        const origAddBtn = activeMenuItem.querySelector('.add-btn');
        if (origAddBtn) {
          origAddBtn.click();
          // close modal shortly after
          setTimeout(() => closeProductModal(), 260);
        } else {
          // fallback: just close and show toast
          closeProductModal();
          console.warn('Original add button not found for item', activeMenuItem);
        }
      } catch (err) {
        console.error('Error copying modal selections back to original item:', err);
        closeProductModal();
      }
    });

    // cancel/close handlers
    pmCancel.addEventListener('click', closeProductModal);
    pmClose.addEventListener('click', closeProductModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeProductModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && modal.style.display === 'flex') closeProductModal(); });

    // Attach openers initially and whenever new menu items might be added later (MutationObserver)
    attachOpeners();
    const menuGrid = document.getElementById('menu-grid');
    if (menuGrid) {
      const mo = new MutationObserver(() => attachOpeners());
      mo.observe(menuGrid, { childList: true, subtree: true });
    }
  });
})();
</script>
  <!-- Task 3: Promo slideshow (paste after your scripts, before </body>) -->
<style>
/* Promo slideshow styles — mobile-first, uses your accent variables */
.promo-carousel {
  width:100%;
  max-width: var(--max-width,420px);
  margin: 8px auto 18px;
  position: relative;
  box-sizing: border-box;
  overflow: visible;
}
.promo-carousel .pc-slides { position: relative; width:100%; height: 42vh; min-height:220px; border-radius:14px; overflow: clip; box-shadow: var(--card-shadow); }
.promo-carousel .pc-slide {
  position: absolute; inset:0;
  display: none;
  will-change: transform, opacity;
  transition: opacity 520ms cubic-bezier(.2,.9,.3,1), transform 520ms cubic-bezier(.2,.9,.3,1);
  background-size: cover;
  background-position: center;
}
.promo-carousel .pc-slide.is-active { display:block; opacity:1; transform: none; }
.promo-carousel .pc-slide .overlay {
  position:absolute; inset:0;
  background: linear-gradient(180deg, rgba(0,0,0,0.18) 0%, rgba(0,0,0,0.55) 70%);
  display:flex; align-items:flex-end; padding:14px; box-sizing:border-box;
}
.promo-card {
  width:100%;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-radius: 12px;
  padding: 12px;
  box-sizing:border-box;
  backdrop-filter: blur(6px) saturate(120%);
  display:flex; gap:10px; align-items:center;
}
.promo-left { flex:0 0 72px; display:flex; align-items:center; justify-content:center; }
.promo-left .pc-ico { font-size:34px; color: #fff; opacity:0.98; text-shadow: 0 6px 20px rgba(0,0,0,0.6); }
.promo-right { flex:1 1 auto; min-width:0; display:flex; flex-direction:column; gap:6px; }
.promo-eyebrow { font-size:12px; color:var(--accent-2); font-weight:900; text-transform:uppercase; letter-spacing:0.8px; }
.promo-title { font-size:16px; font-weight:900; color:#fff; margin:0; line-height:1.05; }
.promo-desc { font-size:13px; color: rgba(255,255,255,0.9); }
.promo-cta-row { display:flex; gap:8px; margin-top:8px; align-items:center; }
.promo-cta-row .btn { min-height:40px; padding:8px 12px; font-weight:900; border-radius:10px; }

.promo-controls { position:absolute; left:12px; right:12px; bottom:12px; display:flex; align-items:center; justify-content:space-between; gap:8px; pointer-events:none; }
.pc-dots { display:flex; gap:8px; align-items:center; pointer-events:auto; }
.pc-dot { width:8px; height:8px; border-radius:999px; background: rgba(255,255,255,0.18); border:1px solid rgba(255,255,255,0.04); padding:0; }
.pc-dot.is-active { width:34px; background: linear-gradient(90deg,var(--accent-1),var(--accent-2)); box-shadow: 0 8px 20px rgba(255,106,0,0.14); border-radius:999px; }

.pc-nav { display:flex; gap:8px; pointer-events:auto; }
.pc-nav .icon-btn { background: rgba(0,0,0,0.45); color:#fff; border-radius:10px; padding:8px; }

@media (max-width:360px){
  .promo-left { flex:0 0 56px; }
  .promo-left .pc-ico { font-size:28px; }
  .promo-title { font-size:15px; }
  .promo-card { padding:10px; border-radius:10px; }
}
</style>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const promoContainer = document.getElementById('promo-details');
    if (!promoContainer) return;

    // Build carousel markup (2 slides)
    promoContainer.innerHTML = `
      <div class="promo-carousel" aria-roledescription="carousel" aria-label="Promotions carousel">
        <div class="pc-slides" id="pc-slides">
          <section class="pc-slide" data-index="0" id="pc-slide-0" role="group" aria-roledescription="slide" aria-label="Shawarma Promo" style="background-image: url('promo-shawarma.jpg');">
            <div class="overlay">
              <div class="promo-card">
                <div class="promo-left"><i class="fa fa-fire pc-ico" aria-hidden="true"></i></div>
                <div class="promo-right">
                  <div class="promo-eyebrow">Limited • Tuesday</div>
                  <h3 class="promo-title">Buy 2 Shawarmas — Get 1 Free</h3>
                  <div class="promo-desc">Add 2 qualifying shawarmas at checkout on Tuesdays and the third becomes free automatically. Applies per 3 items.</div>
                  <div class="promo-cta-row">
                    <button class="btn primary" data-action="apply-promo" data-promo-code="TUES-B2G1" aria-label="Claim Shawarma promo"><i class="fa fa-tag"></i> Claim Promo</button>
                    <button class="btn ghost" data-action="promo-details" data-target="shawarma" aria-expanded="false"><i class="fa fa-info-circle"></i> Details</button>
                    <button class="btn primary" data-action="preorder-promo"><i class="fa fa-calendar-check"></i> Preorder</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="pc-slide" data-index="1" id="pc-slide-1" role="group" aria-roledescription="slide" aria-label="Loaded Fries Promo" style="background-image: url('promo-fries.jpg');">
            <div class="overlay">
              <div class="promo-card">
                <div class="promo-left"><i class="fa fa-bolt pc-ico" aria-hidden="true"></i></div>
                <div class="promo-right">
                  <div class="promo-eyebrow">Freebie • All Days (promo hours)</div>
                  <h3 class="promo-title">Loaded Fries → Free Coke</h3>
                  <div class="promo-desc">Buy qualifying Loaded Fries during promo hours and get a free Coke added to your cart automatically.</div>
                  <div class="promo-cta-row">
                    <button class="btn primary" data-action="apply-promo" data-promo-code="FRIES-FCOKE" aria-label="Claim Fries promo"><i class="fa fa-tag"></i> Claim Promo</button>
                    <button class="btn ghost" data-action="promo-details" data-target="fries" aria-expanded="false"><i class="fa fa-info-circle"></i> Details</button>
                    <button class="btn primary" data-action="preorder-promo"><i class="fa fa-calendar-check"></i> Preorder</button>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="promo-controls" aria-hidden="false">
          <div class="pc-nav">
            <button class="slide-prev icon-btn" aria-label="Previous promo"><i class="fa fa-chevron-left"></i></button>
          </div>

          <div class="pc-dots" role="tablist" aria-label="Promo slides">
            <button class="pc-dot is-active" data-index="0" aria-label="Slide 1"></button>
            <button class="pc-dot" data-index="1" aria-label="Slide 2"></button>
          </div>

          <div class="pc-nav">
            <button class="slide-next icon-btn" aria-label="Next promo"><i class="fa fa-chevron-right"></i></button>
          </div>
        </div>
      </div>

      <!-- hidden area for details text toggling -->
      <div id="promo-more" class="promo-help hidden" style="margin-top:10px;">
        <div class="glass-card">
          <div id="promo-more-content" class="small muted"></div>
        </div>
      </div>
    `;

    // Slide behavior
    const slides = Array.from(document.querySelectorAll('.pc-slide'));
    const dots = Array.from(document.querySelectorAll('.pc-dot'));
    const prevBtn = document.querySelector('.slide-prev');
    const nextBtn = document.querySelector('.slide-next');
    let current = 0;
    let autoTimer = null;
    const AUTO_DELAY = 6000;

    function showSlide(idx) {
      idx = (idx + slides.length) % slides.length;
      slides.forEach((s,i) => {
        s.classList.toggle('is-active', i===idx);
        s.setAttribute('aria-hidden', i===idx ? 'false' : 'true');
      });
      dots.forEach((d,i) => d.classList.toggle('is-active', i===idx));
      current = idx;
    }

    function nextSlide() { showSlide(current+1); }
    function prevSlide() { showSlide(current-1); }

    // auto-rotate
    function startAuto() { stopAuto(); autoTimer = setInterval(() => nextSlide(), AUTO_DELAY); }
    function stopAuto() { if (autoTimer) { clearInterval(autoTimer); autoTimer = null; } }

    // event listeners
    nextBtn?.addEventListener('click', (e) => { e.preventDefault(); nextSlide(); startAuto(); });
    prevBtn?.addEventListener('click', (e) => { e.preventDefault(); prevSlide(); startAuto(); });
    dots.forEach(d => d.addEventListener('click', () => { showSlide(Number(d.dataset.index)); startAuto(); }));

    // pause on hover / touchstart
    const carouselEl = document.querySelector('.promo-carousel');
    carouselEl?.addEventListener('mouseenter', stopAuto);
    carouselEl?.addEventListener('mouseleave', startAuto);
    carouselEl?.addEventListener('touchstart', stopAuto, {passive:true});
    carouselEl?.addEventListener('touchend', startAuto, {passive:true});

    // init
    showSlide(0);
    startAuto();

    // Promo CTA handlers: Claim Promo, Details, Preorder
    function showToast(msg, t = 2200) {
      let tEl = document.querySelector('.wrap-toast');
      if (!tEl) { tEl = document.createElement('div'); tEl.className = 'toast wrap-toast'; document.body.appendChild(tEl); }
      tEl.textContent = msg;
      tEl.classList.add('show');
      setTimeout(()=> tEl.classList.remove('show'), t);
    }

    // Claim buttons: record in localStorage and show quick feedback
    promoContainer.querySelectorAll('button[data-action="apply-promo"]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const code = btn.dataset.promoCode || 'UNKNOWN';
        // store claim flag (not tied to cart logic yet)
        try { localStorage.setItem('wrap_claimed_promo_'+code, JSON.stringify({ ts: Date.now() })); } catch (err) {}
        showToast('Promo claimed: ' + code + '. Add qualifying items at checkout.');
        btn.classList.add('is-claimed');
      });
    });

    // Details toggles: show more copy in #promo-more-content
    const detailsMap = {
      'shawarma': `<strong>Shawarma Promo (Buy 2 Get 1 Free)</strong><br>
                   Promo works per 3 Shawarmas. On Tuesdays, the cheapest of each group of 3 will be discounted to free automatically at checkout. Add 2 qualifying shawarmas to your cart and the third will appear as a free line.`,
      'fries': `<strong>Loaded Fries (Free Coke)</strong><br>
                Buy a qualifying Loaded Fries during promo hours and we will add a free Coke to your cart. If not auto-added, use the "Add missing items" helper inside the cart.`
    };
    promoContainer.querySelectorAll('button[data-action="promo-details"]').forEach(btn => {
      btn.addEventListener('click', () => {
        const t = btn.dataset.target;
        const content = detailsMap[t] || 'More promo details coming soon.';
        const more = document.getElementById('promo-more');
        const moreContent = document.getElementById('promo-more-content');
        moreContent.innerHTML = content;
        more.classList.toggle('hidden');
        const expanded = btn.getAttribute('aria-expanded') === 'true';
        btn.setAttribute('aria-expanded', String(!expanded));
      });
    });

    // Preorder buttons: reuse your existing `data-action="preorder-promo"` behavior by triggering click on any matching element (your earlier script opened preorder modal for these)
    promoContainer.querySelectorAll('[data-action="preorder-promo"]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        // Try to find existing preorder openers; trigger their click if present, else open #preorder-modal directly
        const opener = document.querySelector('[data-action="preorder-promo"], #promo-preorder-btn');
        if (opener && opener !== btn) opener.click(); // your other script listens on those and will open modal
        else {
          const pm = document.getElementById('preorder-modal');
          if (pm) { pm.style.display = 'flex'; pm.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
        }
      });
    });

    // keyboard navigation for dots (left/right)
    document.addEventListener('keydown', (e) => {
      if (document.activeElement && document.activeElement.tagName === 'INPUT') return; // don't interfere with typing
      if (e.key === 'ArrowRight') { nextSlide(); startAuto(); }
      if (e.key === 'ArrowLeft') { prevSlide(); startAuto(); }
    });
  });
})();
</script>
  <!-- END BODY -->
</body>
<!-- REPLACEMENT: Complete Preorder wiring + resilient cart toggle -->
<script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    /* ---------- Preorder modal wiring ---------- */
    const preorderModal = document.getElementById('preorder-modal');
    const preorderClose = document.getElementById('preorder-close');
    const preorderCancel = document.getElementById('preorder-cancel');
    const preorderForm = document.getElementById('preorder-form');
    const preorderName = document.getElementById('preorder-name');
    const preorderPhone = document.getElementById('preorder-phone');
    const preorderNote = document.getElementById('preorder-note');
    const preorderOpeners = Array.from(document.querySelectorAll('[data-action="preorder-promo"], #promo-preorder-btn'));

    function openPreorder() {
      if (!preorderModal) return;
      preorderModal.style.display = 'flex';
      preorderModal.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      setTimeout(()=> { try { preorderName && preorderName.focus(); } catch(e){} }, 80);
    }
    function closePreorder() {
      if (!preorderModal) return;
      preorderModal.style.display = 'none';
      preorderModal.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    // attach openers
    preorderOpeners.forEach(btn => {
      try { btn.addEventListener('click', (ev) => { ev.preventDefault(); openPreorder(); }); } catch(e){}
    });

    // close/cancel handlers
    preorderClose && preorderClose.addEventListener('click', closePreorder);
    preorderCancel && preorderCancel.addEventListener('click', closePreorder);
    preorderModal && preorderModal.addEventListener('click', (ev) => { if (ev.target === preorderModal) closePreorder(); });

    // submit handler: light client-side save + feedback
    if (preorderForm) {
      preorderForm.addEventListener('submit', (ev) => {
        ev.preventDefault();
        try {
          const name = (preorderName && preorderName.value || '').trim();
          const phone = (preorderPhone && preorderPhone.value || '').trim();
          const note = (preorderNote && preorderNote.value || '').trim();

          if (!name || !phone) {
            alert('Please provide both name and phone to preorder.');
            return;
          }

          const payload = { name, phone, note, ts: Date.now() };
          // persist locally (replace with server call if you have one)
          try { localStorage.setItem('wrap_preorder_' + Date.now(), JSON.stringify(payload)); } catch(e){}

          // lightweight UX feedback (replace with a nicer toast if you have)
          alert('Preorder saved. We will contact you via phone/WhatsApp to confirm.');
          closePreorder();
        } catch (err) {
          console.error('Preorder submit error', err);
          alert('Could not save preorder. See console for details.');
        }
      });
    }

    /* ---------- CART DRAWER TOGGLE (resilient, minimal) ---------- */
    const cartToggle = document.getElementById('cart-toggle');
    const cartDrawer = document.getElementById('cart-drawer');
    const cartClose = document.getElementById('cart-close');

    function openCart() {
      if (!cartDrawer) return;
      cartDrawer.style.display = 'block';
      cartDrawer.setAttribute('aria-hidden','false');
      // ensure transform/opacity match your CSS visible state
      cartDrawer.style.transform = 'translateX(0)';
      cartDrawer.style.opacity = '1';
      document.body.style.overflow = 'hidden';
      try { cartDrawer.focus(); } catch(e){}
    }
    function closeCart() {
      if (!cartDrawer) return;
      cartDrawer.style.transform = 'translateX(110%)';
      cartDrawer.style.opacity = '0';
      cartDrawer.setAttribute('aria-hidden','true');
      // wait for CSS transition to finish then hide to avoid flicker
      setTimeout(()=> {
        try { if (cartDrawer.getAttribute('aria-hidden') === 'true') cartDrawer.style.display = 'none'; } catch(e){}
        document.body.style.overflow = '';
      }, 420);
    }

    // toggle on click
    if (cartToggle) {
      cartToggle.addEventListener('click', (ev) => {
        const open = cartDrawer && cartDrawer.getAttribute('aria-hidden') === 'false';
        if (open) closeCart(); else openCart();
      });
    }

    // close button inside drawer
    if (cartClose) cartClose.addEventListener('click', closeCart);

    // escape key closes drawer / preorder
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape') {
        if (cartDrawer && cartDrawer.getAttribute('aria-hidden') === 'false') closeCart();
        if (preorderModal && preorderModal.getAttribute('aria-hidden') === 'false') closePreorder();
      }
    });

    // defensive: if cart-drawer is already visible (maybe from server markup), keep aria consistent
    if (cartDrawer && cartDrawer.style.display !== 'none' && cartDrawer.getAttribute('aria-hidden') === 'true') {
      cartDrawer.setAttribute('aria-hidden','false');
    }
  });
})();
</script>

  <!-- Cart footer enhancement: paste after your main script and before </body> -->
<style>
/* Override / enhancement for cart drawer footer behavior */
.cart-drawer {
  /* make the drawer a column flex container so footer stays pinned */
  display: flex !important;
  flex-direction: column;
  justify-content: space-between;
  height: 100vh;          /* fill viewport so footer anchors to bottom */
  overflow: hidden;       /* inner scrolling happens in .cart-body */
}

/* .cart-body becomes the scrollable area */
.cart-body {
  flex: 1 1 auto;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  /* ensure content never gets hidden under footer */
  padding-bottom: calc(var(--cart-footer-h, 96px) + 18px);
}

/* footer pinned inside flex layout */
.cart-footer {
  position: relative;     /* keep it in flow but pinned to bottom via flex */
  z-index: 60;
  flex: 0 0 var(--cart-footer-h, 96px);
  height: var(--cart-footer-h, 96px);
  box-shadow: 0 -10px 36px rgba(0,0,0,0.55);
  border-top: 1px solid rgba(255,255,255,0.03);
  background: linear-gradient(180deg, rgba(6,6,6,0.98), rgba(8,8,8,0.98));
  box-sizing: border-box;
}

/* compact the footer on very small screens to avoid being too tall */
@media (max-width: 380px) {
  :root { --cart-footer-h: 84px; }
  .cart-footer { height: var(--cart-footer-h); }
  .footer-summary .total-label { font-size: 12px; }
  .footer-summary .total-value { font-size: 14px; }
}

/* ensure checkout button remains visible & tappable */
.cart-footer .footer-actions { align-items: center; gap: 8px; }
.cart-footer .btn.primary { min-width: 120px; }

/* small improvement: when drawer is open, slightly dim body (applies when JS adds class) */
body.cart-open::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.28);
  z-index: 1350; /* behind the drawer (drawer 1400) */
  pointer-events: none;
}
</style>

<script>
/* Cart footer behavior + totals sync
   Place after your main script. Non-invasive: doesn't rewrite your cart logic.
*/
(function () {
  document.addEventListener('DOMContentLoaded', () => {
    const cartDrawer = document.getElementById('cart-drawer');
    const cartToggle = document.getElementById('cart-toggle');
    const cartClose = document.getElementById('cart-close');
    const cartMiniCount = document.getElementById('cart-mini-count');
    const cartSubtotal = document.getElementById('cart-subtotal');
    const cartTotal = document.getElementById('cart-total');
    const footerSubtotal = document.getElementById('footer-subtotal');
    const footerTotal = document.getElementById('footer-total');

    if (!cartDrawer) return;

    // Ensure drawer is flex-column (in case some earlier CSS is applied late)
    cartDrawer.style.display = cartDrawer.style.display || 'block';

    // When the drawer opens/closes, toggle body scroll and add subtle dim
    function setDrawerOpen(open) {
      if (open) {
        cartDrawer.style.display = 'block';
        cartDrawer.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';     // prevent background scroll
        document.body.classList.add('cart-open');    // small dim overlay via CSS
        // ensure drawer gets focus for keyboard navigation
        cartDrawer.setAttribute('tabindex','-1');
        cartDrawer.focus && cartDrawer.focus();
      } else {
        cartDrawer.style.display = 'none';
        cartDrawer.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
        document.body.classList.remove('cart-open');
      }
    }

    // Attach to existing buttons (we add handlers in addition to your existing ones)
    cartToggle && cartToggle.addEventListener('click', (e) => {
      // If it's already open (aria-hidden false) then close, else open.
      const isOpen = cartDrawer.getAttribute('aria-hidden') === 'false' || cartDrawer.style.transform === 'translateX(0)';
      setDrawerOpen(!isOpen);
    });
    cartClose && cartClose.addEventListener('click', () => setDrawerOpen(false));

    // Also close drawer on Escape
    document.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape' && cartDrawer.getAttribute('aria-hidden') === 'false') {
        setDrawerOpen(false);
      }
    });

    // Small helper: sync the small footer totals with the main totals
    function syncFooterTotals(){
      try {
        if (cartSubtotal && footerSubtotal) footerSubtotal.innerText = cartSubtotal.innerText || footerSubtotal.innerText;
        if (cartTotal && footerTotal) footerTotal.innerText = footerTotal.innerText && cartTotal.innerText ? cartTotal.innerText : footerTotal.innerText;
      } catch (err) { /* ignore */ }
    }

    // Run once on start
    syncFooterTotals();

    // Watch for changes to the main totals and sync them to the footer
    const watchTargets = [];
    if (cartSubtotal) watchTargets.push(cartSubtotal);
    if (cartTotal) watchTargets.push(cartTotal);

    if (watchTargets.length) {
      const observer = new MutationObserver(() => { syncFooterTotals(); });
      watchTargets.forEach(el => {
        try {
          observer.observe(el, { characterData: true, childList: true, subtree: true });
        } catch (err) { /* fallback: periodic sync */ }
      });
      // fallback periodic sync in case mutationobserver couldn't attach
      setInterval(syncFooterTotals, 700);
    } else {
      // If those elements don't exist, still try to sync periodically
      setInterval(syncFooterTotals, 700);
    }

    // Also ensure cart-body scroll area is sized properly on orientation/resize
    function adjustCartBodyPadding() {
      const bodyEl = cartDrawer.querySelector('.cart-body');
      const footerEl = cartDrawer.querySelector('.cart-footer');
      if (!bodyEl || !footerEl) return;
      const footerH = footerEl.getBoundingClientRect().height || 96;
      // ensure bottom padding is at least footer height + 12px
      bodyEl.style.paddingBottom = (footerH + 18) + 'px';
    }
    window.addEventListener('resize', adjustCartBodyPadding);
    setTimeout(adjustCartBodyPadding, 120);
  });
})();
</script>
<script>
/* Persistent Cart — Replacement for your cart script
   Paste this in place of (or immediately after) your current cart script block.
   It preserves your UI behavior and adds localStorage persistence + menu selection restore.
*/
(function () {
  const q = (s, ctx = document) => ctx.querySelector(s);
  const qa = (s, ctx = document) => Array.from((ctx || document).querySelectorAll(s));
  const fmtGhc = (n) => `GHC ${Number(n).toFixed(0)}`;

  document.addEventListener('DOMContentLoaded', () => {
    // Elements
    const hamburger = q('#hamburger'), mobileNav = q('#mobile-nav'), navClose = q('#nav-close');
    const cartToggle = q('#cart-toggle'), cartDrawer = q('#cart-drawer'), cartClose = q('#cart-close');
    const cartCountBadge = q('#cart-count'), cartMiniCount = q('#cart-mini-count');
    const cartItemsList = q('#cart-items'), cartSubtotalEl = q('#cart-subtotal'), cartDeliveryEl = q('#cart-delivery'), cartTotalEl = q('#cart-total');
    const cartPromoBlock = q('#cart-promo'), promoDiscountEl = q('#promo-discount'), promoHelpText = q('#promo-help-text'), addMissingBtn = q('#add-missing');
    const checkoutBtn = q('#checkout-btn'), clearCartBtn = q('#clear-cart');
    const slidesWrap = q('#slides'), slideDots = qa('.dot'), slideElements = qa('.slide'), slidePrev = q('.slide-prev'), slideNext = q('.slide-next');
    const promoCountdownEl = q('#promo-timer'), entryPromoModal = q('#entry-promo'), entryCloseBtn = q('#entry-close');
    const claimPromoEntryBtn = q('#claim-promo-entry'), dontShowAgainCheckbox = q('#dont-show-again');

    // Storage keys (bump version if you change format later)
    const CART_KEY = 'wrap_cart_v2';
    const MENU_STATE_KEY = 'wrap_menu_state_v2';

    // App state
    // cart keys are unique per configuration: { key -> { id(key), baseId, title, unitPrice, qty, meta, imageSrc } }
    let cart = loadCartFromStorage();

    // Expose for other scripts that may read window.cart
    window.cart = cart;

    const promo = {
      // only active on Tuesdays (day 2). No "claimed" override — user requested Tue-only.
      activeDays: [2],
      isActive() {
        const now = new Date();
        return this.activeDays.includes(now.getDay());
      }
    };

    // slideshow state
    let slideIndex = 0, slideTimer = null, slideAutoDelay = 5000;

    // init small UI
    hamburger?.addEventListener('click', () => {
      const expanded = hamburger.getAttribute('aria-expanded') === 'true';
      hamburger.setAttribute('aria-expanded', String(!expanded));
      if (mobileNav) {
        mobileNav.setAttribute('aria-hidden', String(expanded));
        mobileNav.style.display = expanded ? 'none' : 'block';
      }
    });
    navClose?.addEventListener('click', () => {
      if (mobileNav) { mobileNav.style.display = 'none'; mobileNav.setAttribute('aria-hidden','true'); hamburger.setAttribute('aria-expanded','false'); }
    });
    cartToggle?.addEventListener('click', openCart);
    cartClose?.addEventListener('click', closeCart);
    addMissingBtn?.addEventListener('click', handleAddMissing);
    checkoutBtn?.addEventListener('click', handleCheckout);
    clearCartBtn?.addEventListener('click', handleClearCart);

    // entry promo handlers
    entryCloseBtn?.addEventListener('click', () => { entryPromoModal.classList.add('hidden'); });
    claimPromoEntryBtn?.addEventListener('click', () => {
      if (!promo.isActive()) {
        alert('The Tuesday promo applies only on Tuesdays. You will be able to claim it when it is Tuesday in your local time.');
        return;
      }
      alert('Promo is active — add qualifying items to see discounts at checkout (Tuesday).');
    });
    dontShowAgainCheckbox?.addEventListener('change', (e) => {
      if (e.target.checked) { localStorage.setItem('wrap_hide_entry_promo','1'); } else { localStorage.removeItem('wrap_hide_entry_promo'); }
    });

    // slideshow
    initSlideshow();

    // menu interactions & preview price
    initMenuInteractions();

    // restore menu selections saved previously (so UI stays the same after refresh)
    restoreMenuSelections();

    // promo countdown
    updatePromoCountdown();
    setInterval(updatePromoCountdown, 1000);

    // initial render (use renderCart defined below)
    renderCart();

    /* ----------------- Persistence helpers ----------------- */
    function saveCartToStorage() {
      try {
        localStorage.setItem(CART_KEY, JSON.stringify(cart));
        // also sync exposed window.cart
        window.cart = cart;
      } catch (err) {
        console.warn('Could not save cart to localStorage:', err);
      }
    }

    function loadCartFromStorage() {
      try {
        const raw = localStorage.getItem(CART_KEY);
        if (!raw) return {};
        const parsed = JSON.parse(raw);
        // ensure numbers are numbers
        Object.keys(parsed).forEach(k => {
          const l = parsed[k];
          l.unitPrice = Number(l.unitPrice) || 0;
          l.qty = Number(l.qty) || 0;
        });
        return parsed;
      } catch (err) {
        console.warn('Could not load cart from storage:', err);
        return {};
      }
    }

    function saveMenuSelections() {
      try {
        const state = {};
        qa('.menu-item').forEach(mi => {
          const id = mi.dataset.itemId;
          if (!id) return;
          const selects = {};
          qa('select', mi).forEach(s => { selects[s.name || s.className || s.dataset.item || 'select'] = s.value; });
          const addons = [];
          qa('input.addon-checkbox', mi).forEach(cb => { if (cb.checked) addons.push(cb.dataset.addonKey || cb.value || 'x'); });
          state[id] = { selects, addons };
        });
        localStorage.setItem(MENU_STATE_KEY, JSON.stringify(state));
      } catch (err) {
        console.warn('Could not save menu selections:', err);
      }
    }

    function restoreMenuSelections() {
      try {
        const raw = localStorage.getItem(MENU_STATE_KEY);
        if (!raw) return;
        const saved = JSON.parse(raw);
        Object.keys(saved).forEach(itemId => {
          const mi = q(`[data-item-id="${itemId}"]`);
          if (!mi) return;
          const info = saved[itemId];
          if (info.selects) {
            Object.keys(info.selects).forEach(name => {
              const sel = mi.querySelector(`select[name="${name}"]`);
              if (sel) sel.value = info.selects[name];
            });
          }
          if (Array.isArray(info.addons)) {
            qa('input.addon-checkbox', mi).forEach(cb => {
              cb.checked = info.addons.includes(cb.dataset.addonKey) || info.addons.includes(cb.value);
            });
          }
          // trigger a change so price recalculation picks up restored values
          mi.querySelectorAll('select, input[type="checkbox"]').forEach(el => el.dispatchEvent(new Event('change', { bubbles:true })));
        });
      } catch (err) {
        console.warn('Could not restore menu selections:', err);
      }
    }

    // Ensure menu selections saved whenever user interacts with selects/checkboxes
    document.addEventListener('change', (e) => {
      if (e.target && (e.target.tagName === 'SELECT' || (e.target.type === 'checkbox' && e.target.classList.contains('addon-checkbox')))) {
        // tiny debounce
        clearTimeout(document._saveMenuTimer);
        document._saveMenuTimer = setTimeout(() => { saveMenuSelections(); }, 180);
      }
    });

    /* ----------------- Cart & Menu logic (same API as your previous script) ----------------- */

    function openCart(){ cartDrawer.style.display='block'; cartDrawer.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
    function closeCart(){ cartDrawer.style.display='none'; cartDrawer.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }

    /* Slideshow */
    function initSlideshow(){
      slideElements.forEach((el, idx)=> {
        el.style.display = idx===slideIndex ? 'block' : 'none';
        el.setAttribute('aria-hidden', idx===slideIndex ? 'false' : 'true');
      });
      updateDots();
      slidePrev?.addEventListener('click', ()=> goToSlide((slideIndex - 1 + slideElements.length) % slideElements.length));
      slideNext?.addEventListener('click', ()=> goToSlide((slideIndex + 1) % slideElements.length));
      slideDots.forEach(dot => dot.addEventListener('click', () => goToSlide(Number(dot.dataset.index))));
      restartSlideTimer();
    }
    function restartSlideTimer(){ clearInterval(slideTimer); slideTimer = setInterval(()=> goToSlide((slideIndex+1)%slideElements.length), slideAutoDelay); }
    function goToSlide(idx){ if (idx===slideIndex) return; slideElements[slideIndex].style.display='none'; slideElements[slideIndex].setAttribute('aria-hidden','true'); slideIndex=idx; slideElements[slideIndex].style.display='block'; slideElements[slideIndex].setAttribute('aria-hidden','false'); updateDots(); restartSlideTimer(); }
    function updateDots(){ qa('.dot').forEach((dot,i)=> dot.classList.toggle('is-active', i===slideIndex)); }

    /* Menu interactions:
       - preview price updates when selects or addons change
       - when Add clicked, collect selects + addons into meta, compute price, create unique cart key, add to cart
    */
    function initMenuInteractions(){
      const menuItems = qa('.menu-item');
      menuItems.forEach(item => {
        updateItemPriceDisplay(item);
        item.addEventListener('change', () => updateItemPriceDisplay(item));

        const addBtn = q('.add-btn', item);
        const removeBtn = q('.remove-btn', item);

        addBtn?.addEventListener('click', () => {
          const baseId = item.dataset.itemId || 'item';
          // collect selected options
          const meta = {};
          qa('select', item).forEach(sel => {
            const key = sel.name || sel.dataset.item || sel.className || ('opt_'+Math.random().toString(36).slice(2,6));
            meta[key] = {
              value: sel.value,
              text: sel.options[sel.selectedIndex]?.text || ''
            };
          });
          // collect addons (labels)
          const addons = [];
          qa('input.addon-checkbox', item).forEach(cb => {
            if (cb.checked) {
              const ownerLabel = cb.closest('.addon');
              const labelText = ownerLabel?.querySelector('span')?.innerText || ownerLabel?.innerText || '';
              addons.push({ key: cb.dataset.addonKey || '', label: labelText, value: Number(cb.value) || 0 });
            }
          });
          if (addons.length) meta.addons = addons;

          const price = calculateItemPrice(item);
          const titleBase = q('.item-title', item)?.innerText?.trim() || baseId;
          const imageSrc = q('.item-thumb', item)?.src || '';

          // create a stable unique key per configuration
          const configId = encodeURIComponent(JSON.stringify({ baseId, meta }));
          const lineKey = `${baseId}::${configId}`;

          addToCart(lineKey, { baseId, title: titleBase, unitPrice: price, qty: 1, meta, imageSrc });

          // toggle buttons: show remove if any baseId in cart
          addBtn.classList.add('hidden');
          removeBtn.classList.remove('hidden');

          // save menu selections too (makes UI persistent)
          saveMenuSelections();
        });

        removeBtn?.addEventListener('click', () => {
          const baseId = item.dataset.itemId;
          const foundKey = Object.keys(cart).find(k => cart[k].baseId === baseId);
          if (foundKey) removeItemFully(foundKey);
          const addBtn = q('.add-btn', item), removeBtn2 = q('.remove-btn', item);
          addBtn?.classList.remove('hidden'); removeBtn2?.classList.add('hidden');
          saveMenuSelections();
        });
      });
    }

    function updateItemPriceDisplay(item){
      try {
        const price = calculateItemPrice(item);
        const displayEl = q('.price-value', item);
        if (displayEl) displayEl.innerText = Math.round(price);
        const priceWrap = q('.item-price', item);
        if (priceWrap) { priceWrap.classList.add('updated'); setTimeout(()=> priceWrap.classList.remove('updated'), 300); }
      } catch (err) {
        console.error('updateItemPriceDisplay error', err);
      }
    }

    function calculateItemPrice(itemElement){
      let total = 0;
      qa('select', itemElement).forEach(sel => { total += Number(sel.value) || 0; });
      qa('input.addon-checkbox', itemElement).forEach(cb => { if (cb.checked) total += Number(cb.value) || 0; });
      if (qa('select', itemElement).length === 0) {
        const fallback = Number(q('.price-value', itemElement)?.innerText || 0);
        if (fallback) total = fallback;
      }
      return Math.round(total);
    }

    /* ---------- Cart utilities ---------- */

    function addToCart(key, { baseId, title, unitPrice, qty = 1, meta = {}, imageSrc = '' } = {}) {
      if (!key) return;
      if (!cart[key]) {
        cart[key] = {
          id: key,
          baseId: baseId || (key.split('::')[0] || 'item'),
          title: title || 'Item',
          unitPrice: Number(unitPrice) || 0,
          qty: 0,
          meta: meta || {},
          imageSrc: imageSrc || ''
        };
      }
      cart[key].qty += Number(qty) || 1;
      cart[key].unitPrice = Number(unitPrice) || cart[key].unitPrice;
      cart[key].meta = meta || cart[key].meta;
      cart[key].imageSrc = imageSrc || cart[key].imageSrc;

      // persist
      saveCartToStorage();
      renderCart();
    }

    function removeItemFully(key) {
      if (!cart[key]) return;
      delete cart[key];
      saveCartToStorage();
      renderCart();
    }

    function changeItemQty(key, newQty) {
      if (!cart[key]) return;
      cart[key].qty = Math.max(0, Math.floor(newQty));
      if (cart[key].qty <= 0) delete cart[key];
      saveCartToStorage();
      renderCart();
    }

    function computeCartTotals() {
      let subtotal = 0, delivery = 0, promoDiscount = 0;
      const freeItemsToShow = [];
      Object.values(cart).forEach(line => { subtotal += (Number(line.unitPrice) || 0) * (Number(line.qty) || 0); });

      // Promo logic: Buy 2 Get 1 free for baseId 'shawarma' only on Tuesdays
      if (promo.isActive()) {
        const shawarmaLines = Object.values(cart).filter(l => l.baseId === 'shawarma');
        const shawarmaQty = shawarmaLines.reduce((s,l) => s + (l.qty||0), 0);
        if (shawarmaQty >= 3) {
          const freeCount = Math.floor(shawarmaQty / 3);
          let pricePool = [];
          shawarmaLines.forEach(l => { for (let i=0;i<l.qty;i++) pricePool.push(l.unitPrice); });
          pricePool.sort((a,b)=>a-b);
          let discount = 0;
          for (let i=0;i<freeCount;i++){ discount += Number(pricePool[i] || 0); }
          if (discount > 0) { promoDiscount = Math.round(discount); freeItemsToShow.push({ id:'free-shawarma', title: 'Free Shawarma (promo)', qty: freeCount, unitPrice: 0 }); }
        }
        const friesQty = Object.values(cart).filter(l => l.baseId === 'loaded-fries').reduce((s,l)=> s + (l.qty||0), 0);
        if (friesQty > 0) freeItemsToShow.push({ id:'free-coke', title: 'Free Coke (promo)', qty: friesQty, unitPrice: 0 });
      }

      const total = Math.max(0, subtotal - promoDiscount + delivery);
      return { subtotal, delivery, promoDiscount, total, freeItems: freeItemsToShow };
    }

    /* Render cart */
    function renderCart() {
      cartItemsList.innerHTML = '';
      const keys = Object.keys(cart);
      if (!keys.length) {
        cartItemsList.innerHTML = '<li class="empty">Your cart is empty. Add something delicious!</li>';
      } else {
        keys.forEach(key => {
          const line = cart[key];
          const li = document.createElement('li');
          li.className = 'cart-line';
          li.dataset.itemId = key;
          const metaLines = [];
          try {
            if (line.meta) {
              Object.keys(line.meta).forEach(k=>{
                if (k === 'addons' && Array.isArray(line.meta.addons)) {
                  metaLines.push('Extras: ' + line.meta.addons.map(a=>a.label||a.key).join(', '));
                } else {
                  const v = line.meta[k];
                  if (v && v.text) metaLines.push(`${k.replace(/[-_]/g,' ')}: ${v.text}`);
                }
              });
            }
          } catch(e){ }
          li.innerHTML = `
            <div style="display:flex;gap:12px;align-items:center;min-width:0">
              <img src="${escapeHtml(line.imageSrc||'')}" alt="${escapeHtml(line.title)}" style="width:68px;height:56px;object-fit:cover;border-radius:10px;flex:0 0 68px;border:1px solid rgba(255,255,255,0.04)">
              <div style="flex:1 1 auto;min-width:0">
                <strong class="line-title" style="display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escapeHtml(line.title)}</strong>
                <div class="line-meta" style="font-size:13px;color:rgba(255,255,255,0.8);margin-top:6px">
                  ${metaLines.length ? `<div style="font-weight:700">${metaLines.join(' • ')}</div>` : ''}
                  <div style="margin-top:6px">${fmtGhc(line.unitPrice)} × <span class="line-qty" style="font-weight:900">${line.qty}</span> = <strong style="display:inline-block;margin-left:6px">${fmtGhc(line.unitPrice * line.qty)}</strong></div>
                </div>
              </div>
            </div>
            <div class="line-controls" style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;justify-content:center">
              <button class="icon-btn cart-increase" aria-label="Increase quantity">+</button>
              <button class="icon-btn cart-decrease" aria-label="Decrease quantity">-</button>
              <button class="icon-btn cart-remove" aria-label="Remove item"><i class="fa fa-trash"></i></button>
            </div>
          `;
          cartItemsList.appendChild(li);
        });
      }

      const totals = computeCartTotals();

      // promo block
      if (totals.promoDiscount > 0) {
        promoDiscountEl.innerText = `-GHC ${Math.round(totals.promoDiscount)}`;
        promoHelpText.innerText = `Promo applied — discount: GHC ${Math.round(totals.promoDiscount)} (Tuesday only).`;
        cartPromoBlock.classList.remove('hidden');
      } else {
        const shawQty = Object.values(cart).filter(l => l.baseId === 'shawarma').reduce((s,l)=> s + (l.qty||0), 0);
        if (shawQty > 0 && promo.isActive()) {
          const missing = (3 - (shawQty % 3)) % 3;
          promoHelpText.innerText = `Add ${missing} more Shawarma${missing>1?'s':''} to get one free.`;
          cartPromoBlock.classList.remove('hidden');
        } else {
          cartPromoBlock.classList.add('hidden');
        }
      }

      (totals.freeItems || []).forEach(fi => {
        const li = document.createElement('li');
        li.className = 'cart-line cart-free';
        li.innerHTML = `
          <div class="line-left">
            <strong class="line-title">${escapeHtml(fi.title)}</strong>
            <div class="line-meta">Free × <span class="line-qty">${fi.qty}</span></div>
          </div>
          <div class="line-controls"></div>
        `;
        cartItemsList.appendChild(li);
      });

      cartSubtotalEl.innerText = fmtGhc(totals.subtotal);
      cartDeliveryEl.innerText = fmtGhc(totals.delivery);
      cartTotalEl.innerText = fmtGhc(totals.total);

      const cartCount = Object.values(cart).reduce((s,li) => s + (li.qty||0), 0);
      cartCountBadge.innerText = String(cartCount);
      cartMiniCount.innerText = String(cartCount);

      // attach cart control listeners (rebind after rerender)
      qa('.cart-increase', cartItemsList).forEach(btn => btn.addEventListener('click', (e) => {
        const key = e.target.closest('.cart-line').dataset.itemId;
        if (!key) return;
        changeItemQty(key, (cart[key].qty || 0) + 1);
      }));
      qa('.cart-decrease', cartItemsList).forEach(btn => btn.addEventListener('click', (e) => {
        const key = e.target.closest('.cart-line').dataset.itemId;
        if (!key) return;
        changeItemQty(key, (cart[key].qty || 0) - 1);
      }));
      qa('.cart-remove', cartItemsList).forEach(btn => btn.addEventListener('click', (e) => {
        const key = e.target.closest('.cart-line').dataset.itemId;
        if (!key) return;
        removeItemFully(key);
      }));

      // sync menu add/remove buttons (by baseId)
      qa('.menu-item').forEach(mi => {
        const baseId = mi.dataset.itemId;
        const addBtn = q('.add-btn', mi), removeBtn = q('.remove-btn', mi);
        const present = Object.values(cart).some(l => l.baseId === baseId && l.qty > 0);
        if (present) { addBtn?.classList.add('hidden'); removeBtn?.classList.remove('hidden'); } else { addBtn?.classList.remove('hidden'); removeBtn?.classList.add('hidden'); }
      });

      // persist after render as well (safety)
      saveCartToStorage();
    }

    function handleAddMissing() {
      const shawQty = Object.values(cart).filter(l => l.baseId === 'shawarma').reduce((s,l) => s + (l.qty||0), 0);
      const missing = (3 - (shawQty % 3)) % 3;
      if (missing === 0) { alert('You already qualify for the Buy 2 Get 1 promo for shawarma.'); return; }
      if (!promo.isActive()) { alert('Tuesday promo is only available on Tuesdays in your local time.'); return; }

      const menuEl = q('[data-item-id="shawarma"]');
      if (!menuEl) { alert('Shawarma item not found in menu.'); return; }
      const price = calculateItemPrice(menuEl);
      const title = q('.item-title', menuEl)?.innerText?.trim() || 'Shawarma';
      const imageSrc = q('.item-thumb', menuEl)?.src || '';
      const meta = {};
      qa('select', menuEl).forEach(sel => {
        const key = sel.name || sel.dataset.item || sel.className || ('opt_'+Math.random().toString(36).slice(2,6));
        meta[key] = { value: sel.value, text: sel.options[sel.selectedIndex]?.text || '' };
      });
      const addons = [];
      qa('input.addon-checkbox', menuEl).forEach(cb => { if (cb.checked) { const owner = cb.closest('.addon'); addons.push({ key: cb.dataset.addonKey || '', label: owner?.querySelector('span')?.innerText || '', value: Number(cb.value) || 0 }); } });
      if (addons.length) meta.addons = addons;

      const configId = encodeURIComponent(JSON.stringify({ baseId:'shawarma', meta }));
      const lineKey = `shawarma::${configId}`;

      for (let i=0;i<missing;i++) addToCart(lineKey, { baseId:'shawarma', title, unitPrice: price, qty:1, meta, imageSrc });
      renderCart(); openCart();
    }

    function handleCheckout(){
      const totals = computeCartTotals();
      let summary = 'ORDER SUMMARY:\\n';
      Object.values(cart).forEach(li => {
        summary += `${li.title} (${Object.keys(li.meta).length? 'configured':'default'}) x${li.qty} — ${fmtGhc(li.unitPrice * li.qty)}\\n`;
      });
      if (totals.promoDiscount > 0) summary += `Promo discount: -GHC ${Math.round(totals.promoDiscount)}\\n`;
      summary += `Subtotal: ${fmtGhc(totals.subtotal)}\\nDelivery: ${fmtGhc(totals.delivery)}\\nTotal: ${fmtGhc(totals.total)}\\n\\n`;
      summary += 'This is a simulated checkout. Integrate Paystack flow here.';
      alert(summary);
    }

    function handleClearCart(){
      if (!confirm('Clear all items from cart?')) return;
      cart = {};
      saveCartToStorage();
      renderCart();
    }

    function updatePromoCountdown(){
      const now = new Date();
      const day = now.getDay();
      const targetDay = 2; // Tuesday
      let daysUntil = (targetDay - day + 7) % 7;
      if (daysUntil === 0) {
        const endOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 23, 59, 59);
        const diff = endOfDay - now;
        promoCountdownEl && (promoCountdownEl.innerText = formatMs(diff));
        return;
      }
      const nextPromo = new Date(now.getFullYear(), now.getMonth(), now.getDate() + daysUntil, 0, 0, 0);
      const diff = nextPromo - now;
      promoCountdownEl && (promoCountdownEl.innerText = formatMs(diff));
    }
    function formatMs(ms) {
      if (ms <= 0) return '00:00:00';
      const secs = Math.floor(ms / 1000);
      const days = Math.floor(secs / 86400);
      const hours = Math.floor((secs % 86400) / 3600);
      const minutes = Math.floor((secs % 3600) / 60);
      const seconds = secs % 60;
      if (days > 0) return `${days}d ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
      return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }
    function pad(n){ return String(n).padStart(2,'0'); }

    function escapeHtml(str){ return String(str||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // End DOMContentLoaded
  });
})();
</script>
  <script>
(function(){
  document.addEventListener('DOMContentLoaded', () => {
    const cartToggle = document.getElementById('cart-toggle');
    const cartDrawer = document.getElementById('cart-drawer');
    const cartClose = document.getElementById('cart-close');
    const opener = cartToggle || document.querySelector('[data-open-cart]');

    function focusFirstInDrawer() {
      if (!cartDrawer) return;
      const focusable = cartDrawer.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (focusable) focusable.focus();
    }

    function openCart() {
      if (!cartDrawer) return;
      cartDrawer.style.display = 'block';
      // ensure no aria-hidden violation: blur any focused element that is inside the drawer before hiding it
      setTimeout(()=> { 
        cartDrawer.setAttribute('aria-hidden','false'); 
        focusFirstInDrawer();
        document.body.style.overflow = 'hidden';
      }, 10);
    }

    function closeCart() {
      if (!cartDrawer) return;
      cartDrawer.setAttribute('aria-hidden','true');
      cartDrawer.style.transform = 'translateX(110%)';
      cartDrawer.style.opacity = '0';
      setTimeout(()=> {
        cartDrawer.style.display = 'none';
        document.body.style.overflow = '';
        if (opener) opener.focus();
      }, 420);
    }

    if (cartToggle) cartToggle.addEventListener('click', (ev) => {
      ev.preventDefault();
      // If ensureOpenPositioning tries to call openCheckoutPage too early, delay briefly
      if (typeof window.openCheckoutPage !== 'function') {
        // short delay to allow other script to initialise (quick test)
        const waiter = setTimeout(()=> { try { openCart(); } catch(e){} }, 150);
        return;
      }
      openCart();
    });

    if (cartClose) cartClose.addEventListener('click', closeCart);

    document.addEventListener('keydown', (ev)=>{
      if (ev.key === 'Escape') closeCart();
    });
  });
})();
</script>

  <script>
(function(){
  // Robust helper to wait / patch global functions that may be defined later
  function whenDefined(propName, cb, interval = 50, timeout = 5000) {
    const start = Date.now();
    const id = setInterval(()=>{
      if (typeof window[propName] !== 'undefined') {
        clearInterval(id);
        cb(window[propName]);
      } else if (Date.now() - start > timeout) {
        clearInterval(id);
        cb(undefined, new Error(propName + ' not defined within timeout'));
      }
    }, interval);
  }

  /* ---------- Patch ensureOpenPositioning to avoid calling openCheckoutPage early ---------- */
  (function patchEnsureOpenPositioning(){
    // If ensureOpenPositioning already exists, wrap it. Otherwise wait for it to be defined then wrap.
    function wrap(originalFn){
      if (!originalFn || typeof originalFn !== 'function') return;
      const wrapped = function(...args){
        // If openCheckoutPage is not ready, wait briefly and then call (queue)
        if (typeof window.openCheckoutPage !== 'function') {
          console.warn('ensureOpenPositioning detected before openCheckoutPage initialised — delaying call');
          const waiter = setInterval(()=>{
            if (typeof window.openCheckoutPage === 'function') {
              clearInterval(waiter);
              try { originalFn.apply(this,args); } catch(e){ console.error(e); }
            }
          }, 60);
          // give up after a while so page doesn't hang forever
          setTimeout(()=> clearInterval(waiter), 6000);
          return;
        }
        return originalFn.apply(this,args);
      };
      // replace global fn
      try { window.ensureOpenPositioning = wrapped; } catch(e){ console.warn('Could not override ensureOpenPositioning', e); }
    }

    if (typeof window.ensureOpenPositioning === 'function') {
      wrap(window.ensureOpenPositioning);
    } else {
      // wait for it to appear and then wrap
      whenDefined('ensureOpenPositioning', (fn, err) => { if (fn) wrap(fn); });
    }
  })();

  /* ---------- Queue/defer openCheckoutPage calls until a real implementation appears ---------- */
  (function queueOpenCheckoutPage(){
    if (typeof window.openCheckoutPage === 'function') return; // nothing to do if already exists

    const queued = [];
    // temporary stub that collects calls
    window.openCheckoutPage = function(...args){
      queued.push(args);
      console.warn('openCheckoutPage called before definition — queued');
    };

    // watch for definition: if someone overwrites openCheckoutPage with a real function later, detect and flush
    const checkInterval = setInterval(()=>{
      // real function must be a different function than our stub (we can't reliably compare, so we check if the stub was replaced)
      if (typeof window.openCheckoutPage === 'function' && window.openCheckoutPage.toString().indexOf('queued') === -1) {
        // Found a replacement — flush queued calls
        const real = window.openCheckoutPage;
        clearInterval(checkInterval);
        setTimeout(()=> {
          try { queued.forEach(args => real.apply(window, args)); } catch(e){ console.error('Error flushing queued openCheckoutPage calls', e); }
        }, 10);
      }
    }, 60);
    // stop polling after a long timeout
    setTimeout(()=> clearInterval(checkInterval), 10000);
  })();

  /* ---------- Cart open/close with correct focus management (prevents aria-hidden focus block) ---------- */
  (function cartUI(){
    document.addEventListener('DOMContentLoaded', () => {
      const cartToggle = document.getElementById('cart-toggle') || document.querySelector('[data-open-cart]');
      const cartDrawer = document.getElementById('cart-drawer') || document.querySelector('.cart-drawer');
      const cartClose = document.getElementById('cart-close') || (cartDrawer && cartDrawer.querySelector('[data-close-cart], .cart-close'));

      if (!cartDrawer || !cartToggle) return;

      // helpers
      function firstFocusable(container){
        return container.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      }

      function openCart() {
        // show drawer before moving focus to avoid aria-hidden violation
        cartDrawer.style.display = 'block';
        // small delay to ensure display applied
        setTimeout(()=> {
          cartDrawer.setAttribute('aria-hidden', 'false');
          // move focus into drawer
          const f = firstFocusable(cartDrawer);
          if (f) f.focus();
          document.body.style.overflow = 'hidden';
        }, 8);
      }

      function closeCart() {
        // move focus out of drawer before hiding to avoid "descendant retained focus" error
        if (cartToggle) cartToggle.focus();
        cartDrawer.setAttribute('aria-hidden', 'true');
        // allow CSS transition to hide visually then remove from flow
        setTimeout(()=> {
          cartDrawer.style.display = 'none';
          document.body.style.overflow = '';
        }, 420);
      }

      cartToggle.addEventListener('click', (ev) => {
        ev.preventDefault();
        // If openCheckoutPage is required in ensureOpenPositioning, we patched it to wait.
        // Here we simply toggle the drawer safely.
        const isOpen = cartDrawer.getAttribute('aria-hidden') === 'false';
        if (isOpen) closeCart(); else openCart();
      });

      if (cartClose) cartClose.addEventListener('click', (ev)=> { ev.preventDefault(); closeCart(); });

      document.addEventListener('keydown', (ev)=>{
        if (ev.key === 'Escape' && cartDrawer.getAttribute('aria-hidden') === 'false') closeCart();
      });

      // Defensive: ensure aria-hidden and display state are consistent on load
      setTimeout(()=> {
        if (cartDrawer.style.display !== 'none' && cartDrawer.getAttribute('aria-hidden') !== 'false') {
          cartDrawer.setAttribute('aria-hidden','false');
        }
      }, 50);
    });
  })();

})();
</script>
  <script>
/* Fix: prevent cart drawer auto-opening on page refresh.
   Paste this at the end of the body (after your other scripts) */
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    const cart = document.getElementById('cart-drawer');
    if (!cart) return;

    // Ensure cart is visually hidden and aria state is closed
    cart.style.display = 'none';
    cart.setAttribute('aria-hidden','true');
    // keep transform/opacity consistent with your CSS hidden state
    cart.style.transform = 'translateX(110%)';
    cart.style.opacity = '0';
    // allow page scrolling
    try { document.body.style.overflow = ''; } catch(e){}

    // Clear any localStorage flags that some flows might use to auto-open the cart
    try {
      localStorage.removeItem('wrap_open_cart');
      localStorage.removeItem('wrap_show_cart');
      // also remove any order-confirmation auto-open keys you don't want
      // (only if you know you don't rely on them)
      // localStorage.removeItem('wrap_show_confirmation');
    } catch(e){ /* ignore storage errors */ }

    // Defensive: if another script flips aria-hidden to false immediately after load,
    // revert that automatic change. We stop observing after 350ms so legitimate later opens work.
    let handled = false;
    try {
      const mo = new MutationObserver(function(muts){
        if (handled) return;
        muts.forEach(m => {
          if (m.type === 'attributes') {
            const ah = cart.getAttribute('aria-hidden');
            if (ah === 'false') {
              // revert the unwanted open
              cart.setAttribute('aria-hidden','true');
              cart.style.display = 'none';
              cart.style.transform = 'translateX(110%)';
              cart.style.opacity = '0';
              handled = true;
            }
          }
        });
      });
      mo.observe(cart, { attributes: true, attributeFilter: ['aria-hidden','style'] });
      setTimeout(() => { try { mo.disconnect(); } catch(e){} }, 350);
    } catch (e) { /* MutationObserver not available => skip */ }
  });
})();
</script>
<script>

(function(){
  document.addEventListener('DOMContentLoaded', function(){

    function openCheckoutSafe(){
      // preferred: direct function that builds the in-page checkout
      if (typeof openCheckoutPage === 'function') {
        try { openCheckoutPage(); return; } catch(e){ console.warn('openCheckoutPage error', e); }
      }
      // fallback: if checkout-full modal exists, open it
      const checkoutFull = document.getElementById('checkout-full-modal');
      if (checkoutFull) { checkoutFull.setAttribute('aria-hidden','false'); checkoutFull.style.display = 'flex'; document.body.style.overflow='hidden'; return; }

      // last fallback: open cart drawer so user can at least see cart
      const cart = document.getElementById('cart-drawer');
      if (cart) { cart.style.display = 'block'; cart.setAttribute('aria-hidden','false'); document.body.style.overflow = 'hidden'; return; }

      // if nothing else, log for debugging
      console.warn('openCheckoutSafe: no checkout UI available.');
      alert('Checkout is not ready. Please try again.');
    }

    // elements we want to guarantee work
    const selectors = [
      '#checkout-btn',                // footer Pay
      '#cart-header-checkout',        // header checkout (if present)
      '.cart-footer .btn.primary',    // any primary buttons in cart footer
      '[data-action="checkout"]',     // fallback selectors
      '[data-action="pay"]'
    ];

    selectors.forEach(sel => {
      Array.from(document.querySelectorAll(sel)).forEach(el => {
        try {
          // ensure it behaves like a button
          if (el.tagName === 'BUTTON' && !el.hasAttribute('type')) el.setAttribute('type','button');

          // remove any inline onclick attribute that might interfere
          if (el.getAttribute && el.getAttribute('onclick')) el.removeAttribute('onclick');

          // remove prior capturing handlers that might block (defensive)
          el.addEventListener('click', function handler(e){
            e.preventDefault();
            e.stopPropagation && e.stopPropagation();
            // run the safe opener
            openCheckoutSafe();
          }, { passive: false, capture: true });
        } catch (err) {
          console.warn('bind checkout btn failed for', sel, err);
        }
      });
    });

    // Also delegate for future elements added dynamically
    document.body.addEventListener('click', function(e){
      const t = e.target.closest && e.target.closest(selectors.join(','));
      if (!t) return;
      e.preventDefault();
      e.stopPropagation && e.stopPropagation();
      openCheckoutSafe();
    }, { passive: false });
  });
})();
</script>

<script>
(function(){
  // ======== Config ========
  const HEADER_SELECTOR_CANDIDATES = ['.site-header', 'header', '.topbar', '.navbar', '.header'];
  const CART_DRAWER_IDS = ['cart-drawer', 'cartDrawer', 'drawer-cart', 'cart-drawer-modal'];
  const POLL_INTERVAL_MS = 1500; // fallback poll interval

  // ======== Utility: robustly get cart count from common places ========
  function parseCartObjectCount(obj) {
    try {
      if (!obj) return 0;
      // If array of items
      if (Array.isArray(obj)) return obj.length;
      // If object with 'items' array
      if (Array.isArray(obj.items)) {
        // sum quantities if present
        return obj.items.reduce((s, it) => s + (Number(it.quantity || it.qty || 1) || 0), 0);
      }
      // If object is mapping of id -> qty
      if (typeof obj === 'object') {
        const values = Object.values(obj);
        if (values.every(v => typeof v === 'number')) return values.reduce((a,b)=>a+b,0);
      }
    } catch(e){ console.warn('parseCartObjectCount error', e); }
    return 0;
  }

  function tryGetCartFromLocalStorage() {
    const keys = ['cart','cartItems','shoppingCart','CART','myCart'];
    for (const k of keys) {
      try {
        const raw = localStorage.getItem(k);
        if (!raw) continue;
        const parsed = JSON.parse(raw);
        const n = parseCartObjectCount(parsed);
        if (n > 0) return n;
      } catch(e){ /* ignore parse errors */ }
    }
    return null;
  }

  function tryCountFromDOM() {
    // If the app renders cart items into the DOM, count them
    const selectors = ['.cart-item', '.cart-row', '.cart-list .item', '[data-cart-item]'];
    for (const s of selectors) {
      const nodes = document.querySelectorAll(s);
      if (nodes && nodes.length) return nodes.length;
    }
    return 0;
  }

  function getCartCount() {
    // 1. If page/app exposes a known accessor
    try {
      if (typeof window.getCartCount === 'function') {
        const r = Number(window.getCartCount());
        if (!isNaN(r)) return r;
      }
      if (window.cart && (Array.isArray(window.cart.items) || typeof window.cart === 'object')) {
        const v = parseCartObjectCount(window.cart);
        if (v) return v;
      }
      if (window.cartItems && Array.isArray(window.cartItems)) return window.cartItems.length;
      if (window.CART && window.CART.items) {
        const v = parseCartObjectCount(window.CART);
        if (v) return v;
      }
      // 2. Try localStorage
      const ls = tryGetCartFromLocalStorage();
      if (ls !== null) return ls;
      // 3. DOM fallback
      const domCount = tryCountFromDOM();
      if (domCount) return domCount;
    } catch (e) {
      console.warn('getCartCount error', e);
    }
    return 0;
  }

  // ======== Create or find cart button in header ========
  function createCartButton() {
    // find header
    let header = null;
    for (const sel of HEADER_SELECTOR_CANDIDATES) {
      header = document.querySelector(sel);
      if (header) break;
    }
    if (!header) {
      // fallback to top of body
      header = document.body;
    }

    // check existing button by id or selector
    let btn = document.querySelector('#cart-icon-btn') || document.querySelector('.cart-icon-btn') || null;
    if (btn) return btn;

    // Build button
    btn = document.createElement('button');
    btn.id = 'cart-icon-btn';
    btn.className = 'cart-icon-btn';
    btn.type = 'button';
    btn.setAttribute('aria-label', 'Open cart (0)');
    btn.setAttribute('title', 'Cart');
    btn.setAttribute('data-role','cart-toggle');

    // Simple cart SVG + badge
    btn.innerHTML = `
      <svg class="cart-icon-svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path d="M7 4h-2l-1 2h2l2.68 7.39a2 2 0 0 0 1.9 1.36h7.36l.96-3.62A1 1 0 0 0 18.98 10H9.4" stroke="currentColor" stroke-width="1.2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="10" cy="20" r="1" />
        <circle cx="18" cy="20" r="1" />
      </svg>
      <span class="cart-badge" aria-hidden="true">0</span>
    `;

    // Put it into header: prefer end of header
    try {
      // try to attach into a right-side container if present
      const right = header.querySelector('.header-right, .nav-actions, .top-actions, .header-actions');
      if (right) right.appendChild(btn);
      else header.appendChild(btn);
    } catch (e) {
      document.body.appendChild(btn);
    }

    return btn;
  }

  // ======== Open cart drawer / fallback ========
  function openCartUI() {
    // preferred: call the site's exposed methods if any
    const tries = [
      () => (typeof openCartDrawer === 'function' && openCartDrawer()),
      () => (typeof openCart === 'function' && openCart()),
      () => (typeof toggleCart === 'function' && toggleCart()),
      () => (typeof showCart === 'function' && showCart()),
    ];
    for (const fn of tries) {
      try {
        const r = fn();
        if (r !== undefined) return; // assume it worked
      } catch(e){ /* ignore and continue */ }
    }
    // DOM-based attempts
    for (const id of CART_DRAWER_IDS) {
      const el = document.getElementById(id);
      if (el) {
        el.style.display = 'block';
        el.setAttribute('aria-hidden','false');
        el.focus && el.focus();
        return;
      }
    }
    // fallback: open checkout page if that's available
    if (typeof openCheckoutPage === 'function') {
      try { openCheckoutPage(); return; } catch(e){ /* ignore */ }
    }
    // last resort: show alert
    alert('Opening cart...');
  }

  // ======== Badge update & animation ========
  let lastCount = -1;
  let pulseTimeout = null;
  function updateBadge(elBadge) {
    if (!elBadge) return;
    const count = getCartCount();
    if (count === lastCount) return;
    lastCount = count;
    elBadge.textContent = count > 99 ? '99+' : String(count);
    const btn = elBadge.closest('.cart-icon-btn');
    if (btn) btn.setAttribute('aria-label', `Open cart (${count})`);
    // pulse animation
    elBadge.classList.add('pulse');
    clearTimeout(pulseTimeout);
    pulseTimeout = setTimeout(()=> elBadge.classList.remove('pulse'), 220);
  }

  // ======== Wrap common "add to cart" functions where present to auto-update badge ========
  function wrapIfFunction(name) {
    try {
      const orig = window[name];
      if (typeof orig === 'function') {
        window[name] = function wrapped(...args) {
          const res = orig.apply(this, args);
          // emit event or call update after a microtask
          setTimeout(()=> window.dispatchEvent(new CustomEvent('cart:updated')), 20);
          return res;
        };
      }
    } catch(e){ /* no-op */ }
  }

  // ======== Initialization ========
  function initCartIcon() {
    const btn = createCartButton();
    const badge = btn.querySelector('.cart-badge');

    // click handler
    btn.addEventListener('click', function(e){
      e.preventDefault();
      openCartUI();
    }, { passive: false });

    // update on load
    updateBadge(badge);

    // listen for custom events that your app might dispatch
    window.addEventListener('cart:updated', ()=> updateBadge(badge));
    // storage event to catch updates from other tabs
    window.addEventListener('storage', ()=> updateBadge(badge));

    // attempt to wrap common functions so the badge refreshes
    ['addToCart','addItemToCart','updateCart','removeFromCart','setCart'].forEach(wrapIfFunction);

    // MutationObserver: if the cart DOM changes, update
    const observer = new MutationObserver(() => updateBadge(badge));
    observer.observe(document.body, { childList: true, subtree: true });

    // Poll fallback (in case app doesn't emit events)
    setInterval(()=> updateBadge(badge), POLL_INTERVAL_MS);
  }

  // Wait for DOM and then init
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCartIcon);
  } else {
    initCartIcon();
  }
})();
</script>
<!-- ========== Small JS helper: modal scroll lock & close-by-esc ========== -->
<script>
(function(){
  // Simple helpers if your modal uses .modal and toggles .open / aria-hidden.
  function lockBody(lock) {
    if (lock) {
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
      document.body.style.paddingRight = window.innerWidth - document.documentElement.clientWidth + 'px';
    } else {
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
      document.body.style.paddingRight = '';
    }
  }

  document.addEventListener('click', function(e){
    // close modal on click outside content
    const modal = e.target.closest('.modal.open, .drawer.open');
    if (!modal) return;
    const inside = e.target.closest('.modal .modal-content, .drawer .drawer-content');
    const isCloseBtn = e.target.closest('.modal .close, .drawer .close, [data-modal-close]');
    if (!inside || isCloseBtn) {
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
      lockBody(false);
    }
  });

  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') {
      const open = document.querySelector('.modal.open, .drawer.open');
      if (open) {
        open.classList.remove('open');
        open.setAttribute('aria-hidden','true');
        lockBody(false);
      }
    }
  });

  // If script finds any open modal at init, lock body
  document.addEventListener('DOMContentLoaded', function(){
    if (document.querySelector('.modal.open, .drawer.open')) lockBody(true);
  });

  // when modal opens programmatically, developers can dispatch a custom event:
  // window.dispatchEvent(new CustomEvent('modal:opened',{detail:{el:myModal}}));
  window.addEventListener('modal:opened', function(e){
    lockBody(true);
    const el = e.detail && e.detail.el;
    if (el) {
      el.classList.add('open');
      el.setAttribute('aria-hidden','false');
    }
  });
})();
</script>
<script>
/* Robust global openCheckoutPage + queue + auto-bind cart buttons
   Paste this near the end of <body> (or inside your existing script block).
*/
(function(){
  // --- helper: body scroll lock (keeps existing logic consistent) ---
  function lockBody(lock) {
    if (lock) {
      document.documentElement.style.overflow = 'hidden';
      document.body.style.overflow = 'hidden';
      // avoid layout shift on many browsers by adding right padding equal to scrollbar
      var scrollBarWidth = window.innerWidth - document.documentElement.clientWidth;
      document.body.style.paddingRight = (scrollBarWidth > 0 ? scrollBarWidth + 'px' : '');
    } else {
      document.documentElement.style.overflow = '';
      document.body.style.overflow = '';
      document.body.style.paddingRight = '';
    }
  }

  // --- helper: try multiple likely selectors for your cart/drawer panel ---
  function findCartDrawer() {
    return document.querySelector(
      '#cart-drawer, .cart-drawer, [data-cart-drawer], .drawer[data-drawer="cart"], .cart-panel, .checkout-drawer'
    );
  }

  // --- queue for early calls (in case callers run before DOM ready / before drawer exists) ---
  window.__openCheckoutQueue = window.__openCheckoutQueue || [];

  // --- global function (exposed so inline onclick won't fail) ---
  window.openCheckoutPage = function(opts) {
    // opts unused for now but left for future extension
    var drawer = findCartDrawer();
    if (!drawer) {
      // If the drawer isn't in the DOM yet, queue the call and try later.
      console.warn('openCheckoutPage: cart drawer not found yet — queuing call.');
      window.__openCheckoutQueue.push(opts || true);
      return;
    }

    // Add 'open' class and aria attribute; match your site's convention if different
    drawer.classList.add('open');
    drawer.setAttribute('aria-hidden', 'false');

    // If drawer has an overlay sibling, show it (common pattern)
    var overlay = drawer.closest('body').querySelector('.modal-backdrop, .drawer-backdrop, .overlay');
    if (overlay) overlay.classList.add('open');

    lockBody(true);

    // Focus first interactive element inside drawer for accessibility
    var focusable = drawer.querySelector('button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])');
    if (focusable) focusable.focus();
  };

  // --- process any queued requests once DOM is ready and drawer likely exists ---
  function flushOpenQueue() {
    if (!window.__openCheckoutQueue || window.__openCheckoutQueue.length === 0) return;
    var q = window.__openCheckoutQueue.slice();
    window.__openCheckoutQueue = [];
    q.forEach(function(opts){ window.openCheckoutPage(opts); });
  }

  // --- attach click handlers to cart icons/buttons (common classes/attributes checked) ---
  function attachCartButtons() {
    var selectors = '.cart-icon-btn, [data-cart-open], .open-cart, .cart-toggle, .btn-open-cart';
    var buttons = document.querySelectorAll(selectors);
    buttons.forEach(function(btn){
      if (btn.__openHandlerAttached) return;
      btn.addEventListener('click', function(e){
        e.preventDefault();
        window.openCheckoutPage();
      });
      btn.__openHandlerAttached = true;
    });
  }

  // If someone closes the cart, remove open states and restore scroll
  function attachCloseLogic() {
    document.addEventListener('click', function(e){
      // close buttons inside drawer
      if (e.target.closest('.modal .close, .drawer .close, [data-modal-close], [data-drawer-close]')) {
        var open = document.querySelector('.modal.open, .drawer.open, .cart-drawer.open, .cart-drawer');
        if (open) {
          open.classList.remove('open');
          open.setAttribute('aria-hidden','true');
          lockBody(false);
        }
      }
    });
    // escape key
    document.addEventListener('keydown', function(e){
      if (e.key === 'Escape') {
        var open = document.querySelector('.modal.open, .drawer.open, .cart-drawer.open, .cart-drawer');
        if (open) {
          open.classList.remove('open');
          open.setAttribute('aria-hidden','true');
          lockBody(false);
        }
      }
    });
  }

  // Run attachers asap (cover case script runs after DOM loaded or before)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function(){
      attachCartButtons();
      attachCloseLogic();
      flushOpenQueue();
    });
  } else {
    attachCartButtons();
    attachCloseLogic();
    flushOpenQueue();
  }

  // also attempt to attach whenever new content is added (simple mutation observer)
  try {
    var mo = new MutationObserver(function(){
      attachCartButtons();
    });
    mo.observe(document.body, { childList: true, subtree: true });
  } catch (e) { /* ignore if MutationObserver not available */ }

})();
</script>

</html>
  
